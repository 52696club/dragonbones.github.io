"use strict";var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),common;!function(t){function e(t){for(var e in t)delete t[e]}function n(t){var e=String(t),n=l[e];return n||(n=l[e]=i(t)),n}function i(t){var e=u[String(t)];if(e&&e.length>0){var n=e.pop();return n}var i=new t;return i._onClear(),i}function o(t,e){if((0>e||e!==e)&&(e=0),t){var n=String(t),i=u[n];c[n]=e,i&&i.length>e&&(i.length=e)}else{a=e;for(var n in u){var i=u[n];i.length>e&&(i.length=e),n in c&&(c[n]=e)}}}function r(t){if(t){var e=u[String(t)];e&&e.length&&(e.length=0)}else for(var n in u){var e=u[n];e.length=0}}var a=3e3,s=0,l={},c={},u={};t.clearMap=e,t.getInstance=n,t.create=i,t.setMaxCount=o,t.clear=r;var p=function(){function t(){this.hashCode=s++}return t.toString=function(){throw new Error},t.prototype.release=function(){this._onClear();var t=String(this.constructor),e=t in c?a:c[t],n=u[t]=u[t]||[];n.length<e&&(console.assert(n.indexOf(this)<0),n.push(this))},t.prototype.dispose=function(){this._onClear()},t}();t.BaseObject=p,__reflect(p.prototype,"common.BaseObject")}(common||(common={}));var common;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return __extends(e,t),e.toString=function(){return"[class common.Event]"},e.prototype._onClear=function(){this.type="",this.target=null,this.currentTarget=null,this.data=null},e.prototype.copyFrom=function(t){return this.type=t.type,this.target=t.target,this.currentTarget=t.currentTarget,this.data=t.data,this},e}(t.BaseObject);t.Event=e,__reflect(e.prototype,"common.Event");var n=function(n){function i(){var t=null!==n&&n.apply(this,arguments)||this;return t._listenerBins={},t}return __extends(i,n),i.toString=function(){return"[class common.EventDispatcher]"},i.prototype._onClear=function(){this.enabled=!0,this._dipatchLevel=0,t.clearMap(this._listenerBins)},i.prototype._sortListeners=function(t,e){return t.priority>e.priority?1:-1},i.prototype._isSameListener=function(t,e){return t===e},i.prototype.hasEventListener=function(t){return t in this._listenerBins[t]},i.prototype.addEventListener=function(t,e,n,i,o){void 0===i&&(i=null),void 0===o&&(o=0),this.removeEventListener(t,e);var r=this._listenerBins[t];r?0!==this._dipatchLevel&&(this._listenerBins[t]=r=r.concat()):this._listenerBins[t]=r=[],r.push({listener:e,thisTarget:n,data:i,priority:o}),r.sort(this._sortListeners)},i.prototype.removeEventListener=function(t,e,n){void 0===n&&(n=null);var i=this._listenerBins[t];if(i){0!==this._dipatchLevel&&(this._listenerBins[t]=i=i.concat());for(var o=0,r=i.length;r>o;++o){var a=i[o];if(a.listener===e&&this._isSameListener(a.data,n)){i.splice(o,1);break}}}},i.prototype.removeEventListeners=function(t){if(t)delete this._listenerBins[t];else for(var e in this._listenerBins)delete this._listenerBins[e]},i.prototype.dispatchEvent=function(t){var e=t.type,n=this._listenerBins[e];if(n){t.target=this,t.currentTarget||(t.currentTarget=t.target),this._dipatchLevel++;for(var i=0,o=n;i<o.length;i++){var r=o[i];r.listener.call(r.thisTarget,t,r.data)}this._dipatchLevel--}},i.prototype.dispatchEventWith=function(n,i){if(this.enabled){var o=t.create(e);o.type=n,o.data=i,this.dispatchEvent(o),o.release()}},i}(t.BaseObject);t.EventDispatcher=n,__reflect(n.prototype,"common.EventDispatcher",["common.IEventDispatcher"])}(common||(common={}));var common;!function(t){function e(t,e){for(var n=0,i=e;n<i.length;n++){var o=i[n];if(o.component===t)return o}return null}function n(t){p.indexOf(t)<0&&p.push(t)}function i(t){var e=p.indexOf(t);e>=0&&p.splice(e,1)}t.getViewByComponent=e;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class common.Notification]"},e.prototype._onClear=function(){this.type="",this.target=null,this.data=null},e}(t.BaseObject);t.Notification=o,__reflect(o.prototype,"common.Notification");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this._context=null},e.prototype.sendNotification=function(t,e){this._context.sendNotification(t,e,this)},Object.defineProperty(e.prototype,"controller",{get:function(){return this._context.controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"application",{get:function(){return this._context.application},enumerable:!0,configurable:!0}),e}(t.BaseObject);t.Model=r,__reflect(r.prototype,"common.Model");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.model=null,this.component=null,this._context=null},e.prototype._notificationListenerHandler=function(t,e){e.call(this,t.data)},e.prototype.addNotification=function(t,e,n){void 0===n&&(n=0),this._context.addEventListener(t,this._notificationListenerHandler,this,e,n)},e.prototype.removeNotification=function(t,e){this._context.removeEventListener(t,this._notificationListenerHandler,e)},e.prototype.sendNotification=function(t,e){this._context.sendNotification(t,e,this)},e.prototype.initialize=function(t,e,n){this.model=t,this.component=e,this._onInitialize(n),this.update()},e.prototype.update=function(){},Object.defineProperty(e.prototype,"controller",{get:function(){return this._context.controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"application",{get:function(){return this._context.application},enumerable:!0,configurable:!0}),e}(t.EventDispatcher);t.View=a,__reflect(a.prototype,"common.View");var s=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.result=null,t}return __extends(r,e),r.prototype._onClear=function(){this.success=null,this.result=null,this._isRetained=!1,this._guard=null,this._hook=null,this._queue=null},r.prototype._retain=function(){this._isRetained=!0,n(this)},r.prototype._release=function(t){this.success=t,null!==this._hook&&this._hook(this),null!==this._queue&&(this.success?this._queue._next(this.result):this._queue._fail(this.result)),this._isRetained=!1,i(this)},r.prototype.execute=function(e,n,i){return void 0===n&&(n=null),void 0===i&&(i=null),e instanceof o?this.notification=e:(this.notification=t.create(o),this.notification.data=e),this._guard=n,this._hook=i,null===this._guard||this._guard(this)!==!1?(this._onExecute(),this.isRetained||null!==this.success||(this.success=!0),null===this._hook||this.isRetained||this._hook(this)):this.success=!0,this.result},r.prototype.sendNotification=function(t,e){this._context.sendNotification(t,e,null)},Object.defineProperty(r.prototype,"isRetained",{get:function(){return this._isRetained},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"data",{get:function(){return this.notification.data},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"application",{get:function(){return this._context.application},enumerable:!0,configurable:!0}),r}(t.BaseObject);t.Command=s,__reflect(s.prototype,"common.Command");var l=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._commandBins=[],t}return __extends(n,e),n.prototype._executeSubCommand=function(e,n,i,o){void 0===i&&(i=null),void 0===o&&(o=null),this._currentCommand=t.create(e),this._currentCommand._queue=this,this._currentCommand.execute(n,i,o)},n.prototype._onExecute=function(){this._next(this.notification.data)},n.prototype._next=function(t){if(this._commandBins.length>0){var e=this._commandBins.shift();e&&(this.notification.data=t,this._executeSubCommand(e.commandClass,this.notification,e.guard,e.hook),this._currentCommand.isRetained||(this._currentCommand.success?this._next(this._currentCommand.result):this._fail(this._currentCommand.result)))}else this.result=this._currentCommand.result,this._release(!0)},n.prototype._fail=function(t){this.result=t,this._release(!1)},n.prototype.addCommand=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null);var i={commandClass:t,guard:e,hook:n};this._commandBins.push(i)},n.prototype.insertCommand=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null);var i={commandClass:t,guard:e,hook:n};this._commandBins.unshift(i)},n}(s);t.QueueCommand=l,__reflect(l.prototype,"common.QueueCommand");var c=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.controller=t.create(u),n._application=null,n}return __extends(n,e),n.toString=function(){return"[class common.Context]"},n.prototype.release=function(){throw new Error},n.prototype._isSameListener=function(t,n){return t&&t.commandClass&&n?t.commandClass===n:e.prototype._isSameListener.call(this,t,n)},n.prototype.initialize=function(t){this._application=t,this.controller._context=this},n.prototype.sendNotification=function(e,n,i){if(void 0===i&&(i=null),this.enabled){var r=t.create(o);r.type=e,r.target=i,r.data=n,this.dispatchEventWith(e,r),r.release()}},n.prototype.getInstance=function(e){var n=t.getInstance(e);return n._context=this,n},n.prototype.create=function(e){var n=t.create(e);return n._context=this,n},Object.defineProperty(n.prototype,"application",{get:function(){return this._application},enumerable:!0,configurable:!0}),n}(t.EventDispatcher);t.Context=c,__reflect(c.prototype,"common.Context");var u=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.toString=function(){return"[class common.Controller]"},n.prototype._notificationHandler=function(t,e){this.execute(e.commandClass,t.data,e.guard,e.hook)},n.prototype._onClear=function(){this._context=null},n.prototype.register=function(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=null);var o={commandClass:e,guard:n,hook:i};this._context.addEventListener(t,this._notificationHandler,this,o)},n.prototype.unregister=function(t,e){var n={commandClass:e,guard:null,hook:null};this._context.removeEventListener(t,this._notificationHandler,n)},n.prototype.execute=function(e,n,i,o){void 0===i&&(i=null),void 0===o&&(o=null);var r=t.create(e);return r.execute(n,i,o)},n}(t.BaseObject);__reflect(u.prototype,"Controller");var p=[]}(common||(common={}));var player;!function(t){t.NotificationType={VOChange:"VOChange",ArmatureAdd:"ArmatureAdd",ArmatureRemove:"ArmatureRemove",ArmatureChange:"ArmatureChange",ArmatureReplace:"ArmatureReplace",AnimationStart:"AnimationStart",AnimationComplete:"AnimationComplete",AnimationChange:"AnimationChange"};var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(common.Model);t.BaseModel=e,__reflect(e.prototype,"player.BaseModel");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(common.View);t.BaseView=n,__reflect(n.prototype,"player.BaseView");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(common.Command);t.BaseCommand=i,__reflect(i.prototype,"player.BaseCommand");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.QueueCommand]"},e}(common.QueueCommand);t.QueueCommand=o,__reflect(o.prototype,"player.QueueCommand")}(player||(player={}));var Main=function(t){function e(){var e=t.call(this)||this;return e.armatureContainer=new egret.DisplayObjectContainer,e._context=common.create(common.Context),e.addChild(e.armatureContainer),e.addEventListener(egret.Event.ADDED_TO_STAGE,function(){var t=e._context.getInstance(player.Application),n=e._context.getInstance(player.ApplicationModel);if(e._context.initialize(t),t.initialize(n,e,null),t.queryConfig=player.getQueryConfig(window.location.search),t.queryConfig&&t.queryConfig.sources)player.loadRemoteData(t.queryConfig,function(e){t.model.vo=e});else{var i=document.getElementById("data");i&&(t.model.vo=player.loadInlineData(i.innerHTML))}t.queryConfig&&t.queryConfig.scaleMode&&(t.component.stage.scaleMode=t.queryConfig.scaleMode)},e),e}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var player;!function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.queryConfig=null,t}return __extends(n,e),n.toString=function(){return"[class player.Application]"},n.prototype._notificationHandler=function(e){switch(e.type){case t.NotificationType.VOChange:for(var n in this.model.factory.getAllDragonBonesData()){var i=this.model.factory.getDragonBonesData(n);if(i&&i.armatureNames.length>0){var o=null;o=i.stage?i.stage:i.getArmature(i.armatureNames[0]),o&&(this.model.armature=this.model.createArmature(o));break}}break;case t.NotificationType.ArmatureAdd:var r=e.data;r&&this.component.armatureContainer.addChild(r.component);break;case t.NotificationType.ArmatureRemove:var r=e.data;r&&this.component.armatureContainer.removeChild(r.component);break;case t.NotificationType.ArmatureChange:var r=this.model.armature;if(r){var o=r.component.armature.armatureData;if(o.canvas){if(this.component.stage.setContentSize(o.canvas.width,o.canvas.height),r.component.x=-o.canvas.x,r.component.y=-o.canvas.y,o.canvas.hasBackground){var a=document.getElementById("dragonBonesPlayer");a&&(a.style.backgroundColor="#"+o.canvas.color.toString(16))}}else this.component.stage.setContentSize(o.aabb.width,o.aabb.height),r.component.x=-(.5*o.aabb.width+o.aabb.x),r.component.y=-(.5*o.aabb.height+o.aabb.y);r.playAnimation()}break;case t.NotificationType.AnimationComplete:var r=this.model.armature;if(r&&r.animation){var s=r.component.armature.armatureData.animationNames;s.indexOf(r.animation.name)<s.length-1&&r.nextAnimation()}}},n.prototype._componentHandler=function(t){switch(t.type){case egret.Event.RESIZE:this.component.armatureContainer.x=.5*this.component.stage.stageWidth,this.component.armatureContainer.y=.5*this.component.stage.stageHeight;break;case egret.TouchEvent.TOUCH_END:var e=this.model.armature;e&&e.animation&&0===e.animation.playTimes&&e.nextAnimation()}},n.prototype._documentHandler=function(e){var n=this;switch(e.type){case"dragenter":case"dragover":e.stopPropagation(),e.preventDefault();break;case"drop":var i=e.dataTransfer;i&&i.files&&t.loadFiles(i.files,function(t){n.model.vo=t})}},n.prototype._onInitialize=function(){if(console.log("DragonBones Player 0.0.1"),this.addNotification(t.NotificationType.VOChange,this._notificationHandler),this.addNotification(t.NotificationType.ArmatureAdd,this._notificationHandler),this.addNotification(t.NotificationType.ArmatureRemove,this._notificationHandler),this.addNotification(t.NotificationType.ArmatureChange,this._notificationHandler),this.addNotification(t.NotificationType.AnimationComplete,this._notificationHandler),this.component.stage.addEventListener(egret.Event.RESIZE,this._componentHandler,this),this.component.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._componentHandler,this),!egret.Capabilities.isMobile){var e=document.body;e.addEventListener("dragenter",this._documentHandler),e.addEventListener("dragover",this._documentHandler),e.addEventListener("drop",this._documentHandler)}},n}(t.BaseView);t.Application=e,__reflect(e.prototype,"player.Application")}(player||(player={}));var common;!function(t){t.EventType={HistoryState:"HistoryState",HistoryAdd:"HistoryAdd",HistoryFree:"HistoryFree"};var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this.data=null,this._isDone=!1},e.prototype.undo=function(){return this._isDone?(this._isDone=!1,!0):!1},e.prototype.redo=function(){return this._isDone?!1:(this._isDone=!0,!0)},e}(t.BaseObject);t.BaseState=e,__reflect(e.prototype,"common.BaseState",["common.IState"]);var n=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._states=[],t._batchs=[],t}return __extends(n,e),n.toString=function(){return"[class common.History]"},n.prototype._onClear=function(){e.prototype._onClear.call(this);for(var t=0,n=this._states;t<n.length;t++){var i=n[t];i.release()}for(var o=0,r=this._batchs;o<r.length;o++){var a=r[o];a.release()}this.dispatcher=null,this._locked=0,this._index=-1,this._states.length=0,this._batchs.length=0},n.prototype._free=function(){this._states.length>this._index+1&&(this._states.length=this._index+1,null!==this.dispatcher&&this.dispatcher.dispatchEventWith(t.EventType.HistoryFree,null))},n.prototype._doState=function(e,n){if(n?e.undo():e.redo(),null!==this.dispatcher&&e.data){var i={isUndo:n,data:e.data};this.dispatcher.dispatchEventWith(t.EventType.HistoryState,i)}},n.prototype._getStateByObject=function(t,e,o,r){void 0===r&&(r=null);for(var a=t._states.length;a--;){var s=t._states[a];if(s instanceof i){if((null===r||s!==r)&&s.object===e&&s.key===o)return s}else if(s instanceof n){var l=this._getStateByObject(s,e,o,r);if(null!==l)return l}}return null},n.prototype.undo=function(){return this._batchs.length>0?!1:this.go(-1)},n.prototype.redo=function(){return this._batchs.length>0?!1:this.go(this._states.length-1)},n.prototype.back=function(){return this._index<0?!1:this._batchs.length>0?!1:(this._locked|=1,this._doState(this._states[this._index--],!0),this._locked&=2,!0)},n.prototype.forward=function(){return this._index>=this._states.length-1?!1:this._batchs.length>0?!1:(this._locked|=1,this._doState(this._states[++this._index],!1),this._locked&=2,!0)},n.prototype.go=function(t){if(this._batchs.length>0)return!1;var e=!1;if(this._index<t)for(;this._index!==t&&this.forward();)e=!0;else for(;this._index!==t&&this.back();)e=!0;return e},n.prototype.add=function(e){if(0===this._locked)if(this._batchs.length>0){var n=this._batchs[this._batchs.length-1];n.add(e)}else this._states[this._index+1]=e,null!==this.dispatcher&&this.dispatcher.dispatchEventWith(t.EventType.HistoryAdd,e),this.forward(),this._free()},n.prototype.addBatch=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(0!==this._locked)return null;var o=t.create(n);o.dispatcher=this.dispatcher;for(var r=0,a=e;r<a.length;r++){var s=a[r];o.add(s)}return this.add(o),o},n.prototype.beginBatch=function(){var e=t.create(n);return e.dispatcher=this.dispatcher,this._batchs.push(e),e},n.prototype.endBatch=function(t){if(void 0===t&&(t=null),!(this._batchs.length<1)){var e=this._batchs.pop();e.count<1||(e.data=t,e._locked|=2,this._batchs.length>0?this._batchs[this._batchs.length-1].add(e):this.add(e))}},n.prototype.linkObjectState=function(t,e){var n=this._getStateByObject(this,t,e);if(null!==n){var i=this._getStateByObject(this,t,e,n);null!==i&&(n.fromValue=i.toValue)}},n.prototype.getState=function(t){return this._states[t]},Object.defineProperty(n.prototype,"enabled",{get:function(){return 0===this._locked},set:function(t){t?this._locked&=2:this._locked|=1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this._states.length},enumerable:!0,configurable:!0}),n}(e);t.History=n,__reflect(n.prototype,"common.History");var i=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.toString=function(){return"[class common.ModifyObjectState]"},n.create=function(e,i,o,r){void 0===r&&(r=null);var a=i in e?e[i]:void 0;if(a===o)return null;var s=t.create(n);return s.object=e,s.key=i,s.data=r,s.fromValue=a,s.toValue=o,s},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.object=null,this.key="",this.fromValue=null,this.toValue=null},n.prototype.undo=function(){return e.prototype.undo.call(this)?(void 0!==this.fromValue?this.object[this.key]=this.fromValue:delete this.object[this.key],!0):!1},n.prototype.redo=function(){return e.prototype.redo.call(this)?(void 0!==this.toValue?this.object[this.key]=this.toValue:delete this.object[this.key],!0):!1},n}(e);t.ModifyObjectState=i,__reflect(i.prototype,"common.ModifyObjectState");var o=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.toString=function(){return"[class common.ModifyArrayState]"},n.create=function(e,i,o,r){void 0===r&&(r=null),0>i&&(i=e.length>0?e.length-1:0);var a=t.create(n);return a.array=e,a.index=i,a.data=r,o?a.toValue=o:a.fromValue=a.array[a.index],a},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.array=null,this.index=-1,this.fromValue=null,this.toValue=null},n.prototype.undo=function(){return e.prototype.undo.call(this)?(this.fromValue?this.array.splice(this.index,0,this.fromValue):this.array.splice(this.index,1),!0):!1},n.prototype.redo=function(){return e.prototype.redo.call(this)?(this.toValue?this.array.splice(this.index,0,this.toValue):this.array.splice(this.index,1),!0):!1},n}(e);t.ModifyArrayState=o,__reflect(o.prototype,"common.ModifyArrayState")}(common||(common={}));var player;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.armatures=[],t.factory=dragonBones.EgretFactory.factory,t._armature=null,t}return __extends(i,e),i.toString=function(){return"[class player.ApplicationModel]"},i.prototype.createArmature=function(e){var i=this.factory.buildArmatureDisplay(e.name,e.parent.name);if(i){var o=this._context.create(n);return o.initialize(null,i,null),this.armatures.push(o),this.sendNotification(t.NotificationType.ArmatureAdd,o),o}return null},i.prototype.removeArmature=function(e){this.armature===e&&(this.armature=null);var n=this.armatures.indexOf(e);console.assert(n>=0),this.armatures.splice(n,1),this.sendNotification(t.NotificationType.ArmatureRemove,e),e.release()},i.prototype.clearAllArmature=function(){for(var t=this.armatures.length;t--;){var e=this.armatures[t];this.removeArmature(e)}},i.prototype.replaceArmature=function(e){var n=this.armature,i=this.createArmature(e);n&&i&&(i.component.x=n.component.x,i.component.y=n.component.y),this.armature=i,this.sendNotification(t.NotificationType.ArmatureReplace,n),n&&this.removeArmature(n)},Object.defineProperty(i.prototype,"vo",{set:function(e){if(e){this.clearAllArmature(),this.factory.clear(!0);for(var n=0,i=e;n<i.length;n++){var o=i[n],r=this.factory.parseDragonBonesData(o.data);if(r)if(o.textureAtlasDatas.length>0)for(var a=0,s=0,l=o.textureAtlasDatas;s<l.length;s++){var c=l[s],u=o.textureAtlases[a];u?this.factory.parseTextureAtlasData(c,u):this.factory.parseTextureAtlasData(c,null)}else this.factory.updateTextureAtlasData(r.name,o.textureAtlases)}this.sendNotification(t.NotificationType.VOChange,null)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},set:function(e){if(this._armature!==e){var n=this._armature;this._armature=e,this.sendNotification(t.NotificationType.ArmatureChange,n)}},enumerable:!0,configurable:!0}),i}(t.BaseModel);t.ApplicationModel=e,__reflect(e.prototype,"player.ApplicationModel");var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.toString=function(){return"[class player.ArmatureView]"},n.prototype._componentHandler=function(e){var n=e.eventObject;switch(e.type){case dragonBones.EventObject.FADE_IN:if(this._animation===n.animationState)return;var i=this._animation;this._animation=n.animationState,i&&this._animation&&i.name===this._animation.name||this.sendNotification(t.NotificationType.AnimationChange,i),this.sendNotification(t.NotificationType.AnimationStart,this._animation);break;case dragonBones.EventObject.COMPLETE:this.sendNotification(t.NotificationType.AnimationComplete,this._animation)}},n.prototype._onClear=function(){this.component&&(this.component.removeEvent(dragonBones.EventObject.FADE_IN,this._componentHandler,this),this.component.removeEvent(dragonBones.EventObject.COMPLETE,this._componentHandler,this),this.component.dispose(!0)),e.prototype._onClear.call(this),this._animation=null},n.prototype._onInitialize=function(t){this.component.addEvent(dragonBones.EventObject.FADE_IN,this._componentHandler,this),this.component.addEvent(dragonBones.EventObject.COMPLETE,this._componentHandler,this)},n.prototype.changeAnimation=function(t){var e=this.component.armature.armatureData.animationNames;t%=e.length,0>t&&(t=e.length+t),this.component.animation.fadeIn(e[t])},n.prototype.playAnimation=function(t){void 0===t&&(t=null),t?this.component.animation.fadeIn(t):!this.component.animation.lastAnimationState||this.component.animation.lastAnimationState.isCompleted?this.component.animation.play():this.component.animation.lastAnimationState.play()},n.prototype.stopAnimation=function(){this.component.animation.lastAnimationState&&this.component.animation.lastAnimationState.stop()},n.prototype.prevAnimation=function(){if(this._animation){var t=this.component.armature.armatureData.animationNames;this.changeAnimation(t.indexOf(this._animation.name)-1)}else this.playAnimation()},n.prototype.nextAnimation=function(){if(this._animation){var t=this.component.armature.armatureData.animationNames;this.changeAnimation(t.indexOf(this._animation.name)+1)}else this.playAnimation()},Object.defineProperty(n.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),n}(t.BaseView);t.ArmatureView=n,__reflect(n.prototype,"player.ArmatureView")}(player||(player={}));var player;!function(t){function e(t){if(t.indexOf("?")>=0){for(var e={},n=void 0,i=/\+/g,o=/([^&=]+)=?([^&]*)/g,r=function(t){return decodeURIComponent(t.replace(i," "))},a=t.substring(1);n=o.exec(a);)e[r(n[1])]=r(n[2]);return e.sources&&"string"==typeof e.sources&&(e.sources=JSON.parse(e.sources)),e.armature&&"string"==typeof e.armature&&e.armature.indexOf(",")>0&&(e.armature=e.armature.split(",")),e.skin&&"string"==typeof e.skin&&e.skin.indexOf(",")>0&&(e.skin=e.skin.split(",")),e}return null}function n(t){for(var e=JSON.parse(t),n=new Array,i=0,r=e;i<r.length;i++){for(var a=r[i],s={data:o(a.data),textureAtlasDatas:[],textureAtlases:[]},l=0,c=a.textureAtlases;l<c.length;l++){var u=c[l],p=document.createElement("img");p.src="data:image/png;base64,"+u,s.textureAtlases.push(p)}n.push(s)}return n}function i(t,e){if(t.sources&&t.sources instanceof Array){var n,i=t.sources,o=null,a=new XMLHttpRequest,s=function(){if(o){if(null===n.data)a.response instanceof ArrayBuffer?n.data=a.response:n.data=JSON.parse(a.response);else if(n.textureAtlasDatas.length===n.textureAtlases.length)n.textureAtlasDatas.push(JSON.parse(a.response));else{var t=document.createElement("img");if(t.src="data:image/png;base64,"+r(a.response),n.textureAtlases.push(t),n.textureAtlases.length===o.textureAtlases.length)return void l()}if(n.textureAtlasDatas.length===n.textureAtlases.length){var e=o.textureAtlasDatas[n.textureAtlasDatas.length];e?(a.open("GET",e,!0),a.responseType="text",a.send()):n.textureAtlasDatas.push("")}else{var e=o.textureAtlases[n.textureAtlases.length];e?(a.open("GET",e,!0),a.responseType="arraybuffer",a.send()):n.textureAtlases.push(null)}}},l=function(){return 0===i.length?void f(_):(o=i.pop(),void(o?(n={data:null,textureAtlasDatas:[],textureAtlases:[]},_.push(n),a.open("GET",o.data,!0),o.data.indexOf(".json")<0?a.responseType="arraybuffer":a.responseType="text",a.send()):l()))};_.length=0,f=e,a.addEventListener("loadend",s),l()}}function o(t){for(var e=window.atob(t),n=e.length,i=new Uint8Array(n),o=0;n>o;++o)i[o]=e.charCodeAt(o);return i.buffer}function r(t){for(var e="",n=new Uint8Array(t),i=n.byteLength,o=0;i>o;o++)e+=String.fromCharCode(n[o]);return window.btoa(e)}function a(t,e){m=0,_.length=0,p={},h={},d={},f=e;for(var n=0,i=t.length;i>n;++n){var o=t[n],r=new FileReader;switch(o.loader=r,r.file=o,r.addEventListener("load",s),r.addEventListener("error",s),m++,o.type){case"image/png":r.readAsDataURL(o),console.log("Loading:",o.type,o.name);break;default:r.readAsText(o.slice(0,Math.min(200,o.size)))}}}function s(t){var e=t.target;switch(t.type){case"load":var n=e.file,i=e.result,o=n.baseName;"image/png"===n.type?(o=n.baseName=u(n.name),d[o]=n,console.log("Load complete:",n.type,n.name,o),e.removeEventListener("load",s),e.removeEventListener("error",s),m--,0===m&&l()):o?(console.log("Load complete:",n.type,n.name,o),e.removeEventListener("load",s),e.removeEventListener("error",s),m--,0===m&&l()):(o=n.baseName=u(n.name),0===i.indexOf("DBDT")?(p[o]=n,e.readAsArrayBuffer(n),console.log("Loading:",n.type,n.name)):i.indexOf("armature")>0||i.indexOf("textureAtlas")>0?(p[o]=n,e.readAsText(n),console.log("Loading:",n.type,n.name)):i.indexOf("SubTexture")>0?(h[o]=n,e.readAsText(n),console.log("Loading:",n.type,n.name)):(e.removeEventListener("load",s),e.removeEventListener("error",s),m--,0===m&&l()));break;default:e.removeEventListener("load",s),e.removeEventListener("error",s),m--,0===m&&l()}}function l(){for(var t in p){for(var e=p[t],n=e.loader,i="string"==typeof n.result?JSON.parse(n.result):n.result,o={data:i,textureAtlasDatas:[],textureAtlases:[]},r=t.split(".").shift(),a=c(r),s=0,l=a;s<l.length;s++){var u=l[s],h=u.loader,m=u.baseName.split(".").shift()+".png",y=JSON.parse(h.result);if(m in d){var g=d[m],v=g.loader,x=document.createElement("img");x.src=v.result,o.textureAtlasDatas.push(y),o.textureAtlases.push(x)}else o.textureAtlasDatas.push(y),o.textureAtlases.push(null)}_.push(o)}f(_)}function c(t,e,n){void 0===e&&(e=null),void 0===n&&(n="texture");var i=null!==e?e:t,o=0,r=new Array,a=(i.length>0?i+(n?"_"+n:n):n)+".json";if(a in h)return r.push(h[a]),r;for(;;){if(i.length>0&&n.length>0)a=i+"_"+n+"_"+o++ +".json";else if(n.length>0)a=n+"_"+o++ +".json";else{if(!(i.length>0)){console.assert(!1);break}a=i+"_"+o++ +".json"}if(a in h)r.push(h[a]);else if(o>1)break}if(r.length>0||null!==e)return r;if(r=c(t,"",n),r.length>0)return r;if(o=t.lastIndexOf("_"),o>=0){if(e=t.substring(0,o),r=c(t,e,n),r.length>0)return r;if(r=c(t,e,""),r.length>0)return r}return r}function u(t){return t.indexOf("_ske.")>0?t=t.replace("_ske.","."):t.indexOf("_tex.")>0?t=t.replace("_tex.","_texture."):t.indexOf("_tex_")>0&&(t=t.replace("_tex_","_texture_")),t}t.getQueryConfig=e,t.loadInlineData=n,t.loadRemoteData=i;var p,h,d,f,m=0,_=[];t.loadFiles=a}(player||(player={}));