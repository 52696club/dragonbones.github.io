var __reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)},DragonBonesControl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.getInstance=function(){return null===e._instance&&(e._instance=new egret.EventDispatcher),e._instance},e}(egret.EventDispatcher);DragonBonesControl._instance=null,__reflect(DragonBonesControl.prototype,"DragonBonesControl");var ModelEvent;!function(t){t[t.DragonBonesChange=100]="DragonBonesChange",t[t.ArmatureAdd=101]="ArmatureAdd",t[t.ArmatureRemove=102]="ArmatureRemove",t[t.ArmatureChange=103]="ArmatureChange",t[t.AnimationStart=104]="AnimationStart",t[t.AnimationComplete=105]="AnimationComplete",t[t.AnimationPlay=106]="AnimationPlay",t[t.AnimationStop=107]="AnimationStop",t[t.AnimationChange=108]="AnimationChange"}(ModelEvent||(ModelEvent={}));var DragonBonesModel=function(){function t(){this._armatures=[],this._inputData=null,this._dragonBonesData=null,this._armature=null,this._animation=null}return t.prototype._animationHandler=function(t){switch(t.type){case dragonBones.EventObject.FADE_IN:t.animationState&&(this._animation&&this._animation.name===t.animationState.name||(this._animation=t.animationState,DragonBonesControl.getInstance().dispatchEventWith(ModelEvent[ModelEvent.AnimationChange],!1,this._animation)),DragonBonesControl.getInstance().dispatchEventWith(ModelEvent[ModelEvent.AnimationStart],!1,this._animation));break;case dragonBones.EventObject.COMPLETE:DragonBonesControl.getInstance().dispatchEventWith(ModelEvent[ModelEvent.AnimationComplete],!1,this._animation)}},t.prototype.init=function(){},t.prototype.addArmature=function(t){var e=dragonBones.EgretFactory.factory.buildArmatureDisplay(t);return null!==e?(this._armatures.push(e.armature),DragonBonesControl.getInstance().dispatchEventWith(ModelEvent[ModelEvent.ArmatureAdd],!1,e.armature),e.armature):null},t.prototype.removeArmature=function(t){this.armature===t&&(this.armature=null);var e=this._armatures.indexOf(t);e>=0&&(this._armatures.splice(e,1),DragonBonesControl.getInstance().dispatchEventWith(ModelEvent[ModelEvent.ArmatureRemove],!1,t),t.dispose())},t.prototype.clearAllArmature=function(){for(var t=this._armatures.length;t--;){var e=this._armatures[t];this.removeArmature(e)}},t.prototype.changeArmature=function(t){if(this._dragonBonesData){this._armature&&this.removeArmature(this._armature);var e=this._dragonBonesData.armatureNames;t%=e.length,0>t&&(t=e.length+t),this.armature=this.addArmature(e[t]),this.playAnimation()}},t.prototype.prevArmature=function(){this._dragonBonesData&&(this._armature?this.changeArmature(this._dragonBonesData.armatureNames.indexOf(this._armature.name)-1):this.changeArmature(0))},t.prototype.nextArmature=function(){this._dragonBonesData&&(this._armature?this.changeArmature(this._dragonBonesData.armatureNames.indexOf(this._armature.name)+1):this.changeArmature(0))},t.prototype.playAnimation=function(){this._armature&&(this._armature.animation.lastAnimationState?this._armature.animation.lastAnimationState.isCompleted?this._armature.animation.play():this._armature.animation.lastAnimationState.play():this._armature.animation.play(),DragonBonesControl.getInstance().dispatchEventWith(ModelEvent[ModelEvent.AnimationPlay],!1))},t.prototype.stopAnimation=function(){this._armature&&(this._armature.animation.lastAnimationState?this._armature.animation.lastAnimationState.stop():this._armature.animation.stop(),DragonBonesControl.getInstance().dispatchEventWith(ModelEvent[ModelEvent.AnimationStop],!1))},t.prototype.changeAnimation=function(t){if(this._armature){var e=this._armature.armatureData.animationNames;t%=e.length,0>t&&(t+=e.length),this._armature.animation.fadeIn(e[t])}},t.prototype.prevAnimation=function(){if(this._armature)if(this._animation){var t=this._armature.armatureData.animationNames;this.changeAnimation(t.indexOf(this._animation.name)-1)}else this._armature.animation.play()},t.prototype.nextAnimation=function(){if(this._armature)if(this._animation){var t=this._armature.armatureData.animationNames;this.changeAnimation(t.indexOf(this._animation.name)+1)}else this._armature.animation.play()},Object.defineProperty(t.prototype,"armatures",{get:function(){return this._armatures},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputData",{get:function(){return this._inputData},set:function(t){if(this._inputData!==t){if(this.clearAllArmature(),this._inputData=t,this._inputData){console.assert(null!=this._inputData.data),console.assert(null!=this._inputData.textures);var e=this._inputData.textures;e.forEach(function(t,e,a){if(t instanceof egret.Texture);else if(t){var n=new egret.Texture,r=document.getElementById(t);r?(n.bitmapData=new egret.BitmapData(r),a[e]=n):a[e]=null}}),dragonBones.EgretFactory.factory.clear(!0),this._dragonBonesData=dragonBones.EgretFactory.factory.parseDragonBonesData(this._inputData.data),this._dragonBonesData&&(dragonBones.EgretFactory.factory.getTextureAtlasData(this._dragonBonesData.name)?dragonBones.EgretFactory.factory.updateTextureAtlasData(this._dragonBonesData.name,e):this._inputData.textureAtlases.forEach(function(t,a){dragonBones.EgretFactory.factory.parseTextureAtlasData(t,e[a])}))}DragonBonesControl.getInstance().dispatchEventWith(ModelEvent[ModelEvent.DragonBonesChange],!1,this._inputData)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dragonBonesData",{get:function(){return this._dragonBonesData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"armature",{get:function(){return this._armature},set:function(t){this._armature!==t&&(this._animation=null,DragonBonesControl.getInstance().dispatchEventWith(ModelEvent[ModelEvent.AnimationChange],!1,null),this._armature&&(this._armature.removeEventListener(dragonBones.EventObject.FADE_IN,this._animationHandler,this),this._armature.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationHandler,this)),this._armature=t,this._armature&&(this._armature.addEventListener(dragonBones.EventObject.FADE_IN,this._animationHandler,this),this._armature.addEventListener(dragonBones.EventObject.COMPLETE,this._animationHandler,this)),DragonBonesControl.getInstance().dispatchEventWith(ModelEvent[ModelEvent.ArmatureChange],!1,this._armature))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),t}();__reflect(DragonBonesModel.prototype,"DragonBonesModel");var DragonBonesView=function(t){function e(){var e=t.call(this)||this;return e._viewStage=new egret.DisplayObjectContainer,e._armatureContainer=new egret.DisplayObjectContainer,e._viewStage.addChild(e._armatureContainer),e.addChild(e._viewStage),e}return __extends(e,t),e.prototype._modelEventHandler=function(t){switch(t.type){case ModelEvent[ModelEvent.ArmatureAdd]:var e=t.data;this._armatureContainer.addChild(e.display);break;case ModelEvent[ModelEvent.ArmatureRemove]:var e=t.data;this._armatureContainer.removeChild(e.display)}},e.prototype.init=function(t){this._model=t,DragonBonesControl.getInstance().addEventListener(ModelEvent[ModelEvent.ArmatureAdd],this._modelEventHandler,this),DragonBonesControl.getInstance().addEventListener(ModelEvent[ModelEvent.ArmatureRemove],this._modelEventHandler,this)},e}(egret.DisplayObjectContainer);__reflect(DragonBonesView.prototype,"DragonBonesView");