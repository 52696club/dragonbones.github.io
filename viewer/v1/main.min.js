"use strict";var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),common;!function(t){function e(t){for(var e in t)delete t[e]}function n(t){var e=String(t),n=l[e];return n||(n=l[e]=i(t)),n}function i(t){var e=h[String(t)];if(e&&e.length>0){var n=e.pop();return n}var i=new t;return i._onClear(),i}function a(t,e){if((0>e||e!==e)&&(e=0),t){var n=String(t),i=h[n];u[n]=e,i&&i.length>e&&(i.length=e)}else{o=e;for(var n in h){var i=h[n];i.length>e&&(i.length=e),n in u&&(u[n]=e)}}}function r(t){if(t){var e=h[String(t)];e&&e.length&&(e.length=0)}else for(var n in h){var e=h[n];e.length=0}}var o=3e3,s=0,l={},u={},h={};t.clearMap=e,t.getInstance=n,t.create=i,t.setMaxCount=a,t.clear=r;var c=function(){function t(){this.hashCode=s++}return t.toString=function(){throw new Error},t.prototype.release=function(){this._onClear();var t=String(this.constructor),e=t in u?o:u[t],n=h[t]=h[t]||[];n.length<e&&(console.assert(n.indexOf(this)<0),n.push(this))},t.prototype.dispose=function(){this._onClear()},t}();t.BaseObject=c,__reflect(c.prototype,"common.BaseObject")}(common||(common={}));var common;!function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return __extends(e,t),e.toString=function(){return"[class common.Event]"},e.prototype._onClear=function(){this.type="",this.target=null,this.currentTarget=null,this.data=null},e.prototype.copyFrom=function(t){return this.type=t.type,this.target=t.target,this.currentTarget=t.currentTarget,this.data=t.data,this},e}(t.BaseObject);t.Event=e,__reflect(e.prototype,"common.Event");var n=function(n){function i(){var t=null!==n&&n.apply(this,arguments)||this;return t._listenerBins={},t}return __extends(i,n),i.toString=function(){return"[class common.EventDispatcher]"},i.prototype._onClear=function(){this.enabled=!0,this._dipatchLevel=0,t.clearMap(this._listenerBins)},i.prototype._sortListeners=function(t,e){return t.priority>e.priority?1:-1},i.prototype._isSameListener=function(t,e){return t===e},i.prototype.hasEventListener=function(t){return t in this._listenerBins[t]},i.prototype.addEventListener=function(t,e,n,i,a){void 0===i&&(i=null),void 0===a&&(a=0),this.removeEventListener(t,e);var r=this._listenerBins[t];r?0!==this._dipatchLevel&&(this._listenerBins[t]=r=r.concat()):this._listenerBins[t]=r=[],r.push({listener:e,thisTarget:n,data:i,priority:a}),r.sort(this._sortListeners)},i.prototype.removeEventListener=function(t,e,n){void 0===n&&(n=null);var i=this._listenerBins[t];if(i){0!==this._dipatchLevel&&(this._listenerBins[t]=i=i.concat());for(var a=0,r=i.length;r>a;++a){var o=i[a];if(o.listener===e&&this._isSameListener(o.data,n)){i.splice(a,1);break}}}},i.prototype.removeEventListeners=function(t){if(t)delete this._listenerBins[t];else for(var e in this._listenerBins)delete this._listenerBins[e]},i.prototype.dispatchEvent=function(t){var e=t.type,n=this._listenerBins[e];if(n){t.target=this,t.currentTarget||(t.currentTarget=t.target),this._dipatchLevel++;for(var i=0,a=n;i<a.length;i++){var r=a[i];r.listener.call(r.thisTarget,t,r.data)}this._dipatchLevel--}},i.prototype.dispatchEventWith=function(n,i){if(this.enabled){var a=t.create(e);a.type=n,a.data=i,this.dispatchEvent(a),a.release()}},i}(t.BaseObject);t.EventDispatcher=n,__reflect(n.prototype,"common.EventDispatcher",["common.IEventDispatcher"])}(common||(common={}));var common;!function(t){function e(t,e){for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.component===t)return a}return null}function n(t){c.indexOf(t)<0&&c.push(t)}function i(t){var e=c.indexOf(t);e>=0&&c.splice(e,1)}t.getViewByComponent=e;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class common.Notification]"},e.prototype._onClear=function(){this.type="",this.target=null,this.data=null},e}(t.BaseObject);t.Notification=a,__reflect(a.prototype,"common.Notification");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this._context=null},e.prototype.sendNotification=function(t,e){this._context.sendNotification(t,e,this)},Object.defineProperty(e.prototype,"controller",{get:function(){return this._context.controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"application",{get:function(){return this._context.application},enumerable:!0,configurable:!0}),e}(t.BaseObject);t.Model=r,__reflect(r.prototype,"common.Model");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.model=null,this.component=null,this._context=null},e.prototype._notificationListenerHandler=function(t,e){e.call(this,t.data)},e.prototype.addNotification=function(t,e,n){void 0===n&&(n=0),this._context.addEventListener(t,this._notificationListenerHandler,this,e,n)},e.prototype.removeNotification=function(t,e){this._context.removeEventListener(t,this._notificationListenerHandler,e)},e.prototype.sendNotification=function(t,e){this._context.sendNotification(t,e,this)},e.prototype.initialize=function(t,e,n){this.model=t,this.component=e,this._onInitialize(n),this.update()},e.prototype.update=function(){},Object.defineProperty(e.prototype,"controller",{get:function(){return this._context.controller},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"application",{get:function(){return this._context.application},enumerable:!0,configurable:!0}),e}(t.EventDispatcher);t.View=o,__reflect(o.prototype,"common.View");var s=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.result=null,t}return __extends(r,e),r.prototype._onClear=function(){this.success=null,this.result=null,this._isRetained=!1,this._guard=null,this._hook=null,this._queue=null},r.prototype._retain=function(){this._isRetained=!0,n(this)},r.prototype._release=function(t){this.success=t,null!==this._hook&&this._hook(this),null!==this._queue&&(this.success?this._queue._next(this.result):this._queue._fail(this.result)),this._isRetained=!1,i(this)},r.prototype.execute=function(e,n,i){return void 0===n&&(n=null),void 0===i&&(i=null),e instanceof a?this.notification=e:(this.notification=t.create(a),this.notification.data=e),this._guard=n,this._hook=i,null===this._guard||this._guard(this)!==!1?(this._onExecute(),this.isRetained||null!==this.success||(this.success=!0),null===this._hook||this.isRetained||this._hook(this)):this.success=!0,this.result},r.prototype.sendNotification=function(t,e){this._context.sendNotification(t,e,null)},Object.defineProperty(r.prototype,"isRetained",{get:function(){return this._isRetained},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"data",{get:function(){return this.notification.data},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"application",{get:function(){return this._context.application},enumerable:!0,configurable:!0}),r}(t.BaseObject);t.Command=s,__reflect(s.prototype,"common.Command");var l=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._commandBins=[],t}return __extends(n,e),n.prototype._executeSubCommand=function(e,n,i,a){void 0===i&&(i=null),void 0===a&&(a=null),this._currentCommand=t.create(e),this._currentCommand._queue=this,this._currentCommand.execute(n,i,a)},n.prototype._onExecute=function(){this._next(this.notification.data)},n.prototype._next=function(t){if(this._commandBins.length>0){var e=this._commandBins.shift();e&&(this.notification.data=t,this._executeSubCommand(e.commandClass,this.notification,e.guard,e.hook),this._currentCommand.isRetained||(this._currentCommand.success?this._next(this._currentCommand.result):this._fail(this._currentCommand.result)))}else this.result=this._currentCommand.result,this._release(!0)},n.prototype._fail=function(t){this.result=t,this._release(!1)},n.prototype.addCommand=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null);var i={commandClass:t,guard:e,hook:n};this._commandBins.push(i)},n.prototype.insertCommand=function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=null);var i={commandClass:t,guard:e,hook:n};this._commandBins.unshift(i)},n}(s);t.QueueCommand=l,__reflect(l.prototype,"common.QueueCommand");var u=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.controller=t.create(h),n._application=null,n}return __extends(n,e),n.toString=function(){return"[class common.Context]"},n.prototype.release=function(){throw new Error},n.prototype._isSameListener=function(t,n){return t&&t.commandClass&&n?t.commandClass===n:e.prototype._isSameListener.call(this,t,n)},n.prototype.initialize=function(t){this._application=t,this.controller._context=this},n.prototype.sendNotification=function(e,n,i){if(void 0===i&&(i=null),this.enabled){var r=t.create(a);r.type=e,r.target=i,r.data=n,this.dispatchEventWith(e,r),r.release()}},n.prototype.getInstance=function(e){var n=t.getInstance(e);return n._context=this,n},n.prototype.create=function(e){var n=t.create(e);return n._context=this,n},Object.defineProperty(n.prototype,"application",{get:function(){return this._application},enumerable:!0,configurable:!0}),n}(t.EventDispatcher);t.Context=u,__reflect(u.prototype,"common.Context");var h=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.toString=function(){return"[class common.Controller]"},n.prototype._notificationHandler=function(t,e){this.execute(e.commandClass,t.data,e.guard,e.hook)},n.prototype._onClear=function(){this._context=null},n.prototype.register=function(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=null);var a={commandClass:e,guard:n,hook:i};this._context.addEventListener(t,this._notificationHandler,this,a)},n.prototype.unregister=function(t,e){var n={commandClass:e,guard:null,hook:null};this._context.removeEventListener(t,this._notificationHandler,n)},n.prototype.execute=function(e,n,i,a){void 0===i&&(i=null),void 0===a&&(a=null);var r=t.create(e);return r.execute(n,i,a)},n}(t.BaseObject);__reflect(h.prototype,"Controller");var c=[]}(common||(common={}));var player;!function(t){t.NotificationType={VOChange:"VOChange",ArmatureAdd:"ArmatureAdd",ArmatureRemove:"ArmatureRemove",ArmatureChange:"ArmatureChange",ArmatureReplace:"ArmatureReplace",AnimationStart:"AnimationStart",AnimationComplete:"AnimationComplete",AnimationChange:"AnimationChange"};var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(common.Model);t.BaseModel=e,__reflect(e.prototype,"player.BaseModel");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(common.View);t.BaseView=n,__reflect(n.prototype,"player.BaseView");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(common.Command);t.BaseCommand=i,__reflect(i.prototype,"player.BaseCommand");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.QueueCommand]"},e}(common.QueueCommand);t.QueueCommand=a,__reflect(a.prototype,"player.QueueCommand")}(player||(player={}));var player;!function(t){var e=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.armatures=[],t.factory=dragonBones.EgretFactory.factory,t._armature=null,t}return __extends(i,e),i.toString=function(){return"[class player.ApplicationModel]"},i.prototype.createArmature=function(e){var i=this.factory.buildArmatureDisplay(e.name,e.parent.name);if(i){var a=this._context.create(n);return a.initialize(null,i,null),this.armatures.push(a),this.sendNotification(t.NotificationType.ArmatureAdd,a),a}return null},i.prototype.removeArmature=function(e){this.armature===e&&(this.armature=null);var n=this.armatures.indexOf(e);console.assert(n>=0),this.armatures.splice(n,1),this.sendNotification(t.NotificationType.ArmatureRemove,e),e.release()},i.prototype.clearAllArmature=function(){for(var t=this.armatures.length;t--;){var e=this.armatures[t];this.removeArmature(e)}},i.prototype.replaceArmature=function(e){var n=this.armature,i=this.createArmature(e);n&&i&&(i.component.x=n.component.x,i.component.y=n.component.y),this.armature=i,this.sendNotification(t.NotificationType.ArmatureReplace,n),n&&this.removeArmature(n)},Object.defineProperty(i.prototype,"vo",{set:function(e){if(e){this.clearAllArmature(),this.factory.clear(!0);for(var n=0,i=e;n<i.length;n++){var a=i[n],r=this.factory.parseDragonBonesData(a.data);if(r)if(a.textureAtlasDatas.length>0)for(var o=0,s=0,l=a.textureAtlasDatas;s<l.length;s++){var u=l[s],h=a.textureAtlases[o];h?this.factory.parseTextureAtlasData(u,h):this.factory.parseTextureAtlasData(u,null)}else this.factory.updateTextureAtlasData(r.name,a.textureAtlases)}this.sendNotification(t.NotificationType.VOChange,null)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},set:function(e){if(this._armature!==e){var n=this._armature;this._armature=e,this.sendNotification(t.NotificationType.ArmatureChange,n)}},enumerable:!0,configurable:!0}),i}(t.BaseModel);t.ApplicationModel=e,__reflect(e.prototype,"player.ApplicationModel");var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.toString=function(){return"[class player.ArmatureView]"},n.prototype._componentHandler=function(e){var n=e.eventObject;switch(e.type){case dragonBones.EventObject.FADE_IN:if(this._animation===n.animationState)return;var i=this._animation;this._animation=n.animationState,i&&this._animation&&i.name===this._animation.name||this.sendNotification(t.NotificationType.AnimationChange,i),this.sendNotification(t.NotificationType.AnimationStart,this._animation);break;case dragonBones.EventObject.COMPLETE:this.sendNotification(t.NotificationType.AnimationComplete,this._animation)}},n.prototype._onClear=function(){this.component&&(this.component.removeEvent(dragonBones.EventObject.FADE_IN,this._componentHandler,this),this.component.removeEvent(dragonBones.EventObject.COMPLETE,this._componentHandler,this),this.component.dispose(!0)),e.prototype._onClear.call(this),this._animation=null},n.prototype._onInitialize=function(t){this.component.addEvent(dragonBones.EventObject.FADE_IN,this._componentHandler,this),this.component.addEvent(dragonBones.EventObject.COMPLETE,this._componentHandler,this)},n.prototype.changeAnimation=function(t){var e=this.component.armature.armatureData.animationNames;t%=e.length,0>t&&(t=e.length+t),this.component.animation.fadeIn(e[t])},n.prototype.playAnimation=function(t){void 0===t&&(t=null),t?this.component.animation.fadeIn(t):!this.component.animation.lastAnimationState||this.component.animation.lastAnimationState.isCompleted?this.component.animation.play():this.component.animation.lastAnimationState.play()},n.prototype.stopAnimation=function(){this.component.animation.lastAnimationState&&this.component.animation.lastAnimationState.stop()},n.prototype.prevAnimation=function(){if(this._animation){var t=this.component.armature.armatureData.animationNames;this.changeAnimation(t.indexOf(this._animation.name)-1)}else this.playAnimation()},n.prototype.nextAnimation=function(){if(this._animation){var t=this.component.armature.armatureData.animationNames;this.changeAnimation(t.indexOf(this._animation.name)+1)}else this.playAnimation()},Object.defineProperty(n.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),n}(t.BaseView);t.ArmatureView=n,__reflect(n.prototype,"player.ArmatureView")}(player||(player={}));var common;!function(t){t.EventType={HistoryState:"HistoryState",HistoryAdd:"HistoryAdd",HistoryFree:"HistoryFree"};var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this.data=null,this._isDone=!1},e.prototype.undo=function(){return this._isDone?(this._isDone=!1,!0):!1},e.prototype.redo=function(){return this._isDone?!1:(this._isDone=!0,!0)},e}(t.BaseObject);t.BaseState=e,__reflect(e.prototype,"common.BaseState",["common.IState"]);var n=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._states=[],t._batchs=[],t}return __extends(n,e),n.toString=function(){return"[class common.History]"},n.prototype._onClear=function(){e.prototype._onClear.call(this);for(var t=0,n=this._states;t<n.length;t++){var i=n[t];i.release()}for(var a=0,r=this._batchs;a<r.length;a++){var o=r[a];o.release()}this.dispatcher=null,this._locked=0,this._index=-1,this._states.length=0,this._batchs.length=0},n.prototype._free=function(){this._states.length>this._index+1&&(this._states.length=this._index+1,null!==this.dispatcher&&this.dispatcher.dispatchEventWith(t.EventType.HistoryFree,null))},n.prototype._doState=function(e,n){if(n?e.undo():e.redo(),null!==this.dispatcher&&e.data){var i={isUndo:n,data:e.data};this.dispatcher.dispatchEventWith(t.EventType.HistoryState,i)}},n.prototype._getStateByObject=function(t,e,a,r){void 0===r&&(r=null);for(var o=t._states.length;o--;){var s=t._states[o];if(s instanceof i){if((null===r||s!==r)&&s.object===e&&s.key===a)return s}else if(s instanceof n){var l=this._getStateByObject(s,e,a,r);if(null!==l)return l}}return null},n.prototype.undo=function(){return this._batchs.length>0?!1:this.go(-1)},n.prototype.redo=function(){return this._batchs.length>0?!1:this.go(this._states.length-1)},n.prototype.back=function(){return this._index<0?!1:this._batchs.length>0?!1:(this._locked|=1,this._doState(this._states[this._index--],!0),this._locked&=2,!0)},n.prototype.forward=function(){return this._index>=this._states.length-1?!1:this._batchs.length>0?!1:(this._locked|=1,this._doState(this._states[++this._index],!1),this._locked&=2,!0)},n.prototype.go=function(t){if(this._batchs.length>0)return!1;var e=!1;if(this._index<t)for(;this._index!==t&&this.forward();)e=!0;else for(;this._index!==t&&this.back();)e=!0;return e},n.prototype.add=function(e){if(0===this._locked)if(this._batchs.length>0){var n=this._batchs[this._batchs.length-1];n.add(e)}else this._states[this._index+1]=e,null!==this.dispatcher&&this.dispatcher.dispatchEventWith(t.EventType.HistoryAdd,e),this.forward(),this._free()},n.prototype.addBatch=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];if(0!==this._locked)return null;var a=t.create(n);a.dispatcher=this.dispatcher;for(var r=0,o=e;r<o.length;r++){var s=o[r];a.add(s)}return this.add(a),a},n.prototype.beginBatch=function(){var e=t.create(n);return e.dispatcher=this.dispatcher,this._batchs.push(e),e},n.prototype.endBatch=function(t){if(void 0===t&&(t=null),!(this._batchs.length<1)){var e=this._batchs.pop();e.count<1||(e.data=t,e._locked|=2,this._batchs.length>0?this._batchs[this._batchs.length-1].add(e):this.add(e))}},n.prototype.linkObjectState=function(t,e){var n=this._getStateByObject(this,t,e);if(null!==n){var i=this._getStateByObject(this,t,e,n);null!==i&&(n.fromValue=i.toValue)}},n.prototype.getState=function(t){return this._states[t]},Object.defineProperty(n.prototype,"enabled",{get:function(){return 0===this._locked},set:function(t){t?this._locked&=2:this._locked|=1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"index",{get:function(){return this._index},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"count",{get:function(){return this._states.length},enumerable:!0,configurable:!0}),n}(e);t.History=n,__reflect(n.prototype,"common.History");var i=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.toString=function(){return"[class common.ModifyObjectState]"},n.create=function(e,i,a,r){void 0===r&&(r=null);var o=i in e?e[i]:void 0;if(o===a)return null;var s=t.create(n);return s.object=e,s.key=i,s.data=r,s.fromValue=o,s.toValue=a,s},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.object=null,this.key="",this.fromValue=null,this.toValue=null},n.prototype.undo=function(){return e.prototype.undo.call(this)?(void 0!==this.fromValue?this.object[this.key]=this.fromValue:delete this.object[this.key],!0):!1},n.prototype.redo=function(){return e.prototype.redo.call(this)?(void 0!==this.toValue?this.object[this.key]=this.toValue:delete this.object[this.key],!0):!1},n}(e);t.ModifyObjectState=i,__reflect(i.prototype,"common.ModifyObjectState");var a=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),n.toString=function(){return"[class common.ModifyArrayState]"},n.create=function(e,i,a,r){void 0===r&&(r=null),0>i&&(i=e.length>0?e.length-1:0);var o=t.create(n);return o.array=e,o.index=i,o.data=r,a?o.toValue=a:o.fromValue=o.array[o.index],o},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.array=null,this.index=-1,this.fromValue=null,this.toValue=null},n.prototype.undo=function(){return e.prototype.undo.call(this)?(this.fromValue?this.array.splice(this.index,0,this.fromValue):this.array.splice(this.index,1),!0):!1},n.prototype.redo=function(){return e.prototype.redo.call(this)?(this.toValue?this.array.splice(this.index,0,this.toValue):this.array.splice(this.index,1),!0):!1},n}(e);t.ModifyArrayState=a,__reflect(a.prototype,"common.ModifyArrayState")}(common||(common={}));var player;!function(t){function e(t){if(t.indexOf("?")>=0){for(var e={},n=void 0,i=/\+/g,a=/([^&=]+)=?([^&]*)/g,r=function(t){return decodeURIComponent(t.replace(i," "))},o=t.substring(1);n=a.exec(o);)e[r(n[1])]=r(n[2]);return e.sources&&"string"==typeof e.sources&&(e.sources=JSON.parse(e.sources)),e.armature&&"string"==typeof e.armature&&e.armature.indexOf(",")>0&&(e.armature=e.armature.split(",")),e.skin&&"string"==typeof e.skin&&e.skin.indexOf(",")>0&&(e.skin=e.skin.split(",")),e}return null}function n(t){for(var e=JSON.parse(t),n=new Array,i=0,r=e;i<r.length;i++){for(var o=r[i],s={data:a(o.data),textureAtlasDatas:[],textureAtlases:[]},l=0,u=o.textureAtlases;l<u.length;l++){var h=u[l],c=document.createElement("img");c.src="data:image/png;base64,"+h,s.textureAtlases.push(c)}n.push(s)}return n}function i(t,e){if(t.sources&&t.sources instanceof Array){var n,i=t.sources,a=null,o=new XMLHttpRequest,s=function(){if(a){if(null===n.data)o.response instanceof ArrayBuffer?n.data=o.response:n.data=JSON.parse(o.response);else if(n.textureAtlasDatas.length===n.textureAtlases.length)n.textureAtlasDatas.push(JSON.parse(o.response));else{var t=document.createElement("img");if(t.src="data:image/png;base64,"+r(o.response),n.textureAtlases.push(t),n.textureAtlases.length===a.textureAtlases.length)return void l()}if(n.textureAtlasDatas.length===n.textureAtlases.length){var e=a.textureAtlasDatas[n.textureAtlasDatas.length];e?(o.open("GET",e,!0),o.responseType="text",o.send()):n.textureAtlasDatas.push("")}else{var e=a.textureAtlases[n.textureAtlases.length];e?(o.open("GET",e,!0),o.responseType="arraybuffer",o.send()):n.textureAtlases.push(null)}}},l=function(){return 0===i.length?void p(_):(a=i.pop(),void(a?(n={data:null,textureAtlasDatas:[],textureAtlases:[]},_.push(n),o.open("GET",a.data,!0),a.data.indexOf(".json")<0?o.responseType="arraybuffer":o.responseType="text",o.send()):l()))};_.length=0,p=e,o.addEventListener("loadend",s),l()}}function a(t){for(var e=window.atob(t),n=e.length,i=new Uint8Array(n),a=0;n>a;++a)i[a]=e.charCodeAt(a);return i.buffer}function r(t){for(var e="",n=new Uint8Array(t),i=n.byteLength,a=0;i>a;a++)e+=String.fromCharCode(n[a]);return window.btoa(e)}function o(t,e){g=0,_.length=0,c={},d={},m={},p=e;for(var n=0,i=t.length;i>n;++n){var a=t[n],r=new FileReader;switch(a.loader=r,r.file=a,r.addEventListener("load",s),r.addEventListener("error",s),g++,a.type){case"image/png":r.readAsDataURL(a),console.log("Loading:",a.type,a.name);break;default:r.readAsText(a.slice(0,Math.min(200,a.size)))}}}function s(t){var e=t.target;switch(t.type){case"load":var n=e.file,i=e.result,a=n.baseName;"image/png"===n.type?(a=n.baseName=h(n.name),m[a]=n,console.log("Load complete:",n.type,n.name,a),e.removeEventListener("load",s),e.removeEventListener("error",s),g--,0===g&&l()):a?(console.log("Load complete:",n.type,n.name,a),e.removeEventListener("load",s),e.removeEventListener("error",s),g--,0===g&&l()):(a=n.baseName=h(n.name),0===i.indexOf("DBDT")?(c[a]=n,e.readAsArrayBuffer(n),console.log("Loading:",n.type,n.name)):i.indexOf("armature")>0||i.indexOf("textureAtlas")>0?(c[a]=n,e.readAsText(n),console.log("Loading:",n.type,n.name)):i.indexOf("SubTexture")>0?(d[a]=n,e.readAsText(n),console.log("Loading:",n.type,n.name)):(e.removeEventListener("load",s),e.removeEventListener("error",s),g--,0===g&&l()));break;default:e.removeEventListener("load",s),e.removeEventListener("error",s),g--,0===g&&l()}}function l(){for(var t in c){for(var e=c[t],n=e.loader,i="string"==typeof n.result?JSON.parse(n.result):n.result,a={data:i,textureAtlasDatas:[],textureAtlases:[]},r=t.split(".").shift(),o=u(r),s=0,l=o;s<l.length;s++){var h=l[s],d=h.loader,g=h.baseName.split(".").shift()+".png",f=JSON.parse(d.result);if(g in m){var y=m[g],v=y.loader,A=document.createElement("img");A.src=v.result,a.textureAtlasDatas.push(f),a.textureAtlases.push(A)}else a.textureAtlasDatas.push(f),a.textureAtlases.push(null)}_.push(a)}p(_)}function u(t,e,n){void 0===e&&(e=null),void 0===n&&(n="texture");var i=null!==e?e:t,a=0,r=new Array,o=(i.length>0?i+(n?"_"+n:n):n)+".json";if(o in d)return r.push(d[o]),r;for(;;){if(i.length>0&&n.length>0)o=i+"_"+n+"_"+a++ +".json";else if(n.length>0)o=n+"_"+a++ +".json";else{if(!(i.length>0)){console.assert(!1);break}o=i+"_"+a++ +".json"}if(o in d)r.push(d[o]);else if(a>1)break}if(r.length>0||null!==e)return r;if(r=u(t,"",n),r.length>0)return r;if(a=t.lastIndexOf("_"),a>=0){if(e=t.substring(0,a),r=u(t,e,n),r.length>0)return r;if(r=u(t,e,""),r.length>0)return r}return r}function h(t){return t.indexOf("_ske.")>0?t=t.replace("_ske.","."):t.indexOf("_tex.")>0?t=t.replace("_tex.","_texture."):t.indexOf("_tex_")>0&&(t=t.replace("_tex_","_texture_")),t}t.getQueryConfig=e,t.loadInlineData=n,t.loadRemoteData=i;var c,d,m,p,g=0,_=[];t.loadFiles=o}(player||(player={}));var DragManager=function(){function t(){this.lastEvent=null,this._isDragMove=!1,this._helpPoint=new egret.Point,this._dragPosition=new egret.Point,this._dragOffset=new egret.Point,this._dragSpeed=new egret.Point,this._dragTarget=null}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.enableDrag=function(t){t&&(t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._dragHandler,this),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this._dragHandler,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this._dragHandler,this))},t.prototype.disableDrag=function(t){t&&(t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this._dragHandler,this),t.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this._dragHandler,this),t.removeEventListener(egret.TouchEvent.TOUCH_END,this._dragHandler,this),t.removeEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this))},t.prototype._dragHandler=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:if(this._dragTarget)return;this.lastEvent=e,this.dragTarget=e.currentTarget;break;case egret.TouchEvent.TOUCH_RELEASE_OUTSIDE:case egret.TouchEvent.TOUCH_END:this.lastEvent=e,this.dragTarget=null;break;case egret.TouchEvent.TOUCH_MOVE:if(this._dragTarget){this.lastEvent=e,this._dragTarget.parent.globalToLocal(e.stageX,e.stageY,this._helpPoint);var n=this._helpPoint.x+this._dragOffset.x,i=this._helpPoint.y+this._dragOffset.y;!this._isDragMove&&(Math.abs(this._dragPosition.x-n)>5||Math.abs(this._dragPosition.y-i)>5)&&(this._isDragMove=!0,this._dragTarget.dispatchEventWith(t.DRAG_BEGIN),this._dragTarget&&this._dragTarget.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this)),this._isDragMove&&(this._dragTarget.parent.globalToLocal(e.stageX,e.stageY,this._helpPoint),this._dragPosition.x=n,this._dragPosition.y=i)}}},t.prototype._enterFrameHandler=function(e){var n=e.currentTarget;if(n===this._dragTarget)this._dragSpeed.x+=.5*(this._dragPosition.x-n.x-this._dragSpeed.x),this._dragSpeed.y+=.5*(this._dragPosition.y-n.y-this._dragSpeed.y),(n.x!==this._dragPosition.x||n.y!==this._dragPosition.y)&&(n.x=this._dragPosition.x,n.y=this._dragPosition.y,n.hasEventListener(t.DRAG_MOVE)&&n.dispatchEventWith(t.DRAG_MOVE));else{var i=n.dragSpeed;n.x+=i.x,n.y+=i.y,i.x*=.7,i.y*=.7,n.hasEventListener(t.DRAG_MOVE)&&n.dispatchEventWith(t.DRAG_MOVE),Math.abs(i.x)<1&&Math.abs(i.y)<1&&n.removeEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this)}},Object.defineProperty(t.prototype,"dragTarget",{get:function(){return this._dragTarget},set:function(e){this._dragTarget!==e&&(this._dragTarget&&(this._dragTarget.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this._dragHandler,this),this._isDragMove?this._dragTarget.dragSpeed=this._dragSpeed.clone():this._dragTarget.removeEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this._isDragMove=!1,this._dragTarget.dispatchEventWith(t.DRAG_END)),this._dragTarget=e,this._dragTarget&&(this.lastEvent&&(this._dragTarget.parent.globalToLocal(this.lastEvent.stageX,this.lastEvent.stageY,this._helpPoint),this._dragPosition.x=this._dragTarget.x,this._dragPosition.y=this._dragTarget.y,this._dragOffset.x=this._dragPosition.x-this._helpPoint.x,this._dragOffset.y=this._dragPosition.y-this._helpPoint.y,this._dragSpeed.x=0,this._dragSpeed.y=0),this._dragTarget.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._dragHandler,this)))},enumerable:!0,configurable:!0}),t.DRAG_BEGIN="dragBegin",t.DRAG_END="dragEnd",t.DRAG_MOVE="dragMove",t._instance=null,t}();__reflect(DragManager.prototype,"DragManager");var lang;!function(t){function e(e){switch(e.toLowerCase()){case"en-us":t.language=i.en_US;break;case"zh-cn":t.language=i.zh_CN;break;case"ru-fr":t.language=i.ru_RF;break;default:t.language=i.en_US}}function n(e){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];var r;if(r=t.language<e.length?e[t.language]:e[i.en_US],n.length>0)for(var o=0,s=n.length;s>o;++o)r=r.replace("{"+o+"}",n[o]);return r}var i;!function(t){t[t.en_US=0]="en_US",t[t.zh_CN=1]="zh_CN",t[t.ru_RF=2]="ru_RF"}(i=t.LanguageType||(t.LanguageType={})),t.language=i.en_US,t.setLanguageByString=e,t.get=n,t.None=["","",""],t.Tip={armature:["Armature","骨架","Armature"],animation:["Animation","动画","Animation"],qrcode:["Qr code","扫描二维码，在手机端查看","Qr code"]},t.Label={backgroundColor:["Background Color","背景色","Background Color"],grid:["Show Grid","显示网格","Show Grid"],info:["Infomation<br/>Time {3}<br/>Animations {0}<br/>Bones {1}<br/>Slots {2}<br/>Child armature {5}<br/>Triangles {4}<br/>","信息<br/>时间 {3}<br/>动画 {0}<br/>骨骼 {1}<br/>插槽 {2}<br/>子骨架 {5}<br/>三角形 {4}<br/>","Infomation<br/>Time {3}<br/>Animations {0}<br/>Bones {1}<br/>Slots {2}<br/>Child armature {5}<br/>Triangles {4}<br/>"]}}(lang||(lang={}));var Main=function(t){function e(){var e=t.call(this)||this;return e.container=new egret.DisplayObjectContainer,e.armatureContainer=new egret.DisplayObjectContainer,e.lineH=new egret.Shape,e.lineV=new egret.Shape,e.grid=new egret.Bitmap,e._context=common.create(common.Context),e.addChild(e.container),e.container.addChild(e.grid),e.container.addChild(e.lineV),e.container.addChild(e.lineH),e.container.addChild(e.armatureContainer),e.lineH.graphics.lineStyle(1,0,1,!0),e.lineV.graphics.lineStyle(1,0,1,!0),e.lineH.graphics.moveTo(0,0),e.lineV.graphics.moveTo(0,0),e.lineH.graphics.lineTo(101,0),e.lineV.graphics.lineTo(0,101),e.grid.smoothing=!1,e.grid.fillMode=egret.BitmapFillMode.REPEAT,e.grid.bitmapData=new egret.BitmapData(document.getElementById("background")),e.addEventListener(egret.Event.ADDED_TO_STAGE,function(){var t=e._context.getInstance(player.Application),n=e._context.getInstance(player.SideView),i=e._context.getInstance(player.ApplicationModel);
if(e._context.initialize(t),t.initialize(i,e,null),n.initialize(i,e,null),t.queryConfig=player.getQueryConfig(window.location.search),t.queryConfig&&t.queryConfig.sources)player.loadRemoteData(t.queryConfig,function(e){t.model.vo=e});else{var a=document.getElementById("data");a&&(t.model.vo=player.loadInlineData(a.innerHTML))}t.queryConfig&&t.queryConfig.showSide===!1||(n.showSide=!0)},e),e}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var player;!function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.queryConfig=null,t._isFirstData=!0,t._gridEnabled=!1,t._isDraged=!1,t._isCtrl=!1,t._scaleType=3,t._stageWidth=0,t._stageHeight=0,t._stageWidthOffset=0,t._stageHeightOffset=0,t._stageScale=1,t._gridScale=3,t._time=0,t._stageScalePoint=new egret.Point,t._defaultArmature=null,t._touchArmature=null,t}return __extends(n,e),n.toString=function(){return"[class player.Application]"},n.prototype._notificationHandler=function(e){switch(e.type){case t.NotificationType.VOChange:var n=null;if(this._isFirstData&&this.queryConfig&&this.queryConfig.armature)if(this.queryConfig.armature instanceof Array)switch(this.queryConfig.armature.length){case 0:break;case 1:n=this.model.factory.getArmatureData(this.queryConfig.armature[0]);break;default:n=this.model.factory.getArmatureData(this.queryConfig.armature[1],this.queryConfig.armature[0])}else n=this.model.factory.getArmatureData(this.queryConfig.armature);else for(var i in this.model.factory.getAllDragonBonesData()){var a=this.model.factory.getDragonBonesData(i);if(a&&a.armatureNames.length>0){n=a.stage?a.stage:a.getArmature(a.armatureNames[0]);break}}n&&(this.model.armature=this.model.createArmature(n));break;case t.NotificationType.ArmatureAdd:var r=e.data;r&&(r.component.touchEnabled=!0,r.component.disableBatch(),this.component.armatureContainer.addChild(r.component));break;case t.NotificationType.ArmatureRemove:var r=e.data;r&&(DragManager.getInstance().disableDrag(r.component),this.component.armatureContainer.removeChild(r.component));break;case t.NotificationType.ArmatureChange:var r=this.model.armature;if(r){if(this._defaultArmature||(this._defaultArmature=r),1===this.model.armatures.length&&this.scaleToType(0),this._isFirstData&&this.queryConfig&&this.queryConfig.skin){var n=null,o=null;if(this.queryConfig.skin instanceof Array)switch(this.queryConfig.skin.length){case 0:break;case 1:n=this.model.factory.getArmatureData(this.queryConfig.skin[0]),n&&(o=n.defaultSkin);break;case 2:n=this.model.factory.getArmatureData(this.queryConfig.skin[1],this.queryConfig.skin[0]),n&&(o=n.defaultSkin);break;case 3:n=this.model.factory.getArmatureData(this.queryConfig.skin[1],this.queryConfig.skin[0]),n&&(o=n.getSkin(this.queryConfig.skin[2]));break;default:for(var s=0,l=this.queryConfig.skin.length;l>s;s+=3)n=this.model.factory.getArmatureData(this.queryConfig.skin[s+1],this.queryConfig.skin[s]),n&&(o=n.getSkin(this.queryConfig.skin[s+2]),o&&this.model.factory.changeSkin(r.component.armature,o));n=null,o=null}else n=this.model.factory.getArmatureData(this.queryConfig.skin),n&&(o=n.defaultSkin);o&&this.model.factory.changeSkin(r.component.armature,o)}this._isFirstData&&this.queryConfig&&this.queryConfig.animation?r.playAnimation(this.queryConfig.animation):r.playAnimation()}this._isFirstData=!1;break;case t.NotificationType.ArmatureReplace:var r=this.model.armature;if(r){var u=e.data;u===this._defaultArmature?this._defaultArmature=r:DragManager.getInstance().enableDrag(r.component)}break;case t.NotificationType.AnimationComplete:}},n.prototype._resizeHandler=function(t){var e=this.component.stage.stageWidth,n=this.component.stage.stageHeight,i=this.component.grid.bitmapData.width*this.component.grid.scaleX,a=this.component.grid.bitmapData.height*this.component.grid.scaleY;this.component.lineH.scaleX=.01*e,this.component.lineV.scaleY=.01*n,this.component.grid.width=(e+i)/this.component.grid.scaleX,this.component.grid.height=(n+a)/this.component.grid.scaleY,this.setStageSize(this.component.stage.stageWidth,this.component.stage.stageHeight,this._stageWidthOffset,this._stageHeightOffset)},n.prototype._touchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:if(this._isDraged=!1,t.target instanceof dragonBones.EgretArmatureDisplay){var e=t.target.armature.display;this._touchArmature=common.getViewByComponent(e,this.model.armatures)}else this._touchArmature=null;egret.Tween.removeTweens(this);break;case egret.TouchEvent.TOUCH_END:var i=(new Date).getTime();if(i-this._time<300)this.scaleToType(this._scaleType+1);else if(!this._isDraged){if(t.target instanceof dragonBones.EgretArmatureDisplay){var e=t.target.armature.display,a=common.getViewByComponent(e,this.model.armatures);a&&this.model.armature===a?a.nextAnimation():(this.model.armature=a,a&&this.component.armatureContainer.addChild(a.component))}this.sendNotification(n.TOUCH_STAGE,null)}this._time=i;break;case DragManager.DRAG_BEGIN:this._isCtrl?(DragManager.getInstance().dragTarget=null,this._touchArmature&&(this.model.armature=this.model.createArmature(this._touchArmature.component.armature.armatureData),this.model.armature&&(DragManager.getInstance().enableDrag(this.model.armature.component),DragManager.getInstance().dragTarget=this.model.armature.component))):this._isDraged=!0;break;case DragManager.DRAG_MOVE:this._isDraged&&this._updateBackgroundPosition()}},n.prototype._documentHandler=function(e){var n=this;switch(e.type){case"keydown":case"keyup":this._isCtrl=e.ctrlKey;break;case"mousewheel":var i=e;if(i.x<0||i.x>0+this.viewStageWidth||i.y<0||i.y>0+this.viewStageHeight)return;var a=this.component.container;if(i.wheelDelta>0){var r=this._getFormatScale(1.2*this.stageScale);this.stageScale!==r&&(this._stageScalePoint.x=i.x-a.x,this._stageScalePoint.y=i.y-a.y,this._stageScalePoint.x=a.x+(this._stageScalePoint.x-this._stageScalePoint.x/this.stageScale*r),this._stageScalePoint.y=a.y+(this._stageScalePoint.y-this._stageScalePoint.y/this.stageScale*r),this.scaleTo(r,this._stageScalePoint))}else{var r=this._getFormatScale(.8*this.stageScale);this.stageScale!==r&&(this._stageScalePoint.x=this.viewStageWidth-i.x,this._stageScalePoint.y=this.viewStageHeight-i.y,this._stageScalePoint.x=a.x+.2*(this._stageScalePoint.x-a.x),this._stageScalePoint.y=a.y+.2*(this._stageScalePoint.y-a.y),this.scaleTo(r,this._stageScalePoint))}break;case"dragenter":case"dragover":e.stopPropagation(),e.preventDefault();break;case"drop":var o=e.dataTransfer;o&&o.files&&t.loadFiles(o.files,function(t){n.model.vo=t}),e.stopPropagation(),e.preventDefault()}},n.prototype._getFormatScale=function(t){return t<n.MIN_SCALE?t=n.MIN_SCALE:t>n.MAX_SCALE&&(t=n.MAX_SCALE),t},n.prototype._updateBackgroundPosition=function(){var t=this.component.container,e=this.component.grid,n=e.bitmapData.width*e.scaleX,i=e.bitmapData.height*e.scaleY;this.component.lineH.x=-t.x,this.component.lineV.y=-t.y,e.x=-Math.ceil(t.x/n)*n,e.y=-Math.ceil(t.y/i)*i},n.prototype._onInitialize=function(){var e=this;if(console.log("DragonBones Viewer 0.0.3"),this.addNotification(t.NotificationType.VOChange,this._notificationHandler),this.addNotification(t.NotificationType.ArmatureAdd,this._notificationHandler),this.addNotification(t.NotificationType.ArmatureRemove,this._notificationHandler),this.addNotification(t.NotificationType.ArmatureChange,this._notificationHandler),this.addNotification(t.NotificationType.ArmatureReplace,this._notificationHandler),this.addNotification(t.NotificationType.AnimationComplete,this._notificationHandler),this.component.container.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.component.container.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),this.component.container.addEventListener(DragManager.DRAG_BEGIN,this._touchHandler,this),this.component.container.addEventListener(DragManager.DRAG_MOVE,this._touchHandler,this),this.component.stage.addEventListener(egret.Event.RESIZE,this._resizeHandler,this),!egret.Capabilities.isMobile){var n=document.body;n.onkeydown=n.onkeyup=n.onmousewheel=n.ondragenter=n.ondragover=n.ondrop=function(t){e._documentHandler(t)}}this.gridEnabled=!0,this.component.container.touchChildren=!0,this._resizeHandler(null),this.scaleToType(1,0),DragManager.getInstance().enableDrag(this.component.container)},n.prototype.setStageSize=function(t,e,n,i){var a=this.viewStageWidth||1,r=this.viewStageHeight||1;this._stageWidth=t,this._stageHeight=e,this._stageWidthOffset=n,this._stageHeightOffset=i,egret.Tween.removeTweens(this),egret.Tween.removeTweens(this.component.container),egret.Tween.get(this.component.container,{onChange:this._updateBackgroundPosition,onChangeObj:this}).to({x:this.viewStageWidth*this.component.container.x/a,y:this.viewStageHeight*this.component.container.y/r},300,egret.Ease.cubicOut)},n.prototype.scaleTo=function(t,e,n){void 0===n&&(n=500),egret.Tween.removeTweens(this),egret.Tween.removeTweens(this.component.container),egret.Tween.get(this).to({stageScale:t},n,egret.Ease.cubicOut),e&&egret.Tween.get(this.component.container,{onChange:this._updateBackgroundPosition,onChangeObj:this}).to({x:e.x,y:e.y},n,egret.Ease.cubicOut)},n.prototype.scaleToType=function(t,e){void 0===e&&(e=500),this._scaleType=t,3===this._scaleType&&(this._scaleType=0);var n=1,i=this.model.armature;if(i){var a=i.component.getBounds(),r=this.viewStageWidth/this.viewStageHeight,o=a.width/a.height;switch(this._scaleType){case 0:break;case 1:n=r>o?this.viewStageHeight/(a.height+100):this.viewStageWidth/(a.width+100);break;case 2:n=r>o?this.viewStageWidth/(a.width+100):this.viewStageHeight/(a.height+100)}this._stageScalePoint.x=.5*this.viewStageWidth-(a.x+.5*a.width+i.component.x)*n,this._stageScalePoint.y=.5*this.viewStageHeight-(a.y+.5*a.height+i.component.y)*n}else this._stageScalePoint.x=.5*this.viewStageWidth,this._stageScalePoint.y=.5*this.viewStageHeight;this.scaleTo(n,this._stageScalePoint,e)},Object.defineProperty(n.prototype,"gridEnabled",{get:function(){return this._gridEnabled},set:function(t){this._gridEnabled!==t&&(this._gridEnabled=t,this._gridEnabled?(this.component.grid.alpha=.1,this.component.lineH.visible=!0,this.component.lineV.visible=!0):(this.component.grid.alpha=0,this.component.lineH.visible=!1,this.component.lineV.visible=!1))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stageWidth",{get:function(){return this._stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stageHeight",{get:function(){return this._stageHeight},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewStageWidth",{get:function(){return Math.max(this._stageWidth+this._stageWidthOffset,0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"viewStageHeight",{get:function(){return Math.max(this._stageHeight+this._stageHeightOffset,0)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"stageScale",{get:function(){return this._stageScale},set:function(t){t=this._getFormatScale(t),this._stageScale=t,this.component.armatureContainer.scaleX=this.component.armatureContainer.scaleY=this._stageScale;var e=Math.max(this._stageScale*this._gridScale,.2),n=this.component.grid,i=n.bitmapData.width*e,a=n.bitmapData.height*e;n.scaleX=n.scaleY=e,n.width=(this.stageWidth+i)/e,n.height=(this.stageHeight+a)/e,this._updateBackgroundPosition()},enumerable:!0,configurable:!0}),n.MAX_SCALE=25,n.MIN_SCALE=.1,n.TOUCH_STAGE="touchStage",n}(t.BaseView);t.Application=e,__reflect(e.prototype,"player.Application")}(player||(player={}));var player;!function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._showSide=!1,t._sideValue=-n.SIDE_WIDTH,t._speeds=[.1,.25,.5,1,1.5,2,4,8],t._dragonBonesPlayer=null,t._side=null,t._sideButton=null,t._dataList=null,t._armatureList=null,t._skinList=null,t._animationList=null,t._prevAnimationButton=null,t._nextAnimationButton=null,t._stopAnimationButton=null,t._playAnimationButton=null,t._animationSpeedLabel=null,t._reduceAnimationSpeedButton=null,t._increaseAnimationSpeedButton=null,t._gridEnabledButton=null,t._infoLabel=null,t}return __extends(n,e),n.toString=function(){return"[class player.SideView]"},n.prototype._notificationHandler=function(e){switch(e.type){case t.NotificationType.VOChange:this._updateDataList(!0);break;case t.NotificationType.ArmatureChange:this._updateDataList(!1),this._updateArmatureList(),this._updateSkinList(),this._updateAnimationList(!0),this._updateAnimationList(!1),this._updatePlayAndStopButton(),this._updateAnimationSpeedLabel(),this._updateArmatureAndAnimationInfo();var n=e.data;n&&(n.component.removeEventListener(dragonBones.EventObject.START,this._animationHandler,this),n.component.removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._animationHandler,this),n.component.removeEventListener(dragonBones.EventObject.COMPLETE,this._animationHandler,this),n.component.removeEventListener(dragonBones.EventObject.FRAME_EVENT,this._animationHandler,this)),this.model.armature&&(this.model.armature.component.addEventListener(dragonBones.EventObject.START,this._animationHandler,this),this.model.armature.component.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._animationHandler,this),this.model.armature.component.addEventListener(dragonBones.EventObject.COMPLETE,this._animationHandler,this),this.model.armature.component.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._animationHandler,this));break;case t.NotificationType.AnimationChange:this._updateAnimationList(!1),this._updateArmatureAndAnimationInfo();break;case t.NotificationType.AnimationStart:this._updatePlayAndStopButton();break;case t.NotificationType.AnimationComplete:this._updatePlayAndStopButton();break;case t.Application.TOUCH_STAGE:egret.Capabilities.isMobile&&(this.showSide=!1)}},n.prototype._animationHandler=function(t){var e=t.eventObject,n="";switch(e.type){case dragonBones.EventObject.FRAME_EVENT:n="[Frame event] "+e.animationState.name+" "+e.name;break;case dragonBones.EventObject.SOUND_EVENT:n="[Sound event] "+e.animationState.name+" "+e.name;break;default:n="[Animation event] "+e.animationState.name+" "+e.type}console.info(n)},n.prototype._updateElementLanguage=function(t,e){var n=document.getElementById(e);n&&(n.innerHTML=lang.get(t))},n.prototype._updateDataList=function(t){if(this._dataList)if(t){this._dataList.innerHTML="";for(var e in this.model.factory.getAllDragonBonesData()){var n=document.createElement("option");n.value=e,n.innerHTML=e,this._dataList.appendChild(n)}}else this.model.armature?this._dataList.value=this.model.armature.component.armature.armatureData.parent.name:this._dataList.selectedIndex=-1},n.prototype._updateArmatureList=function(){if(this._armatureList)if(this._armatureList.innerHTML="",this.model.armature){for(var t=0,e=this.model.armature.component.armature.armatureData.parent.armatureNames;t<e.length;t++){var n=e[t],i=document.createElement("option");i.value=n,i.innerHTML=n,this._armatureList.appendChild(i)}this._armatureList.value=this.model.armature.component.armature.name}else this._armatureList.selectedIndex=-1},n.prototype._updateSkinList=function(){if(this._skinList){var t=document.getElementById("skinGroup");if(this._skinList.innerHTML="",this.model.armature){var e=new Array,n=this.model.armature.component.armature.armatureData,i=this.model.factory.getAllDragonBonesData();for(var a in i){var r=i[a];for(var o in r.armatures){var s=r.armatures[o],l=!0;if(s!==n)for(var u in s.slots)if(!n.getSlot(u)){l=!1;break}if(l)for(var h in s.skins)e.push(a+"->"+o+"->"+h)}}for(var c=0,d=e;c<d.length;c++){var h=d[c],m=document.createElement("option");m.value=h,m.innerHTML=h,this._skinList.appendChild(m)}t&&(e.length>1?(t.style.display=null,t.className="h_group"):t.style.display="none")}else t&&(t.style.display="none");this._skinList.selectedIndex=-1}},n.prototype._updateAnimationList=function(t){if(this._animationList)if(t){if(this._animationList.innerHTML="",this.model.armature)for(var e=0,n=this.model.armature.component.animation.animationNames;e<n.length;e++){var i=n[e],a=document.createElement("option");a.value=i,a.innerHTML=i,this._animationList.appendChild(a)}}else this.model.armature&&this.model.armature.animation?this._animationList.value=this.model.armature.animation.name:this._animationList.selectedIndex=-1},n.prototype._updatePlayAndStopButton=function(){this.model.armature&&this.model.armature.component.animation.isPlaying?(this._stopAnimationButton&&(this._stopAnimationButton.style.display="none"),this._playAnimationButton&&(this._playAnimationButton.style.display="block")):(this._stopAnimationButton&&(this._stopAnimationButton.style.display="block"),this._playAnimationButton&&(this._playAnimationButton.style.display="none"))},n.prototype._updateAnimationSpeedLabel=function(){this.model.armature&&this._animationSpeedLabel&&(this._animationSpeedLabel.innerHTML="X "+this.model.armature.component.animation.timeScale.toFixed(2))},n.prototype._updateGridEnabled=function(){this._gridEnabledButton&&(common.getInstance(t.Application).gridEnabled?this._gridEnabledButton.className="item selected":this._gridEnabledButton.className="item unselected")},n.prototype._updateArmatureAndAnimationInfo=function(){var t=document.getElementById("infoLabel");if(t){var e=this.model.armature;if(e){var n=e.component.armature.armatureData;return void(t.innerHTML=lang.get(lang.Label.info,n.animationNames.length,n.sortedBones.length,n.sortedSlots.length,e.animation?e.animation.currentTime.toFixed(3):0,this._getArmatureTriangleCount(e.component.armature),this._getChildArmatureCount(e.component.armature)))}}this._updateElementLanguage(lang.None,"infoLabel")},n.prototype._updateStageSize=function(){egret.Capabilities.isMobile||common.getInstance(t.Application).setStageSize(this._dragonBonesPlayer.clientWidth,this._dragonBonesPlayer.clientHeight,-this._sideValue,0)},n.prototype._getChildArmatureCount=function(t){for(var e=0,n=0,i=t.getSlots();n<i.length;n++){var a=i[n];a.childArmature&&(e++,e+=this._getChildArmatureCount(a.childArmature))}return e},n.prototype._getArmatureTriangleCount=function(t){for(var e=0,n=0,i=t.getSlots();n<i.length;n++){var a=i[n],r=a._meshData;if(r){var o=r.parent.parent.intArray;e+=o[r.offset+1]}else a.childArmature?e+=this._getArmatureTriangleCount(a.childArmature):a.display&&(e+=2)}return e},n.prototype._onInitialize=function(){var e=this;this.addNotification(t.NotificationType.VOChange,this._notificationHandler),this.addNotification(t.NotificationType.ArmatureChange,this._notificationHandler),this.addNotification(t.NotificationType.AnimationChange,this._notificationHandler),this.addNotification(t.NotificationType.AnimationStart,this._notificationHandler),this.addNotification(t.NotificationType.AnimationComplete,this._notificationHandler),this.addNotification(t.Application.TOUCH_STAGE,this._notificationHandler),this.model.factory.soundEventManager.addEventListener(dragonBones.EventObject.SOUND_EVENT,this._animationHandler,this),egret.startTick(function(t){return e._updateArmatureAndAnimationInfo(),!1},this),lang.setLanguageByString(navigator.language),this._dragonBonesPlayer=document.getElementById("dragonBonesPlayer"),this._side=document.getElementById("side"),this._sideButton=document.getElementById("sideButton"),this._dataList=document.getElementById("dataList"),this._skinList=document.getElementById("skinList"),this._armatureList=document.getElementById("armatureList"),this._animationList=document.getElementById("animationList"),this._prevAnimationButton=document.getElementById("prevAnimationButton"),this._nextAnimationButton=document.getElementById("nextAnimationButton"),this._stopAnimationButton=document.getElementById("playAnimationButton"),this._playAnimationButton=document.getElementById("stopAnimationButton"),this._animationSpeedLabel=document.getElementById("animationSpeedLabel"),this._reduceAnimationSpeedButton=document.getElementById("reduceAnimationSpeedButton"),this._increaseAnimationSpeedButton=document.getElementById("increaseAnimationSpeedButton"),this._gridEnabledButton=document.getElementById("gridEnabledButton"),this._infoLabel=document.getElementById("infoLabel"),this._dataList&&(this._dataList.onchange=function(t){var n=e.model.factory.getDragonBonesData(t.target.value);n&&n.armatureNames.length>0&&e.model.replaceArmature(n.getArmature(n.armatureNames[0]))}),this._armatureList&&(this._armatureList.onchange=function(t){if(e.model.armature){var n=e.model.armature.component.armature.armatureData,i=e.model.factory.getArmatureData(t.target.value,n.parent.name);i&&e.model.replaceArmature(i)}}),this._skinList&&(this._skinList.onchange=function(t){if(e.model.armature){var n=t.target.value.split("->"),i=e.model.armature.component.armature.armatureData,a=e.model.factory.getDragonBonesData(n[0]),r=a.getArmature(n[1]),o=r.getSkin(n[2]);i.defaultSkin&&e.model.factory.changeSkin(e.model.armature.component.armature,i.defaultSkin),e.model.factory.changeSkin(e.model.armature.component.armature,o),e.model.armature.component.armature.invalidUpdate()}}),this._animationList&&(this._animationList.onchange=function(t){e.model.armature&&e.model.armature.playAnimation(t.target.value)}),this._prevAnimationButton&&(this._prevAnimationButton.onclick=function(){e.model.armature&&(e.model.armature.stopAnimation(),e.model.armature.animation&&(e.model.armature.animation.currentTime-=1/e.model.armature.component.armature.armatureData.frameRate))}),this._nextAnimationButton&&(this._nextAnimationButton.onclick=function(){e.model.armature&&(e.model.armature.stopAnimation(),e.model.armature.animation&&(e.model.armature.animation.currentTime+=1/e.model.armature.component.armature.armatureData.frameRate))}),this._stopAnimationButton&&(this._stopAnimationButton.onclick=function(){e.model.armature&&(e.model.armature.playAnimation(),e._updatePlayAndStopButton())}),this._playAnimationButton&&(this._playAnimationButton.onclick=function(){e.model.armature&&(e.model.armature.stopAnimation(),e._updatePlayAndStopButton())}),this._reduceAnimationSpeedButton&&(this._reduceAnimationSpeedButton.onclick=function(){if(e.model.armature){var t=e._speeds.indexOf(e.model.armature.component.animation.timeScale)-1;0>t&&(t=0),e.model.armature.component.animation.timeScale=e._speeds[t],e._updateAnimationSpeedLabel()}}),this._increaseAnimationSpeedButton&&(this._increaseAnimationSpeedButton.onclick=function(){if(e.model.armature){var t=e._speeds.indexOf(e.model.armature.component.animation.timeScale)+1;t>=e._speeds.length&&(t=e._speeds.length-1),e.model.armature.component.animation.timeScale=e._speeds[t],e._updateAnimationSpeedLabel()}}),this._gridEnabledButton&&(this._gridEnabledButton.onclick=function(){common.getInstance(t.Application).gridEnabled=!common.getInstance(t.Application).gridEnabled,e._updateGridEnabled()}),this._sideButton.onclick=function(){e.showSide=!e.showSide},this._updateDataList(!0),this._updateDataList(!1),this._updateArmatureList(),this._updateSkinList(),this._updateAnimationList(!0),this._updateAnimationList(!1),this._updatePlayAndStopButton(),this._updateAnimationSpeedLabel(),this._updateGridEnabled(),this._updateArmatureAndAnimationInfo(),this._updateElementLanguage(lang.Label.backgroundColor,"backgroundColorLabel"),this._updateElementLanguage(lang.Label.grid,"gridLabel");var n=document.getElementById("backgroundColor");if(this._dragonBonesPlayer&&n)for(var i=function(t,i){var a=n.children.item(t);a.onclick=function(){e._dragonBonesPlayer.style.backgroundColor=a.style.backgroundColor}},a=0,r=n.children.length;r>a;++a)i(a,r);var o=document.getElementById("qrCodeGroup");if(o)if(egret.Capabilities.isMobile)o&&(o.style.display="none");else{var s=document.getElementById("data");s&&new QRCode(document.getElementById("qrCode"),{width:120,height:120}).makeCode(window.location.href)}},Object.defineProperty(n.prototype,"showSide",{get:function(){return this._showSide},set:function(t){this._showSide!==t&&(this._showSide=t,egret.Tween.get(this).to({sideValue:this._showSide?n.SIDE_WIDTH:0},300,egret.Ease.cubicOut).call(this._updateStageSize,this))},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"sideValue",{get:function(){return this._sideValue},set:function(t){this._sideValue!==t&&(this._sideValue=t,this._side.style.right=this._sideValue-n.SIDE_WIDTH+"px",this._sideButton.style.right=this._sideValue+"px")},enumerable:!0,configurable:!0}),n.SIDE_WIDTH=260,n}(t.BaseView);t.SideView=e,__reflect(e.prototype,"player.SideView")}(player||(player={}));