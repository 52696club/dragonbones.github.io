"use strict";function enableDrag(e){e&&(e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,_dragHandler,e),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,_dragHandler,e),e.addEventListener(egret.TouchEvent.TOUCH_END,_dragHandler,e))}function disableDrag(e){e&&(e.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,_dragHandler,e),e.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,_dragHandler,e),e.removeEventListener(egret.TouchEvent.TOUCH_END,_dragHandler,e))}function _dragHandler(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:if(dragTarget)return;dragTarget=e.target,dragTarget.parent.globalToLocal(e.stageX,e.stageY,_helpPoint),_dragOffset.x=dragTarget.x-_helpPoint.x,_dragOffset.y=dragTarget.y-_helpPoint.y,dragTarget.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,_dragHandler,dragTarget);break;case egret.TouchEvent.TOUCH_RELEASE_OUTSIDE:case egret.TouchEvent.TOUCH_END:dragTarget&&(dragTarget.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,_dragHandler,dragTarget),dragTarget=null);break;case egret.TouchEvent.TOUCH_MOVE:dragTarget&&(dragTarget.parent.globalToLocal(e.stageX,e.stageY,_helpPoint),dragTarget.x=_helpPoint.x+_dragOffset.x,dragTarget.y=_helpPoint.y+_dragOffset.y)}}var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}(),BaseDemo=function(e){function t(){var a=e.call(this)||this;return a._loadCount=0,a._background=new egret.Bitmap,a._resources=[],a._resourceMap={},a._resources.push(t.BACKGROUND_URL),a.addEventListener(egret.Event.ADDED_TO_STAGE,function(){a.x=.5*a.stageWidth,a.y=.5*a.stageHeight,a._loadResources()},a),a}return __extends(t,e),t.prototype._loadResources=function(){var e=this;this._loadCount=this._resources.length;for(var a=0,s=this._resources;a<s.length;a++){var i=s[a];RES.getResByUrl(i,function(a,s){e._resourceMap[s]=a,e._loadCount--,0===e._loadCount&&(RES.getRes=function(t){return e._resourceMap[t]},e._background.texture=RES.getRes(t.BACKGROUND_URL),e._background.x=.5*-e._background.texture.textureWidth,e._background.y=.5*-e._background.texture.textureHeight,e.addChild(e._background),e._onStart())},this,i.indexOf(".dbbin")>0?RES.ResourceItem.TYPE_BIN:null)}},t.prototype.createText=function(e){var t=new egret.TextField;return t.size=20,t.textAlign=egret.HorizontalAlign.CENTER,t.text=e,t.width=this.stageWidth,t.x=.5*-this.stageWidth,t.y=.5*this.stageHeight-100,this.addChild(t),t},Object.defineProperty(t.prototype,"stageWidth",{get:function(){return this.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stageHeight",{get:function(){return this.stage.stageHeight},enumerable:!0,configurable:!0}),t.BACKGROUND_URL="resource/background.png",t}(egret.DisplayObjectContainer);__reflect(BaseDemo.prototype,"BaseDemo");var SetBoneOffset=function(e){function t(){var t=e.call(this)||this;return t._resources.push("resource/assets/effect_ske.json","resource/assets/effect_tex.json","resource/assets/effect_tex.png"),t}return __extends(t,e),t.prototype._onStart=function(){var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(RES.getRes("resource/assets/effect_ske.json")),e.parseTextureAtlasData(RES.getRes("resource/assets/effect_tex.json"),RES.getRes("resource/assets/effect_tex.png"));for(var t=0;100>t;++t){var a=e.buildArmatureDisplay("effect");a.addEventListener(dragonBones.EventObject.COMPLETE,this._animationHandler,this),this._moveTo(a),this.addChild(a)}},t.prototype._animationHandler=function(e){this._moveTo(e.eventObject.armature.display)},t.prototype._moveTo=function(e){var t=Math.random()*this.stageWidth,a=Math.random()*this.stageHeight,s=Math.random()*this.stageWidth,i=Math.random()*this.stageHeight,r=s-t,n=i-a,o=e.armature.getBone("root"),_=e.armature.getBone("effect");o.offset.scaleX=Math.sqrt(r*r+n*n)/100,o.offset.rotation=Math.atan2(n,r),o.offset.skew=Math.random()*Math.PI-.5*Math.PI,_.offset.scaleX=.5+.5*Math.random(),_.offset.scaleY=.5+.5*Math.random(),o.invalidUpdate(),_.invalidUpdate(),e.x=t,e.y=a,e.animation.timeScale=.5+1*Math.random(),e.animation.play("idle",1)},t}(BaseDemo);__reflect(SetBoneOffset.prototype,"SetBoneOffset");var dragTarget=null,_helpPoint=new egret.Point,_dragOffset=new egret.Point,AnimationBase=function(e){function t(){var t=e.call(this)||this;return t._resources.push("resource/progress_bar/progress_bar_ske.json","resource/progress_bar/progress_bar_tex.json","resource/progress_bar/progress_bar_tex.png"),t}return __extends(t,e),t.prototype._onStart=function(){var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(RES.getRes("resource/progress_bar/progress_bar_ske.json")),e.parseTextureAtlasData(RES.getRes("resource/progress_bar/progress_bar_tex.json"),RES.getRes("resource/progress_bar/progress_bar_tex.png")),this._armatureDisplay=e.buildArmatureDisplay("progress_bar"),this._armatureDisplay.x=0,this._armatureDisplay.y=0,this.addChild(this._armatureDisplay),this._armatureDisplay.addEventListener(dragonBones.EventObject.START,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._animationEventHandler,this),this._armatureDisplay.animation.play("idle"),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._touchHandler,this),this.createText("Click to control animation play progress.")},t.prototype._touchHandler=function(e){var t=Math.min(Math.max((e.stageX-this.x+300)/600,0),1);switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:this._armatureDisplay.animation.gotoAndStopByProgress("idle",t);break;case egret.TouchEvent.TOUCH_END:this._armatureDisplay.animation.play();break;case egret.TouchEvent.TOUCH_MOVE:if(e.touchDown){var a=this._armatureDisplay.animation.getState("idle");a&&(a.currentTime=a.totalTime*t)}}},t.prototype._animationEventHandler=function(e){console.log(e.eventObject.animationState.name,e.type,e.eventObject.name)},t}(BaseDemo);__reflect(AnimationBase.prototype,"AnimationBase");var BoundingBoxTest=function(e){function t(){var t=e.call(this)||this;return t._helpPointA=new egret.Point,t._helpPointB=new egret.Point,t._helpPointC=new egret.Point,t._resources.push("resource/assets/core_element/mecha_2903_ske.json","resource/assets/core_element/mecha_2903_tex.json","resource/assets/core_element/mecha_2903_tex.png","resource/assets/bounding_box_test_ske.json","resource/assets/bounding_box_test_tex.json","resource/assets/bounding_box_test_tex.png"),t}return __extends(t,e),t.prototype._onStart=function(){var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(RES.getRes("resource/assets/core_element/mecha_2903_ske.json")),e.parseTextureAtlasData(RES.getRes("resource/assets/core_element/mecha_2903_tex.json"),RES.getRes("resource/assets/core_element/mecha_2903_tex.png")),e.parseDragonBonesData(RES.getRes("resource/assets/bounding_box_test_ske.json")),e.parseTextureAtlasData(RES.getRes("resource/assets/bounding_box_test_tex.json"),RES.getRes("resource/assets/bounding_box_test_tex.png")),this._armatureDisplay=e.buildArmatureDisplay("mecha_2903d"),this._boundingBoxTester=e.buildArmatureDisplay("tester"),this._targetA=this._boundingBoxTester.armature.getSlot("target_a").display,this._targetB=this._boundingBoxTester.armature.getSlot("target_b").display,this._line=this._boundingBoxTester.armature.getSlot("line").display,this._pointA=this._boundingBoxTester.armature.getSlot("point_a").display,this._pointB=this._boundingBoxTester.armature.getSlot("point_b").display,this._armatureDisplay.debugDraw=!0,this._armatureDisplay.x=.5*this.stageWidth,this._armatureDisplay.y=.5*this.stageHeight,this._boundingBoxTester.x=.5*this.stageWidth,this._boundingBoxTester.y=.5*this.stageHeight+100,this._targetA.armature.inheritAnimation=!1,this._targetB.armature.inheritAnimation=!1,this._armatureDisplay.animation.play("walk"),this._boundingBoxTester.animation.play("0"),this._line.anchorOffsetX=0,this.addChild(this._armatureDisplay),this.addChild(this._boundingBoxTester),this.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),enableDrag(this._targetA),enableDrag(this._targetB),enableDrag(this._boundingBoxTester),this.createText("Drag to move bounding box tester.")},t.prototype._enterFrameHandler=function(e){this._boundingBoxTester.localToGlobal(this._targetA.x,this._targetA.y,this._helpPointA),this._boundingBoxTester.localToGlobal(this._targetB.x,this._targetB.y,this._helpPointB),this._armatureDisplay.globalToLocal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this._armatureDisplay.globalToLocal(this._helpPointB.x,this._helpPointB.y,this._helpPointB);var t=this._armatureDisplay.armature.containsPoint(this._helpPointA.x,this._helpPointA.y),a=this._armatureDisplay.armature.containsPoint(this._helpPointB.x,this._helpPointB.y),s=this._armatureDisplay.armature.intersectsSegment(this._helpPointA.x,this._helpPointA.y,this._helpPointB.x,this._helpPointB.y,this._helpPointA,this._helpPointB,this._helpPointC),i=t?"1":"0";this._targetA.animation.lastAnimationName!==i&&(this._targetA.animation.fadeIn(i,.2).resetToPose=!1);var i=a?"1":"0";this._targetB.animation.lastAnimationName!==i&&(this._targetB.animation.fadeIn(i,.2).resetToPose=!1);var r=this._targetB.x-this._targetA.x,n=this._targetB.y-this._targetA.y;this._line.x=this._targetA.x,this._line.y=this._targetA.y,this._line.scaleX=Math.sqrt(r*r+n*n)/400,this._line.rotation=Math.atan2(n,r)*dragonBones.Transform.RAD_DEG;var i=s?"1":"0";this._boundingBoxTester.animation.lastAnimationName!==i&&(this._boundingBoxTester.animation.fadeIn(i,.2).resetToPose=!1),s?(this._armatureDisplay.localToGlobal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this._armatureDisplay.localToGlobal(this._helpPointB.x,this._helpPointB.y,this._helpPointB),this._boundingBoxTester.globalToLocal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this._boundingBoxTester.globalToLocal(this._helpPointB.x,this._helpPointB.y,this._helpPointB),this._pointA.visible=!0,this._pointB.visible=!0,this._pointA.x=this._helpPointA.x,this._pointA.y=this._helpPointA.y,this._pointB.x=this._helpPointB.x,this._pointB.y=this._helpPointB.y,this._pointA.rotation=this._helpPointC.x*dragonBones.Transform.RAD_DEG,this._pointB.rotation=this._helpPointC.y*dragonBones.Transform.RAD_DEG,this._pointA.scaleX=this._pointA.scaleY=.6,this._pointB.scaleX=this._pointB.scaleY=.4):(this._pointA.visible=!1,this._pointB.visible=!1)},t}(BaseDemo);__reflect(BoundingBoxTest.prototype,"BoundingBoxTest");var coreElement;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t._left=!1,t._right=!1,t._bullets=[],t._resources.push("resource/assets/core_element/mecha_1502b_ske.json","resource/assets/core_element/mecha_1502b_tex.json","resource/assets/core_element/mecha_1502b_tex.png","resource/assets/core_element/skin_1502b_ske.json","resource/assets/core_element/skin_1502b_tex.json","resource/assets/core_element/skin_1502b_tex.png","resource/assets/core_element/weapon_1000_ske.json","resource/assets/core_element/weapon_1000_tex.json","resource/assets/core_element/weapon_1000_tex.png"),t}return __extends(t,e),t.prototype._onStart=function(){t.GROUND=this.stageHeight-150,t.instance=this,this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),document.addEventListener("keydown",this._keyHandler),document.addEventListener("keyup",this._keyHandler);var e=egret.sys.TouchHandler.prototype.onTouchMove;egret.sys.TouchHandler.prototype.onTouchMove=function(a,s,i){e.call(this,a,s,i),t.instance._player.aim(a,s)},this.createText("Press W/A/S/D to move. Press Q/E to switch weapons. Press SPACE to switch skin.\nMouse Move to aim. Click to fire.");var s=dragonBones.EgretFactory.factory;s.parseDragonBonesData(RES.getRes("resource/assets/core_element/mecha_1502b_ske.json")),s.parseTextureAtlasData(RES.getRes("resource/assets/core_element/mecha_1502b_tex.json"),RES.getRes("resource/assets/core_element/mecha_1502b_tex.png")),s.parseDragonBonesData(RES.getRes("resource/assets/core_element/skin_1502b_ske.json")),s.parseTextureAtlasData(RES.getRes("resource/assets/core_element/skin_1502b_tex.json"),RES.getRes("resource/assets/core_element/skin_1502b_tex.png")),s.parseDragonBonesData(RES.getRes("resource/assets/core_element/weapon_1000_ske.json")),s.parseTextureAtlasData(RES.getRes("resource/assets/core_element/weapon_1000_tex.json"),RES.getRes("resource/assets/core_element/weapon_1000_tex.png")),this._player=new a},t.prototype._touchHandler=function(e){this._player.aim(e.stageX,e.stageY),e.type===egret.TouchEvent.TOUCH_BEGIN?this._player.attack(!0):this._player.attack(!1)},t.prototype._keyHandler=function(e){var a="keydown"===e.type;switch(e.keyCode){case 37:case 65:t.instance._left=a,t.instance._updateMove(-1);break;case 39:case 68:t.instance._right=a,t.instance._updateMove(1);break;case 38:case 87:a&&t.instance._player.jump();break;case 83:case 40:t.instance._player.squat(a);break;case 81:a&&t.instance._player.switchWeaponR();break;case 69:a&&t.instance._player.switchWeaponL();break;case 32:a&&t.instance._player.switchSkin()}},t.prototype._enterFrameHandler=function(e){this._player&&this._player.update();for(var t=this._bullets.length;t--;){var a=this._bullets[t];a.update()&&this._bullets.splice(t,1)}},t.prototype._updateMove=function(e){this._left&&this._right?this._player.move(e):this._left?this._player.move(-1):this._right?this._player.move(1):this._player.move(0)},t.prototype.addBullet=function(e){this._bullets.push(e)},t.G=.6,t}(BaseDemo);e.Game=t,__reflect(t.prototype,"coreElement.Game");var a=function(){function e(){this._isJumpingA=!1,this._isJumpingB=!1,this._isSquating=!1,this._isAttackingA=!1,this._isAttackingB=!1,this._weaponRIndex=0,this._weaponLIndex=0,this._skinIndex=0,this._faceDir=1,this._aimDir=0,this._moveDir=0,this._aimRadian=0,this._speedX=0,this._speedY=0,this._aimState=null,this._walkState=null,this._attackState=null,this._target=new egret.Point,this._helpPoint=new egret.Point,this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay("mecha_1502b"),this._armatureDisplay.x=.5*t.instance.stageWidth,this._armatureDisplay.y=t.GROUND,this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._armature=this._armatureDisplay.armature,this._weaponL=this._armature.getSlot("weapon_l").childArmature,this._weaponR=this._armature.getSlot("weapon_r").childArmature,this._weaponL.eventDispatcher.addDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._weaponR.eventDispatcher.addDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),t.instance.addChild(this._armatureDisplay),this._updateAnimation()}return e.prototype.move=function(e){this._moveDir!==e&&(this._moveDir=e,this._updateAnimation())},e.prototype.jump=function(){this._isJumpingA||(this._isJumpingA=!0,this._armature.animation.fadeIn("jump_1",-1,-1,0,e.NORMAL_ANIMATION_GROUP).resetToPose=!1,this._walkState=null)},e.prototype.squat=function(e){this._isSquating!==e&&(this._isSquating=e,this._updateAnimation())},e.prototype.attack=function(e){this._isAttackingA!==e&&(this._isAttackingA=e)},e.prototype.switchWeaponL=function(){this._weaponL.eventDispatcher.removeDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._weaponLIndex++,this._weaponLIndex%=e.WEAPON_L_LIST.length;var t=e.WEAPON_L_LIST[this._weaponLIndex];this._weaponL=dragonBones.EgretFactory.factory.buildArmature(t),this._armature.getSlot("weapon_l").childArmature=this._weaponL,this._weaponL.eventDispatcher.addDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this)},e.prototype.switchWeaponR=function(){this._weaponR.eventDispatcher.removeDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._weaponRIndex++,this._weaponRIndex%=e.WEAPON_R_LIST.length;var t=e.WEAPON_R_LIST[this._weaponRIndex];this._weaponR=dragonBones.EgretFactory.factory.buildArmature(t),this._armature.getSlot("weapon_r").childArmature=this._weaponR,this._weaponR.eventDispatcher.addDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this)},e.prototype.switchSkin=function(){this._skinIndex++,this._skinIndex%=e.SKINS.length;var t=e.SKINS[this._skinIndex],a=dragonBones.EgretFactory.factory.getArmatureData(t).defaultSkin;dragonBones.EgretFactory.factory.replaceSkin(this._armature,a,!1,["weapon_l","weapon_r"])},e.prototype.aim=function(e,t){this._target.x=e,this._target.y=t},e.prototype.update=function(){this._updatePosition(),this._updateAim(),this._updateAttack()},e.prototype._animationEventHandler=function(t){switch(t.type){case dragonBones.EventObject.FADE_IN_COMPLETE:"jump_1"===t.eventObject.animationState.name&&(this._isJumpingB=!0,this._speedY=-e.JUMP_SPEED,0!==this._moveDir&&(this._moveDir*this._faceDir>0?this._speedX=e.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-e.MAX_MOVE_SPEED_BACK*this._faceDir),this._armature.animation.fadeIn("jump_2",-1,-1,0,e.NORMAL_ANIMATION_GROUP).resetToPose=!1);break;case dragonBones.EventObject.FADE_OUT_COMPLETE:"attack_01"===t.eventObject.animationState.name&&(this._isAttackingB=!1,this._attackState=null);break;case dragonBones.EventObject.COMPLETE:"jump_4"===t.eventObject.animationState.name&&(this._isJumpingA=!1,this._isJumpingB=!1,this._updateAnimation())}},e.prototype._frameEventHandler=function(e){"fire"===e.eventObject.name&&(e.eventObject.armature.display.localToGlobal(e.eventObject.bone.global.x,e.eventObject.bone.global.y,this._helpPoint),this._fire(this._helpPoint))},e.prototype._fire=function(e){var a=this._faceDir<0?Math.PI-this._aimRadian:this._aimRadian,i=new s("bullet_01","fire_effect_01",a+.02*Math.random()-.01,40,e);t.instance.addBullet(i)},e.prototype._updateAnimation=function(){return this._isJumpingA?void 0:this._isSquating?(this._speedX=0,this._armature.animation.fadeIn("squat",-1,-1,0,e.NORMAL_ANIMATION_GROUP).resetToPose=!1,void(this._walkState=null)):void(0===this._moveDir?(this._speedX=0,this._armature.animation.fadeIn("idle",-1,-1,0,e.NORMAL_ANIMATION_GROUP).resetToPose=!1,this._walkState=null):(null===this._walkState&&(this._walkState=this._armature.animation.fadeIn("walk",-1,-1,0,e.NORMAL_ANIMATION_GROUP),this._walkState.resetToPose=!1),this._moveDir*this._faceDir>0?this._walkState.timeScale=e.MAX_MOVE_SPEED_FRONT/e.NORMALIZE_MOVE_SPEED:this._walkState.timeScale=-e.MAX_MOVE_SPEED_BACK/e.NORMALIZE_MOVE_SPEED,this._moveDir*this._faceDir>0?this._speedX=e.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-e.MAX_MOVE_SPEED_BACK*this._faceDir))},e.prototype._updatePosition=function(){0!==this._speedX&&(this._armatureDisplay.x+=this._speedX,this._armatureDisplay.x<0?this._armatureDisplay.x=0:this._armatureDisplay.x>t.instance.stageWidth&&(this._armatureDisplay.x=t.instance.stageWidth)),0!==this._speedY&&(this._speedY<5&&this._speedY+t.G>=5&&(this._armature.animation.fadeIn("jump_3",-1,-1,0,e.NORMAL_ANIMATION_GROUP).resetToPose=!1),this._speedY+=t.G,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.y>t.GROUND&&(this._armatureDisplay.y=t.GROUND,this._speedY=0,this._armature.animation.fadeIn("jump_4",-1,-1,0,e.NORMAL_ANIMATION_GROUP).resetToPose=!1))},e.prototype._updateAim=function(){this._faceDir=this._target.x>this._armatureDisplay.x?1:-1,this._armatureDisplay.armature.flipX!==this._faceDir<0&&(this._armatureDisplay.armature.flipX=!this._armatureDisplay.armature.flipX,0!==this._moveDir&&this._updateAnimation());var t=this._armature.getBone("chest").global.y*this._armatureDisplay.scaleY;this._faceDir>0?this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y-t,this._target.x-this._armatureDisplay.x):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y-t,this._target.x-this._armatureDisplay.x),this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var a=0;a=this._aimRadian>0?-1:1,(null===this._aimState||this._aimDir!==a)&&(this._aimDir=a,this._aimDir>=0?this._aimState=this._armature.animation.fadeIn("aim_up",-1,-1,0,e.AIM_ANIMATION_GROUP):this._aimState=this._armature.animation.fadeIn("aim_down",-1,-1,0,e.AIM_ANIMATION_GROUP),this._aimState.resetToPose=!1),this._aimState.weight=Math.abs(this._aimRadian/Math.PI*2),this._armature.invalidUpdate()},e.prototype._updateAttack=function(){this._isAttackingA&&!this._isAttackingB&&(this._isAttackingB=!0,this._attackState=this._armature.animation.fadeIn("attack_01",-1,-1,0,e.ATTACK_ANIMATION_GROUP),this._attackState.resetToPose=!1,this._attackState.autoFadeOutTime=this._attackState.fadeTotalTime)},e.JUMP_SPEED=20,e.NORMALIZE_MOVE_SPEED=3.6,e.MAX_MOVE_SPEED_FRONT=1.4*e.NORMALIZE_MOVE_SPEED,e.MAX_MOVE_SPEED_BACK=1*e.NORMALIZE_MOVE_SPEED,e.NORMAL_ANIMATION_GROUP="normal",e.AIM_ANIMATION_GROUP="aim",e.ATTACK_ANIMATION_GROUP="attack",e.WEAPON_L_LIST=["weapon_1502b_l","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d","weapon_1005e"],e.WEAPON_R_LIST=["weapon_1502b_r","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d"],e.SKINS=["mecha_1502b","skin_a","skin_b","skin_c"],e}();__reflect(a.prototype,"Mecha");var s=function(){function e(e,a,s,i,r){this._speedX=0,this._speedY=0,this._effecDisplay=null,this._speedX=Math.cos(s)*i,this._speedY=Math.sin(s)*i,this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay(e),this._armatureDisplay.x=r.x+2*Math.random()-1,this._armatureDisplay.y=r.y+2*Math.random()-1,this._armatureDisplay.rotation=180*s/Math.PI,null!==a&&(this._effecDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay(a),this._effecDisplay.rotation=180*s/Math.PI,this._effecDisplay.x=this._armatureDisplay.x,this._effecDisplay.y=this._armatureDisplay.y,this._effecDisplay.scaleX=1+1*Math.random(),this._effecDisplay.scaleY=1+.5*Math.random(),Math.random()<.5&&(this._effecDisplay.scaleY*=-1),t.instance.addChild(this._effecDisplay),this._effecDisplay.animation.play("idle")),t.instance.addChild(this._armatureDisplay),this._armatureDisplay.animation.play("idle")}return e.prototype.update=function(){return this._armatureDisplay.x+=this._speedX,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.x<-100||this._armatureDisplay.x>=t.instance.stageWidth+100||this._armatureDisplay.y<-100||this._armatureDisplay.y>=t.instance.stageHeight+100?(t.instance.removeChild(this._armatureDisplay),this._armatureDisplay.dispose(),null!==this._effecDisplay&&(t.instance.removeChild(this._effecDisplay),this._effecDisplay.dispose()),!0):!1},e}();__reflect(s.prototype,"Bullet")}(coreElement||(coreElement={}));var Main=function(e){function t(){var t=e.call(this)||this;return t.addChild(new ReplaceSkin),t}return __extends(t,e),t}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var PerformanceTest=function(e){function t(){var t=e.call(this)||this;return t._addingArmature=!1,t._removingArmature=!1,t._armatures=[],t._resources.push("resource/assets/dragon_boy_ske.dbbin","resource/assets/dragon_boy_tex.json","resource/assets/dragon_boy_tex.png"),t}return __extends(t,e),t.prototype._onStart=function(){this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),this._text=this.createText("");for(var e=0;300>e;++e)this._addArmature();this._resetPosition(),this._updateText()},t.prototype._enterFrameHandler=function(e){if(this._addingArmature){for(var t=0;10>t;++t)this._addArmature();this._resetPosition(),this._updateText()}if(this._removingArmature){for(var t=0;10>t;++t)this._removeArmature();this._resetPosition(),this._updateText()}},t.prototype._touchHandler=function(e){switch(e.type){case egret.TouchEvent.TOUCH_BEGIN:var t=e.stageX>.5*this.stageWidth;this._addingArmature=t,this._removingArmature=!t;break;case egret.TouchEvent.TOUCH_END:this._addingArmature=!1,this._removingArmature=!1}},t.prototype._addArmature=function(){var e=dragonBones.EgretFactory.factory;0===this._armatures.length&&(e.parseDragonBonesData(RES.getRes("resource/assets/dragon_boy_ske.dbbin")),e.parseTextureAtlasData(RES.getRes("resource/assets/dragon_boy_tex.json"),RES.getRes("resource/assets/dragon_boy_tex.png")));var t=e.buildArmatureDisplay("DragonBoy");t.armature.cacheFrameRate=24,t.animation.play("walk",0),t.scaleX=t.scaleY=.7,this.addChild(t),this._armatures.push(t)},t.prototype._removeArmature=function(){if(0!==this._armatures.length){var e=this._armatures.pop();this.removeChild(e),e.dispose(),0===this._armatures.length&&(dragonBones.EgretFactory.factory.clear(!0),dragonBones.BaseObject.clearPool())}},t.prototype._resetPosition=function(){var e=this._armatures.length;if(0!==e)for(var t=50,a=150,s=100,i=this.stageWidth-2*t,r=Math.floor(i/s),n=.5*(this.stageWidth-r*s),o=i/r,_=(this.stageHeight-2*a)/Math.ceil(e/r),h=0,l=e;l>h;++h){var p=this._armatures[h],c=Math.floor(h/r);p.x=h%r*o+n,p.y=c*_+a}},t.prototype._updateText=function(){this._text.text="Count: "+this._armatures.length+" \nTouch screen left to decrease count / right to increase count.",this._text.width=this.stageWidth,this._text.x=0,this._text.y=this.stageHeight-60,this.addChild(this._text)},t}(BaseDemo);__reflect(PerformanceTest.prototype,"PerformanceTest");var ReplaceAnimation=function(e){function t(){var t=e.call(this)||this;return t._resources.push("resource/mecha_2903/mecha_2903_ske.json","resource/mecha_2903/mecha_2903_tex.json","resource/mecha_2903/mecha_2903_tex.png"),t}return __extends(t,e),t.prototype._onStart=function(){var e=this,t=dragonBones.EgretFactory.factory;t.parseDragonBonesData(RES.getRes("resource/mecha_2903/mecha_2903_ske.json")),t.parseTextureAtlasData(RES.getRes("resource/mecha_2903/mecha_2903_tex.json"),RES.getRes("resource/mecha_2903/mecha_2903_tex.png")),this._armatureDisplayA=t.buildArmatureDisplay("mecha_2903"),this._armatureDisplayB=t.buildArmatureDisplay("mecha_2903b"),this._armatureDisplayC=t.buildArmatureDisplay("mecha_2903c"),this._armatureDisplayD=t.buildArmatureDisplay("mecha_2903d");var a=t.getArmatureData("mecha_2903d");t.replaceAnimation(this._armatureDisplayA.armature,a),t.replaceAnimation(this._armatureDisplayB.armature,a),t.replaceAnimation(this._armatureDisplayC.armature,a),this.addChild(this._armatureDisplayD),this.addChild(this._armatureDisplayA),this.addChild(this._armatureDisplayB),this.addChild(this._armatureDisplayC),this._armatureDisplayA.x=-350,this._armatureDisplayA.y=150,this._armatureDisplayB.x=0,this._armatureDisplayB.y=150,this._armatureDisplayC.x=350,this._armatureDisplayC.y=150,this._armatureDisplayD.x=0,this._armatureDisplayD.y=-50,this.stage.addEventListener(egret.TouchEvent.TOUCH_END,function(){e._changeAnimation()},this),this.createText("Click to change animation.")},t.prototype._changeAnimation=function(){var e=this._armatureDisplayD.animation.lastAnimationName;if(e){var t=this._armatureDisplayD.animation.animationNames,a=(t.indexOf(e)+1)%t.length;this._armatureDisplayD.animation.play(t[a])}else this._armatureDisplayD.animation.play();e=this._armatureDisplayD.animation.lastAnimationName,this._armatureDisplayA.animation.play(e),this._armatureDisplayB.animation.play(e),this._armatureDisplayC.animation.play(e)},t}(BaseDemo);__reflect(ReplaceAnimation.prototype,"ReplaceAnimation");var ReplaceSkin=function(e){function t(){var t=e.call(this)||this;t._replaceSuitIndex=0,t._factory=dragonBones.EgretFactory.factory,t._suitConfigs=[],t._replaceSuitParts=[],t._suitConfigs.push(["2010600a","2010600a_1","20208003","20208003_1","20208003_2","20208003_3","20405006","20509005","20703016","20703016_1","2080100c","2080100e","2080100e_1","20803005","2080500b","2080500b_1"]),t._suitConfigs.push(["20106010","20106010_1","20208006","20208006_1","20208006_2","20208006_3","2040600b","2040600b_1","20509007","20703020","20703020_1","2080b003","20801015"]),t._resources.push("resource/you_xin/body/body_ske.json","resource/you_xin/body/body_tex.json","resource/you_xin/body/body_tex.png");for(var a=0,s=t._suitConfigs.length;s>a;++a)for(var i=0,r=t._suitConfigs[a];i<r.length;i++){var n=r[i],o="resource/you_xin/suit"+(a+1)+"/"+n+"/"+n,_=o+"_ske.json",h=o+"_tex.json",l=o+"_tex.png";t._resources.push(_,h,l)}return t}return __extends(t,e),t.prototype._onStart=function(){var e=this;this._factory.parseDragonBonesData(RES.getRes("resource/you_xin/body/body_ske.json")),this._factory.parseTextureAtlasData(RES.getRes("resource/you_xin/body/body_tex.json"),RES.getRes("resource/you_xin/body/body_tex.png"));for(var t=0,a=this._suitConfigs.length;a>t;++t)for(var s=0,i=this._suitConfigs[t];s<i.length;s++){var r=i[s],n="resource/you_xin/suit"+(t+1)+"/"+r+"/"+r,o=n+"_ske.json",_=n+"_tex.json",h=n+"_tex.png";this._factory.parseDragonBonesData(RES.getRes(o)),this._factory.parseTextureAtlasData(RES.getRes(_),RES.getRes(h))}this._armatureDisplay=this._factory.buildArmatureDisplay("body"),this._armatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.animation.play("idle",0),this._armatureDisplay.x=0,this._armatureDisplay.y=200,this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=.25,this.addChild(this._armatureDisplay);for(var l=0,p=this._suitConfigs[0];l<p.length;l++){var c=p[l],u=this._factory.getArmatureData(c);this._factory.replaceSkin(this._armatureDisplay.armature,u.defaultSkin)}this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e._randomReplaceSkin()},this),this.createText("Touch to replace armature skin.")},t.prototype._animationEventHandler=function(e){var t=Math.floor(Math.random()*this._armatureDisplay.animation.animationNames.length),a=this._armatureDisplay.animation.animationNames[t];this._armatureDisplay.animation.fadeIn(a,.3,0)},t.prototype._randomReplaceSkin=function(){if(0==this._replaceSuitParts.length){this._replaceSuitIndex++,this._replaceSuitIndex>=this._suitConfigs.length&&(this._replaceSuitIndex=0);for(var e=0,t=this._suitConfigs[this._replaceSuitIndex];e<t.length;e++){var a=t[e];this._replaceSuitParts.push(a)}}var s=Math.floor(Math.random()*this._replaceSuitParts.length),i=this._replaceSuitParts[s],r=this._factory.getArmatureData(i);this._factory.replaceSkin(this._armatureDisplay.armature,r.defaultSkin),this._replaceSuitParts.splice(s,1)},t}(BaseDemo);__reflect(ReplaceSkin.prototype,"ReplaceSkin");var ReplaceSlotDisplay=function(e){function t(){var t=e.call(this)||this;return t._leftWeaponIndex=0,t._rightWeaponIndex=0,t._factory=dragonBones.EgretFactory.factory,t._resources.push("resource/mecha_1004d_show/mecha_1004d_show_ske.json","resource/mecha_1004d_show/mecha_1004d_show_tex.json","resource/mecha_1004d_show/mecha_1004d_show_tex.png","resource/weapon_1004_show/weapon_1004_show_ske.json","resource/weapon_1004_show/weapon_1004_show_tex.json","resource/weapon_1004_show/weapon_1004_show_tex.png"),t
}return __extends(t,e),t.prototype._onStart=function(){var e=this;this._factory.parseDragonBonesData(RES.getRes("resource/mecha_1004d_show/mecha_1004d_show_ske.json")),this._factory.parseTextureAtlasData(RES.getRes("resource/mecha_1004d_show/mecha_1004d_show_tex.json"),RES.getRes("resource/mecha_1004d_show/mecha_1004d_show_tex.png")),this._factory.parseDragonBonesData(RES.getRes("resource/weapon_1004_show/weapon_1004_show_ske.json")),this._factory.parseTextureAtlasData(RES.getRes("resource/weapon_1004_show/weapon_1004_show_tex.json"),RES.getRes("resource/weapon_1004_show/weapon_1004_show_tex.png")),this._armatureDisplay=this._factory.buildArmatureDisplay("mecha_1004d"),this._armatureDisplay.animation.play(),this._armatureDisplay.x=100,this._armatureDisplay.y=200,this.addChild(this._armatureDisplay),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){var a=t.stageX-e.x;-150>a?e._replaceDisplay(-1):a>150?e._replaceDisplay(1):e._replaceDisplay(0)},this),this.createText("Touch screen left / center / right to relace slot display.")},t.prototype._replaceDisplay=function(e){if(-1===e){this._rightWeaponIndex++,this._rightWeaponIndex%=t.WEAPON_RIGHT_LIST.length;var a=t.WEAPON_RIGHT_LIST[this._rightWeaponIndex];this._factory.replaceSlotDisplay("weapon_1004_show","weapon","weapon_r",a,this._armatureDisplay.armature.getSlot("weapon_hand_r"))}else if(1===e)this._leftWeaponIndex++,this._leftWeaponIndex%=5,this._armatureDisplay.armature.getSlot("weapon_hand_l").displayIndex=this._leftWeaponIndex;else{var s=this._armatureDisplay.armature.getSlot("logo");s.display===this._logoText?s.display=s.rawDisplay:(this._logoText||(this._logoText=new egret.TextField,this._logoText.text="Core Element",this._logoText.anchorOffsetX=.5*this._logoText.width,this._logoText.anchorOffsetY=.5*this._logoText.height),s.display=this._logoText)}},t.WEAPON_RIGHT_LIST=["weapon_1004_r","weapon_1004b_r","weapon_1004c_r","weapon_1004d_r","weapon_1004e_r","weapon_1004s_r"],t}(BaseDemo);__reflect(ReplaceSlotDisplay.prototype,"ReplaceSlotDisplay");var HelloDragonBones=function(e){function t(){var t=e.call(this)||this;return t._resources.push("resource/mecha_1002_101d_show/mecha_1002_101d_show_ske.json","resource/mecha_1002_101d_show/mecha_1002_101d_show_tex.json","resource/mecha_1002_101d_show/mecha_1002_101d_show_tex.png"),t}return __extends(t,e),t.prototype._onStart=function(){var e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(RES.getRes("resource/mecha_1002_101d_show/mecha_1002_101d_show_ske.json")),e.parseTextureAtlasData(RES.getRes("resource/mecha_1002_101d_show/mecha_1002_101d_show_tex.json"),RES.getRes("resource/mecha_1002_101d_show/mecha_1002_101d_show_tex.png"));var t=e.buildArmatureDisplay("mecha_1002_101d","mecha_1002_101d_show");t.animation.play("idle"),t.x=0,t.y=200,this.addChild(t)},t}(BaseDemo);__reflect(HelloDragonBones.prototype,"HelloDragonBones");