function enableDrag(t){t&&(t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,_dragHandler,t),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,_dragHandler,t),t.addEventListener(egret.TouchEvent.TOUCH_END,_dragHandler,t))}function disableDrag(t){t&&(t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,_dragHandler,t),t.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,_dragHandler,t),t.removeEventListener(egret.TouchEvent.TOUCH_END,_dragHandler,t))}function _dragHandler(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:if(dragTarget)return;dragTarget=t.target,dragTarget.parent.globalToLocal(t.stageX,t.stageY,_helpPoint),_dragOffset.x=dragTarget.x-_helpPoint.x,_dragOffset.y=dragTarget.y-_helpPoint.y,dragTarget.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,_dragHandler,dragTarget);break;case egret.TouchEvent.TOUCH_RELEASE_OUTSIDE:case egret.TouchEvent.TOUCH_END:dragTarget&&(dragTarget.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,_dragHandler,dragTarget),dragTarget=null);break;case egret.TouchEvent.TOUCH_MOVE:dragTarget&&(dragTarget.parent.globalToLocal(t.stageX,t.stageY,_helpPoint),dragTarget.x=_helpPoint.x+_dragOffset.x,dragTarget.y=_helpPoint.y+_dragOffset.y)}}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},dragonBones;!function(t){var e=function(){function e(t,e,i,a,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),void 0===n&&(n=1),void 0===r&&(r=1),this.x=t,this.y=e,this.skewX=i,this.skewY=a,this.scaleX=n,this.scaleY=r}return e.normalizeRadian=function(t){return t=(t+Math.PI)%(2*Math.PI),t+=t>0?-Math.PI:Math.PI},e.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skewX/Math.PI+" skewY:"+180*this.skewY/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},e.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skewX=t.skewX,this.skewY=t.skewY,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},e.prototype.identity=function(){return this.x=this.y=this.skewX=this.skewY=0,this.scaleX=this.scaleY=1,this},e.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skewX+=t.skewX,this.skewY+=t.skewY,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},e.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skewX=e.normalizeRadian(this.skewX-t.skewX),this.skewY=e.normalizeRadian(this.skewY-t.skewY),this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},e.prototype.fromMatrix=function(i){this.x=i.tx,this.y=i.ty,this.skewX=Math.atan(-i.c/i.d),this.skewY=Math.atan(i.b/i.a);var a=this.scaleX,n=this.scaleY,r=t.DragonBones.PI_Q,s=this.skewX-this.skewY,o=Math.cos(this.skewX),h=Math.sin(this.skewX);return s>-.01&&.01>s?this.scaleX=this.skewY>-r&&this.skewY<r?i.a/o:i.b/h:this.scaleX=this.skewY>-r&&this.skewY<r?i.a/Math.cos(this.skewY):i.b/Math.sin(this.skewY),this.scaleY=this.skewX>-r&&this.skewX<r?i.d/o:-i.c/h,a>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.skewY=e.normalizeRadian(this.skewY-Math.PI)),n>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,this.skewX=e.normalizeRadian(this.skewX-Math.PI)),this},e.prototype.toMatrix=function(t){if(0!==this.skewX||0!==this.skewY){t.a=Math.cos(this.skewY),t.b=Math.sin(this.skewY);var e=this.skewX-this.skewY;e>-.01&&.01>e?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skewX),t.d=Math.cos(this.skewX)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY)}else t.a=this.scaleX,t.b=0,t.c=0,t.d=this.scaleY;return t.tx=this.x,t.ty=this.y,this},Object.defineProperty(e.prototype,"rotation",{get:function(){return this.scaleX>=0?this.skewY:this.skewY+Math.PI},set:function(t){var e=this.scaleX>=0?t-this.skewY:t-this.skewY-Math.PI;this.skewX+=e,this.skewY+=e},enumerable:!0,configurable:!0}),e}();t.Transform=e,__reflect(e.prototype,"dragonBones.Transform")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=e,__reflect(e.prototype,"dragonBones.Point")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function t(t,e,i,a,n,r){void 0===t&&(t=1),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=1),void 0===n&&(n=0),void 0===r&&(r=0),this.a=t,this.b=e,this.c=i,this.d=a,this.tx=n,this.ty=r}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},t.prototype.concat=function(t){var e=this.a*t.a,i=0,a=0,n=this.d*t.d,r=this.tx*t.a+t.tx,s=this.ty*t.d+t.ty;return(0!==this.b||0!==this.c)&&(e+=this.b*t.c,i+=this.b*t.d,a+=this.c*t.a,n+=this.c*t.b),(0!==t.b||0!==t.c)&&(i+=this.a*t.b,a+=this.d*t.c,r+=this.ty*t.c,s+=this.tx*t.b),this.a=e,this.b=i,this.c=a,this.d=n,this.tx=r,this.ty=s,this},t.prototype.invert=function(){var t=this.a,e=this.b,i=this.c,a=this.d,n=this.tx,r=this.ty;if(0===e&&0===i)return this.b=this.c=0,0===t||0===a?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,a=this.d=1/a,this.tx=-t*n,this.ty=-a*r),this;var s=t*a-e*i;if(0===s)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;s=1/s;var o=this.a=a*s;return e=this.b=-e*s,i=this.c=-i*s,a=this.d=t*s,this.tx=-(o*n+i*r),this.ty=-(e*n+a*r),this},t.prototype.transformPoint=function(t,e,i,a){void 0===a&&(a=!1),i.x=this.a*t+this.c*e,i.y=this.b*t+this.d*e,a||(i.x+=this.tx,i.y+=this.ty)},t}();t.Matrix=e,__reflect(e.prototype,"dragonBones.Matrix")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function t(){this.hashCode=t._hashCode++}return t._returnObject=function(e){var i=String(e.constructor),a=null==t._maxCountMap[i]?t._defaultMaxCount:t._maxCountMap[i],n=t._poolsMap[i]=t._poolsMap[i]||[];n.length<a&&n.push(e)},t.setMaxCount=function(e,i){if((0>i||i!==i)&&(i=0),e){var a=String(e);t._maxCountMap[a]=i;var n=t._poolsMap[a];n&&n.length>i&&(n.length=i)}else{t._defaultMaxCount=i;for(var a in t._poolsMap)if(null!=t._maxCountMap[a]){t._maxCountMap[a]=i;var n=t._poolsMap[a];n.length>i&&(n.length=i)}}},t.clearPool=function(e){if(void 0===e&&(e=null),e){var i=t._poolsMap[String(e)];i&&i.length&&(i.length=0)}else for(var a in t._poolsMap){var i=t._poolsMap[a];i.length=0}},t.borrowObject=function(e){var i=t._poolsMap[String(e)];if(i&&i.length>0)return i.pop();var a=new e;return a._onClear(),a},t.prototype.returnToPool=function(){this._onClear(),t._returnObject(this)},t}();e._hashCode=0,e._defaultMaxCount=5e3,e._maxCountMap={},e._poolsMap={},t.BaseObject=e,__reflect(e.prototype,"dragonBones.BaseObject")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.textures={},t}return __extends(i,e),i.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.scale=1,this.width=0,this.height=0,this.name=null,this.imagePath=null},i.prototype.addTexture=function(e){if(!e||!e.name||this.textures[e.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);this.textures[e.name]=e,e.parent=this},i.prototype.getTexture=function(t){return this.textures[t]},i.prototype.copyFrom=function(t){this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath;for(var e in this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var i=this.generateTexture();i.copyFrom(t.textures[e]),this.textures[e]=i}},i}(t.BaseObject);t.TextureAtlasData=e,__reflect(e.prototype,"dragonBones.TextureAtlasData");var i=function(e){function i(){var i=e.call(this)||this;return i.region=new t.Rectangle,i}return __extends(i,e),i.generateRectangle=function(){return new t.Rectangle},i.prototype._onClear=function(){this.rotated=!1,this.name=null,this.region.clear(),this.frame=null,this.parent=null},i.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,!this.frame&&t.frame?this.frame=i.generateRectangle():this.frame&&!t.frame&&(this.frame=null),this.frame&&t.frame&&this.frame.copyFrom(t.frame),this.parent=t.parent,this.region.copyFrom(t.region)},i}(t.BaseObject);t.TextureData=i,__reflect(i.prototype,"dragonBones.TextureData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.globalTransformMatrix=new t.Matrix,i.global=new t.Transform,i.offset=new t.Transform,i}return __extends(i,e),i.prototype._onClear=function(){this.name=null,this.global.identity(),this.offset.identity(),this.globalTransformMatrix.identity(),this.origin=null,this.userData=null,this._armature=null,this._parent=null,this._globalDirty=!1},i.prototype._setArmature=function(t){this._armature=t},i.prototype._setParent=function(t){this._parent=t},i.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(i.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),i}(t.BaseObject);e._helpPoint=new t.Point,e._helpTransform=new t.Transform,e._helpMatrix=new t.Matrix,t.TransformObject=e,__reflect(e.prototype,"dragonBones.TransformObject")}(dragonBones||(dragonBones={}));var dragTarget=null,_helpPoint=new egret.Point,_dragOffset=new egret.Point,BoundingBoxTester=function(t){function e(){var e=t.call(this)||this;return e.armatureDisplay=null,e._helpPointA=new egret.Point,e._helpPointB=new egret.Point,e._helpPointC=new egret.Point,e._background=new egret.Shape,e._pointA=new egret.Shape,e._pointB=new egret.Shape,e._pointA.x=0,e._pointA.y=0,e._pointB.x=200,e._pointB.y=200,e.addChild(e._background),e.addChild(e._pointA),e.addChild(e._pointB),enableDrag(e._pointA),enableDrag(e._pointB),enableDrag(e),e.addEventListener(egret.Event.ENTER_FRAME,e._enterFrameHandler,e),e}return __extends(e,t),e.prototype._enterFrameHandler=function(t){if(this.armatureDisplay){this.localToGlobal(this._pointA.x,this._pointA.y,this._helpPointA),this.localToGlobal(this._pointB.x,this._pointB.y,this._helpPointB),this.armatureDisplay.globalToLocal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this.armatureDisplay.globalToLocal(this._helpPointB.x,this._helpPointB.y,this._helpPointB);var e=this.armatureDisplay.armature.containsPoint(this._helpPointA.x,this._helpPointA.y),i=this.armatureDisplay.armature.containsPoint(this._helpPointB.x,this._helpPointB.y),a=this.armatureDisplay.armature.intersectsSegment(this._helpPointA.x,this._helpPointA.y,this._helpPointB.x,this._helpPointB.y,this._helpPointA,this._helpPointB,this._helpPointC),n=e?65280:16711680;this._pointA.graphics.clear(),this._pointA.graphics.beginFill(n,.2),this._pointA.graphics.drawCircle(0,0,60),this._pointA.graphics.endFill(),this._pointA.graphics.beginFill(n,.8),this._pointA.graphics.drawCircle(0,0,6),this._pointA.graphics.endFill();var r=i?65280:16711680;this._pointB.graphics.clear(),this._pointB.graphics.beginFill(r,.2),this._pointB.graphics.drawCircle(0,0,40),this._pointB.graphics.endFill(),this._pointB.graphics.beginFill(r,.8),this._pointB.graphics.drawCircle(0,0,4),this._pointB.graphics.endFill();var s=a?65280:16711680;this._background.graphics.clear(),this._background.graphics.lineStyle(20,s,0),this._background.graphics.moveTo(this._pointA.x,this._pointA.y),this._background.graphics.lineTo(this._pointB.x,this._pointB.y),this._background.graphics.lineStyle(2,s,.8),this._background.graphics.moveTo(this._pointA.x,this._pointA.y),this._background.graphics.lineTo(this._pointB.x,this._pointB.y),a&&(this.armatureDisplay.localToGlobal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this.armatureDisplay.localToGlobal(this._helpPointB.x,this._helpPointB.y,this._helpPointB),this.globalToLocal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this.globalToLocal(this._helpPointB.x,this._helpPointB.y,this._helpPointB),this._background.graphics.moveTo(this._helpPointA.x,this._helpPointA.y),this._background.graphics.lineTo(this._helpPointA.x+60*Math.cos(this._helpPointC.x),this._helpPointA.y+60*Math.sin(this._helpPointC.x)),this._background.graphics.moveTo(this._helpPointB.x,this._helpPointB.y),this._background.graphics.lineTo(this._helpPointB.x+40*Math.cos(this._helpPointC.y),this._helpPointB.y+40*Math.sin(this._helpPointC.y)),this._background.graphics.beginFill(65280,.8),this._background.graphics.drawCircle(this._helpPointA.x,this._helpPointA.y,6),this._background.graphics.endFill(),this._background.graphics.beginFill(65280,.8),this._background.graphics.drawCircle(this._helpPointB.x,this._helpPointB.y,4),this._background.graphics.endFill())}},e}(egret.DisplayObjectContainer);__reflect(BoundingBoxTester.prototype,"BoundingBoxTester");var BaseTest=function(t){function e(){var e=t.call(this)||this;return e._resourceGroup=null,e._resourceConfigURL=null,e._background=new egret.Shape,e.loadingView=null,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this._resourceConfigURL&&(this._background.graphics.beginFill(6710886,1),this._background.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),this.addChild(this._background),this.loadingView=new LoadingView,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig(this._resourceConfigURL,"resource/"))},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this._resourceGroup=this._resourceGroup||"preload",RES.loadGroup(this._resourceGroup)},e.prototype.onResourceLoadComplete=function(t){t.groupName==this._resourceGroup&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this._onStart())},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e}(egret.DisplayObjectContainer);__reflect(BaseTest.prototype,"BaseTest");var LoadingView=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.addToStageHandler,e),e}return __extends(e,t),e.prototype.addToStageHandler=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.addToStageHandler,this),this.textField=new egret.TextField,this.textField.y=.5*this.stage.stageHeight,this.textField.width=this.stage.stageWidth,this.textField.height=60,this.textField.textAlign="center",this.addChild(this.textField)},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingView.prototype,"LoadingView");var dragonBones;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.frames=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.TimelineData]"},e.prototype._onClear=function(){for(var t=null,e=0,i=this.frames.length;i>e;++e){var a=this.frames[e];t&&a!==t&&t.returnToPool(),t=a}this.scale=1,this.offset=0,this.frames.length=0},e}(t.BaseObject);t.TimelineData=e,__reflect(e.prototype,"dragonBones.TimelineData");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineData]"},e}(e);t.ZOrderTimelineData=i,__reflect(i.prototype,"dragonBones.ZOrderTimelineData");var a=function(e){function i(){var i=e.call(this)||this;return i.originalTransform=new t.Transform,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.BoneTimelineData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.originalTransform.identity(),this.bone=null},i}(e);t.BoneTimelineData=a,__reflect(a.prototype,"dragonBones.BoneTimelineData");var n=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.SlotTimelineData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.slot=null},e}(e);t.SlotTimelineData=n,__reflect(n.prototype,"dragonBones.SlotTimelineData");var r=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.FFDTimelineData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.skin=null,this.slot=null,this.display=null},e}(e);t.FFDTimelineData=r,__reflect(r.prototype,"dragonBones.FFDTimelineData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function t(t,e,i,a,n,r,s,o){void 0===t&&(t=1),void 0===e&&(e=1),void 0===i&&(i=1),void 0===a&&(a=1),void 0===n&&(n=0),void 0===r&&(r=0),void 0===s&&(s=0),void 0===o&&(o=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=i,this.blueMultiplier=a,this.alphaOffset=n,this.redOffset=r,this.greenOffset=s,this.blueOffset=o}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.redOffset=t.redOffset,this.greenOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=e,__reflect(e.prototype,"dragonBones.ColorTransform")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function e(i){void 0===i&&(i=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dataParser=null,this._dataParser=i,this._dataParser||(e._defaultParser||(e._defaultParser=new t.ObjectDataParser),this._dataParser=e._defaultParser)}return e.prototype._getTextureData=function(t,e){var i=this._textureAtlasDataMap[t];if(i)for(var a=0,n=i.length;n>a;++a){var r=i[a].getTexture(e);if(r)return r}if(this.autoSearch)for(var s in this._textureAtlasDataMap){i=this._textureAtlasDataMap[s];for(var a=0,n=i.length;n>a;++a){var o=i[a];if(o.autoSearch){var r=o.getTexture(e);if(r)return r}}}return null},e.prototype._fillBuildArmaturePackage=function(t,e,i,a,n){var r=null,s=null;if(e&&(r=this._dragonBonesDataMap[e],r&&(s=r.getArmature(i))),!s&&(!e||this.autoSearch))for(var o in this._dragonBonesDataMap)if(r=this._dragonBonesDataMap[o],(!e||r.autoSearch)&&(s=r.getArmature(i))){e=o;break}return s?(t.dataName=e,t.textureAtlasName=n,t.data=r,t.armature=s,t.skin=s.getSkin(a),t.skin||(t.skin=s.defaultSkin),!0):!1},e.prototype._buildBones=function(e,i){for(var a=e.armature.sortedBones,n=0,r=a.length;r>n;++n){var s=a[n],o=t.BaseObject.borrowObject(t.Bone);o._init(s),s.parent?i.addBone(o,s.parent.name):i.addBone(o),s.ik&&(o.ikBendPositive=s.bendPositive,o.ikWeight=s.weight,o._setIK(i.getBone(s.ik.name),s.chain,s.chainIndex))}},e.prototype._buildSlots=function(t,e){var i=t.skin,a=t.armature.defaultSkin;if(i&&a){var n={};for(var r in a.slots){var s=a.slots[r];n[s.slot.name]=s}if(i!==a)for(var r in i.slots){var s=i.slots[r];n[s.slot.name]=s}for(var o=t.armature.sortedSlots,h=0,l=o.length;l>h;++h){var _=o[h],s=n[_.name];if(s){var u=this._generateSlot(t,s,e);u&&(e.addSlot(u,_.parent.name),u._setDisplayIndex(_.displayIndex))}}}},e.prototype._replaceSlotDisplay=function(t,e,i,a){if(0>a&&(a=i.displayIndex),a>=0){var n=i.displayList;if(n.length<=a&&(n.length=a+1),i._replacedDisplayDatas.length<=a&&(i._replacedDisplayDatas.length=a+1),i._replacedDisplayDatas[a]=e,1===e.type){var r=this.buildArmature(e.path,t.dataName,null,t.textureAtlasName);n[a]=r}else{(!e.texture||t.textureAtlasName)&&(e.texture=this._getTextureData(t.textureAtlasName?t.textureAtlasName:t.dataName,e.path));var s=i.skinSlotData.displays;e.mesh||a<s.length&&s[a].mesh?n[a]=i.meshDisplay:n[a]=i.rawDisplay}i.displayList=n}},e.prototype.parseDragonBonesData=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=1);var a=this._dataParser.parseDragonBonesData(t,i);return this.addDragonBonesData(a,e),a},e.prototype.parseTextureAtlasData=function(t,e,i,a){void 0===i&&(i=null),void 0===a&&(a=0);var n=this._generateTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,n,a),this._generateTextureAtlasData(n,e),this.addTextureAtlasData(n,i),n},e.prototype.getDragonBonesData=function(t){return this._dragonBonesDataMap[t]},e.prototype.addDragonBonesData=function(e,i){if(void 0===i&&(i=null),!e)throw new Error(t.DragonBones.ARGUMENT_ERROR);i=i||e.name,i?this._dragonBonesDataMap[i]?console.warn("Same name data.",i):this._dragonBonesDataMap[i]=e:console.warn("Unnamed data.")},e.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0);var i=this._dragonBonesDataMap[t];i&&(e&&i.returnToPool(),delete this._dragonBonesDataMap[t])},e.prototype.getTextureAtlasData=function(t){return this._textureAtlasDataMap[t]},e.prototype.addTextureAtlasData=function(e,i){if(void 0===i&&(i=null),!e)throw new Error(t.DragonBones.ARGUMENT_ERROR);if(i=i||e.name){var a=this._textureAtlasDataMap[i]?this._textureAtlasDataMap[i]:this._textureAtlasDataMap[i]=[];a.indexOf(e)<0&&a.push(e)}else console.warn("Unnamed data.")},e.prototype.removeTextureAtlasData=function(t,e){void 0===e&&(e=!0);var i=this._textureAtlasDataMap[t];if(i){if(e)for(var a=0,n=i.length;n>a;++a)i[a].returnToPool();delete this._textureAtlasDataMap[t]}},e.prototype.clear=function(t){void 0===t&&(t=!0);for(var e in this._dragonBonesDataMap)t&&this._dragonBonesDataMap[e].returnToPool(),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var i=this._textureAtlasDataMap[e],a=0,n=i.length;n>a;++a)i[a].returnToPool();delete this._textureAtlasDataMap[e]}},e.prototype.buildArmature=function(t,e,i,a){void 0===e&&(e=null),void 0===i&&(i=null),void 0===a&&(a=null);var n={};if(this._fillBuildArmaturePackage(n,e,t,i,a)){var r=this._generateArmature(n);return this._buildBones(n,r),this._buildSlots(n,r),r.invalidUpdate(null,!0),r.advanceTime(0),r}return console.warn("No armature data.",t,e?e:""),null},e.prototype.copyAnimationsToArmature=function(e,i,a,n,r){void 0===a&&(a=null),void 0===n&&(n=null),void 0===r&&(r=!0);var s={};if(this._fillBuildArmaturePackage(s,n,i,a,null)){var o=s.armature;if(r)e.animation.animations=o.animations;else{var h={};for(var l in e.animation.animations)h[l]=e.animation.animations[l];for(var l in o.animations)h[l]=o.animations[l];e.animation.animations=h}if(s.skin){for(var _=e.getSlots(),u=0,p=_.length;p>u;++u)for(var c=_[u],d=c.displayList,m=0,f=d.length;f>m;++m){var g=d[m];if(g instanceof t.Armature){var y=s.skin.getSlot(c.name).displays;if(m<y.length){var v=y[m];1===v.type&&this.copyAnimationsToArmature(g,v.path,a,n,r)}}}return!0}}return!1},e.prototype.replaceSlotDisplay=function(t,e,i,a,n,r){void 0===r&&(r=-1);var s={};if(this._fillBuildArmaturePackage(s,t,e,null,null)){var o=s.skin.getSlot(i);if(o)for(var h=0,l=o.displays.length;l>h;++h){var _=o.displays[h];if(_.name===a){this._replaceSlotDisplay(s,_,n,r);break}}}},e.prototype.replaceSlotDisplayList=function(t,e,i,a){var n={};if(this._fillBuildArmaturePackage(n,t,e,null,null)){var r=n.skin.getSlot(i);if(r)for(var s=0,o=r.displays.length;o>s;++s){var h=r.displays[s];this._replaceSlotDisplay(n,h,a,s)}}},e.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},e.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},e}();e._defaultParser=null,t.BaseFactory=e,__reflect(e.prototype,"dragonBones.BaseFactory")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.type=null,this.name=null,this.frame=null,this.data=null,this.armature=null,this.bone=null,this.slot=null,this.animationState=null},e}(t.BaseObject);e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",t.EventObject=e,__reflect(e.prototype,"dragonBones.EventObject")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function a(){return e.call(this)||this}return __extends(a,e),a.toString=function(){return"[class dragonBones.EgretTextureAtlasData]"},a.prototype._onClear=function(){e.prototype._onClear.call(this),this.texture,this.texture=null},a.prototype.generateTexture=function(){return t.BaseObject.borrowObject(i)},a.prototype.dispose=function(){this.returnToPool()},a}(t.TextureAtlasData);t.EgretTextureAtlasData=e,__reflect(e.prototype,"dragonBones.EgretTextureAtlasData");var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.EgretTextureData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.texture,this.texture=null},e}(t.TextureData);t.EgretTextureData=i,__reflect(i.prototype,"dragonBones.EgretTextureData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function t(){}return t.hasArmature=function(e){return t._armatures.indexOf(e)>=0},t.addArmature=function(e){e&&t._armatures.indexOf(e)<0&&t._armatures.push(e)},t.removeArmature=function(e){if(e){var i=t._armatures.indexOf(e);i>=0&&t._armatures.splice(i,1)}},t}();e.PI_D=2*Math.PI,e.PI_H=Math.PI/2,e.PI_Q=Math.PI/4,e.ANGLE_TO_RADIAN=Math.PI/180,e.RADIAN_TO_ANGLE=180/Math.PI,e.SECOND_TO_MILLISECOND=1e3,e.NO_TWEEN=100,e.VERSION="5.0.0",e.ARGUMENT_ERROR="Argument error.",e.yDown=!0,e.debug=!1,e.debugDraw=!1,e._armatures=[],t.DragonBones=e,__reflect(e.prototype,"dragonBones.DragonBones")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._localMatrix=new t.Matrix,i._colorTransform=new t.ColorTransform,i._ffdVertices=[],i._displayList=[],i._textureDatas=[],i._replacedDisplayDatas=[],i._meshBones=[],i}return __extends(i,e),i.prototype._onClear=function(){e.prototype._onClear.call(this);for(var i=[],a=0,n=this._displayList.length;n>a;++a){var r=this._displayList[a];r!==this._rawDisplay&&r!==this._meshDisplay&&i.indexOf(r)<0&&i.push(r)}for(var a=0,n=i.length;n>a;++a){var r=i[a];r instanceof t.Armature?r.dispose():this._disposeDisplay(r)}this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay),this._rawDisplay&&this._disposeDisplay(this._rawDisplay),this.displayController=null,this._displayDirty=!1,this._zOrderDirty=!1,this._blendModeDirty=!1,this._colorDirty=!1,this._meshDirty=!1,this._transformDirty=!1,this._blendMode=0,this._displayIndex=-1,this._zOrder=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._ffdVertices.length=0,this._displayList.length=0,this._textureDatas.length=0,this._replacedDisplayDatas.length=0,this._meshBones.length=0,this._skinSlotData=null,this._displayData=null,this._replacedDisplayData=null,this._textureData=null,this._meshData=null,this._boundingBoxData=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._cachedFrameIndices=null},i.prototype._isMeshBonesUpdate=function(){for(var t=0,e=this._meshBones.length;e>t;++t)if(this._meshBones[t]._childrenTransformDirty)return!0;return!1},i.prototype._updateDisplayData=function(){var t=this._displayData,e=this._replacedDisplayData,a=this._textureData,n=this._meshData,r=this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._displayList[this._displayIndex]:null;if(this._displayIndex>=0&&this._displayIndex<this._skinSlotData.displays.length?this._displayData=this._skinSlotData.displays[this._displayIndex]:this._displayData=null,this._displayIndex>=0&&this._displayIndex<this._replacedDisplayDatas.length?this._replacedDisplayData=this._replacedDisplayDatas[this._displayIndex]:this._replacedDisplayData=null,this._displayData!==t||this._replacedDisplayData!==e||this._display!=r){var s=this._replacedDisplayData?this._replacedDisplayData:this._displayData;if(!s||r!==this._rawDisplay&&r!==this._meshDisplay)this._textureData=null,this._meshData=null,this._pivotX=0,this._pivotY=0,this._meshBones.length=0,this._ffdVertices.length=0;else{if(this._replacedDisplayData?this._textureData=this._replacedDisplayData.texture:this._displayIndex<this._textureDatas.length&&this._textureDatas[this._displayIndex]?this._textureData=this._textureDatas[this._displayIndex]:this._textureData=this._displayData.texture,r===this._meshDisplay?this._replacedDisplayData&&this._replacedDisplayData.mesh?this._meshData=this._replacedDisplayData.mesh:this._meshData=this._displayData.mesh:this._meshData=null,this._meshData)this._pivotX=0,this._pivotY=0;else if(this._textureData){var o=this._armature.armatureData.scale;if(this._pivotX=s.pivot.x,this._pivotY=s.pivot.y,s.isRelativePivot){var h=this._textureData.frame?this._textureData.frame:this._textureData.region,l=h.width*o,_=h.height*o;this._textureData.rotated&&(l=h.height,_=h.width),this._pivotX*=l,this._pivotY*=_}this._textureData.frame&&(this._pivotX+=this._textureData.frame.x*o,this._pivotY+=this._textureData.frame.y*o)}else this._pivotX=0,this._pivotY=0;if(!this._displayData||s===this._displayData||this._meshData&&this._meshData===this._displayData.mesh||(this._displayData.transform.toMatrix(i._helpMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(0,0,i._helpPoint),this._pivotX-=i._helpPoint.x,this._pivotY-=i._helpPoint.y,s.transform.toMatrix(i._helpMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(0,0,i._helpPoint),this._pivotX+=i._helpPoint.x,this._pivotY+=i._helpPoint.y),this._meshData!==n)if(this._meshData&&this._displayData&&this._meshData===this._displayData.mesh){if(this._meshData.skinned){this._meshBones.length=this._meshData.bones.length;for(var u=0,p=this._meshBones.length;p>u;++u)this._meshBones[u]=this._armature.getBone(this._meshData.bones[u].name);for(var c=0,u=0,p=this._meshData.boneIndices.length;p>u;++u)c+=this._meshData.boneIndices[u].length;this._ffdVertices.length=2*c}else this._meshBones.length=0,this._ffdVertices.length=this._meshData.vertices.length;for(var u=0,p=this._ffdVertices.length;p>u;++u)this._ffdVertices[u]=0;this._meshDirty=!0}else this._meshBones.length=0,this._ffdVertices.length=0;
else this._textureData!==a&&(this._meshDirty=!0)}this._displayDirty=!0,this._transformDirty=!0,this._displayData?this.origin=this._displayData.transform:this._replacedDisplayData&&(this.origin=this._replacedDisplayData.transform)}this._replacedDisplayData?this._boundingBoxData=this._replacedDisplayData.boundingBox:this._displayData?this._boundingBoxData=this._displayData.boundingBox:this._boundingBoxData=null},i.prototype._updateDisplay=function(){var e=this._display||this._rawDisplay,i=this._childArmature;this._displayIndex>=0&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null);var a=this._display?this._display:this._rawDisplay;if(a!==e&&(this._onUpdateDisplay(),this._replaceDisplay(e),this._blendModeDirty=!0,this._colorDirty=!0),(a===this._rawDisplay||a===this._meshDisplay)&&this._updateFrame(),this._childArmature!==i&&(i&&(i._parent=null,i.clock=null,i.inheritAnimation&&i.animation.reset()),this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var n=this._armature.cacheFrameRate;0!==n&&(this._childArmature.cacheFrameRate=n)}var r=this._skinSlotData.slot.actions.length>0?this._skinSlotData.slot.actions:this._childArmature.armatureData.actions;if(r.length>0)for(var s=0,o=r.length;o>s;++s)this._childArmature._bufferAction(r[s]);else this._childArmature.animation.play()}},i.prototype._updateGlobalTransformMatrix=function(t){this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(this._parent.globalTransformMatrix),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},i.prototype._init=function(t,e,i){if(!this._skinSlotData){this._skinSlotData=t;var a=this._skinSlotData.slot;this.name=a.name,this._zOrder=a.zOrder,this._blendMode=a.blendMode,this._colorTransform.copyFrom(a.color),this._rawDisplay=e,this._meshDisplay=i,this._blendModeDirty=!0,this._colorDirty=!0}},i.prototype._setArmature=function(t){this._armature!==t&&(this._armature&&this._armature._removeSlotFromSlotList(this),this._armature=t,this._onUpdateDisplay(),this._armature?(this._armature._addSlotToSlotList(this),this._addDisplay()):this._removeDisplay())},i.prototype._update=function(t){if(this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix))),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),t>=0&&this._cachedFrameIndices){var e=this._cachedFrameIndices[t];e>=0&&this._cachedFrameIndex===e?this._transformDirty=!1:e>=0?(this._transformDirty=!0,this._cachedFrameIndex=e):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(this._display){if(this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),this._meshData&&this._displayData&&this._meshData===this._displayData.mesh&&((this._meshDirty||this._meshData.skinned&&this._isMeshBonesUpdate())&&(this._meshDirty=!1,this._updateMesh()),this._meshData.skinned))return void(this._transformDirty&&(this._transformDirty=!1,this._updateTransform(!0)));if(this._transformDirty){if(this._transformDirty=!1,this._cachedFrameIndex<0){var i=t>=0;this._updateGlobalTransformMatrix(i),i&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform(!1)}}},i.prototype._updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},i.prototype._setDisplayList=function(e){if(e&&e.length>0){this._displayList.length!==e.length&&(this._displayList.length=e.length);for(var i=0,a=e.length;a>i;++i){var n=e[i];n&&n!==this._rawDisplay&&n!==this._meshDisplay&&!(n instanceof t.Armature)&&this._displayList.indexOf(n)<0&&this._initDisplay(n),this._displayList[i]=n}}else this._displayList.length>0&&(this._displayList.length=0);return this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!==this._displayList[this._displayIndex]:this._displayDirty=null!=this._display,this._updateDisplayData(),this._displayDirty},i.prototype._setDisplayIndex=function(t){return this._displayIndex===t?!1:(this._displayIndex=t,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},i.prototype._setZorder=function(t){return this._zOrder===t,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},i.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,!0},i.prototype.containsPoint=function(t,e){return this._boundingBoxData?(this._updateTransformAndMatrix(),i._helpMatrix.copyFrom(this.globalTransformMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(t,e,i._helpPoint),this._boundingBoxData.containsPoint(i._helpPoint.x,i._helpPoint.y)):!1},i.prototype.intersectsSegment=function(t,e,a,n,r,s,o){if(void 0===r&&(r=null),void 0===s&&(s=null),void 0===o&&(o=null),!this._boundingBoxData)return 0;this._updateTransformAndMatrix(),i._helpMatrix.copyFrom(this.globalTransformMatrix),i._helpMatrix.invert(),i._helpMatrix.transformPoint(t,e,i._helpPoint),t=i._helpPoint.x,e=i._helpPoint.y,i._helpMatrix.transformPoint(a,n,i._helpPoint),a=i._helpPoint.x,n=i._helpPoint.y;var h=this._boundingBoxData.intersectsSegment(t,e,a,n,r,s,o);return h>0&&(1===h||2===h?r?(this.globalTransformMatrix.transformPoint(r.x,r.y,r),s&&(s.x=r.x,s.y=r.y)):s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s):(r&&this.globalTransformMatrix.transformPoint(r.x,r.y,r),s&&this.globalTransformMatrix.transformPoint(s.x,s.y,s)),o&&(this.globalTransformMatrix.transformPoint(Math.cos(o.x),Math.sin(o.x),i._helpPoint,!0),o.x=Math.atan2(i._helpPoint.y,i._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(o.y),Math.sin(o.y),i._helpPoint,!0),o.y=Math.atan2(i._helpPoint.y,i._helpPoint.x))),h},i.prototype.invalidUpdate=function(){this._displayDirty=!0,this._transformDirty=!0},Object.defineProperty(i.prototype,"skinSlotData",{get:function(){return this._skinSlotData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this._update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(e){var i=this._displayList.concat(),a=[];this._setDisplayList(e)&&this._update(-1);for(var n=0,r=i.length;r>n;++n){var s=i[n];s&&s!==this._rawDisplay&&s!==this._meshDisplay&&this._displayList.indexOf(s)<0&&a.indexOf(s)<0&&a.push(s)}for(var n=0,r=a.length;r>n;++n){var s=a[n];s instanceof t.Armature?s.dispose():this._disposeDisplay(s)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display!==t){var e=this._displayList.length;if(this._displayIndex<0&&0===e&&(this._displayIndex=0),!(this._displayIndex<0)){var i=this.displayList;e<=this._displayIndex&&(i.length=this._displayIndex+1),i[this._displayIndex]=t,this.displayList=i}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),i.prototype.getDisplay=function(){return this._display},i.prototype.setDisplay=function(t){this.display=t},i}(t.TransformObject);t.Slot=e,__reflect(e.prototype,"dragonBones.Slot")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function e(){this._isOldData=!1,this._isGlobalTransform=!1,this._isAutoTween=!1,this._animationTweenEasing=0,this._timelinePivot=new t.Point,this._helpPoint=new t.Point,this._helpTransformA=new t.Transform,this._helpTransformB=new t.Transform,this._helpMatrix=new t.Matrix,this._rawBones=[],this._data=null,this._armature=null,this._skin=null,this._skinSlotData=null,this._animation=null,this._timeline=null}return e._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return-1}},e._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;default:return-1}},e._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return-1}},e._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return-1}},e._getActionType=function(t){switch(t.toLowerCase()){case"play":case"gotoandplay":return 0;default:return-1}},e.prototype._getTimelineFrameMatrix=function(e,i,a,n){var r=Math.floor(a*e.frameCount/e.duration);if(1===i.frames.length||r>=i.frames.length)n.copyFrom(i.frames[0].transform);else{var s=i.frames[r],o=0;s.tweenEasing!==t.DragonBones.NO_TWEEN?(o=(a-s.position)/s.duration,0!==s.tweenEasing&&(o=t.TweenTimelineState._getEasingValue(o,s.tweenEasing))):s.curve&&(o=(a-s.position)/s.duration,o=t.TweenTimelineState._getEasingCurveValue(o,s.curve));var h=s.next;n.x=h.transform.x-s.transform.x,n.y=h.transform.y-s.transform.y,n.skewX=t.Transform.normalizeRadian(h.transform.skewX-s.transform.skewX),n.skewY=t.Transform.normalizeRadian(h.transform.skewY-s.transform.skewY),n.scaleX=h.transform.scaleX-s.transform.scaleX,n.scaleY=h.transform.scaleY-s.transform.scaleY,n.x=s.transform.x+n.x*o,n.y=s.transform.y+n.y*o,n.skewX=s.transform.skewX+n.skewX*o,n.skewY=s.transform.skewY+n.skewY*o,n.scaleX=s.transform.scaleX+n.scaleX*o,n.scaleY=s.transform.scaleY+n.scaleY*o}n.add(i.originalTransform)},e.prototype._globalToLocal=function(t){for(var e=new Array,i=t.sortedBones.concat().reverse(),a=0,n=i.length;n>a;++a){var r=i[a];r.parent&&(r.parent.transform.toMatrix(this._helpMatrix),this._helpMatrix.invert(),this._helpMatrix.transformPoint(r.transform.x,r.transform.y,this._helpPoint),r.transform.x=this._helpPoint.x,r.transform.y=this._helpPoint.y,r.transform.rotation-=r.parent.transform.rotation);for(var s in t.animations){var o=t.animations[s],h=o.getBoneTimeline(r.name);if(h){var l=r.parent?o.getBoneTimeline(r.parent.name):null;this._helpTransformB.copyFrom(h.originalTransform),e.length=0;for(var _=0,u=h.frames.length;u>_;++_){var p=h.frames[_];e.indexOf(p)>=0||(e.push(p),l?(this._getTimelineFrameMatrix(o,l,p.position,this._helpTransformA),p.transform.add(this._helpTransformB),this._helpTransformA.toMatrix(this._helpMatrix),this._helpMatrix.invert(),this._helpMatrix.transformPoint(p.transform.x,p.transform.y,this._helpPoint),p.transform.x=this._helpPoint.x,p.transform.y=this._helpPoint.y,p.transform.rotation-=this._helpTransformA.rotation):p.transform.add(this._helpTransformB),p.transform.minus(r.transform),0===_?(h.originalTransform.copyFrom(p.transform),p.transform.identity()):p.transform.minus(h.originalTransform))}}}}},e.prototype._mergeFrameToAnimationTimeline=function(e,i,a){var n=Math.floor(e*this._armature.frameRate),r=this._animation.frames;if(0===r.length){var s=t.BaseObject.borrowObject(t.AnimationFrameData);if(s.position=0,this._animation.frameCount>1){r.length=this._animation.frameCount+1;var o=t.BaseObject.borrowObject(t.AnimationFrameData);o.position=this._animation.frameCount/this._armature.frameRate,r[0]=s,r[this._animation.frameCount]=o}}var h=null,l=r[n];if(!l||0!==n&&r[n-1]!==l.prev){h=t.BaseObject.borrowObject(t.AnimationFrameData),h.position=n/this._armature.frameRate,r[n]=h;for(var _=n+1,u=r.length;u>_;++_)l&&r[_]===l&&(r[_]=null)}else h=l;if(i)for(var _=0,u=i.length;u>_;++_)h.actions.push(i[_]);if(a)for(var _=0,u=a.length;u>_;++_)h.events.push(a[_]);for(var p=null,c=null,_=0,u=r.length;u>_;++_){var d=r[_];d&&c!==d?(c=d,p&&(c.prev=p,p.next=c,p.duration=c.position-p.position),p=c):r[_]=p}c.duration=this._animation.duration-c.position,c=r[0],p.next=c,c.prev=p},e.parseDragonBonesData=function(e){return t.ObjectDataParser.getInstance().parseDragonBonesData(e)},e.parseTextureAtlasData=function(i,a){void 0===a&&(a=1);for(var n={},r=i[e.SUB_TEXTURE],s=0,o=r.length;o>s;s++){var h=r[s],l=h[e.NAME],_=new t.Rectangle,u=null;_.x=h[e.X]/a,_.y=h[e.Y]/a,_.width=h[e.WIDTH]/a,_.height=h[e.HEIGHT]/a,e.FRAME_WIDTH in h&&(u=new t.Rectangle,u.x=h[e.FRAME_X]/a,u.y=h[e.FRAME_Y]/a,u.width=h[e.FRAME_WIDTH]/a,u.height=h[e.FRAME_HEIGHT]/a),n[l]={region:_,frame:u,rotated:!1}}return n},e}();e.DATA_VERSION_2_3="2.3",e.DATA_VERSION_3_0="3.0",e.DATA_VERSION_4_0="4.0",e.DATA_VERSION_4_5="4.5",e.DATA_VERSION_5_0="5.0",e.DATA_VERSION=e.DATA_VERSION_5_0,e.DATA_VERSIONS=[e.DATA_VERSION_5_0,e.DATA_VERSION_4_5,e.DATA_VERSION_4_0,e.DATA_VERSION_3_0,e.DATA_VERSION_2_3],e.TEXTURE_ATLAS="TextureAtlas",e.SUB_TEXTURE="SubTexture",e.FORMAT="format",e.IMAGE_PATH="imagePath",e.WIDTH="width",e.HEIGHT="height",e.ROTATED="rotated",e.FRAME_X="frameX",e.FRAME_Y="frameY",e.FRAME_WIDTH="frameWidth",e.FRAME_HEIGHT="frameHeight",e.DRADON_BONES="dragonBones",e.ARMATURE="armature",e.BONE="bone",e.IK="ik",e.SLOT="slot",e.SKIN="skin",e.DISPLAY="display",e.ANIMATION="animation",e.Z_ORDER="zOrder",e.FFD="ffd",e.FRAME="frame",e.ACTIONS="actions",e.EVENTS="events",e.INTS="ints",e.FLOATS="floats",e.STRINGS="strings",e.PIVOT="pivot",e.TRANSFORM="transform",e.AABB="aabb",e.COLOR="color",e.VERSION="version",e.COMPATIBLE_VERSION="compatibleVersion",e.FRAME_RATE="frameRate",e.TYPE="type",e.SUB_TYPE="subType",e.NAME="name",e.PARENT="parent",e.TARGET="target",e.SHARE="share",e.PATH="path",e.LENGTH="length",e.DISPLAY_INDEX="displayIndex",e.BLEND_MODE="blendMode",e.INHERIT_TRANSLATION="inheritTranslation",e.INHERIT_ROTATION="inheritRotation",e.INHERIT_SCALE="inheritScale",e.INHERIT_REFLECTION="inheritReflection",e.INHERIT_ANIMATION="inheritAnimation",e.INHERIT_FFD="inheritFFD",e.BEND_POSITIVE="bendPositive",e.CHAIN="chain",e.WEIGHT="weight",e.FADE_IN_TIME="fadeInTime",e.PLAY_TIMES="playTimes",e.SCALE="scale",e.OFFSET="offset",e.POSITION="position",e.DURATION="duration",e.TWEEN_TYPE="tweenType",e.TWEEN_EASING="tweenEasing",e.TWEEN_ROTATE="tweenRotate",e.TWEEN_SCALE="tweenScale",e.CURVE="curve",e.EVENT="event",e.SOUND="sound",e.ACTION="action",e.DEFAULT_ACTIONS="defaultActions",e.X="x",e.Y="y",e.SKEW_X="skX",e.SKEW_Y="skY",e.SCALE_X="scX",e.SCALE_Y="scY",e.ALPHA_OFFSET="aO",e.RED_OFFSET="rO",e.GREEN_OFFSET="gO",e.BLUE_OFFSET="bO",e.ALPHA_MULTIPLIER="aM",e.RED_MULTIPLIER="rM",e.GREEN_MULTIPLIER="gM",e.BLUE_MULTIPLIER="bM",e.UVS="uvs",e.VERTICES="vertices",e.TRIANGLES="triangles",e.WEIGHTS="weights",e.SLOT_POSE="slotPose",e.BONE_POSE="bonePose",e.COLOR_TRANSFORM="colorTransform",e.TIMELINE="timeline",e.IS_GLOBAL="isGlobal",e.PIVOT_X="pX",e.PIVOT_Y="pY",e.Z="z",e.LOOP="loop",e.AUTO_TWEEN="autoTween",e.HIDE="hide",e.DEFAULT_NAME="__default",t.DataParser=e,__reflect(e.prototype,"dragonBones.DataParser")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._onClear=function(){this._playState=-1,this._currentPlayTimes=0,this._currentTime=-1,this._timelineData=null,this._frameRate=0,this._frameCount=0,this._position=0,this._duration=0,this._animationDutation=0,this._timeScale=1,this._timeOffset=0,this._currentFrame=null,this._armature=null,this._animationState=null,this._mainTimeline=null},e.prototype._onUpdateFrame=function(){},e.prototype._onArriveAtFrame=function(){},e.prototype._setCurrentTime=function(t){var e=this._playState,i=0,a=0;if(this._mainTimeline&&1===this._frameCount)this._playState=this._mainTimeline._playState>=0?1:-1,i=1,a=this._mainTimeline._currentTime;else if(this._mainTimeline&&1===this._timeScale&&0===this._timeOffset)this._playState=this._mainTimeline._playState,i=this._mainTimeline._currentPlayTimes,a=this._mainTimeline._currentTime;else{var n=this._animationState.playTimes,r=n*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationDutation),n>0&&(t>=r||-r>=t)?(this._playState<=0&&3===this._animationState._playheadState&&(this._playState=1),i=n,a=0>t?0:this._duration):(0!==this._playState&&3===this._animationState._playheadState&&(this._playState=0),0>t?(t=-t,i=Math.floor(t/this._duration),a=this._duration-t%this._duration):(i=Math.floor(t/this._duration),a=t%this._duration)),a+=this._position}return this._currentPlayTimes===i&&this._currentTime===a?!1:((0>e&&this._playState!==e||this._playState<=0&&this._currentPlayTimes!==i)&&(this._currentFrame=null),this._currentPlayTimes=i,this._currentTime=a,!0)},e.prototype._init=function(t,e,i){this._armature=t,this._animationState=e,this._timelineData=i,this._mainTimeline=this._animationState._timeline,this===this._mainTimeline&&(this._mainTimeline=null),this._frameRate=this._armature.armatureData.frameRate,this._frameCount=this._timelineData.frames.length,this._position=this._animationState._position,this._duration=this._animationState._duration,this._animationDutation=this._animationState.animationData.duration,this._timeScale=this._mainTimeline?1/this._timelineData.scale:1,this._timeOffset=this._mainTimeline?this._timelineData.offset:0},e.prototype.fadeOut=function(){},e.prototype.update=function(t){if(this._playState<=0&&this._setCurrentTime(t)){var e=this._frameCount>1?Math.floor(this._currentTime*this._frameRate):0,i=this._timelineData.frames[e];this._currentFrame!==i&&(this._currentFrame=i,this._onArriveAtFrame()),this._onUpdateFrame()}},e}(t.BaseObject);t.TimelineState=e,__reflect(e.prototype,"dragonBones.TimelineState");var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i._getEasingValue=function(t,e){if(0>=t)return 0;if(t>=1)return 1;var i=1;if(e>2)return t;if(e>1)i=.5*(1-Math.cos(t*Math.PI)),e-=1;else if(e>0)i=1-Math.pow(1-t,2);else if(e>=-1)e*=-1,i=Math.pow(t,2);else{if(!(e>=-2))return t;e*=-1,i=Math.acos(1-2*t)/Math.PI,e-=1}return(i-t)*e+t},i._getEasingCurveValue=function(t,e){if(0>=t)return 0;if(t>=1)return 1;var i=e.length+1,a=Math.floor(t*i),n=0===a?0:e[a-1],r=a===i-1?1:e[a];return n+(r-n)*(t*i-a)},i.prototype._onClear=function(){e.prototype._onClear.call(this),this._tweenProgress=0,this._tweenEasing=t.DragonBones.NO_TWEEN,this._curve=null},i.prototype._onArriveAtFrame=function(){this._frameCount>1&&(this._currentFrame.next!==this._timelineData.frames[0]||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1)?(this._tweenEasing=this._currentFrame.tweenEasing,this._curve=this._currentFrame.curve):(this._tweenEasing=t.DragonBones.NO_TWEEN,this._curve=null)},i.prototype._onUpdateFrame=function(){this._tweenEasing!==t.DragonBones.NO_TWEEN?(this._tweenProgress=(this._currentTime-this._currentFrame.position)/this._currentFrame.duration,0!==this._tweenEasing&&(this._tweenProgress=i._getEasingValue(this._tweenProgress,this._tweenEasing))):this._curve?(this._tweenProgress=(this._currentTime-this._currentFrame.position)/this._currentFrame.duration,this._tweenProgress=i._getEasingCurveValue(this._tweenProgress,this._curve)):this._tweenProgress=0},i}(e);t.TweenTimelineState=i,__reflect(i.prototype,"dragonBones.TweenTimelineState")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){function e(t,e){for(var i=0,a=t.length;a>i;++i){var n=t[i];if(n.name===e)return n}return null}function i(t){if(t.groupName){var i=u[t.groupName];if(i){var a=e(i.movie||i.animation,t.movieName);if(a)return t.groupConfig=i,t.movieConfig=a,!0}}if(!t.groupName)for(var n in u){var i=u[n];if(!t.groupName){var a=e(i.movie||i.animation,t.movieName);if(a)return t.groupName=n,t.groupConfig=i,t.movieConfig=a,!0}}return!1}function a(t){return null!=u[t]}function n(t,e,i){if(void 0===i&&(i=null),!t)throw new Error;var a=new egret.ByteArray(t);a.endian=egret.Endian.LITTLE_ENDIAN,a.position=8;var n=JSON.parse(a.readUTF());n.offset=a.position,n.arrayBuffer=t,n.textures=[];var r=n.offset%4;r&&(n.offset+=4-r);for(var s=0,o=n.position.length;o>s;s+=3)switch(s/3){case 1:n.displayFrameArray=new Int16Array(n.arrayBuffer,n.offset+n.position[s],n.position[s+1]/n.position[s+2]);break;case 2:n.rectangleArray=new Float32Array(n.arrayBuffer,n.offset+n.position[s],n.position[s+1]/n.position[s+2]);break;case 3:n.transformArray=new Float32Array(n.arrayBuffer,n.offset+n.position[s],n.position[s+1]/n.position[s+2]);break;case 4:n.colorArray=new Int16Array(n.arrayBuffer,n.offset+n.position[s],n.position[s+1]/n.position[s+2])}if(i=i||n.name,u[i],u[i]=n,e instanceof Array)for(var s=0,o=e.length;o>s;++s){var h=e[s];n.textures.push(h)}else n.textures.push(e)}function r(t){var e=u[t];e&&delete u[t]}function s(){for(var t in u)delete u[t]}function o(e,a){void 0===a&&(a=null);var n={movieName:e,groupName:a};if(i(n)){var r=new d(n);return t.EgretFactory.factory,r.clock=t.EgretFactory.clock,r}return console.warn("No movie named: "+e),null}function h(t){var e=u[t];if(e){for(var i=[],a=e.movie||e.animation,n=0,r=a.length;r>n;++n)i.push(a[n].name);return i}return console.warn("No group named: "+t),null}var l=new egret.Rectangle,_=new egret.Matrix,u={};t.hasMovieGroup=a,t.addMovieGroup=n,t.removeMovieGroup=r,t.removeAllMovieGroup=s,t.buildMovie=o,t.getMovieNames=h;var p=function(t){function e(e){var i=t.call(this,e)||this;return i.name=null,i.slotName=null,i.clipName=null,i.movie=null,i}return __extends(e,t),Object.defineProperty(e.prototype,"armature",{get:function(){return this.movie},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animation",{get:function(){return this.movie},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bone",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationState",{get:function(){return{name:this.clipName}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameLabel",{get:function(){return this.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movementID",{get:function(){return this.clipName},enumerable:!0,configurable:!0}),e}(egret.Event);p.START="start",p.LOOP_COMPLETE="loopComplete",p.COMPLETE="complete",p.FRAME_EVENT="frameEvent",p.SOUND_EVENT="soundEvent",t.MovieEvent=p,__reflect(p.prototype,"dragonBones.MovieEvent");var c=function(t){function e(e){var i=t.call(this)||this;return i.displayIndex=-1,i.colorIndex=-1,i.transformIndex=-1,i.rawDisplay=new egret.Bitmap,i.childMovies={},i.config=null,i.displayConfig=null,i.display=null,i.childMovie=null,i.colorFilter=null,i.display=i.rawDisplay,i.config=e,i.rawDisplay.name=i.config.name,null==i.config.blendMode&&(i.config.blendMode=0),i}return __extends(e,t),e.prototype.dispose=function(){this.rawDisplay=null,this.childMovies=null,this.config=null,this.displayConfig=null,this.display=null,this.childMovie=null,this.colorFilter=null},e}(egret.HashObject);__reflect(c.prototype,"MovieSlot");var d=function(e){function i(t){var a=e.call(this)||this;a.timeScale=1,a.clipTimeScale=1,a._batchEnabled=!0,a._isLockDispose=!1,a._isDelayDispose=!1,a._isStarted=!1,a._isPlaying=!1,a._isReversing=!1,a._isCompleted=!1,a._playTimes=0,a._time=0,a._currentTime=0,a._timeStamp=0,a._currentPlayTimes=0,a._cacheFrameIndex=0,a._frameSize=0,a._cacheRectangle=null,a._clock=null,a._groupConfig=null,a._config=null,a._clipConfig=null,a._currentFrameConfig=null,a._clipArray=null,a._clipNames=[],a._slots=[],a._childMovies=[],a._groupConfig=t.groupConfig,a._config=t.movieConfig,a._batchEnabled=!(a._config.isNested||a._config.hasChildAnimation),a._batchEnabled&&(a.$renderNode=new egret.sys.GroupNode,a.$renderNode.cleanBeforeRender=i._cleanBeforeRender),a._clipNames.length=0;for(var n=0,r=a._config.clip.length;r>n;++n)a._clipNames.push(a._config.clip[n].name);for(var n=0,r=a._config.slot.length;r>n;++n){var s=new c(a._config.slot[n]);a._updateSlotBlendMode(s),a._slots.push(s),a._batchEnabled?a.$renderNode.addNode(s.rawDisplay.$renderNode):a.addChild(s.rawDisplay)}return a._frameSize=2*a._slots.length,a.name=a._config.name,a.play(),a.advanceTime(1e-6),a.stop(),a}return __extends(i,e),i._cleanBeforeRender=function(){},i.prototype._configToEvent=function(t,e){e.movie=this,e.clipName=this._clipConfig.name,e.name=t.name,e.slotName=t.slot},i.prototype._onCrossFrame=function(e){for(var i=0,a=e.actionAndEvent.length;a>i;++i){var n=e.actionAndEvent[i];if(n)switch(n.type){case 11:if(t.EgretFactory.factory.soundEventManager.hasEventListener(p.SOUND_EVENT)){var r=egret.Event.create(p,p.SOUND_EVENT);this._configToEvent(n,r),t.EgretFactory.factory.soundEventManager.dispatchEvent(r),egret.Event.release(r)}break;case 10:if(this.hasEventListener(p.FRAME_EVENT)){var s=egret.Event.create(p,p.FRAME_EVENT);this._configToEvent(n,s),this.dispatchEvent(s),egret.Event.release(s)}break;case 0:case 4:if(n.slot){var o=this._getSlot(n.slot);o&&o.childMovie&&o.childMovie.play(n.name)}else this.play(n.name)}}},i.prototype._updateSlotBlendMode=function(t){var e="";switch(t.config.blendMode){case 0:e=egret.BlendMode.NORMAL;break;case 1:e=egret.BlendMode.ADD;break;case 5:e=egret.BlendMode.ERASE}e&&(this._batchEnabled?t.display.$renderNode.blendMode=egret.sys.blendModeToNumber(e):t.display.blendMode=e)},i.prototype._updateSlotColor=function(t,e,i,a,n,r,s,o,h){if(1!==i||1!==a||1!==n||0!==s||0!==o||0!==h||0!==r){t.colorFilter||(t.colorFilter=new egret.ColorMatrixFilter);var l=t.colorFilter.matrix;if(l[0]=i,l[6]=a,l[12]=n,l[18]=e,l[4]=s,l[9]=o,l[14]=h,l[19]=r,t.colorFilter.matrix=l,this._batchEnabled){t.display.$renderNode.filter;t.display.$renderNode.filter=t.colorFilter,t.display.$renderNode.alpha=1}else{var _=t.display.filters;_||(_=[]),_.indexOf(t.colorFilter)<0&&_.push(t.colorFilter),t.display.filters=_,t.display.$setAlpha(1)}}else t.colorFilter&&(t.colorFilter=null),this._batchEnabled?(t.display.$renderNode.filter=null,t.display.$renderNode.alpha=e):(t.display.filters=null,t.display.$setAlpha(e))},i.prototype._updateSlotDisplay=function(t){var e=t.display||t.rawDisplay,i=t.childMovie;if(t.displayIndex>=0)if(t.displayConfig=this._groupConfig.display[t.displayIndex],1===t.displayConfig.type){var a=t.childMovies[t.displayConfig.name];a||(a=o(t.displayConfig.name,this._groupConfig.name),t.childMovies[t.displayConfig.name]=a),t.display=a,t.childMovie=a}else t.display=t.rawDisplay,t.childMovie=null;else t.displayConfig=null,t.display=t.rawDisplay,t.childMovie=null;if(t.display!==e&&(e&&(this.addChild(t.display),this.swapChildren(t.display,e),this.removeChild(e)),this._updateSlotBlendMode(t)),t.display===t.rawDisplay)if(t.displayConfig&&null!=t.displayConfig.regionIndex){if(!t.displayConfig.texture){var n=this._groupConfig.textures[t.displayConfig.textureIndex||0],r=4*t.displayConfig.regionIndex,s=this._groupConfig.rectangleArray[r],h=this._groupConfig.rectangleArray[r+1],l=this._groupConfig.rectangleArray[r+2],_=this._groupConfig.rectangleArray[r+3];t.displayConfig.texture=new egret.Texture,t.displayConfig.texture._bitmapData=n._bitmapData,t.displayConfig.texture.$initData(s,h,Math.min(l,n.textureWidth-s),Math.min(_,n.textureHeight-h),0,0,Math.min(l,n.textureWidth-s),Math.min(_,n.textureHeight-h),n.textureWidth,n.textureHeight)}if(this._batchEnabled){var u=t.displayConfig.texture,p=t.rawDisplay.$renderNode;egret.sys.RenderNode.prototype.cleanBeforeRender.call(t.rawDisplay.$renderNode),p.image=u._bitmapData,p.drawImage(u._bitmapX,u._bitmapY,u._bitmapWidth,u._bitmapHeight,u._offsetX,u._offsetY,u.textureWidth,u.textureHeight),p.imageWidth=u._sourceWidth,p.imageHeight=u._sourceHeight}else t.rawDisplay.visible=!0,t.rawDisplay.$setBitmapData(t.displayConfig.texture)}else this._batchEnabled?t.rawDisplay.$renderNode.image=null:(t.rawDisplay.visible=!1,t.rawDisplay.$setBitmapData(null));t.childMovie!==i&&(i&&(i.stop(),this._childMovies.slice(this._childMovies.indexOf(i),1)),t.childMovie&&(this._childMovies.indexOf(t.childMovie)<0&&this._childMovies.push(t.childMovie),t.config.action?t.childMovie.play(t.config.action):t.childMovie.play(t.childMovie._config.action)))},i.prototype._getSlot=function(t){for(var e=0,i=this._slots.length;i>e;++e){var a=this._slots[e];if(a.config.name===t)return a}return null},i.prototype.$render=function(){this._batchEnabled||e.prototype.$render.call(this)},i.prototype.$measureContentBounds=function(t){this._batchEnabled&&this._cacheRectangle?t.setTo(this._cacheRectangle.x,this._cacheRectangle.y,this._cacheRectangle.width-this._cacheRectangle.x,this._cacheRectangle.height-this._cacheRectangle.y):e.prototype.$measureContentBounds.call(this,t)},i.prototype.$doAddChild=function(t,i,a){return this._batchEnabled?(console.warn("Can not add child."),null):e.prototype.$doAddChild.call(this,t,i,a)},i.prototype.$doRemoveChild=function(t,i){return this._batchEnabled?(console.warn("Can not remove child."),null):e.prototype.$doRemoveChild.call(this,t,i)},i.prototype.dispose=function(){if(this._isLockDispose)this._isDelayDispose=!0;else{if(this._clock&&this._clock.remove(this),this._slots)for(var t=0,e=this._slots.length;e>t;++t)this._slots[t].dispose();this._isPlaying=!1,this._cacheRectangle=null,this._clock=null,this._groupConfig=null,this._config=null,this._clipConfig=null,this._currentFrameConfig=null,this._clipArray=null,this._clipNames=null,this._slots=null,this._childMovies=null}},i.prototype.advanceTime=function(t){if(this._isPlaying){this._isLockDispose=!0,0>t&&(t=-t),t*=this.timeScale,this._time+=t*this.clipTimeScale;var e=this._clipConfig.duration,i=e*this._playTimes,a=this._time,n=this._currentPlayTimes;if(this._playTimes>0&&(a>=i||-i>=a)?(this._isCompleted=!0,n=this._playTimes,a=0>a?0:e):(this._isCompleted=!1,0>a?(n=Math.floor(-a/e),a=e- -a%e):(n=Math.floor(a/e),a%=e),this._playTimes>0&&n>this._playTimes&&(n=this._playTimes)),this._currentTime===a)return;var r=Math.floor(a*this._clipConfig.cacheTimeToFrameScale);if(this._cacheFrameIndex!==r){this._cacheFrameIndex=r;var s=this._groupConfig.displayFrameArray,o=this._groupConfig.transformArray,h=this._groupConfig.colorArray,u=!0,c=!1,d=!1,m=this._cacheRectangle;this._cacheRectangle=this._clipConfig.cacheRectangles[this._cacheFrameIndex],this._batchEnabled&&!this._cacheRectangle&&(d=!0,this._cacheRectangle=new egret.Rectangle,this._clipConfig.cacheRectangles[this._cacheFrameIndex]=this._cacheRectangle);for(var f=0,g=this._slots.length;g>f;++f){var y=this._slots[f],v=this._frameSize*this._cacheFrameIndex+2*f;v>=this._clipArray.length&&(v=this._frameSize*(this._cacheFrameIndex-1)+2*f);var D=2*this._clipArray[v];if(D>=0){var T=s[D],E=8*s[D+1],b=6*this._clipArray[v+1],O=!1;if(y.displayIndex!==T&&(y.displayIndex=T,O=!0,this._updateSlotDisplay(y)),(y.colorIndex!==E||O)&&(y.colorIndex=E,y.colorIndex>=0?this._updateSlotColor(y,.01*h[E],.01*h[E+1],.01*h[E+2],.01*h[E+3],h[E+4],h[E+5],h[E+6],h[E+7]):this._updateSlotColor(y,1,1,1,1,0,0,0,0)),c=!0,y.transformIndex!==b)if(y.transformIndex=b,this._batchEnabled){var x=y.display.$renderNode.matrix;
x||(x=y.display.$renderNode.matrix=new egret.Matrix),x.a=o[b],x.b=o[b+1],x.c=o[b+2],x.d=o[b+3],x.tx=o[b+4],x.ty=o[b+5]}else _.a=o[b],_.b=o[b+1],_.c=o[b+2],_.d=o[b+3],_.tx=o[b+4],_.ty=o[b+5],y.display.$setMatrix(_);if(this._batchEnabled&&d){var x=y.display.$renderNode.matrix;l.x=0,l.y=0,l.width=y.displayConfig.texture.textureWidth,l.height=y.displayConfig.texture.textureHeight,x.$transformBounds(l),u?(u=!1,this._cacheRectangle.x=l.x,this._cacheRectangle.width=l.x+l.width,this._cacheRectangle.y=l.y,this._cacheRectangle.height=l.y+l.height):(this._cacheRectangle.x=Math.min(this._cacheRectangle.x,l.x),this._cacheRectangle.width=Math.max(this._cacheRectangle.width,l.x+l.width),this._cacheRectangle.y=Math.min(this._cacheRectangle.y,l.y),this._cacheRectangle.height=Math.max(this._cacheRectangle.height,l.y+l.height))}}else-1!==y.displayIndex&&(y.displayIndex=-1,this._updateSlotDisplay(y))}this._cacheRectangle&&(c&&d&&u&&m&&(this._cacheRectangle.x=m.x,this._cacheRectangle.y=m.y,this._cacheRectangle.width=m.width,this._cacheRectangle.height=m.height),this.$invalidateContentBounds())}if(this._isCompleted&&(this._isPlaying=!1),!this._isStarted&&(this._isStarted=!0,this.hasEventListener(p.START))){var A=egret.Event.create(p,p.START);A.movie=this,A.clipName=this._clipConfig.name,A.name=null,A.slotName=null,this.dispatchEvent(A)}this._isReversing=this._currentTime>a&&this._currentPlayTimes===n,this._currentTime=a;var S=this._clipConfig.frame?this._clipConfig.frame.length:0;if(S>0){var B=Math.floor(this._currentTime*this._config.frameRate),M=this._groupConfig.frame[this._clipConfig.frame[B]];if(this._currentFrameConfig!==M)if(S>1){var P=this._currentFrameConfig;if(this._currentFrameConfig=M,!P){var w=Math.floor(this._currentTime*this._config.frameRate);P=this._groupConfig.frame[this._clipConfig.frame[w]],this._isReversing||(this._currentTime<=P.position||this._currentPlayTimes!==n)&&(P=this._groupConfig.frame[P.prev])}if(this._isReversing)for(;P!==M;)this._onCrossFrame(P),P=this._groupConfig.frame[P.prev];else for(;P!==M;)P=this._groupConfig.frame[P.next],this._onCrossFrame(P)}else this._currentFrameConfig=M,this._currentFrameConfig&&this._onCrossFrame(this._currentFrameConfig)}if(this._currentPlayTimes!==n){if(this._currentPlayTimes=n,this.hasEventListener(p.LOOP_COMPLETE)){var C=egret.Event.create(p,p.LOOP_COMPLETE);C.movie=this,C.clipName=this._clipConfig.name,C.name=null,C.slotName=null,this.dispatchEvent(C),egret.Event.release(C)}if(this._isCompleted&&this.hasEventListener(p.COMPLETE)){var R=egret.Event.create(p,p.COMPLETE);R.movie=this,R.clipName=this._clipConfig.name,R.name=null,R.slotName=null,this.dispatchEvent(R),egret.Event.release(R)}}}this._isLockDispose=!1,this._isDelayDispose&&this.dispose()},i.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),t){for(var i=null,a=0,n=this._config.clip.length;n>a;++a){var r=this._config.clip[a];r.name===t&&(i=r)}i?(this._clipConfig=i,this._clipArray=new Int16Array(this._groupConfig.arrayBuffer,this._groupConfig.offset+this._groupConfig.position[0]+this._clipConfig.p,this._clipConfig.s/this._groupConfig.position[2]),this._clipConfig.cacheRectangles||(this._clipConfig.cacheRectangles=[]),this._isPlaying=!0,this._isStarted=!1,this._isCompleted=!1,0>e||e!==e?this._playTimes=this._clipConfig.playTimes:this._playTimes=e,this._time=0,this._currentTime=0,this._currentPlayTimes=0,this._cacheFrameIndex=-1,this._currentFrameConfig=null,this._cacheRectangle=null,this.clipTimeScale=1/this._clipConfig.scale):console.warn("No clip in movie.",this._config.name,t)}else this._clipConfig?this._isPlaying||this._isCompleted?this.play(this._clipConfig.name,this._playTimes):this._isPlaying=!0:this._config.action&&this.play(this._config.action,e)},i.prototype.stop=function(){this._isPlaying=!1},i.prototype.gotoAndPlay=function(t,e,i){void 0===t&&(t=null),void 0===i&&(i=-1),e%=this._clipConfig.duration,0>e&&(e+=this._clipConfig.duration),this.play(t,i),this._time=e,this._currentTime=e},i.prototype.gotoAndStop=function(t,e){void 0===t&&(t=null),e%=this._clipConfig.duration,0>e&&(e+=this._clipConfig.duration),this.play(t,1),this._time=e,this._currentTime=e,this.advanceTime(.001),this.stop()},i.prototype.hasClip=function(t){for(var e=0,i=this._config.clip.length;i>e;++e){var a=this._config.clip[e];if(a.name===t)return!0}return!1},Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._isPlaying&&!this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isComplete",{get:function(){return this._isCompleted},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._currentTime},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalTime",{get:function(){return this._clipConfig?this._clipConfig.duration:0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentPlayTimes",{get:function(){return this._currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"playTimes",{get:function(){return this._playTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"groupName",{get:function(){return this._groupConfig.name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clipName",{get:function(){return this._clipConfig?this._clipConfig.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clipNames",{get:function(){return this._clipNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){var e=this._clock;this._clock=t,e&&e.remove(this),this._clock&&this._clock.add(this)}},enumerable:!0,configurable:!0}),i.prototype.advanceTimeBySelf=function(e){e?this.clock=t.EgretFactory.clock:this.clock=null},i}(egret.DisplayObjectContainer);t.Movie=d,__reflect(d.prototype,"dragonBones.Movie",["dragonBones.IAnimateble"])}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._armatureDisplayA=null,e._armatureDisplayB=null,e._resourceGroup="baseTest",e._resourceConfigURL="resource/base_test.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=this,e=RES.getGroupByName("search");if(e&&e.length>0)for(var i=0,a=e.length;a>i;++i){var n=e[i].name;dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes(n));var r=RES.getRes(n+"_textureData");r&&dragonBones.EgretFactory.factory.parseTextureAtlasData(r,RES.getRes(n+"_texture"))}this._armatureDisplayA=dragonBones.EgretFactory.factory.buildArmatureDisplay("armatureName","dead_1"),this._armatureDisplayA.x=.5*this.stage.stageWidth-200,this._armatureDisplayA.y=.5*this.stage.stageHeight,this.addChild(this._armatureDisplayA),this._armatureDisplayB=dragonBones.EgretFactory.factory.buildArmatureDisplay("armatureName","hero_1"),this._armatureDisplayB.x=.5*this.stage.stageWidth+200,this._armatureDisplayB.y=.5*this.stage.stageHeight,this.addChild(this._armatureDisplayB),dragonBones.EgretFactory.factory.soundEventManager.addEventListener(dragonBones.EventObject.SOUND_EVENT,function(t){console.log(t.armature.armatureData.parent.name,t.eventObject.animationState.name,t.eventObject.name)},null);var s=function(e){switch(e.keyCode){case 49:t._armatureDisplayA.animation.play("empty_ZouLu",0);break;case 50:t._armatureDisplayB.animation.play("empty_PaoBu",0);break;case 51:t._armatureDisplayA.animation.stop(),t._armatureDisplayB.animation.stop()}};document.addEventListener("keyup",s)},e}(BaseTest);t.SoundTest=e,__reflect(e.prototype,"demosEgret.SoundTest")}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._boneMask=[],t._animationNames=[],t._boneTimelines=[],t._slotTimelines=[],t._ffdTimelines=[],t.autoTween=!1,t}return __extends(i,e),i.toString=function(){return"[class dragonBones.AnimationState]"},i.prototype._onClear=function(){for(var t=0,e=this._boneTimelines.length;e>t;++t)this._boneTimelines[t].returnToPool();for(var t=0,e=this._slotTimelines.length;e>t;++t)this._slotTimelines[t].returnToPool();for(var t=0,e=this._ffdTimelines.length;e>t;++t)this._ffdTimelines[t].returnToPool();this._timeline&&this._timeline.returnToPool(),this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.displayControl=!0,this.additiveBlending=!1,this.actionEnabled=!1,this.playTimes=1,this.timeScale=1,this.weight=1,this.autoFadeOutTime=-1,this.fadeTotalTime=0,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._layer=0,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._name=null,this._group=null,this._boneMask.length=0,this._animationNames.length=0,this._boneTimelines.length=0,this._slotTimelines.length=0,this._ffdTimelines.length=0,this._animationData=null,this._armature=null,this._timeline=null,this._zOrderTimeline=null},i.prototype._advanceFadeTime=function(e){var i=this._fadeState>0;if(this._subFadeState<0){this._subFadeState=0;var a=i?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;if(this._armature.eventDispatcher.hasEvent(a)){var n=t.BaseObject.borrowObject(t.EventObject);n.animationState=this,this._armature._bufferEvent(n,a)}}if(0>e&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=i?0:1):this._fadeTime>0?this._fadeProgress=i?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=i?1:0,this._subFadeState>0){i||(this._playheadState|=1,this._fadeState=0);var a=i?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE;if(this._armature.eventDispatcher.hasEvent(a)){var n=t.BaseObject.borrowObject(t.EventObject);n.animationState=this,this._armature._bufferEvent(n,a)}}},i.prototype._init=function(e,i,a){if(this._armature=e,this._animationData=i,this._name=a.name?a.name:a.animation,this.actionEnabled=a.actionEnabled,this.additiveBlending=a.additiveBlending,this.displayControl=a.displayControl,this.playTimes=a.playTimes,this.timeScale=a.timeScale,this.fadeTotalTime=a.fadeInTime,this.autoFadeOutTime=a.autoFadeOutTime,this.weight=a.weight,a.pauseFadeIn?this._playheadState=2:this._playheadState=3,this._fadeState=-1,this._subFadeState=-1,this._layer=a.layer,this._group=a.group,a.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==a.position?this.timeScale>=0?this._time=a.position:this._time=a.position-this._duration:this._time=0):(this._position=a.position,this._duration=a.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),a.boneMask.length>0){this._boneMask.length=a.boneMask.length;for(var n=0,r=this._boneMask.length;r>n;++n)this._boneMask[n]=a.boneMask[n]}if(a.animationNames.length>0){this._animationNames.length=a.animationNames.length;for(var n=0,r=this._animationNames.length;r>n;++n)this._animationNames[n]=a.animationNames[n]}this._timeline=t.BaseObject.borrowObject(t.AnimationTimelineState),this._timeline._init(this._armature,this,this._animationData),this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline._init(this._armature,this,this._animationData.zOrderTimeline)),this._updateTimelineStates()},i.prototype._updateTimelineStates=function(){for(var e={},i={},a={},n=0,r=this._boneTimelines.length;r>n;++n){var s=this._boneTimelines[n];e[s.bone.name]=s}for(var o=this._armature.getBones(),n=0,r=o.length;r>n;++n){var h=o[n],l=h.name;if(this.containsBoneMask(l)){var _=this._animationData.getBoneTimeline(l);if(_)if(e[l])delete e[l];else{var s=t.BaseObject.borrowObject(t.BoneTimelineState);s.bone=h,s._init(this._armature,this,_),this._boneTimelines.push(s)}}}for(var u in e){var s=e[u];s.bone.invalidUpdate(),this._boneTimelines.splice(this._boneTimelines.indexOf(s),1),s.returnToPool()}for(var n=0,r=this._slotTimelines.length;r>n;++n){var p=this._slotTimelines[n];i[p.slot.name]=p}for(var n=0,r=this._ffdTimelines.length;r>n;++n){var c=this._ffdTimelines[n],d=c._timelineData.display,m=d.inheritAnimation?d.mesh.name:d.name;a[m]=c}for(var f=this._armature.getSlots(),n=0,r=f.length;r>n;++n){var g=f[n],y=g.name,v=g.parent.name,D=!1;if(this.containsBoneMask(v)){var T=this._animationData.getSlotTimeline(y);if(T)if(i[y])delete i[y];else{var p=t.BaseObject.borrowObject(t.SlotTimelineState);p.slot=g,p._init(this._armature,this,T),this._slotTimelines.push(p)}var E=this._animationData.getFFDTimeline(this._armature._skinData.name,y);if(E)for(var u in E)if(a[u])delete a[u];else{var c=t.BaseObject.borrowObject(t.FFDTimelineState);c.slot=g,c._init(this._armature,this,E[u]),this._ffdTimelines.push(c)}else D=!0}else D=!0;if(D){for(var b=0,O=g._ffdVertices.length;O>b;++b)g._ffdVertices[b]=0;g._meshDirty=!0}}for(var u in i){var p=i[u];this._slotTimelines.splice(this._slotTimelines.indexOf(p),1),p.returnToPool()}for(var u in a){var c=a[u];this._ffdTimelines.splice(this._ffdTimelines.indexOf(c),1),c.returnToPool()}},i.prototype._advanceTime=function(t,e){if((0!==this._fadeState||0!==this._subFadeState)&&this._advanceFadeTime(t),1!==this.timeScale&&(t*=this.timeScale),0!==t&&3===this._playheadState&&(this._time+=t),0!==this.weight){var i=0===this._fadeState&&e>0,a=!0,n=!0,r=this._time;if(this._weightResult=this.weight*this._fadeProgress,this._timeline.update(r),i){var s=2*e;this._timeline._currentTime=Math.floor(this._timeline._currentTime*s)/s}if(this._zOrderTimeline&&this._zOrderTimeline.update(r),i){var o=Math.floor(this._timeline._currentTime*e);this._armature.animation._cacheFrameIndex===o?(a=!1,n=!1):(this._armature.animation._cacheFrameIndex=o,this._animationData.cachedFrames[o]?n=!1:this._animationData.cachedFrames[o]=!0)}if(a){if(n)for(var h=0,l=this._boneTimelines.length;l>h;++h)this._boneTimelines[h].update(r);for(var h=0,l=this._slotTimelines.length;l>h;++h)this._slotTimelines[h].update(r);for(var h=0,l=this._ffdTimelines.length;l>h;++h)this._ffdTimelines[h].update(r)}}0===this._fadeState&&(this._subFadeState>0&&(this._subFadeState=0),this._timeline._playState>0&&(this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime),this._animationNames.length>0))},i.prototype._isDisabled=function(t){return!this.displayControl||t.displayController&&t.displayController!==this._name&&t.displayController!==this._group?!0:!1},i.prototype.play=function(){this._playheadState=3},i.prototype.stop=function(){this._playheadState&=1},i.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),(0>t||t!==t)&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>t-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(0>=t||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var i=0,a=this._boneTimelines.length;a>i;++i)this._boneTimelines[i].fadeOut();for(var i=0,a=this._slotTimelines.length;a>i;++i)this._slotTimelines[i].fadeOut();for(var i=0,a=this._ffdTimelines.length;a>i;++i)this._ffdTimelines[i].fadeOut()}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},i.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},i.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._armature.getBone(t);if(i){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var a=this._armature.getBones(),n=0,r=a.length;r>n;++n){var s=a[n];this._boneMask.indexOf(s.name)<0&&i.contains(s)&&this._boneMask.push(s.name)}this._updateTimelineStates()}},i.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var i=this._boneMask.indexOf(t);if(i>=0&&this._boneMask.splice(i,1),e){var a=this._armature.getBone(t);if(a){var n=this._armature.getBones();if(this._boneMask.length>0)for(var r=0,s=n.length;s>r;++r){var o=n[r],h=this._boneMask.indexOf(o.name);h>=0&&a.contains(o)&&this._boneMask.splice(h,1)}else for(var r=0,s=n.length;s>r;++r){var o=n[r];a.contains(o)||this._boneMask.push(o.name)}}}this._updateTimelineStates()},i.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._updateTimelineStates()},Object.defineProperty(i.prototype,"layer",{get:function(){return this._layer},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"group",{get:function(){return this._group},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){return this._timeline._playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isPlaying",{get:function(){return 2&this._playheadState&&this._timeline._playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentPlayTimes",{get:function(){return this._timeline._currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"currentTime",{get:function(){return this._timeline._currentTime},set:function(t){t!==t&&(t=0);var e=this._timeline._currentPlayTimes-(this._timeline._playState>0?1:0);if(t=t%this._duration+e*this._duration,0>t&&(t+=this._duration),this._time!==t){this._time=t,this._timeline.setCurrentTime(this._time),this._zOrderTimeline&&(this._zOrderTimeline._playState=-1);for(var i=0,a=this._boneTimelines.length;a>i;++i)this._boneTimelines[i]._playState=-1;for(var i=0,a=this._slotTimelines.length;a>i;++i)this._slotTimelines[i]._playState=-1;for(var i=0,a=this._ffdTimelines.length;a>i;++i)this._ffdTimelines[i]._playState=-1}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clip",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),i}(t.BaseObject);t.AnimationState=e,__reflect(e.prototype,"dragonBones.AnimationState")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._displayIndex=0,e._replaceDisplays=["display0002","display0003","display0004","display0005","display0006","display0007","display0008","display0009","display0010","meshA","meshB","mesh"],e._factory=dragonBones.EgretFactory.factory,e._armatureDisplay=null,e._resourceConfigURL="resource/replace_slot_display.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=this;this._factory.parseDragonBonesData(RES.getRes("dragonBonesData")),this._factory.parseTextureAtlasData(RES.getRes("textureDataA"),RES.getRes("textureA")),this._armatureDisplay=this._factory.buildArmatureDisplay("MyArmature"),this._armatureDisplay.animation.timeScale=.1,this._armatureDisplay.animation.play(),this._armatureDisplay.x=.5*this.stage.stageWidth,this._armatureDisplay.y=.5*this.stage.stageHeight,this.addChild(this._armatureDisplay),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t._replaceDisplay()},this),document.addEventListener("keydown",function(e){t._armatureDisplay.armature.replacedTexture?t._armatureDisplay.armature.replacedTexture=null:t._armatureDisplay.armature.replacedTexture=RES.getRes("textureRP")})},e.prototype._replaceDisplay=function(){this._displayIndex=(this._displayIndex+1)%this._replaceDisplays.length;var t=this._replaceDisplays[this._displayIndex];if(t.indexOf("mesh")>=0)switch(t){case"meshA":this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyMesh","meshA","weapon_1004_1",this._armatureDisplay.armature.getSlot("weapon")),this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyDisplay","ball","display0002",this._armatureDisplay.armature.getSlot("mesh"));break;case"meshB":this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyMesh","meshB","weapon_1004_1",this._armatureDisplay.armature.getSlot("weapon")),this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyDisplay","ball","display0003",this._armatureDisplay.armature.getSlot("mesh"));break;case"mesh":this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyMesh","mesh","weapon_1004_1",this._armatureDisplay.armature.getSlot("weapon")),this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyDisplay","ball","display0005",this._armatureDisplay.armature.getSlot("mesh"))}else this._factory.replaceSlotDisplay("ReplaceSlotDisplay","MyDisplay","ball",t,this._armatureDisplay.armature.getSlot("ball"))},e}(BaseTest);t.ReplaceSlotDisplay=e,__reflect(e.prototype,"demosEgret.ReplaceSlotDisplay")}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.toString=function(){return"[class dragonBones.AnimationTimelineState]"},i.prototype._onCrossFrame=function(e){if(this._animationState.actionEnabled)for(var i=e.actions,a=0,n=i.length;n>a;++a)this._armature._bufferAction(i[a]);for(var r=this._armature.eventDispatcher,s=e.events,a=0,n=s.length;n>a;++a){var o=s[a],h=null;switch(o.type){case 10:h=t.EventObject.FRAME_EVENT;break;case 11:h=t.EventObject.SOUND_EVENT}if(r.hasEvent(h)||11===o.type){var l=t.BaseObject.borrowObject(t.EventObject);l.name=o.name,l.frame=e,l.data=o.data,l.animationState=this._animationState,o.bone&&(l.bone=this._armature.getBone(o.bone.name)),o.slot&&(l.slot=this._armature.getSlot(o.slot.name)),this._armature._bufferEvent(l,h)}}},i.prototype.update=function(e){var i=this._playState,a=this._currentPlayTimes,n=this._currentTime;if(this._playState<=0&&this._setCurrentTime(e)){var r=this._armature.eventDispatcher;if(0>i&&this._playState!==i&&(this._animationState.displayControl&&this._armature._sortZOrder(null),r.hasEvent(t.EventObject.START))){var s=t.BaseObject.borrowObject(t.EventObject);s.animationState=this._animationState,this._armature._bufferEvent(s,t.EventObject.START)}if(0>n)return;var o=!1,h=null,l=null;if(this._currentPlayTimes!==a?(r.hasEvent(t.EventObject.LOOP_COMPLETE)&&(h=t.BaseObject.borrowObject(t.EventObject),h.animationState=this._animationState),this._playState>0?(r.hasEvent(t.EventObject.COMPLETE)&&(l=t.BaseObject.borrowObject(t.EventObject),l.animationState=this._animationState),o=n>this._currentTime):o=n<this._currentTime):o=n>this._currentTime,this._frameCount>1){var _=Math.floor(this._currentTime*this._frameRate),u=this._timelineData.frames[_];if(this._currentFrame!==u){var p=this._currentFrame;if(this._currentFrame=u,o){if(!p){var c=Math.floor(n*this._frameRate);p=this._timelineData.frames[c],this._currentPlayTimes===a&&p===u&&(p=null)}for(;p&&(this._position<=p.position&&p.position<=this._position+this._duration&&this._onCrossFrame(p),h&&p===this._timelineData.frames[0]&&(this._armature._bufferEvent(h,t.EventObject.LOOP_COMPLETE),h=null),p=p.prev,p!==u););}else{if(!p){var c=Math.floor(n*this._frameRate);p=this._timelineData.frames[c],this._currentPlayTimes===a&&(n<=p.position?p=p.prev:p===u&&(p=null))}for(;p&&(p=p.next,h&&p===this._timelineData.frames[0]&&(this._armature._bufferEvent(h,t.EventObject.LOOP_COMPLETE),h=null),this._position<=p.position&&p.position<=this._position+this._duration&&this._onCrossFrame(p),p!==u););}}}else this._frameCount>0&&!this._currentFrame&&(this._currentFrame=this._timelineData.frames[0],this._currentPlayTimes===a?n<=this._currentFrame.position&&this._onCrossFrame(this._currentFrame):this._position<=this._currentFrame.position&&(!o&&h&&(this._armature._bufferEvent(h,t.EventObject.LOOP_COMPLETE),h=null),this._onCrossFrame(this._currentFrame)));h&&(this._armature._bufferEvent(h,t.EventObject.LOOP_COMPLETE),h=null),l&&(this._armature._bufferEvent(l,t.EventObject.COMPLETE),l=null)}},i.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._currentFrame=null},i}(t.TimelineState);t.AnimationTimelineState=e,__reflect(e.prototype,"dragonBones.AnimationTimelineState");var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this),this._armature._sortZOrder(this._currentFrame.zOrder)},e}(t.TimelineState);t.ZOrderTimelineState=i,__reflect(i.prototype,"dragonBones.ZOrderTimelineState");var a=function(e){function i(){var i=e.call(this)||this;return i._transform=new t.Transform,i._durationTransform=new t.Transform,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.BoneTimelineState]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.bone=null,this._transformDirty=!1,this._tweenTransform=0,this._tweenRotate=0,this._tweenScale=0,this._transform.identity(),this._durationTransform.identity(),this._boneTransform=null,this._originalTransform=null},i.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),this._tweenTransform=1,this._tweenRotate=1,this._tweenScale=1,this._frameCount>1&&(this._tweenEasing!==t.DragonBones.NO_TWEEN||this._curve)){var i=this._currentFrame.transform,a=this._currentFrame.next,n=a.transform;this._durationTransform.x=n.x-i.x,this._durationTransform.y=n.y-i.y,(0!==this._durationTransform.x||0!==this._durationTransform.y)&&(this._tweenTransform=2);var r=this._currentFrame.tweenRotate;r!==t.DragonBones.NO_TWEEN?(r?((r>0?n.skewY>=i.skewY:n.skewY<=i.skewY)&&(r=r>0?r-1:r+1),this._durationTransform.skewX=n.skewX-i.skewX+t.DragonBones.PI_D*r,this._durationTransform.skewY=n.skewY-i.skewY+t.DragonBones.PI_D*r):(this._durationTransform.skewX=t.Transform.normalizeRadian(n.skewX-i.skewX),this._durationTransform.skewY=t.Transform.normalizeRadian(n.skewY-i.skewY)),(0!==this._durationTransform.skewX||0!==this._durationTransform.skewY)&&(this._tweenRotate=2)):(this._durationTransform.skewX=0,this._durationTransform.skewY=0),this._currentFrame.tweenScale?(this._durationTransform.scaleX=n.scaleX-i.scaleX,this._durationTransform.scaleY=n.scaleY-i.scaleY,(0!==this._durationTransform.scaleX||0!==this._durationTransform.scaleY)&&(this._tweenScale=2)):(this._durationTransform.scaleX=0,this._durationTransform.scaleY=0)}else this._durationTransform.x=0,this._durationTransform.y=0,this._durationTransform.skewX=0,this._durationTransform.skewY=0,this._durationTransform.scaleX=0,this._durationTransform.scaleY=0},i.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var i=0,a=this._currentFrame.transform;0!==this._tweenTransform&&(1===this._tweenTransform?(this._tweenTransform=0,i=0):i=this._tweenProgress,this._animationState.additiveBlending?(this._transform.x=a.x+this._durationTransform.x*i,this._transform.y=a.y+this._durationTransform.y*i):(this._transform.x=this._originalTransform.x+a.x+this._durationTransform.x*i,this._transform.y=this._originalTransform.y+a.y+this._durationTransform.y*i),this._transformDirty=!0),0!==this._tweenRotate&&(1===this._tweenRotate?(this._tweenRotate=0,i=0):i=this._tweenProgress,this._animationState.additiveBlending?(this._transform.skewX=a.skewX+this._durationTransform.skewX*i,this._transform.skewY=a.skewY+this._durationTransform.skewY*i):(this._transform.skewX=t.Transform.normalizeRadian(this._originalTransform.skewX+a.skewX+this._durationTransform.skewX*i),this._transform.skewY=t.Transform.normalizeRadian(this._originalTransform.skewY+a.skewY+this._durationTransform.skewY*i)),this._transformDirty=!0),0!==this._tweenScale&&(1===this._tweenScale?(this._tweenScale=0,i=0):i=this._tweenProgress,this._animationState.additiveBlending?(this._transform.scaleX=a.scaleX+this._durationTransform.scaleX*i,this._transform.scaleY=a.scaleY+this._durationTransform.scaleY*i):(this._transform.scaleX=this._originalTransform.scaleX*(a.scaleX+this._durationTransform.scaleX*i),this._transform.scaleY=this._originalTransform.scaleY*(a.scaleY+this._durationTransform.scaleY*i)),this._transformDirty=!0)},i.prototype._init=function(t,i,a){e.prototype._init.call(this,t,i,a),this._originalTransform=this._timelineData.originalTransform,this._boneTransform=this.bone._animationPose},i.prototype.fadeOut=function(){this._transform.skewX=t.Transform.normalizeRadian(this._transform.skewX),this._transform.skewY=t.Transform.normalizeRadian(this._transform.skewY)},i.prototype.update=function(i){var a=this._animationState._layer,n=this._animationState._weightResult;this.bone._blendDirty?this.bone._blendLeftWeight>0&&(this.bone._blendLayer!==a&&(this.bone._blendTotalWeight>=this.bone._blendLeftWeight?this.bone._blendLeftWeight=0:(this.bone._blendLayer=a,this.bone._blendLeftWeight-=this.bone._blendTotalWeight,this.bone._blendTotalWeight=0)),n*=this.bone._blendLeftWeight,n>=0&&(e.prototype.update.call(this,i),this.bone._blendTotalWeight+=n,this._boneTransform.x+=this._transform.x*n,this._boneTransform.y+=this._transform.y*n,this._boneTransform.skewX+=this._transform.skewX*n,this._boneTransform.skewY+=this._transform.skewY*n,this._boneTransform.scaleX+=(this._transform.scaleX-1)*n,this._boneTransform.scaleY+=(this._transform.scaleY-1)*n,this._boneTransform.skewX=t.Transform.normalizeRadian(this._boneTransform.skewX),this._boneTransform.skewY=t.Transform.normalizeRadian(this._boneTransform.skewY))):(e.prototype.update.call(this,i),this.bone._blendLayer=a,this.bone._blendLeftWeight=1,this.bone._blendTotalWeight=n,this._boneTransform.x=this._transform.x*n,this._boneTransform.y=this._transform.y*n,this._boneTransform.skewX=this._transform.skewX*n,this._boneTransform.skewY=this._transform.skewY*n,this._boneTransform.scaleX=(this._transform.scaleX-1)*n+1,this._boneTransform.scaleY=(this._transform.scaleY-1)*n+1,this.bone._blendDirty=!0),(this._transformDirty||0!==this._animationState._fadeState||0!==this._animationState._subFadeState)&&(this._transformDirty=!1,this.bone.invalidUpdate())},i}(t.TweenTimelineState);t.BoneTimelineState=a,__reflect(a.prototype,"dragonBones.BoneTimelineState");var n=function(e){function i(){var i=e.call(this)||this;return i._color=new t.ColorTransform,i._durationColor=new t.ColorTransform,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.SlotTimelineState]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.slot=null,this._colorDirty=!1,this._tweenColor=0,this._color.identity(),this._durationColor.identity(),this._slotColor=null},i.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),this._animationState._isDisabled(this.slot))return this._tweenEasing=t.DragonBones.NO_TWEEN,this._curve=null,void(this._tweenColor=0);var i=this._currentFrame.displayIndex;if(this._playState>=0&&this.slot.displayIndex!==i&&this.slot._setDisplayIndex(i),i>=0){this._tweenColor=0;var a=this._currentFrame.color;if(this._tweenEasing!==t.DragonBones.NO_TWEEN||this._curve){var n=this._currentFrame.next,r=n.color;a!==r&&(this._durationColor.alphaMultiplier=r.alphaMultiplier-a.alphaMultiplier,this._durationColor.redMultiplier=r.redMultiplier-a.redMultiplier,this._durationColor.greenMultiplier=r.greenMultiplier-a.greenMultiplier,this._durationColor.blueMultiplier=r.blueMultiplier-a.blueMultiplier,this._durationColor.alphaOffset=r.alphaOffset-a.alphaOffset,this._durationColor.redOffset=r.redOffset-a.redOffset,this._durationColor.greenOffset=r.greenOffset-a.greenOffset,this._durationColor.blueOffset=r.blueOffset-a.blueOffset,(0!==this._durationColor.alphaMultiplier||0!==this._durationColor.redMultiplier||0!==this._durationColor.greenMultiplier||0!==this._durationColor.blueMultiplier||0!==this._durationColor.alphaOffset||0!==this._durationColor.redOffset||0!==this._durationColor.greenOffset||0!==this._durationColor.blueOffset)&&(this._tweenColor=2))}0===this._tweenColor&&(this._slotColor.alphaMultiplier!==a.alphaMultiplier||this._slotColor.redMultiplier!==a.redMultiplier||this._slotColor.greenMultiplier!==a.greenMultiplier||this._slotColor.blueMultiplier!==a.blueMultiplier||this._slotColor.alphaOffset!==a.alphaOffset||this._slotColor.redOffset!==a.redOffset||this._slotColor.greenOffset!==a.greenOffset||this._slotColor.blueOffset!==a.blueOffset)&&(this._tweenColor=1)}else this._tweenEasing=t.DragonBones.NO_TWEEN,this._curve=null,this._tweenColor=0
},i.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=0;if(0!==this._tweenColor&&this.slot.parent._blendLayer>=this._animationState._layer){1===this._tweenColor?(this._tweenColor=0,t=0):t=this._tweenProgress;var i=this._currentFrame.color;this._color.alphaMultiplier=i.alphaMultiplier+this._durationColor.alphaMultiplier*t,this._color.redMultiplier=i.redMultiplier+this._durationColor.redMultiplier*t,this._color.greenMultiplier=i.greenMultiplier+this._durationColor.greenMultiplier*t,this._color.blueMultiplier=i.blueMultiplier+this._durationColor.blueMultiplier*t,this._color.alphaOffset=i.alphaOffset+this._durationColor.alphaOffset*t,this._color.redOffset=i.redOffset+this._durationColor.redOffset*t,this._color.greenOffset=i.greenOffset+this._durationColor.greenOffset*t,this._color.blueOffset=i.blueOffset+this._durationColor.blueOffset*t,this._colorDirty=!0}},i.prototype._init=function(t,i,a){e.prototype._init.call(this,t,i,a),this._slotColor=this.slot._colorTransform},i.prototype.fadeOut=function(){this._tweenColor=0},i.prototype.update=function(t){if(e.prototype.update.call(this,t),0!==this._tweenColor||this._colorDirty)if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){var i=Math.pow(this._animationState._fadeProgress,4);this._slotColor.alphaMultiplier+=(this._color.alphaMultiplier-this._slotColor.alphaMultiplier)*i,this._slotColor.redMultiplier+=(this._color.redMultiplier-this._slotColor.redMultiplier)*i,this._slotColor.greenMultiplier+=(this._color.greenMultiplier-this._slotColor.greenMultiplier)*i,this._slotColor.blueMultiplier+=(this._color.blueMultiplier-this._slotColor.blueMultiplier)*i,this._slotColor.alphaOffset+=(this._color.alphaOffset-this._slotColor.alphaOffset)*i,this._slotColor.redOffset+=(this._color.redOffset-this._slotColor.redOffset)*i,this._slotColor.greenOffset+=(this._color.greenOffset-this._slotColor.greenOffset)*i,this._slotColor.blueOffset+=(this._color.blueOffset-this._slotColor.blueOffset)*i,this.slot._colorDirty=!0}else this._colorDirty&&(this._colorDirty=!1,this._slotColor.alphaMultiplier=this._color.alphaMultiplier,this._slotColor.redMultiplier=this._color.redMultiplier,this._slotColor.greenMultiplier=this._color.greenMultiplier,this._slotColor.blueMultiplier=this._color.blueMultiplier,this._slotColor.alphaOffset=this._color.alphaOffset,this._slotColor.redOffset=this._color.redOffset,this._slotColor.greenOffset=this._color.greenOffset,this._slotColor.blueOffset=this._color.blueOffset,this.slot._colorDirty=!0)},i}(t.TweenTimelineState);t.SlotTimelineState=n,__reflect(n.prototype,"dragonBones.SlotTimelineState");var r=function(e){function i(){var t=e.call(this)||this;return t._ffdVertices=[],t._durationFFDVertices=[],t}return __extends(i,e),i.toString=function(){return"[class dragonBones.FFDTimelineState]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.slot=null,this._ffdDirty=!1,this._tweenFFD=0,this._ffdVertices.length=0,this._durationFFDVertices.length=0,this._slotFFDVertices=null},i.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),this.slot.displayIndex>=0&&this._animationState._isDisabled(this.slot))return this._tweenEasing=t.DragonBones.NO_TWEEN,this._curve=null,void(this._tweenFFD=0);if(this._tweenFFD=0,this._tweenEasing!==t.DragonBones.NO_TWEEN||this._curve)for(var i=this._currentFrame.tweens,a=this._currentFrame.next.tweens,n=0,r=i.length;r>n;++n){var s=a[n]-i[n];this._durationFFDVertices[n]=s,0!==s&&(this._tweenFFD=2)}if(0===this._tweenFFD){this._tweenFFD=1;for(var n=0,r=this._durationFFDVertices.length;r>n;++n)this._durationFFDVertices[n]=0}},i.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=0;if(0!==this._tweenFFD&&this.slot.parent._blendLayer>=this._animationState._layer){1===this._tweenFFD?(this._tweenFFD=0,t=0):t=this._tweenProgress;for(var i=this._currentFrame.tweens,a=0,n=i.length;n>a;++a)this._ffdVertices[a]=i[a]+this._durationFFDVertices[a]*t;this._ffdDirty=!0}},i.prototype._init=function(t,i,a){e.prototype._init.call(this,t,i,a),this._slotFFDVertices=this.slot._ffdVertices,this._ffdVertices.length=this._timelineData.frames[0].tweens.length,this._durationFFDVertices.length=this._ffdVertices.length;for(var n=0,r=this._ffdVertices.length;r>n;++n)this._ffdVertices[n]=0;for(var n=0,r=this._durationFFDVertices.length;r>n;++n)this._durationFFDVertices[n]=0},i.prototype.fadeOut=function(){this._tweenFFD=0},i.prototype.update=function(t){if(e.prototype.update.call(this,t),this.slot._meshData===this._timelineData.display.mesh&&(0!==this._tweenFFD||this._ffdDirty))if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var i=Math.pow(this._animationState._fadeProgress,4),a=0,n=this._ffdVertices.length;n>a;++a)this._slotFFDVertices[a]+=(this._ffdVertices[a]-this._slotFFDVertices[a])*i;this.slot._meshDirty=!0}else if(this._ffdDirty){this._ffdDirty=!1;for(var a=0,n=this._ffdVertices.length;n>a;++a)this._slotFFDVertices[a]=this._ffdVertices[a];this.slot._meshDirty=!0}},i}(t.TweenTimelineState);t.FFDTimelineState=r,__reflect(r.prototype,"dragonBones.FFDTimelineState")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(){function e(){this.time=(new Date).getTime()/t.DragonBones.SECOND_TO_MILLISECOND,this.timeScale=1,this._animatebles=[],this._clock=null}return Object.defineProperty(e,"clock",{get:function(){return e._clock||(e._clock=new e),e._clock},enumerable:!0,configurable:!0}),e.prototype.advanceTime=function(e){if(e!==e&&(e=0),0>e&&(e=(new Date).getTime()/t.DragonBones.SECOND_TO_MILLISECOND-this.time),1!==this.timeScale&&(e*=this.timeScale),0>e?this.time-=e:this.time+=e,e){for(var i=0,a=0,n=this._animatebles.length;n>i;++i){var r=this._animatebles[i];r?(a>0&&(this._animatebles[i-a]=r,this._animatebles[i]=null),r.advanceTime(e)):a++}if(a>0){for(n=this._animatebles.length;n>i;++i){var r=this._animatebles[i];r?this._animatebles[i-a]=r:a++}this._animatebles.length-=a}}},e.prototype.contains=function(t){return this._animatebles.indexOf(t)>=0},e.prototype.add=function(e){e&&this._animatebles.indexOf(e)<0&&(this._animatebles.push(e),e.clock=this,t.DragonBones.debug&&e instanceof t.Armature&&t.DragonBones.addArmature(e))},e.prototype.remove=function(e){var i=this._animatebles.indexOf(e);i>=0&&(this._animatebles[i]=null,e.clock=null,t.DragonBones.debug&&e instanceof t.Armature&&t.DragonBones.removeArmature(e))},e.prototype.clear=function(){for(var t=0,e=this._animatebles.length;e>t;++t){var i=this._animatebles[t];this._animatebles[t]=null,null!=i&&(i.clock=null)}},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){var e=this._clock;this._clock=t,e&&e.remove(this),this._clock&&this._clock.add(this)}},enumerable:!0,configurable:!0}),e}();e._clock=null,t.WorldClock=e,__reflect(e.prototype,"dragonBones.WorldClock",["dragonBones.IAnimateble"])}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._bones=[],t._slots=[],t._actions=[],t._events=[],t.enableCache=!1,t}return __extends(i,e),i.toString=function(){return"[class dragonBones.Armature]"},i._onSortSlots=function(t,e){return t._zOrder>e._zOrder?1:-1},i.prototype._onClear=function(){for(var t=0,e=this._bones.length;e>t;++t)this._bones[t].returnToPool();for(var t=0,e=this._slots.length;e>t;++t)this._slots[t].returnToPool();for(var t=0,e=this._events.length;e>t;++t)this._events[t].returnToPool();this._clock&&this._clock.remove(this),this._proxy&&this._proxy._onClear(),this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this._animation&&this._animation.returnToPool(),this.inheritAnimation=!0,this.debugDraw=!1,this.userData=null,this._debugDraw=!1,this._delayDispose=!1,this._lockDispose=!1,this._bonesDirty=!1,this._slotsDirty=!1,this._zOrderDirty=!1,this._flipX=!1,this._flipY=!1,this._bones.length=0,this._slots.length=0,this._actions.length=0,this._events.length=0,this._armatureData=null,this._skinData=null,this._animation=null,this._proxy=null,this._display=null,this._eventManager=null,this._parent=null,this._clock=null,this._replaceTextureAtlasData=null,this._replacedTexture=null},i.prototype._sortBones=function(){var t=this._bones.length;if(!(0>=t)){var e=this._bones.concat(),i=0,a=0;for(this._bones.length=0;t>a;){var n=e[i++];i>=t&&(i=0),this._bones.indexOf(n)>=0||n.parent&&this._bones.indexOf(n.parent)<0||n.ik&&this._bones.indexOf(n.ik)<0||(n.ik&&n.ikChain>0&&n.ikChainIndex===n.ikChain?this._bones.splice(this._bones.indexOf(n.parent)+1,0,n):this._bones.push(n),a++)}}},i.prototype._sortSlots=function(){this._slots.sort(i._onSortSlots)},i.prototype._doAction=function(t){switch(t.type){case 0:this._animation.playConfig(t.animationConfig)}},i.prototype._init=function(e,i,a,n,r){this._armatureData||(this._armatureData=e,this._skinData=i,this._animation=t.BaseObject.borrowObject(t.Animation),this._proxy=a,this._display=n,this._eventManager=r,this._animation._init(this),this._animation.animations=this._armatureData.animations)},i.prototype._addBoneToBoneList=function(t){this._bones.indexOf(t)<0&&(this._bonesDirty=!0,this._bones.push(t),this._animation._timelineStateDirty=!0)},i.prototype._removeBoneFromBoneList=function(t){var e=this._bones.indexOf(t);e>=0&&(this._bones.splice(e,1),this._animation._timelineStateDirty=!0)},i.prototype._addSlotToSlotList=function(t){this._slots.indexOf(t)<0&&(this._slotsDirty=!0,this._slots.push(t),this._animation._timelineStateDirty=!0)},i.prototype._removeSlotFromSlotList=function(t){var e=this._slots.indexOf(t);e>=0&&(this._slots.splice(e,1),this._animation._timelineStateDirty=!0)},i.prototype._sortZOrder=function(t){var e=this._armatureData.sortedSlots,i=!t||t.length<1;if(this._zOrderDirty||!i){for(var a=0,n=e.length;n>a;++a){var r=i?a:t[a],s=e[r];if(s){var o=this.getSlot(s.name);o&&o._setZorder(a)}}this._slotsDirty=!0,this._zOrderDirty=!i}},i.prototype._bufferAction=function(t){this._actions.push(t)},i.prototype._bufferEvent=function(t,e){t.type=e,t.armature=this,this._events.push(t)},i.prototype.dispose=function(){this._armatureData&&(this._lockDispose?this._delayDispose=!0:this.returnToPool())},i.prototype.advanceTime=function(e){if(!this._armatureData)throw new Error("The armature has been disposed.");if(!this._armatureData.parent)throw new Error("The armature data has been disposed.");var i=this._animation._cacheFrameIndex;this._animation._advanceTime(e);var a=this._animation._cacheFrameIndex;this._bonesDirty&&(this._bonesDirty=!1,this._sortBones()),this._slotsDirty&&(this._slotsDirty=!1,this._sortSlots());var n=0,r=0;if(0>a||a!==i){for(n=0,r=this._bones.length;r>n;++n)this._bones[n]._update(a);for(n=0,r=this._slots.length;r>n;++n)this._slots[n]._update(a)}var s=this.debugDraw||t.DragonBones.debugDraw;if((s||this._debugDraw)&&(this._debugDraw=s,this._proxy._debugDraw(this._debugDraw)),!this._lockDispose){if(this._lockDispose=!0,r=this._events.length,r>0){for(n=0;r>n;++n){var o=this._events[n];this._proxy._dispatchEvent(o.type,o),o.type===t.EventObject.SOUND_EVENT&&this._eventManager._dispatchEvent(o.type,o),o.returnToPool()}this._events.length=0}if(r=this._actions.length,r>0){for(n=0;r>n;++n){var h=this._actions[n];if(h.slot){var l=this.getSlot(h.slot.name);if(l){var _=l.childArmature;_&&_._doAction(h)}}else if(h.bone)for(var u=0,p=this._slots.length;p>u;++u){var _=this._slots[u].childArmature;_&&_._doAction(h)}else this._doAction(h)}this._actions.length=0}this._lockDispose=!1}this._delayDispose&&this.returnToPool()},i.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),t){var i=this.getBone(t);if(i&&(i.invalidUpdate(),e))for(var a=0,n=this._slots.length;n>a;++a){var r=this._slots[a];r.parent===i&&r.invalidUpdate()}}else{for(var a=0,n=this._bones.length;n>a;++a)this._bones[a].invalidUpdate();if(e)for(var a=0,n=this._slots.length;n>a;++a)this._slots[a].invalidUpdate()}},i.prototype.containsPoint=function(t,e){for(var i=0,a=this._slots.length;a>i;++i){var n=this._slots[i];if(n.containsPoint(t,e))return n}return null},i.prototype.intersectsSegment=function(t,e,i,a,n,r,s){void 0===n&&(n=null),void 0===r&&(r=null),void 0===s&&(s=null);for(var o=t===i,h=0,l=0,_=0,u=0,p=0,c=0,d=0,m=0,f=null,g=null,y=0,v=this._slots.length;v>y;++y){var D=this._slots[y],T=D.intersectsSegment(t,e,i,a,n,r,s);if(T>0){if(!n&&!r){f=D;break}if(n){var E=o?n.y-e:n.x-t;0>E&&(E=-E),(!f||h>E)&&(h=E,_=n.x,u=n.y,f=D,s&&(d=s.x))}if(r){var E=r.x-t;0>E&&(E=-E),(!g||E>l)&&(l=E,p=r.x,c=r.y,g=D,s&&(m=s.y))}}}return f&&n&&(n.x=_,n.y=u,s&&(s.x=d)),g&&r&&(r.x=p,r.y=c,s&&(s.y=m)),f},i.prototype.getBone=function(t){for(var e=0,i=this._bones.length;i>e;++e){var a=this._bones[e];if(a.name===t)return a}return null},i.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return e?e.parent:null},i.prototype.getSlot=function(t){for(var e=0,i=this._slots.length;i>e;++e){var a=this._slots[e];if(a.name===t)return a}return null},i.prototype.getSlotByDisplay=function(t){if(t)for(var e=0,i=this._slots.length;i>e;++e){var a=this._slots[e];if(a.display===t)return a}return null},i.prototype.addBone=function(e,i){if(void 0===i&&(i=null),!e)throw new Error(t.DragonBones.ARGUMENT_ERROR);e._setArmature(this),e._setParent(i?this.getBone(i):null)},i.prototype.removeBone=function(e){if(!e||e.armature!==this)throw new Error(t.DragonBones.ARGUMENT_ERROR);e._setParent(null),e._setArmature(null)},i.prototype.addSlot=function(e,i){var a=this.getBone(i);if(!a)throw new Error(t.DragonBones.ARGUMENT_ERROR);e._setArmature(this),e._setParent(a)},i.prototype.removeSlot=function(e){if(!e||e.armature!==this)throw new Error(t.DragonBones.ARGUMENT_ERROR);e._setParent(null),e._setArmature(null)},i.prototype.replaceTexture=function(t){this.replacedTexture=t},i.prototype.getBones=function(){return this._bones},i.prototype.getSlots=function(){return this._slots},Object.defineProperty(i.prototype,"name",{get:function(){return this._armatureData?this._armatureData.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,i=this._slots.length;i>e;++e){var a=this._slots[e].childArmature;a&&(a.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){var e=this._clock;this._clock=t,e&&e.remove(this),this._clock&&this._clock.add(this);for(var i=0,a=this._slots.length;a>i;++i){var n=this._slots[i].childArmature;n&&(n.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,i=this._slots.length;i>e;++e){var a=this._slots[e];a.invalidUpdate(),a._update(-1)}}},enumerable:!0,configurable:!0}),i.prototype.hasEventListener=function(t){return this._proxy.hasEvent(t)},i.prototype.addEventListener=function(t,e,i){this._proxy.addEvent(t,e,i)},i.prototype.removeEventListener=function(t,e,i){this._proxy.removeEvent(t,e,i)},i.prototype.enableAnimationCache=function(t){this.cacheFrameRate=t},i.prototype.getDisplay=function(){return this._display},i}(t.BaseObject);t.Armature=e,__reflect(e.prototype,"dragonBones.Armature",["dragonBones.IAnimateble"])}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i._animationPose=new t.Transform,i._bones=[],i._slots=[],i}return __extends(i,e),i.toString=function(){return"[class dragonBones.Bone]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.ikBendPositive=!1,this.ikWeight=0,this._ikChain=0,this._ikChainIndex=0,this._ik=null,this._transformDirty=!1,this._childrenTransformDirty=!1,this._blendDirty=!1,this._visible=!0,this._cachedFrameIndex=-1,this._blendLayer=0,this._blendLeftWeight=1,this._blendTotalWeight=0,this._animationPose.identity(),this._bones.length=0,this._slots.length=0,this._boneData=null,this._cachedFrameIndices=null},i.prototype._updateGlobalTransformMatrix=function(e){var i=this._armature.flipX,a=this._armature.flipY===t.DragonBones.yDown,n=0;if(this.global.x=this.origin.x+this.offset.x+this._animationPose.x,this.global.y=this.origin.y+this.offset.y+this._animationPose.y,this.global.skewX=this.origin.skewX+this.offset.skewX+this._animationPose.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this._animationPose.skewY,this.global.scaleX=this.origin.scaleX*this.offset.scaleX*this._animationPose.scaleX,this.global.scaleY=this.origin.scaleY*this.offset.scaleY*this._animationPose.scaleY,this._parent){var r=this._parent.globalTransformMatrix;if(this._boneData.inheritScale)this._boneData.inheritRotation||(this._parent.updateGlobalTransform(),n=this._parent.global.skewY,this.global.skewX-=n,this.global.skewY-=n),this.global.toMatrix(this.globalTransformMatrix),this.globalTransformMatrix.concat(r),this._boneData.inheritTranslation?(this.global.x=this.globalTransformMatrix.tx,this.global.y=this.globalTransformMatrix.ty):(this.globalTransformMatrix.tx=this.global.x,this.globalTransformMatrix.ty=this.global.y),e?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0;else{if(this._boneData.inheritTranslation){var s=this.global.x,o=this.global.y;this.global.x=r.a*s+r.c*o+r.tx,this.global.y=r.d*o+r.b*s+r.ty}else i&&(this.global.x=-this.global.x),a&&(this.global.y=-this.global.y);this._boneData.inheritRotation?(this._parent.updateGlobalTransform(),n=this._parent.global.skewY,this._armature._armatureData.isRightTransform&&r.a*r.d-r.b*r.c<0&&(n-=2*this.global.skewY,this._parent.global.scaleX<0&&(n+=Math.PI),(i!=a||this._boneData.inheritReflection)&&(this.global.skewX+=Math.PI)),this.global.skewX+=n,this.global.skewY+=n):(i||a)&&(i&&a?n=Math.PI:(n=2*-this.global.skewY,i&&(n+=Math.PI),this.global.skewX+=Math.PI),this.global.skewX+=n,this.global.skewY+=n),this.global.toMatrix(this.globalTransformMatrix)}}else(i||a)&&(i&&(this.global.x=-this.global.x),a&&(this.global.y=-this.global.y),i&&a?n=Math.PI:(n=2*-this.global.skewY,i&&(n+=Math.PI),this.global.skewX+=Math.PI),this.global.skewX+=n,this.global.skewY+=n),this.global.toMatrix(this.globalTransformMatrix);this._ik&&this._ikChainIndex===this._ikChain&&this.ikWeight>0&&(this._boneData.inheritTranslation&&this._ikChain>0&&this._parent?this._computeIKB():this._computeIKA())},i.prototype._computeIKA=function(){this.updateGlobalTransform();var t=this._boneData.length,e=this._ik.global,i=(this.globalTransformMatrix.a*t,this.globalTransformMatrix.b*t,Math.atan2(e.y-this.global.y,e.x-this.global.x));this.global.scaleX<0&&(i+=Math.PI);var a=(i-this.global.skewY)*this.ikWeight;this.global.skewX+=a,this.global.skewY+=a,this.global.toMatrix(this.globalTransformMatrix)},i.prototype._computeIKB=function(){this._parent.updateGlobalTransform(),this.updateGlobalTransform();var t=this._boneData.length,e=this._parent.global,i=this._ik.global,a=this.globalTransformMatrix.a*t,n=this.globalTransformMatrix.b*t,r=a*a+n*n,s=Math.sqrt(r),o=this.global.x-e.x,h=this.global.y-e.y,l=o*o+h*h,_=Math.sqrt(l),u=Math.atan2(h,o);o=i.x-e.x,h=i.y-e.y;var p=o*o+h*h,c=Math.sqrt(p),d=0;if(c>=s+_||_>=c+s||s>=c+_)d=Math.atan2(i.y-e.y,i.x-e.x),c>=s+_||s>_&&(d+=Math.PI);else{var m=(l-r+p)/(2*p),f=Math.sqrt(l-m*m*p)/c,g=e.x+o*m,y=e.y+h*m,v=-h*f,D=o*f,T=!1;if(this._parent._parent){var E=this._parent._parent.globalTransformMatrix;T=E.a*E.d-E.b*E.c<0}T!==this.ikBendPositive?(this.global.x=g-v,this.global.y=y-D):(this.global.x=g+v,this.global.y=y+D),d=Math.atan2(this.global.y-e.y,this.global.x-e.x)}var b=(d-u)*this.ikWeight;e.skewX+=b,e.skewY+=b,e.toMatrix(this._parent.globalTransformMatrix),this._parent._childrenTransformDirty=!0,this._parent._cachedFrameIndex>=0&&this._armature._armatureData.setCacheFrame(this._parent.globalTransformMatrix,e,this._parent._cachedFrameIndex);var O=u+b;this.global.x=e.x+Math.cos(O)*_,this.global.y=e.y+Math.sin(O)*_;var x=Math.atan2(i.y-this.global.y,i.x-this.global.x);this.global.scaleX<0&&(x+=Math.PI),b=(x-this.global.skewY)*this.ikWeight,this.global.skewX+=b,this.global.skewY+=b,this.global.toMatrix(this.globalTransformMatrix)},i.prototype._init=function(t){this._boneData||(this._boneData=t,this.name=this._boneData.name,this.origin=this._boneData.transform)},i.prototype._setArmature=function(t){if(this._armature!==t){this._ik=null;var e=null,i=null;if(this._armature&&(e=this.getSlots(),i=this.getBones(),this._armature._removeBoneFromBoneList(this)),this._armature=t,this._armature&&this._armature._addBoneToBoneList(this),e)for(var a=0,n=e.length;n>a;++a){var r=e[a];r.parent===this&&r._setArmature(this._armature)}if(i)for(var a=0,n=i.length;n>a;++a){var s=i[a];s.parent===this&&s._setArmature(this._armature)}}},i.prototype._setIK=function(t,e,i){if(t){if(e===i){var a=this._parent;if(e&&a?e=1:(e=0,i=0,a=this),a===t||a.contains(t))t=null,e=0,i=0;else for(var n=t;n.ik&&n.ikChain;){if(a.contains(n.ik)){t=null,e=0,i=0;break}n=n.parent}}}else e=0,i=0;this._ik=t,this._ikChain=e,this._ikChainIndex=i,this._armature&&(this._armature._bonesDirty=!0)},i.prototype._update=function(t){if(this._blendDirty=!1,t>=0&&this._cachedFrameIndices){var e=this._cachedFrameIndices[t];e>=0&&this._cachedFrameIndex===e?this._transformDirty=!1:e>=0?(this._transformDirty=!0,this._cachedFrameIndex=e):this._transformDirty||this._parent&&this._parent._childrenTransformDirty||this._ik&&this.ikWeight>0&&this._ik._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent&&this._parent._childrenTransformDirty||this._ik&&this.ikWeight>0&&this._ik._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var i=t>=0;this._updateGlobalTransformMatrix(i),i&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1)},i.prototype.invalidUpdate=function(){this._transformDirty=!0},i.prototype.contains=function(t){if(t){if(t===this)return!1;for(var e=t;e!==this&&e;)e=e.parent;return e===this}return!1},i.prototype.getBones=function(){this._bones.length=0;for(var t=this._armature.getBones(),e=0,i=t.length;i>e;++e){var a=t[e];a.parent===this&&this._bones.push(a)}return this._bones},i.prototype.getSlots=function(){this._slots.length=0;for(var t=this._armature.getSlots(),e=0,i=t.length;i>e;++e){var a=t[e];a.parent===this&&this._slots.push(a)}return this._slots},Object.defineProperty(i.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=this._armature.getSlots(),i=0,a=e.length;a>i;++i){var n=e[i];n._parent===this&&n._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"length",{get:function(){return this.boneData.length},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"slot",{get:function(){for(var t=this._armature.getSlots(),e=0,i=t.length;i>e;++e){var a=t[e];if(a.parent===this)return a}return null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ikChain",{get:function(){return this._ikChain},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ikChainIndex",{get:function(){return this._ikChainIndex},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ik",{get:function(){return this._ik},enumerable:!0,configurable:!0}),i}(t.TransformObject);t.Bone=e,__reflect(e.prototype,"dragonBones.Bone")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._isTouched=!1,e._isTouchMoved=!1,e._isHorizontalMoved=!1,e._prevArmatureScale=1,e._prevAnimationScale=1,e._startPoint=new egret.Point,e._text=new egret.TextField,e._dragonBonesIndex=0,e._armatureIndex=0,e._animationIndex=0,e._armatureDisplay=null,e._allDragonBonesData=[],e._movie=null,e._boundingBoxTester=new BoundingBoxTester,e._resourceGroup="baseTest",e._resourceConfigURL="resource/base_test.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=RES.getGroupByName("search");if(t&&t.length>0)for(var e=0,i=t.length;i>e;++e){var a=t[e].name;dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes(a));var n=RES.getRes(a+"_textureData");n&&dragonBones.EgretFactory.factory.parseTextureAtlasData(n,RES.getRes(a+"_texture"));var r=a+"_mov";RES.hasRes(r)&&animation.addGroup(r,a+"_texture")}dragonBones.DragonBones.debugDraw=!0;var s=dragonBones.EgretFactory.factory.getAllDragonBonesData();for(var e in s){var o=s[e];this._allDragonBonesData.push(o)}if(!(this._allDragonBonesData.length>0))throw new Error;this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._touchHandler,this),dragonBones.EgretFactory.factory.soundEventManager.addEventListener(dragonBones.EventObject.SOUND_EVENT,this._armatureEventHandler,this),this._boundingBoxTester.x=200,this._boundingBoxTester.y=200,this.addChild(this._boundingBoxTester),this._changeArmature(1),this._changeAnimation(),this._text.size=20,this._text.textAlign=egret.HorizontalAlign.CENTER,this._text.width=this.stage.stageWidth,this._text.x=0,this._text.y=this.stage.stageHeight-80,this.addChild(this._text)},e.prototype._touchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:t.target==this.stage&&(this._isTouched=!0,this._prevArmatureScale=this._armatureDisplay.scaleX,this._prevAnimationScale=this._armatureDisplay.animation.timeScale,this._startPoint.setTo(t.stageX,t.stageY));break;case egret.TouchEvent.TOUCH_END:if(this._isTouched)if(this._isTouched=!1,this._isTouchMoved)this._isTouchMoved=!1;else{if(this._allDragonBonesData.length>1||this._allDragonBonesData[0].armatureNames.length>1){var e=Math.abs(this.stage.stageWidth/2-t.stageX)>this.stage.stageWidth/6,i=t.stageX>this.stage.stageWidth/2;e&&(i?this._changeArmature(1):this._changeArmature(-1))}this._changeAnimation()}break;case egret.TouchEvent.TOUCH_MOVE:if(this._isTouched){var a=this._startPoint.x-t.stageX,n=this._startPoint.y-t.stageY;if(!this._isTouchMoved){var r=Math.abs(a),s=Math.abs(n);(r>5||s>5)&&(this._isTouchMoved=!0,this._isHorizontalMoved=r>s)}if(this._isTouchMoved)if(this._isHorizontalMoved){var o=Math.max(-a/200+this._prevAnimationScale,.01);this._armatureDisplay.animation.timeScale=o,this._movie&&(this._movie.timeScale=o)}else{var h=Math.max(n/200+this._prevArmatureScale,.01);this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=h,this._movie&&(this._movie.scaleX=this._movie.scaleY=h)}}}},e.prototype._changeArmature=function(t){var e=!1,i=this._allDragonBonesData[this._dragonBonesIndex],a=i.armatureNames;this._animationIndex=0,this._armatureIndex+=t>0?1:-1,this._armatureIndex<0?(e=!0,this._dragonBonesIndex--):this._armatureIndex>=a.length&&(this._armatureIndex=0,e=!0,this._dragonBonesIndex++),e&&(this._dragonBonesIndex<0?this._dragonBonesIndex=this._allDragonBonesData.length-1:this._dragonBonesIndex>=this._allDragonBonesData.length&&(this._dragonBonesIndex=0),i=this._allDragonBonesData[this._dragonBonesIndex],a=i.armatureNames,this._armatureIndex=t>0?0:a.length-1);var n=a[this._armatureIndex];this._armatureDisplay&&(disableDrag(this._armatureDisplay),this.removeChild(this._armatureDisplay),this._armatureDisplay.removeEventListener(dragonBones.EventObject.START,this._armatureEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.FRAME_EVENT,this._armatureEventHandler,this),this._armatureDisplay.dispose()),this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay(n,i.name),this._armatureDisplay.armature.cacheFrameRate=24,this._armatureDisplay.addEventListener(dragonBones.EventObject.START,this._armatureEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._armatureEventHandler,this),this._armatureDisplay.x=.5*this.stage.stageWidth,this._armatureDisplay.y=.5*this.stage.stageHeight+100,this.addChild(this._armatureDisplay),enableDrag(this._armatureDisplay),this._movie&&(disableDrag(this._movie),this.removeChild(this._movie),this._movie.removeEventListener(dragonBones.MovieEvent.START,this._movieEventHandler,this),this._movie.removeEventListener(dragonBones.MovieEvent.LOOP_COMPLETE,this._movieEventHandler,this),this._movie.removeEventListener(dragonBones.MovieEvent.COMPLETE,this._movieEventHandler,this),this._movie.removeEventListener(dragonBones.MovieEvent.FRAME_EVENT,this._movieEventHandler,this),this._movie.dispose(),this._movie=null),this._movie=animation.createAnimation(n,i.name),this._movie&&(this._movie.addEventListener(dragonBones.MovieEvent.START,this._movieEventHandler,this),this._movie.addEventListener(dragonBones.MovieEvent.LOOP_COMPLETE,this._movieEventHandler,this),this._movie.addEventListener(dragonBones.MovieEvent.COMPLETE,this._movieEventHandler,this),this._movie.addEventListener(dragonBones.MovieEvent.FRAME_EVENT,this._movieEventHandler,this),this._movie.x=.5*this.stage.stageWidth+200,this._movie.y=.5*this.stage.stageHeight+100,this.addChild(this._movie),enableDrag(this._movie),this._armatureDisplay.x-=200),this._boundingBoxTester.armatureDisplay=this._armatureDisplay,this.addChild(this._boundingBoxTester)},e.prototype._changeAnimation=function(){var t=this._armatureDisplay.animation.animationNames;if(0!=t.length){this._animationIndex++,this._animationIndex>=t.length&&(this._animationIndex=0);var e=t[this._animationIndex];this._armatureDisplay.animation.play(e),this._text.text="DragonBones: "+this._armatureDisplay.armature.armatureData.parent.name+"    Armature: "+this._armatureDisplay.armature.name+"    Animation: "+this._armatureDisplay.armature.animation.lastAnimationName+"\nTouch screen left/right to change prev/next armature.\nTouch center to play next animation.",this._movie&&this._movie.play(e)
}},e.prototype._armatureEventHandler=function(t){console.log("Armature.",t.type,t.eventObject.animationState.name,t.eventObject.name||"")},e.prototype._movieEventHandler=function(t){console.log("Movie.",t.type,t.clipName,t.name||"")},e}(BaseTest);t.AnimationMovieTest=e,__reflect(e.prototype,"demosEgret.AnimationMovieTest")}(demosEgret||(demosEgret={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._addingArmature=!1,e._removingArmature=!1,e._text=new egret.TextField,e._armatures=[],e._resourceGroup="performanceTest",e._resourceConfigURL="resource/test.res.json",e}return __extends(e,t),e.prototype._onStart=function(){this._text.size=20,this._text.textAlign=egret.HorizontalAlign.CENTER,this._text.text="",this.addChild(this._text),this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this);for(var t=0;100>t;++t)this._addArmature();this._resetPosition(),this._updateText()},e.prototype._enterFrameHandler=function(t){if(this._addingArmature){for(var e=0;5>e;++e)this._addArmature();this._resetPosition(),this._updateText()}if(this._removingArmature){for(var e=0;5>e;++e)this._removeArmature();this._resetPosition(),this._updateText()}},e.prototype._touchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:var e=t.stageX>.5*this.stage.stageWidth;this._addingArmature=e,this._removingArmature=!e;break;case egret.TouchEvent.TOUCH_END:this._addingArmature=!1,this._removingArmature=!1}},e.prototype._addArmature=function(){0==this._armatures.length&&(dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes(this._resourceGroup)),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes(this._resourceGroup+"_textureData"),RES.getRes(this._resourceGroup+"_texture")));var t=dragonBones.EgretFactory.factory.buildArmatureDisplay("DragonBoy");t.scaleX=t.scaleY=.7,t.armature.cacheFrameRate=24;var e="walk";t.animation.play(e,0),this._armatures.push(t),this.addChild(t)},e.prototype._removeArmature=function(){if(0!=this._armatures.length){var t=this._armatures.pop();this.removeChild(t),t.dispose(),0==this._armatures.length&&dragonBones.EgretFactory.factory.clear(!0)}},e.prototype._resetPosition=function(){var t=this._armatures.length;if(t)for(var e=50,i=150,a=100,n=this.stage.stageWidth-2*e,r=Math.floor(n/a),s=.5*(this.stage.stageWidth-r*a),o=n/r,h=(this.stage.stageHeight-2*i)/Math.ceil(t/r),l=0,_=t;_>l;++l){var u=this._armatures[l],p=Math.floor(l/r);u.x=l%r*o+s,u.y=p*h+i}},e.prototype._updateText=function(){this._text.text="Count: "+this._armatures.length+" \nTouch screen left to decrease count / right to increase count.",this._text.width=this.stage.stageWidth,this._text.x=0,this._text.y=this.stage.stageHeight-60},e}(BaseTest);t.PerformanceTest=e,__reflect(e.prototype,"demosEgret.PerformanceTest")}(demosEgret||(demosEgret={}));var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addChild(new demosEgret.GroundTest)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var demosEgret;!function(t){var e;!function(t){var e=function(t){function e(){var i=t.call(this)||this;return i._left=!1,i._right=!1,i._player=null,i._bullets=[],e.instance=i,i._resourceConfigURL="resource/knight.res.json",i}return __extends(e,t),e.prototype._onStart=function(){e.STAGE_WIDTH=this.stage.stageWidth,e.STAGE_HEIGHT=this.stage.stageHeight,e.GROUND=e.STAGE_HEIGHT-100,dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("dragonBonesData")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("textureDataA"),RES.getRes("textureA")),this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),document.addEventListener("keydown",this._keyHandler),document.addEventListener("keyup",this._keyHandler),this._player=new i;var t=new egret.TextField;t.size=20,t.textAlign=egret.HorizontalAlign.CENTER,t.text="Press W/A/S/D to move. Press SPACE to switch weapons. Press Q/E to upgrade weapon. \nClick to attack.",t.width=e.STAGE_WIDTH,t.x=0,t.y=e.STAGE_HEIGHT-60,this.addChild(t)},e.prototype.addBullet=function(t){this._bullets.push(t)},e.prototype._touchHandler=function(t){this._player.attack()},e.prototype._keyHandler=function(t){var i="keydown"==t.type;switch(t.keyCode){case 37:case 65:e.instance._left=i,e.instance._updateMove(-1);break;case 39:case 68:e.instance._right=i,e.instance._updateMove(1);break;case 38:case 87:i&&e.instance._player.jump();break;case 83:case 40:break;case 81:i&&e.instance._player.upgradeWeapon(-1);break;case 69:i&&e.instance._player.upgradeWeapon(1);break;case 32:i&&e.instance._player.switchWeapon()}},e.prototype._enterFrameHandler=function(t){this._player.update();for(var e=this._bullets.length;e--;){var i=this._bullets[e];i.update()&&this._bullets.splice(e,1)}dragonBones.WorldClock.clock.advanceTime(-1)},e.prototype._updateMove=function(t){this._left&&this._right?this._player.move(t):this._left?this._player.move(-1):this._right?this._player.move(1):this._player.move(0)},e}(BaseTest);e.STAGE_WIDTH=0,e.STAGE_HEIGHT=0,e.GROUND=300,e.G=.6,e.instance=null,t.Game=e,__reflect(e.prototype,"demosEgret.knight.Game");var i=function(){function t(){this._isJumping=!1,this._isAttacking=!1,this._hitCount=0,this._weaponIndex=0,this._weaponName=t.WEAPON_LIST[0],this._weaponsLevel=[0,0,0,0],this._faceDir=1,this._moveDir=0,this._speedX=0,this._speedY=0,this._armature=null,this._armatureDisplay=null,this._armArmature=null,this._armature=dragonBones.EgretFactory.factory.buildArmature("knight"),this._armatureDisplay=this._armature.display,this._armatureDisplay.x=.5*e.STAGE_WIDTH,this._armatureDisplay.y=e.GROUND,this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=1,this._armArmature=this._armature.getSlot("armOutside").childArmature,this._armArmature.addEventListener(dragonBones.EventObject.COMPLETE,this._armEventHandler,this),this._armArmature.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._armEventHandler,this),this._updateAnimation(),e.instance.addChild(this._armatureDisplay),dragonBones.WorldClock.clock.add(this._armature)}return t.prototype.move=function(t){this._moveDir!=t&&(this._moveDir=t,this._moveDir&&this._faceDir!=this._moveDir&&(this._faceDir=this._moveDir,this._armatureDisplay.scaleX*=-1),this._updateAnimation())},t.prototype.jump=function(){this._isJumping||(this._isJumping=!0,this._speedY=t.JUMP_SPEED,this._armature.animation.fadeIn("jump"))},t.prototype.attack=function(){if(!this._isAttacking){this._isAttacking=!0;var t="attack_"+this._weaponName+"_"+(this._hitCount+1);this._armArmature.animation.fadeIn(t)}},t.prototype.switchWeapon=function(){this._isAttacking=!1,this._hitCount=0,this._weaponIndex++,this._weaponIndex>=t.WEAPON_LIST.length&&(this._weaponIndex=0),this._weaponName=t.WEAPON_LIST[this._weaponIndex],this._armArmature.animation.fadeIn("ready_"+this._weaponName)},t.prototype.upgradeWeapon=function(e){var i=this._weaponsLevel[this._weaponIndex]+e;i%=t.MAX_WEAPON_LEVEL,0>i&&(i=t.MAX_WEAPON_LEVEL+i),this._weaponsLevel[this._weaponIndex]=i,"bow"==this._weaponName?this._armArmature.getSlot("bow").childArmature=dragonBones.EgretFactory.factory.buildArmature("knightFolder/"+this._weaponName+"_"+(i+1)):dragonBones.EgretFactory.factory.replaceSlotDisplay(null,"weapons","weapon","knightFolder/"+this._weaponName+"_"+(i+1),this._armArmature.getSlot("weapon"))},t.prototype.update=function(){this._updatePosition()},t.prototype._armEventHandler=function(e){switch(e.type){case dragonBones.EventObject.COMPLETE:this._isAttacking=!1,this._hitCount=0;var i="ready_"+this._weaponName;this._armArmature.animation.fadeIn(i);break;case dragonBones.EventObject.FRAME_EVENT:if("ready"==e.eventObject.name)this._isAttacking=!1,this._hitCount++;else if("fire"==e.eventObject.name){var a=e.eventObject.armature.getBone("bow");e.eventObject.armature.display.localToGlobal(a.global.x,a.global.y,t._globalPoint);var n=0;switch(n=this._faceDir>0?a.global.rotation+e.eventObject.armature.display.rotation*dragonBones.DragonBones.ANGLE_TO_RADIAN:Math.PI-(a.global.rotation+e.eventObject.armature.display.rotation)*dragonBones.DragonBones.ANGLE_TO_RADIAN,this._weaponsLevel[this._weaponIndex]){case 0:this._fire(t._globalPoint,n);break;case 1:this._fire(t._globalPoint,n+3/180*Math.PI),this._fire(t._globalPoint,n-3/180*Math.PI);break;case 2:this._fire(t._globalPoint,n+6/180*Math.PI),this._fire(t._globalPoint,n),this._fire(t._globalPoint,n-6/180*Math.PI)}}}},t.prototype._fire=function(t,i){var n=new a("arrow",i,20,t);e.instance.addBullet(n)},t.prototype._updateAnimation=function(){this._isJumping||(0==this._moveDir?(this._speedX=0,this._armature.animation.fadeIn("stand")):(this._speedX=t.MOVE_SPEED*this._moveDir,this._armature.animation.fadeIn("run")))},t.prototype._updatePosition=function(){0!=this._speedX&&(this._armatureDisplay.x+=this._speedX,this._armatureDisplay.x<0?this._armatureDisplay.x=0:this._armatureDisplay.x>e.STAGE_WIDTH&&(this._armatureDisplay.x=e.STAGE_WIDTH)),0!=this._speedY&&(this._speedY<0&&this._speedY+e.G>=0&&this._armature.animation.fadeIn("fall"),this._speedY+=e.G,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.y>e.GROUND&&(this._armatureDisplay.y=e.GROUND,this._isJumping=!1,this._speedY=0,this._speedX=0,this._updateAnimation()))},t}();i.MAX_WEAPON_LEVEL=3,i.JUMP_SPEED=-20,i.MOVE_SPEED=4,i.WEAPON_LIST=["sword","pike","axe","bow"],i._globalPoint=new egret.Point,__reflect(i.prototype,"Hero");var a=function(){function t(t,i,a,n){this._speedX=0,this._speedY=0,this._armature=null,this._armatureDisplay=null,this._speedX=Math.cos(i)*a,this._speedY=Math.sin(i)*a,this._armature=dragonBones.EgretFactory.factory.buildArmature(t),this._armatureDisplay=this._armature.display,this._armatureDisplay.x=n.x,this._armatureDisplay.y=n.y,this._armatureDisplay.rotation=i*dragonBones.DragonBones.RADIAN_TO_ANGLE,this._armature.animation.play("idle"),dragonBones.WorldClock.clock.add(this._armature),e.instance.addChild(this._armatureDisplay)}return t.prototype.update=function(){return this._speedY+=e.G,this._armatureDisplay.x+=this._speedX,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.rotation=Math.atan2(this._speedY,this._speedX)*dragonBones.DragonBones.RADIAN_TO_ANGLE,this._armatureDisplay.x<-100||this._armatureDisplay.x>=e.STAGE_WIDTH+100||this._armatureDisplay.y<-100||this._armatureDisplay.y>=e.STAGE_HEIGHT+100?(dragonBones.WorldClock.clock.remove(this._armature),e.instance.removeChild(this._armatureDisplay),this._armature.dispose(),!0):!1},t}();__reflect(a.prototype,"Bullet")}(e=t.knight||(t.knight={}))}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(t){function e(e,i,a,n){return t.call(this,e,i,a,n)||this}return __extends(e,t),Object.defineProperty(e.prototype,"eventObject",{get:function(){return this.data},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationName",{get:function(){return this.eventObject.animationState.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"armature",{get:function(){return this.eventObject.armature},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bone",{get:function(){return this.eventObject.bone},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slot",{get:function(){return this.eventObject.slot},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationState",{get:function(){return this.eventObject.animationState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameLabel",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sound",{get:function(){return this.eventObject.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"movementID",{get:function(){return this.animationName},enumerable:!0,configurable:!0}),e}(egret.Event);e.START=t.EventObject.START,e.LOOP_COMPLETE=t.EventObject.LOOP_COMPLETE,e.COMPLETE=t.EventObject.COMPLETE,e.FADE_IN=t.EventObject.FADE_IN,e.FADE_IN_COMPLETE=t.EventObject.FADE_IN_COMPLETE,e.FADE_OUT=t.EventObject.FADE_OUT,e.FADE_OUT_COMPLETE=t.EventObject.FADE_OUT_COMPLETE,e.FRAME_EVENT=t.EventObject.FRAME_EVENT,e.SOUND_EVENT=t.EventObject.SOUND_EVENT,e.ANIMATION_FRAME_EVENT=t.EventObject.FRAME_EVENT,e.BONE_FRAME_EVENT=t.EventObject.FRAME_EVENT,e.MOVEMENT_FRAME_EVENT=t.EventObject.FRAME_EVENT,e.SOUND=t.EventObject.SOUND_EVENT,t.EgretEvent=e,__reflect(e.prototype,"dragonBones.EgretEvent");var i=function(i){function a(){return i.call(this)||this}return __extends(a,i),a.prototype._onClear=function(){this._disposeProxy=!1,this._armature=null,this._debugDrawer=null},a.prototype._dispatchEvent=function(t,a){var n=egret.Event.create(e,t);n.data=a,i.prototype.dispatchEvent.call(this,n),egret.Event.release(n)},a.prototype._debugDraw=function(t){if(t){this._debugDrawer||(this._debugDrawer=new egret.Sprite),this.addChild(this._debugDrawer),this._debugDrawer.graphics.clear();for(var e=this._armature.getBones(),i=0,a=e.length;a>i;++i){var n=e[i];n.updateGlobalTransform();var r=n.boneData.length,s=n.globalTransformMatrix.tx,o=n.globalTransformMatrix.ty,h=s+n.globalTransformMatrix.a*r,l=o+n.globalTransformMatrix.b*r;this._debugDrawer.graphics.lineStyle(2,n.ik?16711680:65535,.7),this._debugDrawer.graphics.moveTo(s,o),this._debugDrawer.graphics.lineTo(h,l),this._debugDrawer.graphics.lineStyle(0,0,0),this._debugDrawer.graphics.beginFill(65535,.7),this._debugDrawer.graphics.drawCircle(s,o,3),this._debugDrawer.graphics.endFill()}for(var _=this._armature.getSlots(),i=0,a=_.length;a>i;++i){var u=_[i],p=u.boundingBoxData;if(p){var c=this._debugDrawer.getChildByName(u.name);switch(c||(c=new egret.Shape,c.name=u.name,this._debugDrawer.addChild(c)),c.graphics.clear(),c.graphics.beginFill(p.color?p.color:16711935,.3),p.type){case 0:c.graphics.drawRect(.5*-p.width,.5*-p.height,p.width,p.height);break;case 1:c.graphics.drawEllipse(.5*-p.width,.5*-p.height,p.width,p.height);break;case 2:for(var d=p.vertices,m=0,f=p.vertices.length;f>m;m+=2)0===m?c.graphics.moveTo(d[m],d[m+1]):c.graphics.lineTo(d[m],d[m+1])}c.graphics.endFill(),u._updateTransformAndMatrix(),u.updateGlobalTransform(),c.$setMatrix(u.globalTransformMatrix,!1)}else{var c=this._debugDrawer.getChildByName(u.name);c&&this._debugDrawer.removeChild(c)}}}else this._debugDrawer&&this._debugDrawer.parent===this&&this.removeChild(this._debugDrawer)},a.prototype.dispose=function(t){void 0===t&&(t=!0),this._disposeProxy=t,this._armature&&(this._armature.dispose(),this._armature=null)},a.prototype.hasEvent=function(t){return this.hasEventListener(t)},a.prototype.addEvent=function(t,e,i){this.addEventListener(t,e,i)},a.prototype.removeEvent=function(t,e,i){this.removeEventListener(t,e,i)},Object.defineProperty(a.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"animation",{get:function(){return this._armature.animation},enumerable:!0,configurable:!0}),a.prototype.advanceTimeBySelf=function(e){e?this._armature.clock=t.EgretFactory.clock:this._armature.clock=null},a}(egret.DisplayObjectContainer);t.EgretArmatureDisplay=i,__reflect(i.prototype,"dragonBones.EgretArmatureDisplay",["dragonBones.IArmatureDisplay","dragonBones.IArmatureProxy","dragonBones.IEventDispatcher"]);var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.Event=a,__reflect(a.prototype,"dragonBones.Event");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.ArmatureEvent=n,__reflect(n.prototype,"dragonBones.ArmatureEvent");var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.AnimationEvent=r,__reflect(r.prototype,"dragonBones.AnimationEvent");var s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.FrameEvent=s,__reflect(s.prototype,"dragonBones.FrameEvent");var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(e);t.SoundEvent=o,__reflect(o.prototype,"dragonBones.SoundEvent");var h=function(e){function i(i,a,n){void 0===n&&(n=1);var r=e.call(this)||this;return r._onClear(),r.texture=i,t.ObjectDataParser.getInstance().parseTextureAtlasData(a,r,n),r}return __extends(i,e),i.toString=function(){return"[class dragonBones.EgretTextureAtlas]"},i}(t.EgretTextureAtlasData);t.EgretTextureAtlas=h,__reflect(h.prototype,"dragonBones.EgretTextureAtlas");var l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e}(h);t.EgretSheetAtlas=l,__reflect(l.prototype,"dragonBones.EgretSheetAtlas");var _=function(){function e(){}return e.getInstance=function(){return t.EgretFactory.factory.soundEventManager},e}();t.SoundEventManager=_,__reflect(_.prototype,"dragonBones.SoundEventManager");var u=function(){function t(){}return t}();t.AnimationCacheManager=u,__reflect(u.prototype,"dragonBones.AnimationCacheManager")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(a){void 0===a&&(a=null);var n=e.call(this,a)||this;return i._eventManager||(i._eventManager=new t.EgretArmatureDisplay,i._clock=new t.WorldClock,i._clock.time=.001*egret.getTimer(),egret.startTick(i._clockHandler,i)),n}return __extends(i,e),i._clockHandler=function(t){t*=.001;var e=t-i._clock.time;return i._clock.advanceTime(e),i._clock.time=t,!1},Object.defineProperty(i,"factory",{get:function(){return i._factory||(i._factory=new i),i._factory},enumerable:!0,configurable:!0}),Object.defineProperty(i,"clock",{get:function(){return i._clock},enumerable:!0,configurable:!0}),i.prototype._generateTextureAtlasData=function(e,i){return e?e.texture=i:e=t.BaseObject.borrowObject(t.EgretTextureAtlasData),e},i.prototype._generateArmature=function(e){var a=t.BaseObject.borrowObject(t.Armature),n=new t.EgretArmatureDisplay;return n._armature=a,a._init(e.armature,e.skin,n,n,i._eventManager),a},i.prototype._generateSlot=function(e,i,a){var n=i.slot,r=t.BaseObject.borrowObject(t.EgretSlot),s=[];r._init(i,new egret.Bitmap,new egret.Mesh);for(var o=0,h=i.displays.length;h>o;++o){var l=i.displays[o];switch(l.type){case 0:l.texture||(l.texture=this._getTextureData(e.dataName,l.path)),e.textureAtlasName&&(r._textureDatas[o]=this._getTextureData(e.textureAtlasName,l.path)),s[o]=r.rawDisplay;break;case 2:l.texture||(l.texture=this._getTextureData(e.dataName,l.path)),e.textureAtlasName&&(r._textureDatas[o]=this._getTextureData(e.textureAtlasName,l.path)),!l.mesh&&l.share&&(l.mesh=i.getMesh(l.share)),"webgl"===egret.Capabilities.renderMode||egret.Capabilities.runtimeType===egret.RuntimeType.NATIVE?s[o]=r.meshDisplay:(console.warn("Canvas can not support mesh, please change renderMode to webgl."),s[o]=r.rawDisplay);break;case 1:var _=this.buildArmature(l.path,e.dataName,null,e.textureAtlasName);if(_){if(_.inheritAnimation=l.inheritAnimation,!_.inheritAnimation){var u=n.actions.length>0?n.actions:_.armatureData.actions;if(u.length>0)for(var p=0,c=u.length;c>p;++p)_._bufferAction(u[p]);else _.animation.play()}l.armature=_.armatureData}s[o]=_;break;default:s[o]=null}}return r._setDisplayList(s),r},i.prototype.buildArmatureDisplay=function(t,e,a,n){void 0===e&&(e=null),void 0===a&&(a=null),void 0===n&&(n=null);var r=this.buildArmature(t,e,a,n);return r?(i._clock.add(r),r.display):null},i.prototype.getTextureDisplay=function(t,e){void 0===e&&(e=null);var i=this._getTextureData(e,t);if(i){if(!i.texture){var a=i.parent.texture;i.texture=new egret.Texture,i.texture._bitmapData=a._bitmapData,i.texture.$initData(i.region.x,i.region.y,i.region.width,i.region.height,0,0,i.region.width,i.region.height,a.textureWidth,a.textureHeight)}return new egret.Bitmap(i.texture)}return null},Object.defineProperty(i.prototype,"soundEventManager",{get:function(){return i._eventManager},enumerable:!0,configurable:!0}),i.prototype.addSkeletonData=function(t,e){void 0===e&&(e=null),this.addDragonBonesData(t,e)},i.prototype.getSkeletonData=function(t){return this.getDragonBonesData(t)},i.prototype.removeSkeletonData=function(t){this.removeDragonBonesData(t)},i.prototype.addTextureAtlas=function(t,e){void 0===e&&(e=null),this.addTextureAtlasData(t,e)},i.prototype.getTextureAtlas=function(t){return this.getTextureAtlasData(t)},i.prototype.removeTextureAtlas=function(t){this.removeTextureAtlasData(t)},i.prototype.buildFastArmature=function(t,e,i){return void 0===e&&(e=null),void 0===i&&(i=null),this.buildArmature(t,e,i)},i.prototype.dispose=function(){this.clear()},Object.defineProperty(i.prototype,"soundEventManater",{get:function(){return i._eventManager},enumerable:!0,configurable:!0}),i}(t.BaseFactory);e._factory=null,e._eventManager=null,e._clock=null,t.EgretFactory=e,__reflect(e.prototype,"dragonBones.EgretFactory")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.toString=function(){return"[class dragonBones.EgretSlot]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.transformUpdateEnabled=!1,this._renderDisplay=null,this._colorFilter=null},i.prototype._initDisplay=function(t){},i.prototype._disposeDisplay=function(t){},i.prototype._onUpdateDisplay=function(){this._renderDisplay=this._display?this._display:this._rawDisplay},i.prototype._addDisplay=function(){var t=this._armature.display;t.addChild(this._renderDisplay)},i.prototype._replaceDisplay=function(t){var e=this._armature.display,i=t;e.addChild(this._renderDisplay),e.swapChildren(this._renderDisplay,i),e.removeChild(i)},i.prototype._removeDisplay=function(){this._renderDisplay.parent.removeChild(this._renderDisplay)},i.prototype._updateZOrder=function(){var t=this._armature.display,e=t.getChildIndex(this._renderDisplay);e!==this._zOrder&&t.addChildAt(this._renderDisplay,this._zOrder)},i.prototype._updateVisible=function(){this._renderDisplay.visible=this._parent.visible},i.prototype._updateBlendMode=function(){switch(this._blendMode){case 0:this._renderDisplay.blendMode=egret.BlendMode.NORMAL;break;case 1:this._renderDisplay.blendMode=egret.BlendMode.ADD;break;case 5:this._renderDisplay.blendMode=egret.BlendMode.ERASE}},i.prototype._updateColor=function(){if(1!==this._colorTransform.redMultiplier||1!==this._colorTransform.greenMultiplier||1!==this._colorTransform.blueMultiplier||0!==this._colorTransform.redOffset||0!==this._colorTransform.greenOffset||0!==this._colorTransform.blueOffset||0!==this._colorTransform.alphaOffset){this._colorFilter||(this._colorFilter=new egret.ColorMatrixFilter);var t=this._colorFilter.matrix;t[0]=this._colorTransform.redMultiplier,t[6]=this._colorTransform.greenMultiplier,t[12]=this._colorTransform.blueMultiplier,t[18]=this._colorTransform.alphaMultiplier,t[4]=this._colorTransform.redOffset,t[9]=this._colorTransform.greenOffset,t[14]=this._colorTransform.blueOffset,t[19]=this._colorTransform.alphaOffset,this._colorFilter.matrix=t;var e=this._renderDisplay.filters;e||(e=[]),e.indexOf(this._colorFilter)<0&&e.push(this._colorFilter),this._renderDisplay.filters=e,this._renderDisplay.$setAlpha(1)}else this._colorFilter&&(this._colorFilter=null,this._renderDisplay.filters=null),this._renderDisplay.$setAlpha(this._colorTransform.alphaMultiplier)},i.prototype._updateFrame=function(){var e=this._meshData&&this._display===this._meshDisplay,i=this._textureData;if(this._displayIndex>=0&&this._display&&i){var a=i.parent;this._armature.replacedTexture&&this._displayData&&a===this._displayData.texture.parent&&(a=this._armature._replaceTextureAtlasData,a||(a=t.BaseObject.borrowObject(t.EgretTextureAtlasData),a.copyFrom(this._textureData.parent),a.texture=this._armature.replacedTexture,this._armature._replaceTextureAtlasData=a),i=a.getTexture(i.name));var n=a.texture?a.texture._bitmapData:null;if(n){if(!i.texture){var r=a.width>0?a.width:n.width,s=a.height>0?a.height:n.height,o=Math.min(i.region.width,r-i.region.x),h=Math.min(i.region.height,s-i.region.y);i.texture=new egret.Texture,i.texture._bitmapData=n,i.texture.$initData(i.region.x,i.region.y,o,h,0,0,o,h,r,s)}if(e){var l=this._renderDisplay,_=l.$renderNode;_.uvs.length=0,_.vertices.length=0,_.indices.length=0;for(var u=0,p=this._meshData.vertices.length;p>u;++u)_.uvs[u]=this._meshData.uvs[u],_.vertices[u]=this._meshData.vertices[u];for(var u=0,p=this._meshData.vertexIndices.length;p>u;++u)_.indices[u]=this._meshData.vertexIndices[u];l.$setBitmapData(i.texture),l.$setAnchorOffsetX(this._pivotX),l.$setAnchorOffsetY(this._pivotY),l.$updateVertices(),l.$invalidateTransform()}else{var c=this._renderDisplay;c.$setBitmapData(i.texture),c.$setAnchorOffsetX(this._pivotX),c.$setAnchorOffsetY(this._pivotY)}return void this._updateVisible()}}if(e){var l=this._renderDisplay;l.$setBitmapData(null),l.x=0,l.y=0,l.visible=!1}else{var c=this._renderDisplay;c.$setBitmapData(null),c.x=0,c.y=0,c.visible=!1}},i.prototype._updateMesh=function(){var t=this._renderDisplay,e=t.$renderNode,i=this._ffdVertices.length>0;if(this._meshData.skinned){for(var a=0,n=0,r=this._meshData.vertices.length;r>a;a+=2){for(var s=a/2,o=this._meshData.boneIndices[s],h=this._meshData.boneVertices[s],l=this._meshData.weights[s],_=0,u=0,p=0,c=o.length;c>p;++p){var d=this._meshBones[o[p]],m=d.globalTransformMatrix,f=l[p],g=0,y=0;i?(g=h[2*p]+this._ffdVertices[n],y=h[2*p+1]+this._ffdVertices[n+1]):(g=h[2*p],y=h[2*p+1]),_+=(m.a*g+m.c*y+m.tx)*f,u+=(m.b*g+m.d*y+m.ty)*f,n+=2}e.vertices[a]=_,e.vertices[a+1]=u}t.$updateVertices(),t.$invalidateTransform()}else if(i){for(var v=this._meshData.vertices,a=0,r=this._meshData.vertices.length;r>a;a+=2){var _=v[a]+this._ffdVertices[a],u=v[a+1]+this._ffdVertices[a+1];e.vertices[a]=_,e.vertices[a+1]=u}t.$updateVertices(),t.$invalidateTransform()}},i.prototype._updateTransform=function(t){if(t){var e=this._renderDisplay.matrix;e.identity(),this._renderDisplay.$setMatrix(e,this.transformUpdateEnabled)}else if(this.transformUpdateEnabled)this._renderDisplay.$setMatrix(this.globalTransformMatrix,!0);else{var i=this._renderDisplay.$DisplayObject,a=i[6];a.a=this.globalTransformMatrix.a,a.b=this.globalTransformMatrix.b,a.c=this.globalTransformMatrix.c,a.d=this.globalTransformMatrix.d,a.tx=this.globalTransformMatrix.tx,a.ty=this.globalTransformMatrix.ty,this._renderDisplay.$removeFlags(8),this._renderDisplay.$invalidatePosition()}},i}(t.Slot);t.EgretSlot=e,__reflect(e.prototype,"dragonBones.EgretSlot")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._resourceConfigURL="resource/hello_movie.res.json",e}return __extends(e,t),e.prototype._onStart=function(){dragonBones.addMovieGroup(RES.getRes("movie"),RES.getRes("texture"));var t=dragonBones.buildMovie("DragonBoy");t.addEventListener(dragonBones.MovieEvent.START,this._movieEventHandler,this),t.addEventListener(dragonBones.MovieEvent.LOOP_COMPLETE,this._movieEventHandler,this),t.addEventListener(dragonBones.MovieEvent.COMPLETE,this._movieEventHandler,this),t.addEventListener(dragonBones.MovieEvent.FRAME_EVENT,this._movieEventHandler,this),t.play("walk"),this.addChild(t),t.x=.5*this.stage.stageWidth,t.y=.5*this.stage.stageHeight+100},e.prototype._movieEventHandler=function(t){console.log("Movie.",t.type,t.clipName,t.name||"")},e}(BaseTest);t.HelloMovie=e,__reflect(e.prototype,"demosEgret.HelloMovie")}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._animationNames=[],t._animations={},t._animationStates=[],t}return __extends(i,e),i._sortAnimationState=function(t,e){return t.layer>e.layer?-1:1},i.toString=function(){return"[class dragonBones.Animation]"},i.prototype._onClear=function(){for(var t=0,e=this._animationStates.length;e>t;++t)this._animationStates[t].returnToPool();this._animationConfig&&this._animationConfig.returnToPool();for(var i in this._animations)delete this._animations[i];this.timeScale=1,this._isPlaying=!1,this._animationStateDirty=!1,this._timelineStateDirty=!1,this._cacheFrameIndex=-1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._lastAnimationState=null,this._animationConfig=null},i.prototype._fadeOut=function(t){var e=0,i=this._animationStates.length,a=null;switch(t.fadeOutMode){case 1:for(;i>e;++e)a=this._animationStates[e],a.layer===t.layer&&a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 2:for(;i>e;++e)a=this._animationStates[e],a.group===t.group&&a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 3:for(;i>e;++e)a=this._animationStates[e],a.layer===t.layer&&a.group===t.group&&a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 4:for(;i>e;++e)a=this._animationStates[e],a.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 0:}},i.prototype._init=function(e){this._armature||(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},i.prototype._advanceTime=function(t){if(this._isPlaying){0>t&&(t=-t),this._armature.inheritAnimation&&this._armature._parent&&(t*=this._armature._parent._armature.animation.timeScale),1!==this.timeScale&&(t*=this.timeScale);var e=this._animationStates.length;if(1===e){var i=this._animationStates[0];if(i._fadeState>0&&i._subFadeState>0)i.returnToPool(),this._animationStates.length=0,this._animationStateDirty=!0,this._lastAnimationState=null;else{var a=i.animationData,n=a.cacheFrameRate;if(this._animationStateDirty&&n>0){this._animationStateDirty=!1;for(var r=this._armature.getBones(),s=0,o=r.length;o>s;++s){var h=r[s];h._cachedFrameIndices=a.getBoneCachedFrameIndices(h.name)}for(var l=this._armature.getSlots(),s=0,o=l.length;o>s;++s){var _=l[s];_._cachedFrameIndices=a.getSlotCachedFrameIndices(_.name)}}this._timelineStateDirty&&i._updateTimelineStates(),i._advanceTime(t,n)}}else if(e>1){for(var s=0,u=0;e>s;++s){var i=this._animationStates[s];i._fadeState>0&&i._subFadeState>0?(u++,i.returnToPool(),this._animationStateDirty=!0,this._lastAnimationState===i&&(this._lastAnimationState=null)):(u>0&&(this._animationStates[s-u]=i),this._timelineStateDirty&&i._updateTimelineStates(),i._advanceTime(t,0)),s===e-1&&u>0&&(this._animationStates.length-=u,!this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._cacheFrameIndex=-1}else this._cacheFrameIndex=-1;this._timelineStateDirty=!1}},i.prototype.reset=function(){for(var t=0,e=this._animationStates.length;e>t;++t)this._animationStates[t].returnToPool();this._isPlaying=!1,this._animationStateDirty=!1,this._timelineStateDirty=!1,this._cacheFrameIndex=-1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},i.prototype.stop=function(t){if(void 0===t&&(t=null),t){var e=this.getState(t);e&&e.stop()}else this._isPlaying=!1},i.prototype.playConfig=function(e){if(!e)throw new Error(t.DragonBones.ARGUMENT_ERROR);var a=e.animation?e.animation:e.name,n=this._animations[a];if(!n)return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+a),null;this._isPlaying=!0,(e.fadeInTime<0||e.fadeInTime!==e.fadeInTime)&&(this._lastAnimationState?e.fadeInTime=n.fadeInTime:e.fadeInTime=0),(e.fadeOutTime<0||e.fadeOutTime!==e.fadeOutTime)&&(e.fadeOutTime=e.fadeInTime),(e.timeScale<=-100||e.timeScale!==e.timeScale)&&(e.timeScale=1/n.scale),n.frameCount>1?(e.position!==e.position?e.position=0:e.position<0?(e.position%=n.duration,e.position=n.duration-e.position):e.position===n.duration?e.position-=1e-6:e.position>n.duration&&(e.position%=n.duration),e.duration>0&&e.position+e.duration>n.duration&&(e.duration=n.duration-e.position),e.playTimes<0&&(e.playTimes=n.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0));
var r=!1;0===e.duration&&(e.duration=-1,r=!0),this._fadeOut(e),this._lastAnimationState=t.BaseObject.borrowObject(t.AnimationState),this._lastAnimationState._init(this._armature,n,e),this._animationStates.push(this._lastAnimationState),this._animationStateDirty=!0,this._cacheFrameIndex=-1,this._animationStates.length>1&&this._animationStates.sort(i._sortAnimationState);for(var s=this._armature.getSlots(),o=0,h=s.length;h>o;++o){var l=s[o].childArmature;l&&l.inheritAnimation&&l.animation.hasAnimation(a)&&!l.animation.getState(a)&&l.animation.fadeIn(a)}return e.fadeInTime<=0&&this._armature.advanceTime(0),r&&this._lastAnimationState.stop(),this._lastAnimationState},i.prototype.fadeIn=function(t,e,i,a,n,r){return void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===a&&(a=0),void 0===n&&(n=null),void 0===r&&(r=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=r,this._animationConfig.playTimes=i,this._animationConfig.layer=a,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=n,this.playConfig(this._animationConfig)},i.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,t)this.playConfig(this._animationConfig);else if(this._lastAnimationState)this._isPlaying&&(this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted)?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):(this._isPlaying=!0,this._lastAnimationState.play());else{var i=this._armature.armatureData.defaultAnimation;i&&(this._animationConfig.animation=i.name,this.playConfig(this._animationConfig))}return this._lastAnimationState},i.prototype.gotoAndPlayByTime=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.playTimes=i,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByFrame=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var a=this._animations[t];return a&&(this._animationConfig.position=a.duration*e/a.frameCount),this.playConfig(this._animationConfig)},i.prototype.gotoAndPlayByProgress=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=-1),this._animationConfig.clear(),this._animationConfig.playTimes=i,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var a=this._animations[t];return a&&(this._animationConfig.position=a.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},i.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByTime(t,e,1);return i&&i.stop(),i},i.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByFrame(t,e,1);return i&&i.stop(),i},i.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var i=this.gotoAndPlayByProgress(t,e,1);return i&&i.stop(),i},i.prototype.getState=function(t){for(var e=0,i=this._animationStates.length;i>e;++e){var a=this._animationStates[e];if(a.name===t)return a}return null},i.prototype.hasAnimation=function(t){return null!=this._animations[t]},Object.defineProperty(i.prototype,"isPlaying",{get:function(){return this._animationStates.length>1?this._isPlaying&&!this.isCompleted:this._lastAnimationState?this._isPlaying&&this._lastAnimationState.isPlaying:this._isPlaying},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isCompleted",{get:function(){if(this._lastAnimationState){if(!this._lastAnimationState.isCompleted)return!1;for(var t=0,e=this._animationStates.length;e>t;++t)if(!this._animationStates[t].isCompleted)return!1;return!0}return!1},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationName",{get:function(){return this._lastAnimationState?this._lastAnimationState.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){this._animationNames.length=0;for(var e in this._animations)delete this._animations[e];if(t)for(var e in t)this._animations[e]=t[e],this._animationNames.push(e)}},enumerable:!0,configurable:!0}),i.prototype.gotoAndPlay=function(t,e,i,a,n,r,s,o,h){void 0===e&&(e=-1),void 0===i&&(i=-1),void 0===a&&(a=-1),void 0===n&&(n=0),void 0===r&&(r=null),void 0===s&&(s=3),void 0===o&&(o=!0),void 0===h&&(h=!0),this._animationConfig.clear(),this._animationConfig.fadeOutMode=s,this._animationConfig.playTimes=a,this._animationConfig.layer=n,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=r;var l=this._animations[t];return l&&i>0&&(this._animationConfig.timeScale=l.duration/i),this.playConfig(this._animationConfig)},i.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),this.gotoAndStopByTime(t,e)},Object.defineProperty(i.prototype,"animationList",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"animationDataList",{get:function(){for(var t=[],e=0,i=this._animationNames.length;i>e;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),i}(t.BaseObject);e.None=0,e.SameLayer=1,e.SameGroup=2,e.SameLayerAndGroup=3,e.All=4,t.Animation=e,__reflect(e.prototype,"dragonBones.Animation")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._resourceConfigURL="resource/hello_dragonbones.res.json",e.addEventListener(egret.Event.ADDED_TO_STAGE,e._onStart,e),e}return __extends(e,t),e.prototype._onStart=function(){dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("dragonBonesData")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("textureDataA"),RES.getRes("textureA"));var t=dragonBones.EgretFactory.factory.buildArmatureDisplay("DragonBoy");t.animation.play("walk"),this.addChild(t),t.x=.5*this.stage.stageWidth,t.y=.5*this.stage.stageHeight+100},e}(BaseTest);t.HelloDragonBones=e,__reflect(e.prototype,"demosEgret.HelloDragonBones")}(demosEgret||(demosEgret={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._left=!1,e._right=!1,e._tester=new BoundingBoxTester,e._mecha=null,e._groudDisplay=null,e._resourceGroup="groundTest",e._resourceConfigURL="resource/groundTest.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=this;dragonBones.DragonBones.debugDraw=!0,dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("ground")),dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("mecha_1008d")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("mecha_1008d_texture_config"),RES.getRes("mecha_1008d_texture")),this._groudDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay("ground_1"),this.addChild(this._groudDisplay),this._groudDisplay.x=.5*this.stage.stageWidth,this._groudDisplay.y=.5*this.stage.stageHeight+100,this._mecha=new i(this._groudDisplay),this.addChild(this._mecha.display),this._mecha.display.x=.5*this.stage.stageWidth,this._mecha.display.y=.5*this.stage.stageHeight-100,enableDrag(this._groudDisplay),this._tester.armatureDisplay=this._groudDisplay,this._tester.x=200,this._tester.y=200,this.addChild(this._tester),this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this);var e=function(e){var i="keydown"==e.type;switch(e.keyCode){case 37:case 65:t._left=i,t._updateMove(-1);break;case 39:case 68:t._left=t._right=i,t._updateMove(1);break;case 38:case 87:i&&t._mecha.jump();break;case 83:case 40:t._mecha.squat(i)}};document.addEventListener("keydown",e),document.addEventListener("keyup",e);var a=this._mecha,n=egret.sys.TouchHandler.prototype.onTouchMove;egret.sys.TouchHandler.prototype.onTouchMove=function(t,e,i){n.call(this,t,e,i),a.aim(t,e)}},e.prototype._updateMove=function(t){this._left&&this._right?this._mecha.move(t):this._left?this._mecha.move(-1):this._right?this._mecha.move(1):this._mecha.move(0)},e.prototype._enterFrameHandler=function(t){this._mecha.update()},e}(BaseTest);t.GroundTest=e,__reflect(e.prototype,"demosEgret.GroundTest");var i=function(){function t(t){this._isSquating=!1,this._faceDir=1,this._aimDir=0,this._moveState=0,this._jumpState=0,this._aimRadian=0,this._speedX=0,this._speedY=0,this._hitHeight=100,this._bodyRadian=0,this._footRadian=0,this._armatureDisplay=null,this._footL=null,this._footR=null,this._groundDisplay=null,this._aimState=null,this._walkState=null,this._target=new egret.Point,this._helpPointA=new egret.Point,this._helpPointC=new egret.Point,this._helpPointE=new egret.Point,this._helpPointB=new egret.Point,this._helpPointD=new egret.Point,this._helpPointF=new egret.Point,this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay("mecha_1008d"),this._footL=this._armatureDisplay.armature.getBone("foot_l"),this._footR=this._armatureDisplay.armature.getBone("foot_r"),this._groundDisplay=t,this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this._animationEventHandler,this),this.jump()}return Object.defineProperty(t.prototype,"display",{get:function(){return this._armatureDisplay},enumerable:!0,configurable:!0}),t.prototype.move=function(t){this._moveState!=t&&(this._moveState=t,this._updateAnimation())},t.prototype.jump=function(){0==this._jumpState&&(this._jumpState=1,this._armatureDisplay.animation.fadeIn("jump_1",.1,-1,0,t.NORMAL_ANIMATION_GROUP),this._walkState=null)},t.prototype.squat=function(t){this._isSquating!=t&&(this._isSquating=t,this._updateAnimation())},t.prototype.aim=function(t,e){0==this._aimDir&&(this._aimDir=10),this._target.x=t,this._target.y=e},t.prototype.update=function(){this._updatePosition(),this._updateAim()},t.prototype._animationEventHandler=function(e){switch(e.type){case dragonBones.EventObject.FADE_IN_COMPLETE:0!=this._jumpState&&"jump_1"==e.eventObject.animationState.name&&(4==this._jumpState?(this._jumpState=0,this._updateAnimation()):(this._jumpState=2,this._speedY=-t.JUMP_SPEED,0!=this._moveState&&(this._moveState*this._faceDir>0?this._speedX=t.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-t.MAX_MOVE_SPEED_BACK*this._faceDir),this._armatureDisplay.animation.fadeIn("jump_2",.1,-1,0,t.NORMAL_ANIMATION_GROUP)))}},t.prototype._hitTestGround=function(){var e=2!=this._jumpState&&3!=this._jumpState,i=!1,a=0,n=0,r=0;if(e||(this._speedY>0&&(this._groundDisplay.globalToLocal(this._armatureDisplay.x,this._armatureDisplay.y,this._helpPointA),this._groundDisplay.armature.containsPoint(this._helpPointA.x,this._helpPointA.y)&&(this._groundDisplay.armature.containsPoint(this._helpPointA.x-this._speedX,this._helpPointA.y-this._speedY)||(i=!0))),this._armatureDisplay.y>=this._armatureDisplay.stage.stageHeight-50&&(i=!0,e=!0)),e||i){if(this._groundDisplay.globalToLocal(this._armatureDisplay.x,this._armatureDisplay.y,this._helpPointA),this._groundDisplay.armature.intersectsSegment(this._helpPointA.x,this._helpPointA.y-this._hitHeight,this._helpPointA.x,this._helpPointB.y+this._hitHeight,this._helpPointA,this._helpPointB,this._helpPointD)){var s=this._helpPointA.x,o=this._helpPointA.y,h=this._helpPointD.x;this._armatureDisplay.localToGlobal(this._footR.global.x,0,this._helpPointA),this._armatureDisplay.localToGlobal(this._footL.global.x,0,this._helpPointB),this._groundDisplay.globalToLocal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this._groundDisplay.globalToLocal(this._helpPointB.x,this._helpPointB.y,this._helpPointB);var l=this._helpPointA.x,_=this._helpPointA.y,u=this._helpPointB.x,p=this._helpPointB.y;if(this._groundDisplay.armature.intersectsSegment(this._helpPointA.x,this._helpPointA.y-this._hitHeight,this._helpPointA.x,this._helpPointA.y+this._hitHeight,this._helpPointA,this._helpPointC,this._helpPointE)&&(a|=1),this._groundDisplay.armature.intersectsSegment(this._helpPointB.x,this._helpPointB.y-this._hitHeight,this._helpPointB.x,this._helpPointB.y+this._hitHeight,this._helpPointB,this._helpPointC,this._helpPointF)&&(a|=2),a){2==a?(this._helpPointA.x=s+this._footR.global.x/this._footL.global.x*(this._helpPointB.x-s),this._helpPointA.y=o+(this._helpPointA.x-s)/(this._helpPointB.x-s)*(this._helpPointB.y-o),this._helpPointE.x=h):1==a&&(this._helpPointB.x=s+this._footR.global.x/this._footL.global.x*(this._helpPointA.x-s),this._helpPointB.y=o+(this._helpPointB.x-s)/(this._helpPointA.x-s)*(this._helpPointA.y-o),this._helpPointF.x=h),n=this._helpPointA.y-_,r=this._helpPointB.y-p;var c=-this._footR.global.x/(this._footL.global.x-this._footR.global.x),d=this._helpPointB.x-this._helpPointA.x,m=this._helpPointB.y-this._helpPointA.y,f=this._helpPointA.x+d*c,g=this._helpPointA.y+m*c;this._groundDisplay.localToGlobal(f,g,this._helpPointC),this._armatureDisplay.y=this._helpPointC.y;var y=-20*dragonBones.DragonBones.ANGLE_TO_RADIAN,v=20*dragonBones.DragonBones.ANGLE_TO_RADIAN,D=this._bodyRadian;this._footRadian=u>l?Math.atan2(m,d):Math.atan2(-m,-d),D=this._faceDir>0?this._footRadian<y?this._footRadian-y:this._footRadian>v?this._footRadian-v:0:this._footRadian<-v?this._footRadian+v:this._footRadian>-y?this._footRadian+y:0,this._bodyRadian+=.2*(D-this._bodyRadian)}}}else this._footRadian=0,this._bodyRadian*=.2;if(a){i&&(this._jumpState=4,this._armatureDisplay.animation.fadeIn("jump_1",.1,-1,0,t.NORMAL_ANIMATION_GROUP));var T=this._faceDir*(this._helpPointE.x-this._bodyRadian+.5*Math.PI),E=this._faceDir*(this._helpPointF.x-this._bodyRadian+.5*Math.PI);this._footR.offset.x=n,this._footL.offset.x=r,this._footR.offset.rotation=T,this._footL.offset.rotation=E}else i?(this._jumpState=4,this._armatureDisplay.animation.fadeIn("jump_1",.1,-1,0,t.NORMAL_ANIMATION_GROUP)):this._armatureDisplay.y<this._armatureDisplay.stage.stageHeight-50&&(this._jumpState=2),this._footR.offset.x*=.8,this._footL.offset.x*=.8,this._footR.offset.rotation*=.8,this._footL.offset.rotation*=.8;this._armatureDisplay.rotation=this._bodyRadian*dragonBones.DragonBones.RADIAN_TO_ANGLE},t.prototype._updateAnimation=function(){return 0==this._jumpState?this._isSquating?(this._speedX=0,this._armatureDisplay.animation.fadeIn("jump_1",.3,-1,0,t.NORMAL_ANIMATION_GROUP),void(this._walkState=null)):void(0==this._moveState?(this._speedX=0,this._armatureDisplay.animation.fadeIn("idle",.3,-1,0,t.NORMAL_ANIMATION_GROUP),this._walkState=null):(this._walkState||(this._walkState=this._armatureDisplay.animation.fadeIn("walk",.3,-1,0,t.NORMAL_ANIMATION_GROUP,2),this._walkState.play()),this._moveState*this._faceDir>0?this._walkState.timeScale=t.MAX_MOVE_SPEED_FRONT/t.NORMALIZE_MOVE_SPEED:this._walkState.timeScale=-t.MAX_MOVE_SPEED_BACK/t.NORMALIZE_MOVE_SPEED,this._moveState*this._faceDir>0?this._speedX=t.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-t.MAX_MOVE_SPEED_BACK*this._faceDir)):void 0},t.prototype._updatePosition=function(){this._armatureDisplay.x,this._armatureDisplay.y;(this._moveState||0!=this._speedX)&&(this._armatureDisplay.x+=this._speedX*Math.cos(this._footRadian),this._armatureDisplay.x<0?this._armatureDisplay.x=0:this._armatureDisplay.x>this._armatureDisplay.stage.stageWidth&&(this._armatureDisplay.x=this._armatureDisplay.stage.stageWidth)),(2==this._jumpState||3==this._jumpState)&&(this._speedY<5&&this._speedY+t.G>=5&&(this._jumpState=3,this._armatureDisplay.animation.fadeIn("jump_3",.3,-1,0,t.NORMAL_ANIMATION_GROUP)),this._speedY+=t.G,this._armatureDisplay.y+=this._speedY),this._hitTestGround()},t.prototype._updateAim=function(){if(0!=this._aimDir){this._faceDir=this._target.x>this._armatureDisplay.x?1:-1,this._armatureDisplay.scaleX*this._faceDir<0&&(this._armatureDisplay.scaleX*=-1,this._moveState&&this._updateAnimation());var e=this._armatureDisplay.armature.getBone("chest").global.y*this._armatureDisplay.scaleY;this._faceDir>0?(this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x),this._aimRadian-=this._bodyRadian):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x),this._aimRadian+=this._bodyRadian,this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var i=0;i=this._aimRadian>0?-1:1,this._aimDir!=i&&(this._aimDir=i,this._aimDir>=0?this._aimState=this._armatureDisplay.animation.fadeIn("aimUp",.001,1,0,t.AIM_ANIMATION_GROUP,2):this._aimState=this._armatureDisplay.animation.fadeIn("aimDown",.001,1,0,t.AIM_ANIMATION_GROUP,2)),this._aimState.weight=Math.abs(this._aimRadian/Math.PI*2),this._armatureDisplay.armature.invalidUpdate()}},t}();i.G=1,i.JUMP_SPEED=30,i.NORMALIZE_MOVE_SPEED=2,i.MAX_MOVE_SPEED_FRONT=1.4*i.NORMALIZE_MOVE_SPEED,i.MAX_MOVE_SPEED_BACK=1*i.NORMALIZE_MOVE_SPEED,i.NORMAL_ANIMATION_GROUP="normal",i.AIM_ANIMATION_GROUP="aim",__reflect(i.prototype,"Mecha")}(demosEgret||(demosEgret={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._isTouched=!1,e._isTouchMoved=!1,e._isHorizontalMoved=!1,e._prevArmatureScale=1,e._prevAnimationScale=1,e._startPoint=new egret.Point,e._text=new egret.TextField,e._dragonBonesIndex=0,e._armatureIndex=0,e._animationIndex=0,e._armatureDisplay=null,e._allDragonBonesData=[],e._movie=null,e._boundingBoxTester=new BoundingBoxTester,e._resourceGroup="baseTest",e._resourceConfigURL="resource/base_test.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=RES.getGroupByName("search");if(t&&t.length>0)for(var e=0,i=t.length;i>e;++e){var a=t[e].name;dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes(a));var n=RES.getRes(a+"_textureData");n&&dragonBones.EgretFactory.factory.parseTextureAtlasData(n,RES.getRes(a+"_texture"));var r=a+"_mov";RES.hasRes(r)&&dragonBones.addMovieGroup(RES.getRes(r),RES.getRes(a+"_texture"))}dragonBones.DragonBones.debugDraw=!0;var s=dragonBones.EgretFactory.factory.getAllDragonBonesData();for(var e in s){var o=s[e];this._allDragonBonesData.push(o)}if(!(this._allDragonBonesData.length>0))throw new Error;this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._touchHandler,this),dragonBones.EgretFactory.factory.soundEventManager.addEventListener(dragonBones.EventObject.SOUND_EVENT,this._armatureEventHandler,this),this._boundingBoxTester.x=200,this._boundingBoxTester.y=200,this.addChild(this._boundingBoxTester),this._changeArmature(1),this._changeAnimation(),this._text.size=20,this._text.textAlign=egret.HorizontalAlign.CENTER,this._text.width=this.stage.stageWidth,this._text.x=0,this._text.y=this.stage.stageHeight-80,this.addChild(this._text)},e.prototype._touchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:t.target==this.stage&&(this._isTouched=!0,this._prevArmatureScale=this._armatureDisplay.scaleX,this._prevAnimationScale=this._armatureDisplay.animation.timeScale,this._startPoint.setTo(t.stageX,t.stageY));break;case egret.TouchEvent.TOUCH_END:if(this._isTouched)if(this._isTouched=!1,this._isTouchMoved)this._isTouchMoved=!1;else{if(this._allDragonBonesData.length>1||this._allDragonBonesData[0].armatureNames.length>1){var e=Math.abs(this.stage.stageWidth/2-t.stageX)>this.stage.stageWidth/6,i=t.stageX>this.stage.stageWidth/2;e&&(i?this._changeArmature(1):this._changeArmature(-1))}this._changeAnimation()}break;case egret.TouchEvent.TOUCH_MOVE:if(this._isTouched){var a=this._startPoint.x-t.stageX,n=this._startPoint.y-t.stageY;if(!this._isTouchMoved){var r=Math.abs(a),s=Math.abs(n);(r>5||s>5)&&(this._isTouchMoved=!0,this._isHorizontalMoved=r>s)}if(this._isTouchMoved)if(this._isHorizontalMoved){var o=Math.max(-a/200+this._prevAnimationScale,.01);this._armatureDisplay.animation.timeScale=o,this._movie&&(this._movie.timeScale=o)}else{var h=Math.max(n/200+this._prevArmatureScale,.01);this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=h,this._movie&&(this._movie.scaleX=this._movie.scaleY=h)}}}},e.prototype._changeArmature=function(t){var e=!1,i=this._allDragonBonesData[this._dragonBonesIndex],a=i.armatureNames;this._animationIndex=0,this._armatureIndex+=t>0?1:-1,this._armatureIndex<0?(e=!0,this._dragonBonesIndex--):this._armatureIndex>=a.length&&(this._armatureIndex=0,e=!0,this._dragonBonesIndex++),e&&(this._dragonBonesIndex<0?this._dragonBonesIndex=this._allDragonBonesData.length-1:this._dragonBonesIndex>=this._allDragonBonesData.length&&(this._dragonBonesIndex=0),i=this._allDragonBonesData[this._dragonBonesIndex],a=i.armatureNames,this._armatureIndex=t>0?0:a.length-1);var n=a[this._armatureIndex];this._armatureDisplay&&(disableDrag(this._armatureDisplay),this.removeChild(this._armatureDisplay),this._armatureDisplay.removeEventListener(dragonBones.EventObject.START,this._armatureEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.removeEventListener(dragonBones.EventObject.FRAME_EVENT,this._armatureEventHandler,this),this._armatureDisplay.dispose()),this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay(n,i.name),this._armatureDisplay.addEventListener(dragonBones.EventObject.START,this._armatureEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._armatureEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._armatureEventHandler,this),this._armatureDisplay.x=.5*this.stage.stageWidth,this._armatureDisplay.y=.5*this.stage.stageHeight+100,this.addChild(this._armatureDisplay),enableDrag(this._armatureDisplay),this._movie&&(disableDrag(this._movie),this.removeChild(this._movie),this._movie.removeEventListener(dragonBones.MovieEvent.START,this._movieEventHandler,this),this._movie.removeEventListener(dragonBones.MovieEvent.LOOP_COMPLETE,this._movieEventHandler,this),this._movie.removeEventListener(dragonBones.MovieEvent.COMPLETE,this._movieEventHandler,this),this._movie.removeEventListener(dragonBones.MovieEvent.FRAME_EVENT,this._movieEventHandler,this),this._movie.dispose(),this._movie=null),this._movie=dragonBones.buildMovie(n,i.name),this._movie&&(this._movie.addEventListener(dragonBones.MovieEvent.START,this._movieEventHandler,this),this._movie.addEventListener(dragonBones.MovieEvent.LOOP_COMPLETE,this._movieEventHandler,this),this._movie.addEventListener(dragonBones.MovieEvent.COMPLETE,this._movieEventHandler,this),this._movie.addEventListener(dragonBones.MovieEvent.FRAME_EVENT,this._movieEventHandler,this),this._movie.x=.5*this.stage.stageWidth+200,this._movie.y=.5*this.stage.stageHeight+100,this.addChild(this._movie),enableDrag(this._movie),this._armatureDisplay.x-=200),this._boundingBoxTester.armatureDisplay=this._armatureDisplay,this.addChild(this._boundingBoxTester)},e.prototype._changeAnimation=function(){var t=this._armatureDisplay.animation.animationNames;if(0!=t.length){this._animationIndex++,this._animationIndex>=t.length&&(this._animationIndex=0);var e=t[this._animationIndex];this._armatureDisplay.animation.fadeIn(e,2),this._text.text="DragonBones: "+this._armatureDisplay.armature.armatureData.parent.name+"    Armature: "+this._armatureDisplay.armature.name+"    Animation: "+this._armatureDisplay.armature.animation.lastAnimationName+"\nTouch screen left/right to change prev/next armature.\nTouch center to play next animation.",this._movie&&this._movie.play(e)}},e.prototype._armatureEventHandler=function(t){console.log("Armature.",t.type,t.eventObject.animationState.name,t.eventObject.name||"")},e.prototype._movieEventHandler=function(t){console.log("Movie.",t.type,t.clipName,t.name||"")},e}(BaseTest);t.DragonBonesTest=e,__reflect(e.prototype,"demosEgret.DragonBonesTest")}(demosEgret||(demosEgret={}));var demosEgret;!function(t){var e;!function(t){var e=function(t){function e(){var i=t.call(this)||this;return i._left=!1,i._right=!1,i._player=null,i._bullets=[],e.instance=i,i._resourceConfigURL="resource/core_element.res.json",i}return __extends(e,t),e.prototype._onStart=function(){e.STAGE_WIDTH=this.stage.stageWidth,e.STAGE_HEIGHT=this.stage.stageHeight,e.GROUND=e.STAGE_HEIGHT-100,dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes("dragonBonesData")),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes("textureDataA"),RES.getRes("textureA")),this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),document.addEventListener("keydown",this._keyHandler),document.addEventListener("keyup",this._keyHandler);var t=egret.sys.TouchHandler.prototype.onTouchMove;egret.sys.TouchHandler.prototype.onTouchMove=function(i,a,n){t.call(this,i,a,n),e.instance._player.aim(i,a)},this._player=new i;var a=new egret.TextField;a.size=20,a.textAlign=egret.HorizontalAlign.CENTER,a.text="Press W/A/S/D to move. Press Q/E/SPACE to switch weapons.\nMouse Move to aim. Click to fire.",a.width=e.STAGE_WIDTH,a.x=0,a.y=e.STAGE_HEIGHT-60,this.addChild(a)},e.prototype.addBullet=function(t){this._bullets.push(t)},e.prototype._touchHandler=function(t){this._player.aim(t.stageX,t.stageY),t.type==egret.TouchEvent.TOUCH_BEGIN?this._player.attack(!0):this._player.attack(!1)},e.prototype._keyHandler=function(t){var i="keydown"==t.type;switch(t.keyCode){case 37:case 65:e.instance._left=i,e.instance._updateMove(-1);break;case 39:case 68:e.instance._right=i,e.instance._updateMove(1);break;case 38:case 87:i&&e.instance._player.jump();break;case 83:case 40:e.instance._player.squat(i);break;case 81:i&&e.instance._player.switchWeaponR();break;case 69:i&&e.instance._player.switchWeaponL();break;case 32:i&&(e.instance._player.switchWeaponR(),e.instance._player.switchWeaponL())}},e.prototype._enterFrameHandler=function(t){this._player.update();for(var e=this._bullets.length;e--;){var i=this._bullets[e];i.update()&&this._bullets.splice(e,1)}dragonBones.WorldClock.clock.advanceTime(-1)},e.prototype._updateMove=function(t){this._left&&this._right?this._player.move(t):this._left?this._player.move(-1):this._right?this._player.move(1):this._player.move(0)},e}(BaseTest);e.STAGE_WIDTH=0,e.STAGE_HEIGHT=0,e.GROUND=300,e.G=.6,e.instance=null,t.Game=e,__reflect(e.prototype,"demosEgret.coreElement.Game");var i=function(){function t(){this._isJumpingA=!1,this._isJumpingB=!1,this._isSquating=!1,this._isAttackingA=!1,this._isAttackingB=!1,this._weaponRIndex=0,this._weaponLIndex=0,this._faceDir=1,this._aimDir=0,this._moveDir=0,this._aimRadian=0,this._speedX=0,this._speedY=0,this._armature=null,this._armatureDisplay=null,this._weaponR=null,this._weaponL=null,this._aimState=null,this._walkState=null,this._attackState=null,this._target=new egret.Point,this._armature=dragonBones.EgretFactory.factory.buildArmature("mecha_1502b"),this._armatureDisplay=this._armature.display,this._armatureDisplay.x=.5*e.STAGE_WIDTH,this._armatureDisplay.y=e.GROUND,this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=1,this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this._animationEventHandler,this),this._armature.getSlot("effects_1").displayController=t.NORMAL_ANIMATION_GROUP,this._armature.getSlot("effects_2").displayController=t.NORMAL_ANIMATION_GROUP,this._weaponR=this._armature.getSlot("weapon_r").childArmature,this._weaponL=this._armature.getSlot("weapon_l").childArmature,this._weaponR.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._weaponL.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._updateAnimation(),e.instance.addChild(this._armatureDisplay),dragonBones.WorldClock.clock.add(this._armature)}return t.prototype.move=function(t){this._moveDir!=t&&(this._moveDir=t,this._updateAnimation())},t.prototype.jump=function(){this._isJumpingA||(this._isJumpingA=!0,this._armature.animation.fadeIn("jump_1",-1,-1,0,t.NORMAL_ANIMATION_GROUP),this._walkState=null)},t.prototype.squat=function(t){this._isSquating!=t&&(this._isSquating=t,this._updateAnimation())},t.prototype.attack=function(t){this._isAttackingA!=t&&(this._isAttackingA=t)},t.prototype.switchWeaponR=function(){this._weaponRIndex++,this._weaponRIndex>=t.WEAPON_R_LIST.length&&(this._weaponRIndex=0),this._weaponR.removeEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this);var e=t.WEAPON_R_LIST[this._weaponRIndex];this._weaponR=dragonBones.EgretFactory.factory.buildArmature(e),this._armature.getSlot("weapon_r").childArmature=this._weaponR,this._weaponR.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this)},t.prototype.switchWeaponL=function(){this._weaponLIndex++,this._weaponLIndex>=t.WEAPON_L_LIST.length&&(this._weaponLIndex=0),this._weaponL.removeEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this);var e=t.WEAPON_L_LIST[this._weaponLIndex];this._weaponL=dragonBones.EgretFactory.factory.buildArmature(e),this._armature.getSlot("weapon_l").childArmature=this._weaponL,this._weaponL.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this)},t.prototype.aim=function(t,e){0==this._aimDir&&(this._aimDir=10),this._target.x=t,this._target.y=e},t.prototype.update=function(){this._updatePosition(),this._updateAim(),this._updateAttack()},t.prototype._animationEventHandler=function(e){switch(e.type){case dragonBones.EventObject.FADE_IN_COMPLETE:"jump_1"==e.eventObject.animationState.name?(this._isJumpingB=!0,this._speedY=-t.JUMP_SPEED,0!=this._moveDir&&(this._moveDir*this._faceDir>0?this._speedX=t.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-t.MAX_MOVE_SPEED_BACK*this._faceDir),this._armature.animation.fadeIn("jump_2",-1,-1,0,t.NORMAL_ANIMATION_GROUP)):"jump_4"==e.eventObject.animationState.name&&(this._isJumpingA=!1,this._isJumpingB=!1,this._updateAnimation());break;case dragonBones.EventObject.FADE_OUT_COMPLETE:"attack_01"==e.eventObject.animationState.name&&(this._isAttackingB=!1,this._attackState=null)}},t.prototype._frameEventHandler=function(e){if("onFire"==e.eventObject.name){var i=e.eventObject.armature.getBone("firePoint");e.eventObject.armature.display.localToGlobal(i.global.x,i.global.y,t._globalPoint),this._fire(t._globalPoint)}},t.prototype._fire=function(t){t.x+=2*Math.random()-1,t.y+=2*Math.random()-1;var i=this._faceDir<0?Math.PI-this._aimRadian:this._aimRadian,n=new a("bullet_01","fireEffect_01",i+.02*Math.random()-.01,40,t);e.instance.addBullet(n)},t.prototype._updateAnimation=function(){return this._isJumpingA?void 0:this._isSquating?(this._speedX=0,this._armature.animation.fadeIn("squat",-1,-1,0,t.NORMAL_ANIMATION_GROUP),void(this._walkState=null)):void(0==this._moveDir?(this._speedX=0,this._armature.animation.fadeIn("idle",-1,-1,0,t.NORMAL_ANIMATION_GROUP),this._walkState=null):(this._walkState||(this._walkState=this._armature.animation.fadeIn("walk",-1,-1,0,t.NORMAL_ANIMATION_GROUP)),this._moveDir*this._faceDir>0?this._walkState.timeScale=t.MAX_MOVE_SPEED_FRONT/t.NORMALIZE_MOVE_SPEED:this._walkState.timeScale=-t.MAX_MOVE_SPEED_BACK/t.NORMALIZE_MOVE_SPEED,this._moveDir*this._faceDir>0?this._speedX=t.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-t.MAX_MOVE_SPEED_BACK*this._faceDir))
},t.prototype._updatePosition=function(){0!=this._speedX&&(this._armatureDisplay.x+=this._speedX,this._armatureDisplay.x<0?this._armatureDisplay.x=0:this._armatureDisplay.x>e.STAGE_WIDTH&&(this._armatureDisplay.x=e.STAGE_WIDTH)),0!=this._speedY&&(this._speedY<5&&this._speedY+e.G>=5&&this._armature.animation.fadeIn("jump_3",-1,-1,0,t.NORMAL_ANIMATION_GROUP),this._speedY+=e.G,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.y>e.GROUND&&(this._armatureDisplay.y=e.GROUND,this._speedY=0,this._armature.animation.fadeIn("jump_4",-1,-1,0,t.NORMAL_ANIMATION_GROUP)))},t.prototype._updateAim=function(){if(0!=this._aimDir){this._faceDir=this._target.x>this._armatureDisplay.x?1:-1,this._armatureDisplay.scaleX*this._faceDir<0&&(this._armatureDisplay.scaleX*=-1,this._moveDir&&this._updateAnimation());var e=this._armature.getBone("chest").global.y*this._armatureDisplay.scaleY;this._faceDir>0?this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x),this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var i=0;i=this._aimRadian>0?-1:1,this._aimDir!=i&&(this._aimDir=i,this._aimDir>=0?this._aimState=this._armature.animation.fadeIn("aimUp",0,1,0,t.AIM_ANIMATION_GROUP,2):this._aimState=this._armature.animation.fadeIn("aimDown",0,1,0,t.AIM_ANIMATION_GROUP,2)),this._aimState.weight=Math.abs(this._aimRadian/Math.PI*2),this._armature.invalidUpdate()}},t.prototype._updateAttack=function(){this._isAttackingA&&!this._isAttackingB&&(this._isAttackingB=!0,this._attackState=this._armature.animation.fadeIn("attack_01",-1,-1,0,t.ATTACK_ANIMATION_GROUP,2),this._attackState.autoFadeOutTime=this._attackState.fadeTotalTime,this._attackState.addBoneMask("pelvis"))},t}();i.NORMAL_ANIMATION_GROUP="normal",i.AIM_ANIMATION_GROUP="aim",i.ATTACK_ANIMATION_GROUP="attack",i.JUMP_SPEED=20,i.NORMALIZE_MOVE_SPEED=3.6,i.MAX_MOVE_SPEED_FRONT=1.4*i.NORMALIZE_MOVE_SPEED,i.MAX_MOVE_SPEED_BACK=1*i.NORMALIZE_MOVE_SPEED,i.WEAPON_R_LIST=["weapon_1502b_r","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d","weapon_1005e"],i.WEAPON_L_LIST=["weapon_1502b_l","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d"],i._globalPoint=new egret.Point,__reflect(i.prototype,"Mecha");var a=function(){function t(t,i,a,n,r){if(this._speedX=0,this._speedY=0,this._armature=null,this._armatureDisplay=null,this._effect=null,this._speedX=Math.cos(a)*n,this._speedY=Math.sin(a)*n,this._armature=dragonBones.EgretFactory.factory.buildArmature(t),this._armatureDisplay=this._armature.display,this._armatureDisplay.x=r.x,this._armatureDisplay.y=r.y,this._armatureDisplay.rotation=a*dragonBones.DragonBones.RADIAN_TO_ANGLE,this._armature.animation.play("idle"),i){this._effect=dragonBones.EgretFactory.factory.buildArmature(i);var s=this._effect.display;s.rotation=a*dragonBones.DragonBones.RADIAN_TO_ANGLE,s.x=r.x,s.y=r.y,s.scaleX=1+1*Math.random(),s.scaleY=1+.5*Math.random(),Math.random()<.5&&(s.scaleY*=-1),this._effect.animation.play("idle"),dragonBones.WorldClock.clock.add(this._effect),e.instance.addChild(s)}dragonBones.WorldClock.clock.add(this._armature),e.instance.addChild(this._armatureDisplay)}return t.prototype.update=function(){return this._armatureDisplay.x+=this._speedX,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.x<-100||this._armatureDisplay.x>=e.STAGE_WIDTH+100||this._armatureDisplay.y<-100||this._armatureDisplay.y>=e.STAGE_HEIGHT+100?(dragonBones.WorldClock.clock.remove(this._armature),e.instance.removeChild(this._armatureDisplay),this._armature.dispose(),this._effect&&(dragonBones.WorldClock.clock.remove(this._effect),e.instance.removeChild(this._effect.display),this._effect.dispose()),!0):!1},t}();__reflect(a.prototype,"Bullet")}(e=t.coreElement||(t.coreElement={}))}(demosEgret||(demosEgret={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._armatureDisplay=null,e._resourceGroup="animationBlendTest",e._resourceConfigURL="resource/test.res.json",e}return __extends(e,t),e.prototype._onStart=function(){var t=this;dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes(this._resourceGroup)),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes(this._resourceGroup+"_textureData"),RES.getRes(this._resourceGroup+"_texture")),this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay("Armature"),this._armatureDisplay.x=.5*this.stage.stageWidth,this._armatureDisplay.y=.5*this.stage.stageHeight,this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=.5,this.addChild(this._armatureDisplay);var e=function(e){switch(e.keyCode){case 49:t._armatureDisplay.animation.fadeIn("wait",.1,0,0);break;case 50:t._armatureDisplay.animation.fadeIn("run",.1,0,0);break;case 51:var i=t._armatureDisplay.animation.getState("shoot");i?i.isPlaying&&i.fadeOut(.1,!0):(i=t._armatureDisplay.animation.fadeIn("shoot",.1,0,1,"shoot",2),i.addBoneMask("head"),i.addBoneMask("body"),i.addBoneMask("lhand1"),i.addBoneMask("rhand1"),i.addBoneMask("gun"),i.addBoneMask("firePoint"))}};document.addEventListener("keyup",e)},e}(BaseTest);t.AnimationBlendTest=e,__reflect(e.prototype,"demosEgret.AnimationBlendTest")}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(){function t(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),this.x=t,this.y=e,this.width=i,this.height=a}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=e,__reflect(e.prototype,"dragonBones.Rectangle")}(dragonBones||(dragonBones={}));var demosEgret;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._armatureDisplay=null,e._resourceGroup="animationBaseTest",e._resourceConfigURL="resource/test.res.json",e}return __extends(e,t),e.prototype._onStart=function(){dragonBones.EgretFactory.factory.parseDragonBonesData(RES.getRes(this._resourceGroup)),dragonBones.EgretFactory.factory.parseTextureAtlasData(RES.getRes(this._resourceGroup+"_textureData"),RES.getRes(this._resourceGroup+"_texture")),this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay("progressBar"),this._armatureDisplay.x=.5*this.stage.stageWidth,this._armatureDisplay.y=.5*this.stage.stageHeight,this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=this.stage.stageWidth>=300?1:this.stage.stageWidth/330,this.addChild(this._armatureDisplay),this._armatureDisplay.addEventListener(dragonBones.EventObject.START,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._animationEventHandler,this);var t=this._armatureDisplay.animation.animationConfig;t.name="test",t.animation="idle",t.playTimes=1,this._armatureDisplay.animation.playConfig(t),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._touchHandler,this)},e.prototype._touchHandler=function(t){var e=Math.min(Math.max((t.stageX-this._armatureDisplay.x+300*this._armatureDisplay.scaleX)/600*this._armatureDisplay.scaleX,0),1);switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._armatureDisplay.animation.gotoAndStopByProgress("idle",e);break;case egret.TouchEvent.TOUCH_END:this._armatureDisplay.animation.play();break;case egret.TouchEvent.TOUCH_MOVE:if(t.touchDown){var i=this._armatureDisplay.animation.getState("idle");i&&(i.currentTime=i.totalTime*e)}}},e.prototype._animationEventHandler=function(t){console.log(t.eventObject.animationState.name,t.type,t.eventObject.name?t.eventObject.name:"")},e}(BaseTest);t.AnimationBaseTest=e,__reflect(e.prototype,"demosEgret.AnimationBaseTest")}(demosEgret||(demosEgret={}));var dragonBones;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.boneMask=[],e.animationNames=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.AnimationConfig]"},e.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTime=-1,this.fadeOutEasing=0,this.additiveBlending=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.actionEnabled=!0,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.fadeInEasing=0,this.weight=1,this.name=null,this.animation=null,this.group=null,this.boneMask.length=0,this.animationNames.length=0},e.prototype.clear=function(){this._onClear()},e.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutEasing=t.fadeOutEasing,this.additiveBlending=t.additiveBlending,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.actionEnabled=t.actionEnabled,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInEasing=t.fadeInEasing,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,i=this.boneMask.length;i>e;++e)this.boneMask[e]=t.boneMask[e];this.animationNames.length=t.animationNames.length;for(var e=0,i=this.animationNames.length;i>e;++e)this.animationNames[e]=t.animationNames[e]},e.prototype.containsBoneMask=function(t){return 0===this.boneMask.length||this.boneMask.indexOf(t)>=0},e.prototype.addBoneMask=function(t,e,i){void 0===i&&(i=!0);var a=t.getBone(e);if(a&&(this.boneMask.indexOf(e)<0&&this.boneMask.push(e),i))for(var n=t.getBones(),r=0,s=n.length;s>r;++r){var o=n[r];this.boneMask.indexOf(o.name)<0&&a.contains(o)&&this.boneMask.push(o.name)}},e.prototype.removeBoneMask=function(t,e,i){void 0===i&&(i=!0);var a=this.boneMask.indexOf(e);if(a>=0&&this.boneMask.splice(a,1),i){var n=t.getBone(e);if(n){var r=t.getBones();if(this.boneMask.length>0)for(var s=0,o=r.length;o>s;++s){var h=r[s],l=this.boneMask.indexOf(h.name);l>=0&&n.contains(h)&&this.boneMask.splice(l,1)}else for(var s=0,o=r.length;o>s;++s){var h=r[s];n.contains(h)||this.boneMask.push(h.name)}}}},e}(t.BaseObject);t.AnimationConfig=e,__reflect(e.prototype,"dragonBones.AnimationConfig")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.boneTimelines={},t.slotTimelines={},t.ffdTimelines={},t.cachedFrames=[],t.boneCachedFrameIndices={},t.slotCachedFrameIndices={},t}return __extends(i,e),i.toString=function(){return"[class dragonBones.AnimationData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this);for(var t in this.boneTimelines)this.boneTimelines[t].returnToPool(),delete this.boneTimelines[t];for(var t in this.slotTimelines)this.slotTimelines[t].returnToPool(),delete this.slotTimelines[t];for(var t in this.ffdTimelines){for(var i in this.ffdTimelines[t])for(var a in this.ffdTimelines[t][i])this.ffdTimelines[t][i][a].returnToPool();delete this.ffdTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameCount=0,this.playTimes=0,this.duration=0,this.fadeInTime=0,this.cacheFrameRate=0,this.name=null,this.cachedFrames.length=0,this.zOrderTimeline=null},i.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=0,this.cachedFrames.length=e;for(var i in this.boneTimelines){for(var a=new Array(e),n=0,r=a.length;r>n;++n)a[n]=-1;this.boneCachedFrameIndices[i]=a}for(var i in this.slotTimelines){for(var a=new Array(e),n=0,r=a.length;r>n;++n)a[n]=-1;this.slotCachedFrameIndices[i]=a}}},i.prototype.addBoneTimeline=function(e){if(!e||!e.bone||this.boneTimelines[e.bone.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);this.boneTimelines[e.bone.name]=e},i.prototype.addSlotTimeline=function(e){if(!e||!e.slot||this.slotTimelines[e.slot.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);this.slotTimelines[e.slot.name]=e},i.prototype.addFFDTimeline=function(e){if(!(e&&e.skin&&e.slot&&e.display))throw new Error(t.DragonBones.ARGUMENT_ERROR);var i=this.ffdTimelines[e.skin.name]=this.ffdTimelines[e.skin.name]||{},a=i[e.slot.slot.name]=i[e.slot.slot.name]||{};if(a[e.display.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);a[e.display.name]=e},i.prototype.getBoneTimeline=function(t){return this.boneTimelines[t]},i.prototype.getSlotTimeline=function(t){return this.slotTimelines[t]},i.prototype.getFFDTimeline=function(t,e){var i=this.ffdTimelines[t];return i?i[e]:null},i.prototype.getBoneCachedFrameIndices=function(t){return this.boneCachedFrameIndices[t]},i.prototype.getSlotCachedFrameIndices=function(t){return this.slotCachedFrameIndices[t]},i}(t.TimelineData);t.AnimationData=e,__reflect(e.prototype,"dragonBones.AnimationData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){var i=e.call(this)||this;return i.aabb=new t.Rectangle,i.bones={},i.slots={},i.skins={},i.animations={},i.actions=[],i._animationNames=[],i._sortedBones=[],i._sortedSlots=[],i._bonesChildren={},i}return __extends(i,e),i.toString=function(){return"[class dragonBones.ArmatureData]"},i._onSortSlots=function(t,e){return t.zOrder>e.zOrder?1:-1},i.prototype._onClear=function(){for(var t in this.bones)this.bones[t].returnToPool(),delete this.bones[t];for(var t in this.slots)this.slots[t].returnToPool(),delete this.slots[t];for(var t in this.skins)this.skins[t].returnToPool(),delete this.skins[t];for(var t in this.animations)this.animations[t].returnToPool(),delete this.animations[t];for(var e=0,i=this.actions.length;i>e;++e)this.actions[e].returnToPool();for(var t in this._bonesChildren)delete this._bonesChildren[t];this.userData&&this.userData.returnToPool(),this.isRightTransform=!1,this.frameRate=0,this.type=-1,this.cacheFrameRate=0,this.scale=1,this.name=null,this.aabb.clear(),this.actions.length=0,this.parent=null,this.userData=null,this._boneDirty=!1,this._slotDirty=!1,this._animationNames.length=0,this._sortedBones.length=0,this._sortedSlots.length=0,this._defaultSkin=null,this._defaultAnimation=null},i.prototype._sortBones=function(){var t=this._sortedBones.length;if(!(1>t)){var e=this._sortedBones.concat(),i=0,a=0;for(this._sortedBones.length=0;t>a;){var n=e[i++];i>=t&&(i=0),this._sortedBones.indexOf(n)>=0||n.parent&&this._sortedBones.indexOf(n.parent)<0||n.ik&&this._sortedBones.indexOf(n.ik)<0||(n.ik&&n.chain>0&&n.chainIndex===n.chain?this._sortedBones.splice(this._sortedBones.indexOf(n.parent)+1,0,n):this._sortedBones.push(n),a++)}}},i.prototype._sortSlots=function(){this._sortedSlots.sort(i._onSortSlots)},i.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=t;for(var e in this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)}},i.prototype.setCacheFrame=function(t,e,i){void 0===i&&(i=-1);var a=this.parent.cachedFrames;return 0>i&&(i=a.length),a.length+=10,a[i]=t.a,a[i+1]=t.b,a[i+2]=t.c,a[i+3]=t.d,a[i+4]=t.tx,a[i+5]=t.ty,a[i+6]=e.skewX,a[i+7]=e.skewY,a[i+8]=e.scaleX,a[i+9]=e.scaleY,i},i.prototype.getCacheFrame=function(t,e,i){var a=this.parent.cachedFrames;t.a=a[i],t.b=a[i+1],t.c=a[i+2],t.d=a[i+3],t.tx=a[i+4],t.ty=a[i+5],e.skewX=a[i+6],e.skewY=a[i+7],e.scaleX=a[i+8],e.scaleY=a[i+9],e.x=t.tx,e.y=t.ty},i.prototype.addBone=function(e,i){if(!e||!e.name||this.bones[e.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);if(i){var a=this.getBone(i);a?e.parent=a:(this._bonesChildren[i]=this._bonesChildren[i]||[]).push(e)}var n=this._bonesChildren[e.name];if(n){for(var r=0,s=n.length;s>r;++r)n[r].parent=e;delete this._bonesChildren[e.name]}this.bones[e.name]=e,this._sortedBones.push(e),this._boneDirty=!0},i.prototype.addSlot=function(e){if(!e||!e.name||this.slots[e.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);this.slots[e.name]=e,this._sortedSlots.push(e),this._slotDirty=!0},i.prototype.addSkin=function(e){if(!e||!e.name||this.skins[e.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);this.skins[e.name]=e,this._defaultSkin||(this._defaultSkin=e)},i.prototype.addAnimation=function(e){if(!e||!e.name||this.animations[e.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);this.animations[e.name]=e,this._animationNames.push(e.name),this._defaultAnimation||(this._defaultAnimation=e)},i.prototype.getBone=function(t){return this.bones[t]},i.prototype.getSlot=function(t){return this.slots[t]},i.prototype.getSkin=function(t){return t?this.skins[t]:this._defaultSkin},i.prototype.getAnimation=function(t){return t?this.animations[t]:this._defaultAnimation},Object.defineProperty(i.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sortedBones",{get:function(){return this._boneDirty&&(this._boneDirty=!1,this._sortBones()),this._sortedBones},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"sortedSlots",{get:function(){return this._slotDirty&&(this._slotDirty=!1,this._sortSlots()),this._sortedSlots},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"defaultSkin",{get:function(){return this._defaultSkin},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"defaultAnimation",{get:function(){return this._defaultAnimation},enumerable:!0,configurable:!0}),i}(t.BaseObject);t.ArmatureData=e,__reflect(e.prototype,"dragonBones.ArmatureData");var i=function(e){function i(){var i=e.call(this)||this;return i.transform=new t.Transform,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.BoneData]"},i.prototype._onClear=function(){this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.bendPositive=!1,this.chain=0,this.chainIndex=0,this.weight=0,this.length=0,this.name=null,this.transform.identity(),this.parent=null,this.ik=null,this.userData=null},i}(t.BaseObject);t.BoneData=i,__reflect(i.prototype,"dragonBones.BoneData");var a=function(e){function i(){var t=e.call(this)||this;return t.actions=[],t}return __extends(i,e),i.generateColor=function(){return new t.ColorTransform},i.toString=function(){return"[class dragonBones.SlotData]"},i.prototype._onClear=function(){for(var t=0,e=this.actions.length;e>t;++t)this.actions[t].returnToPool();this.userData&&this.userData.returnToPool(),this.displayIndex=-1,this.zOrder=0,this.blendMode=-1,this.name=null,this.actions.length=0,this.parent=null,this.color=null,this.userData=null},i}(t.BaseObject);a.DEFAULT_COLOR=new t.ColorTransform,t.SlotData=a,__reflect(a.prototype,"dragonBones.SlotData");var n=function(e){function i(){var t=e.call(this)||this;return t.slots={},t}return __extends(i,e),i.toString=function(){return"[class dragonBones.SkinData]"},i.prototype._onClear=function(){for(var t in this.slots)this.slots[t].returnToPool(),delete this.slots[t];this.name=null},i.prototype.addSlot=function(e){if(!e||!e.slot||this.slots[e.slot.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);this.slots[e.slot.name]=e},i.prototype.getSlot=function(t){return this.slots[t]},i}(t.BaseObject);t.SkinData=n,__reflect(n.prototype,"dragonBones.SkinData");var r=function(e){function i(){var t=e.call(this)||this;return t.displays=[],t.meshs={},t}return __extends(i,e),i.toString=function(){return"[class dragonBones.SkinSlotData]"},i.prototype._onClear=function(){for(var t=0,e=this.displays.length;e>t;++t)this.displays[t].returnToPool();for(var i in this.meshs)this.meshs[i].returnToPool(),delete this.meshs[i];this.displays.length=0,this.slot=null},i.prototype.getDisplay=function(t){for(var e=0,i=this.displays.length;i>e;++e){var a=this.displays[e];if(a.name===t)return a}return null},i.prototype.addMesh=function(e){if(!e||!e.name||this.meshs[e.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);this.meshs[e.name]=e},i.prototype.getMesh=function(t){return this.meshs[t]},i}(t.BaseObject);t.SkinSlotData=r,__reflect(r.prototype,"dragonBones.SkinSlotData");var s=function(e){function i(){var i=e.call(this)||this;return i.pivot=new t.Point,i.transform=new t.Transform,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.DisplayData]"},i.prototype._onClear=function(){this.boundingBox&&this.boundingBox.returnToPool(),this.isRelativePivot=!1,this.type=-1,this.inheritAnimation=!0,this.name=null,this.path=null,this.share=null,this.pivot.clear(),this.transform.identity(),this.texture=null,this.armature=null,this.mesh=null,this.boundingBox=null},i}(t.BaseObject);t.DisplayData=s,__reflect(s.prototype,"dragonBones.DisplayData");var o=function(e){function i(){var i=e.call(this)||this;return i.slotPose=new t.Matrix,i.uvs=[],i.vertices=[],i.vertexIndices=[],i.boneIndices=[],i.weights=[],i.boneVertices=[],i.bones=[],i.inverseBindPose=[],i}return __extends(i,e),i.toString=function(){return"[class dragonBones.MeshData]"},i.prototype._onClear=function(){this.skinned=!1,this.name=null,this.slotPose.identity(),this.uvs.length=0,this.vertices.length=0,this.vertexIndices.length=0,this.boneIndices.length=0,this.weights.length=0,this.boneVertices.length=0,this.bones.length=0,this.inverseBindPose.length=0},i}(t.BaseObject);t.MeshData=o,__reflect(o.prototype,"dragonBones.MeshData");var h=function(t){function e(){var e=t.call(this)||this;return e.vertices=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.BoundingBoxData]"},e._computeOutCode=function(t,e,i,a,n,r){var s=0;return i>t?s|=1:t>n&&(s|=2),a>e?s|=4:e>r&&(s|=8),s},e.segmentIntersectsRectangle=function(t,i,a,n,r,s,o,h,l,_,u){void 0===l&&(l=null),void 0===_&&(_=null),void 0===u&&(u=null);var p=t>r&&o>t&&i>s&&h>i,c=a>r&&o>a&&n>s&&h>n;if(p&&c)return-1;for(var d=0,m=e._computeOutCode(t,i,r,s,o,h),f=e._computeOutCode(a,n,r,s,o,h);;){if(!(m|f)){d=2;break}if(m&f)break;var g=0,y=0,v=0,D=m?m:f;4&D?(g=t+(a-t)*(s-i)/(n-i),y=s,u&&(v=.5*-Math.PI)):8&D?(g=t+(a-t)*(h-i)/(n-i),y=h,u&&(v=.5*Math.PI)):2&D?(y=i+(n-i)*(o-t)/(a-t),g=o,u&&(v=0)):1&D&&(y=i+(n-i)*(r-t)/(a-t),g=r,u&&(v=Math.PI)),D===m?(t=g,i=y,m=e._computeOutCode(t,i,r,s,o,h),u&&(u.x=v)):(a=g,n=y,f=e._computeOutCode(a,n,r,s,o,h),u&&(u.y=v))}return d&&(p?(d=2,l&&(l.x=a,l.y=n),_&&(_.x=a,_.y=a),u&&(u.x=u.y+Math.PI)):c?(d=1,l&&(l.x=t,l.y=i),_&&(_.x=t,_.y=i),u&&(u.y=u.x+Math.PI)):(d=3,l&&(l.x=t,l.y=i),_&&(_.x=a,_.y=n))),d},e.segmentIntersectsEllipse=function(t,e,i,a,n,r,s,o,h,l,_){void 0===h&&(h=null),void 0===l&&(l=null),void 0===_&&(_=null);var u=s/o,p=u*u;e*=u,a*=u;var c=i-t,d=a-e,m=Math.sqrt(c*c+d*d),f=c/m,g=d/m,y=(n-t)*f+(r-e)*g,v=y*y,D=t*t+e*e,T=s*s,E=T-D+v,b=0;if(E>=0){var O=Math.sqrt(E),x=y-O,A=y+O,S=0>x?-1:m>=x?0:1,B=0>A?-1:m>=A?0:1,M=S*B;if(0>M)return-1;0===M&&(-1===S?(b=2,i=t+A*f,a=(e+A*g)/u,h&&(h.x=i,h.y=a),l&&(l.x=i,l.y=a),_&&(_.x=Math.atan2(a/T*p,i/T),_.y=_.x+Math.PI)):1===B?(b=1,t+=x*f,e=(e+x*g)/u,h&&(h.x=t,h.y=e),l&&(l.x=t,l.y=e),_&&(_.x=Math.atan2(e/T*p,t/T),_.y=_.x+Math.PI)):(b=3,h&&(h.x=t+x*f,h.y=(e+x*g)/u,_&&(_.x=Math.atan2(h.y/T*p,h.x/T))),l&&(l.x=t+A*f,l.y=(e+A*g)/u,_&&(_.y=Math.atan2(l.y/T*p,l.x/T)))))}return b},e.segmentIntersectsPolygon=function(t,e,i,a,n,r,s,o){void 0===r&&(r=null),void 0===s&&(s=null),void 0===o&&(o=null),t===i&&(t=i+.01),e===a&&(e=a+.01);for(var h=n.length,l=t-i,_=e-a,u=t*a-e*i,p=0,c=n[h-2],d=n[h-1],m=0,f=0,g=0,y=0,v=0,D=0,T=0;h>T;T+=2){var E=n[T],b=n[T+1];c===E&&(c=E+.01),d===b&&(d=b+.01);var O=c-E,x=d-b,A=c*b-d*E,S=l*x-_*O,B=(u*O-l*A)/S;if((B>=c&&E>=B||B>=E&&c>=B)&&(0===l||B>=t&&i>=B||B>=i&&t>=B)){var M=(u*x-_*A)/S;if((M>=d&&b>=M||M>=b&&d>=M)&&(0===_||M>=e&&a>=M||M>=a&&e>=M)){if(!s){g=B,y=M,v=B,D=M,p++,o&&(o.x=Math.atan2(b-d,E-c)-.5*Math.PI,o.y=o.x);break}var P=B-t;0>P&&(P=-P),0===p?(m=P,f=P,g=B,y=M,v=B,D=M,o&&(o.x=Math.atan2(b-d,E-c)-.5*Math.PI,o.y=o.x)):(m>P&&(m=P,g=B,y=M,o&&(o.x=Math.atan2(b-d,E-c)-.5*Math.PI)),P>f&&(f=P,v=B,D=M,o&&(o.y=Math.atan2(b-d,E-c)-.5*Math.PI))),p++}}c=E,d=b}return 1===p?(r&&(r.x=g,r.y=y),s&&(s.x=g,s.y=y),o&&(o.y=o.x+Math.PI)):p>1&&(p++,r&&(r.x=g,r.y=y),s&&(s.x=v,s.y=D)),p},e.prototype._onClear=function(){this.type=-1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0,this.vertices.length=0},e.prototype.containsPoint=function(t,e){var i=!1;if(2===this.type){if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var a=0,n=this.vertices.length,r=n-2;n>a;a+=2){var s=this.vertices[r+1],o=this.vertices[a+1];if(e>o&&s>=e||e>s&&o>=e){var h=this.vertices[r],l=this.vertices[a];t>(e-o)*(h-l)/(s-o)+l&&(i=!i)}r=a}}else{var _=.5*this.width;if(t>=-_&&_>=t){var u=.5*this.height;e>=-u&&u>=e&&(1===this.type?(e*=_/u,i=Math.sqrt(t*t+e*e)<=_):i=!0)}}return i},e.prototype.intersectsSegment=function(t,i,a,n,r,s,o){void 0===r&&(r=null),void 0===s&&(s=null),void 0===o&&(o=null);var h=0;switch(this.type){case 0:var l=.5*this.width,_=.5*this.height;h=e.segmentIntersectsRectangle(t,i,a,n,-l,-_,l,_,r,s,o);break;case 1:h=e.segmentIntersectsEllipse(t,i,a,n,0,0,.5*this.width,.5*this.height,r,s,o);break;case 2:0!==e.segmentIntersectsRectangle(t,i,a,n,this.x,this.y,this.width,this.height,null,null)&&(h=e.segmentIntersectsPolygon(t,i,a,n,this.vertices,r,s,o))}return h},e}(t.BaseObject);t.BoundingBoxData=h,__reflect(h.prototype,"dragonBones.BoundingBoxData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.ints=[],e.floats=[],e.strings=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.CustomData]"},e.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},e.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},e.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},e.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:null},e}(t.BaseObject);t.CustomData=e,__reflect(e.prototype,"dragonBones.CustomData");var i=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.EventData]"},e.prototype._onClear=function(){this.data&&this.data.returnToPool(),this.type=-1,this.name=null,this.bone=null,this.slot=null,this.data=null},e}(t.BaseObject);t.EventData=i,__reflect(i.prototype,"dragonBones.EventData");var a=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.ActionData]"},e.prototype._onClear=function(){this.animationConfig&&this.animationConfig.returnToPool(),this.type=-1,this.bone=null,this.slot=null,this.animationConfig=null},e}(t.BaseObject);t.ActionData=a,__reflect(a.prototype,"dragonBones.ActionData");var n=function(e){function i(){var t=e.call(this)||this;return t.armatures={},t.cachedFrames=[],t._armatureNames=[],t}return __extends(i,e),i.toString=function(){return"[class dragonBones.DragonBonesData]"},i.prototype._onClear=function(){if(t.DragonBones.debug)for(var e=0,i=t.DragonBones._armatures.length;i>e;++e){var a=t.DragonBones._armatures[e];if(a.armatureData.parent===this)throw new Error("The DragonBonesData is being used, please make sure all armature references to the data have been deleted.")}for(var n in this.armatures)this.armatures[n].returnToPool(),delete this.armatures[n];this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version=null,this.name=null,this.cachedFrames.length=0,this.userData=null,this._armatureNames.length=0},i.prototype.addArmature=function(e){if(!e||!e.name||this.armatures[e.name])throw new Error(t.DragonBones.ARGUMENT_ERROR);this.armatures[e.name]=e,this._armatureNames.push(e.name),e.parent=this},i.prototype.getArmature=function(t){return this.armatures[t]},Object.defineProperty(i.prototype,"armatureNames",{get:function(){return this._armatureNames},enumerable:!0,configurable:!0}),i.prototype.dispose=function(){this.returnToPool()},i}(t.BaseObject);t.DragonBonesData=n,__reflect(n.prototype,"dragonBones.DragonBonesData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype._onClear=function(){this.position=0,this.duration=0,this.prev=null,this.next=null},e}(t.BaseObject);t.FrameData=e,__reflect(e.prototype,"dragonBones.FrameData");var i=function(e){function i(){return e.call(this)||this}return __extends(i,e),i._getCurvePoint=function(t,e,i,a,n,r,s,o,h,l){var _=1-h,u=_*_,p=h*h,c=_*u,d=3*h*u,m=3*_*p,f=h*p;l.x=c*t+d*i+m*n+f*s,l.y=c*e+d*a+m*r+f*o},i.samplingEasingCurve=function(e,a){for(var n=e.length,r=new t.Point,s=-2,o=0,h=a.length;h>o;++o){for(var l=(o+1)/(h+1);(n>s+6?e[s+6]:1)<l;)s+=6;for(var _=s>=0&&n>s+6,u=_?e[s]:0,p=_?e[s+1]:0,c=e[s+2],d=e[s+3],m=e[s+4],f=e[s+5],g=_?e[s+6]:1,y=_?e[s+7]:1,v=0,D=1;D-v>.01;){var T=(D+v)/2;i._getCurvePoint(u,p,c,d,m,f,g,y,T,r),l-r.x>0?v=T:D=T}a[o]=r.y}},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.tweenEasing=0,this.curve=null},i}(e);t.TweenFrameData=i,__reflect(i.prototype,"dragonBones.TweenFrameData");var a=function(t){function e(){var e=t.call(this)||this;return e.actions=[],e.events=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.AnimationFrameData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,i=this.actions.length;i>e;++e)this.actions[e].returnToPool();for(var e=0,i=this.events.length;i>e;++e)this.events[e].returnToPool();this.actions.length=0,this.events.length=0},e}(e);t.AnimationFrameData=a,__reflect(a.prototype,"dragonBones.AnimationFrameData");var n=function(t){function e(){var e=t.call(this)||this;return e.zOrder=[],e}return __extends(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.zOrder.length=0},e}(e);t.ZOrderFrameData=n,__reflect(n.prototype,"dragonBones.ZOrderFrameData");var r=function(e){function i(){var i=e.call(this)||this;return i.transform=new t.Transform,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.BoneFrameData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.tweenScale=!1,this.tweenRotate=0,this.transform.identity()},i}(i);t.BoneFrameData=r,__reflect(r.prototype,"dragonBones.BoneFrameData");var s=function(e){function i(){return e.call(this)||this}return __extends(i,e),i.generateColor=function(){return new t.ColorTransform},i.toString=function(){return"[class dragonBones.SlotFrameData]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.displayIndex=0,this.color=null},i}(i);s.DEFAULT_COLOR=new t.ColorTransform,t.SlotFrameData=s,__reflect(s.prototype,"dragonBones.SlotFrameData");var o=function(t){function e(){var e=t.call(this)||this;return e.tweens=[],e}return __extends(e,t),e.toString=function(){return"[class dragonBones.ExtensionFrameData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.tweens.length=0},e}(i);t.ExtensionFrameData=o,__reflect(o.prototype,"dragonBones.ExtensionFrameData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this
}return __extends(e,t),e.prototype._onClear=function(){this.order=0,this.target=null,this.bone=null},e}(t.BaseObject);t.ConstraintData=e,__reflect(e.prototype,"dragonBones.ConstraintData");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bendPositive=!1,this.rotateWeight=1,this.scaleWeight=1,this.parent=null},e}(e);t.IKConstraintData=i,__reflect(i.prototype,"dragonBones.IKConstraintData");var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bendPositive=!1,this.weight=1,this.parent=null},e}(e);t.TransformConstraintData=a,__reflect(a.prototype,"dragonBones.TransformConstraintData")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype._onClear=function(){this.target=null,this.bone=null},e}(t.BaseObject);e._helpPoint=new t.Point,e._helpTransform=new t.Transform,e._helpMatrix=new t.Matrix,t.Constraint=e,__reflect(e.prototype,"dragonBones.Constraint");var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.IKConstraint]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendDir=1,this.weight=1,this.parent=null},e.prototype._updateA=function(t,e,i){var a=t.transform,n=this.bone.global,r=this.target.global,s=(this.bone.globalTransformMatrix,r.x-n.x),o=r.y-n.x,h=Math.atan2(o,s)*e;if(a.skewX+=h,a.skewY+=h,i>0){var l=Math.sqrt(s*s+o*o)/this.bone.boneData.length;a.scaleX*=l}},e.prototype._updateB=function(t,e,i){t.transform,this.parent.global,this.bone.global,this.target.global,this.parent.globalTransformMatrix,this.bone.globalTransformMatrix},e.prototype.update=function(t){},e}(e);t.IKConstraint=i,__reflect(i.prototype,"dragonBones.IKConstraint");var a=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.offset=new t.Transform,i}return __extends(i,e),i.toString=function(){return"[class dragonBones.TransformConstraint]"},i.prototype._onClear=function(){e.prototype._onClear.call(this),this.chainCount=0,this.weightChanging=0,this.positionWeight=1,this.rotationWeight=1,this.scaleWeight=1,this.offset.identity()},i.prototype.update=function(t){},i}(e);t.TransformConstraint=a,__reflect(a.prototype,"dragonBones.TransformConstraint");var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.toString=function(){return"[class dragonBones.PathConstraint]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.chainType=0,this.chainCount=0,this.spacing=0,this.position=0,this.weightChanging=0,this.offsetChanging=0,this.positionWeight=1,this.rotationWeight=1,this.offsetDecrement=0,this.rotationOffset=0,this.normalOffset=0},e.prototype.update=function(t){},e}(e);t.PathConstraint=n,__reflect(n.prototype,"dragonBones.PathConstraint");var r=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.transform=new t.Transform,i.constraints=[],i}return __extends(i,e),i.toString=function(){return"[class dragonBones.ConstraintGroup]"},i.prototype._onClear=function(){this.positionWeight=1,this.rotationWeight=1,this.scaleWeight=1,this.transform.identity(),this.constraints.length=0,this.bone=null},i.prototype.update=function(){this.positionWeight=1,this.rotationWeight=1,this.scaleWeight=1,this.transform.identity();for(var t=this.constraints.length;t--;){var e=this.constraints[t];if(this.bone===e.bone&&!e.update(this))return!1}return!0},i.prototype.isTransformDirty=function(){for(var t=this.constraints.length;t--;){var e=this.constraints[t];if(e.target._childrenTransformDirty)return!0}return!1},i}(t.BaseObject);t.ConstraintGroup=r,__reflect(r.prototype,"dragonBones.ConstraintGroup")}(dragonBones||(dragonBones={}));var dragonBones;!function(t){var e=function(e){function i(){return e.call(this)||this}return __extends(i,e),i._getBoolean=function(t,e,i){if(e in t){var a=t[e],n=typeof a;if("boolean"===n)return a;if("string"!==n)return!!a;switch(a){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return i},i._getNumber=function(t,e,i){if(e in t){var a=t[e];return null==a||"NaN"===a?i:+a||0}return i},i._getString=function(t,e,i){return e in t?String(t[e]):i},i.prototype._parseArmature=function(e,a){var n=t.BaseObject.borrowObject(t.ArmatureData);if(n.isRightTransform=i.DATA_VERSIONS.indexOf(this._data.version)>i.DATA_VERSIONS.indexOf(i.DATA_VERSION_4_5),n.name=i._getString(e,i.NAME,null),n.frameRate=i._getNumber(e,i.FRAME_RATE,this._data.frameRate),n.scale=a,0===n.frameRate&&(n.frameRate=24),i.TYPE in e&&"string"==typeof e[i.TYPE]?n.type=i._getArmatureType(e[i.TYPE]):n.type=i._getNumber(e,i.TYPE,0),this._armature=n,this._rawBones.length=0,i.AABB in e){var r=e[i.AABB];n.aabb.x=i._getNumber(r,i.X,0),n.aabb.y=i._getNumber(r,i.Y,0),n.aabb.width=i._getNumber(r,i.WIDTH,0),n.aabb.height=i._getNumber(r,i.HEIGHT,0)}if(i.BONE in e)for(var s=e[i.BONE],o=0,h=s.length;h>o;++o){var l=s[o],_=this._parseBone(l);n.addBone(_,i._getString(l,i.PARENT,null)),this._rawBones.push(_)}if(i.IK in e)for(var u=e[i.IK],o=0,h=u.length;h>o;++o)this._parseIK(u[o]);if(i.SLOT in e)for(var p=e[i.SLOT],c=0,o=0,h=p.length;h>o;++o)n.addSlot(this._parseSlot(p[o],c++));if(i.SKIN in e)for(var d=e[i.SKIN],o=0,h=d.length;h>o;++o)n.addSkin(this._parseSkin(d[o]));if(i.ANIMATION in e)for(var m=e[i.ANIMATION],o=0,h=m.length;h>o;++o)n.addAnimation(this._parseAnimation(m[o]));return(i.ACTIONS in e||i.DEFAULT_ACTIONS in e)&&this._parseActionData(e,n.actions,null,null),this._isOldData&&this._isGlobalTransform&&this._globalToLocal(n),this._armature=null,this._rawBones.length=0,n},i.prototype._parseBone=function(e){var a=t.BaseObject.borrowObject(t.BoneData);return a.inheritTranslation=i._getBoolean(e,i.INHERIT_TRANSLATION,!0),a.inheritRotation=i._getBoolean(e,i.INHERIT_ROTATION,!0),a.inheritScale=i._getBoolean(e,i.INHERIT_SCALE,!0),a.inheritReflection=i._getBoolean(e,i.INHERIT_REFLECTION,!0),a.length=i._getNumber(e,i.LENGTH,0)*this._armature.scale,a.name=i._getString(e,i.NAME,null),i.TRANSFORM in e&&this._parseTransform(e[i.TRANSFORM],a.transform),this._isOldData&&(a.inheritScale=!1),a},i.prototype._parseIK=function(t){var e=this._armature.getBone(i._getString(t,i.BONE in t?i.BONE:i.NAME,null));e&&(e.bendPositive=i._getBoolean(t,i.BEND_POSITIVE,!0),e.chain=i._getNumber(t,i.CHAIN,0),e.weight=i._getNumber(t,i.WEIGHT,1),e.ik=this._armature.getBone(i._getString(t,i.TARGET,null)),e.chain>0&&e.parent&&!e.parent.ik?(e.parent.ik=e.ik,e.parent.chainIndex=0,e.parent.chain=0,e.chainIndex=1):(e.chain=0,e.chainIndex=0))},i.prototype._parseSlot=function(e,a){var n=t.BaseObject.borrowObject(t.SlotData);return n.displayIndex=i._getNumber(e,i.DISPLAY_INDEX,0),n.zOrder=i._getNumber(e,i.Z,a),n.name=i._getString(e,i.NAME,null),n.parent=this._armature.getBone(i._getString(e,i.PARENT,null)),i.COLOR in e||i.COLOR_TRANSFORM in e?(n.color=t.SlotData.generateColor(),this._parseColorTransform(e[i.COLOR]||e[i.COLOR_TRANSFORM],n.color)):n.color=t.SlotData.DEFAULT_COLOR,i.BLEND_MODE in e&&"string"==typeof e[i.BLEND_MODE]?n.blendMode=i._getBlendMode(e[i.BLEND_MODE]):n.blendMode=i._getNumber(e,i.BLEND_MODE,0),(i.ACTIONS in e||i.DEFAULT_ACTIONS in e)&&this._parseActionData(e,n.actions,null,null),this._isOldData&&(i.COLOR_TRANSFORM in e?(n.color=t.SlotData.generateColor(),this._parseColorTransform(e[i.COLOR_TRANSFORM],n.color)):n.color=t.SlotData.DEFAULT_COLOR),n},i.prototype._parseSkin=function(e){var a=t.BaseObject.borrowObject(t.SkinData);if(a.name=i._getString(e,i.NAME,i.DEFAULT_NAME),a.name||(a.name=i.DEFAULT_NAME),i.SLOT in e){this._skin=a;for(var n=e[i.SLOT],r=0,s=0,o=n.length;o>s;++s)this._isOldData&&this._armature.addSlot(this._parseSlot(n[s],r++)),a.addSlot(this._parseSkinSlotData(n[s]));this._skin=null}return a},i.prototype._parseSkinSlotData=function(e){var a=t.BaseObject.borrowObject(t.SkinSlotData);if(a.slot=this._armature.getSlot(i._getString(e,i.NAME,null)),i.DISPLAY in e){var n=e[i.DISPLAY];this._skinSlotData=a;for(var r=0,s=n.length;s>r;++r)a.displays.push(this._parseDisplay(n[r]));this._skinSlotData=null}return a},i.prototype._parseDisplay=function(e){var a=t.BaseObject.borrowObject(t.DisplayData);if(a.inheritAnimation=i._getBoolean(e,i.INHERIT_ANIMATION,!0),a.name=i._getString(e,i.NAME,null),a.path=i._getString(e,i.PATH,a.name),i.TYPE in e&&"string"==typeof e[i.TYPE]?a.type=i._getDisplayType(e[i.TYPE]):a.type=i._getNumber(e,i.TYPE,0),a.isRelativePivot=!0,i.PIVOT in e){var n=e[i.PIVOT];a.pivot.x=i._getNumber(n,i.X,0),a.pivot.y=i._getNumber(n,i.Y,0)}else if(this._isOldData){var r=e[i.TRANSFORM];a.isRelativePivot=!1,a.pivot.x=i._getNumber(r,i.PIVOT_X,0)*this._armature.scale,a.pivot.y=i._getNumber(r,i.PIVOT_Y,0)*this._armature.scale}else a.pivot.x=.5,a.pivot.y=.5;switch(i.TRANSFORM in e&&this._parseTransform(e[i.TRANSFORM],a.transform),a.type){case 0:break;case 1:break;case 2:a.share=i._getString(e,i.SHARE,null),a.share||(a.inheritAnimation=i._getBoolean(e,i.INHERIT_FFD,!0),a.mesh=this._parseMesh(e),this._skinSlotData.addMesh(a.mesh));break;case 3:a.boundingBox=this._parseBoundingBox(e)}return a},i.prototype._parseMesh=function(e){var a=t.BaseObject.borrowObject(t.MeshData),n=e[i.VERTICES],r=e[i.UVS],s=e[i.TRIANGLES],o=Math.floor(n.length/2),h=Math.floor(s.length/3),l=new Array(this._armature.sortedBones.length);if(a.skinned=i.WEIGHTS in e&&e[i.WEIGHTS].length>0,a.name=i._getString(e,i.NAME,null),a.uvs.length=2*o,a.vertices.length=2*o,a.vertexIndices.length=3*h,a.skinned){if(a.boneIndices.length=o,a.weights.length=o,a.boneVertices.length=o,i.SLOT_POSE in e){var _=e[i.SLOT_POSE];a.slotPose.a=_[0],a.slotPose.b=_[1],a.slotPose.c=_[2],a.slotPose.d=_[3],a.slotPose.tx=_[4]*this._armature.scale,a.slotPose.ty=_[5]*this._armature.scale}if(i.BONE_POSE in e)for(var u=e[i.BONE_POSE],p=0,c=u.length;c>p;p+=7){var d=u[p],m=l[d]=new t.Matrix;m.a=u[p+1],m.b=u[p+2],m.c=u[p+3],m.d=u[p+4],m.tx=u[p+5]*this._armature.scale,m.ty=u[p+6]*this._armature.scale,m.invert()}}for(var p=0,f=0,c=n.length;c>p;p+=2){var g=p+1,y=p/2,v=a.vertices[p]=n[p]*this._armature.scale,D=a.vertices[g]=n[g]*this._armature.scale;if(a.uvs[p]=r[p],a.uvs[g]=r[g],a.skinned){var T=e[i.WEIGHTS],E=T[f],b=a.boneIndices[y]=new Array(E),O=a.weights[y]=new Array(E),x=a.boneVertices[y]=new Array(2*E);a.slotPose.transformPoint(v,D,this._helpPoint),v=a.vertices[p]=this._helpPoint.x,D=a.vertices[g]=this._helpPoint.y;for(var A=0;E>A;++A){var S=f+1+2*A,d=T[S],B=this._rawBones[d],M=a.bones.indexOf(B);0>M&&(M=a.bones.length,a.bones[M]=B,a.inverseBindPose[M]=l[d]),a.inverseBindPose[M].transformPoint(v,D,this._helpPoint),b[A]=M,O[A]=T[S+1],x[2*A]=this._helpPoint.x,x[2*A+1]=this._helpPoint.y}f+=2*E+1}}for(var p=0,c=s.length;c>p;++p)a.vertexIndices[p]=s[p];return a},i.prototype._parseBoundingBox=function(e){var a=t.BaseObject.borrowObject(t.BoundingBoxData);switch(i.SUB_TYPE in e&&"string"==typeof e[i.SUB_TYPE]?a.type=i._getBoundingBoxType(e[i.SUB_TYPE]):a.type=i._getNumber(e,i.SUB_TYPE,0),a.color=i._getNumber(e,i.COLOR,0),a.type){case 0:case 1:a.width=i._getNumber(e,i.WIDTH,0),a.height=i._getNumber(e,i.HEIGHT,0);break;case 2:if(i.VERTICES in e){var n=e[i.VERTICES];a.vertices.length=n.length;for(var r=0,s=a.vertices.length;s>r;r+=2){var o=r+1,h=n[r],l=n[o];a.vertices[r]=h,a.vertices[o]=l,0===r?(a.x=h,a.y=l,a.width=h,a.height=l):(h<a.x?a.x=h:h>a.width&&(a.width=h),l<a.y?a.y=l:l>a.height&&(a.height=l))}}}return a},i.prototype._parseAnimation=function(e){var a=t.BaseObject.borrowObject(t.AnimationData);if(a.frameCount=Math.max(i._getNumber(e,i.DURATION,1),1),a.playTimes=i._getNumber(e,i.PLAY_TIMES,1),a.duration=a.frameCount/this._armature.frameRate,a.fadeInTime=i._getNumber(e,i.FADE_IN_TIME,0),a.name=i._getString(e,i.NAME,i.DEFAULT_NAME),a.name||(a.name=i.DEFAULT_NAME),this._animation=a,this._parseTimeline(e,a,this._parseAnimationFrame),i.Z_ORDER in e&&(a.zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineData),this._parseTimeline(e[i.Z_ORDER],a.zOrderTimeline,this._parseZOrderFrame)),i.BONE in e)for(var n=e[i.BONE],r=0,s=n.length;s>r;++r)a.addBoneTimeline(this._parseBoneTimeline(n[r]));if(i.SLOT in e)for(var o=e[i.SLOT],r=0,s=o.length;s>r;++r)a.addSlotTimeline(this._parseSlotTimeline(o[r]));if(i.FFD in e)for(var h=e[i.FFD],r=0,s=h.length;s>r;++r)a.addFFDTimeline(this._parseFFDTimeline(h[r]));if(this._isOldData){if(this._isAutoTween=i._getBoolean(e,i.AUTO_TWEEN,!0),this._animationTweenEasing=i._getNumber(e,i.TWEEN_EASING,0)||0,a.playTimes=i._getNumber(e,i.LOOP,1),i.TIMELINE in e)for(var l=e[i.TIMELINE],r=0,s=l.length;s>r;++r){var _=l[r];a.addBoneTimeline(this._parseBoneTimeline(_)),a.addSlotTimeline(this._parseSlotTimeline(_))}}else this._isAutoTween=!1,this._animationTweenEasing=0;for(var r in this._armature.bones){var u=this._armature.bones[r];if(!a.getBoneTimeline(u.name)){var p=t.BaseObject.borrowObject(t.BoneTimelineData),c=t.BaseObject.borrowObject(t.BoneFrameData);p.bone=u,p.frames[0]=c,a.addBoneTimeline(p)}}for(var r in this._armature.slots){var d=this._armature.slots[r];if(!a.getSlotTimeline(d.name)){var m=t.BaseObject.borrowObject(t.SlotTimelineData),f=t.BaseObject.borrowObject(t.SlotFrameData);m.slot=d,f.displayIndex=d.displayIndex,d.color===t.SlotData.DEFAULT_COLOR?f.color=t.SlotFrameData.DEFAULT_COLOR:(f.color=t.SlotFrameData.generateColor(),f.color.copyFrom(d.color)),m.frames[0]=f,a.addSlotTimeline(m),this._isOldData&&(f.displayIndex=-1)}}return this._animation=null,a},i.prototype._parseBoneTimeline=function(e){var a=t.BaseObject.borrowObject(t.BoneTimelineData);a.bone=this._armature.getBone(i._getString(e,i.NAME,null)),this._parseTimeline(e,a,this._parseBoneFrame);for(var n=a.originalTransform,r=null,s=0,o=a.frames.length;o>s;++s){var h=a.frames[s];r?r!==h&&h.transform.minus(n):(n.copyFrom(h.transform),h.transform.identity(),0===n.scaleX&&(n.scaleX=.001),0===n.scaleY&&(n.scaleY=.001)),r=h}return this._isOldData&&(i.PIVOT_X in e||i.PIVOT_Y in e)?(this._timelinePivot.x=i._getNumber(e,i.PIVOT_X,0)*this._armature.scale,this._timelinePivot.y=i._getNumber(e,i.PIVOT_Y,0)*this._armature.scale):this._timelinePivot.clear(),a},i.prototype._parseSlotTimeline=function(e){var a=t.BaseObject.borrowObject(t.SlotTimelineData);return a.slot=this._armature.getSlot(i._getString(e,i.NAME,null)),this._parseTimeline(e,a,this._parseSlotFrame),a},i.prototype._parseFFDTimeline=function(e){var a=t.BaseObject.borrowObject(t.FFDTimelineData);a.skin=this._armature.getSkin(i._getString(e,i.SKIN,null)),a.slot=a.skin.getSlot(i._getString(e,i.SLOT,null));for(var n=i._getString(e,i.NAME,null),r=0,s=a.slot.displays.length;s>r;++r){var o=a.slot.displays[r];if(o.mesh&&o.name===n){a.display=o;break}}return this._parseTimeline(e,a,this._parseFFDFrame),a},i.prototype._parseAnimationFrame=function(e,a,n){var r=t.BaseObject.borrowObject(t.AnimationFrameData);return this._parseFrame(e,r,a,n),(i.ACTION in e||i.ACTIONS in e)&&this._parseActionData(e,r.actions,null,null),(i.EVENTS in e||i.EVENT in e||i.SOUND in e)&&this._parseEventData(e,r.events,null,null),r},i.prototype._parseZOrderFrame=function(e,a,n){var r=t.BaseObject.borrowObject(t.ZOrderFrameData);this._parseFrame(e,r,a,n);var s=e[i.Z_ORDER];if(s&&s.length>0){var o=this._armature.sortedSlots.length,h=new Array(o-s.length/2);r.zOrder.length=o;for(var l=0;o>l;++l)r.zOrder[l]=-1;for(var _=0,u=0,p=0,c=s.length;c>p;p+=2){for(var d=s[p],m=s[p+1];_!==d;)h[u++]=_++;r.zOrder[_+m]=_++}for(;o>_;)h[u++]=_++;for(var f=o;f--;)-1===r.zOrder[f]&&(r.zOrder[f]=h[--u])}return r},i.prototype._parseBoneFrame=function(e,a,n){var r=t.BaseObject.borrowObject(t.BoneFrameData);if(r.tweenRotate=i._getNumber(e,i.TWEEN_ROTATE,0),r.tweenScale=i._getBoolean(e,i.TWEEN_SCALE,!0),this._parseTweenFrame(e,r,a,n),i.TRANSFORM in e){var s=e[i.TRANSFORM];this._parseTransform(s,r.transform),this._isOldData&&(this._helpPoint.x=this._timelinePivot.x+i._getNumber(s,i.PIVOT_X,0)*this._armature.scale,this._helpPoint.y=this._timelinePivot.y+i._getNumber(s,i.PIVOT_Y,0)*this._armature.scale,r.transform.toMatrix(this._helpMatrix),this._helpMatrix.transformPoint(this._helpPoint.x,this._helpPoint.y,this._helpPoint,!0),r.transform.x+=this._helpPoint.x,r.transform.y+=this._helpPoint.y)}var o=this._timeline.bone,h=new Array,l=new Array;if(i.ACTION in e||i.ACTIONS in e){var _=this._armature.getSlot(o.name);this._parseActionData(e,h,o,_)}return(i.EVENT in e||i.SOUND in e)&&this._parseEventData(e,l,o,null),(h.length>0||l.length>0)&&this._mergeFrameToAnimationTimeline(r.position,h,l),r},i.prototype._parseSlotFrame=function(e,a,n){var r=t.BaseObject.borrowObject(t.SlotFrameData);if(r.displayIndex=i._getNumber(e,i.DISPLAY_INDEX,0),this._parseTweenFrame(e,r,a,n),i.COLOR in e||i.COLOR_TRANSFORM in e?(r.color=t.SlotFrameData.generateColor(),this._parseColorTransform(e[i.COLOR]||e[i.COLOR_TRANSFORM],r.color)):r.color=t.SlotFrameData.DEFAULT_COLOR,this._isOldData)i._getBoolean(e,i.HIDE,!1)&&(r.displayIndex=-1);else if(i.ACTION in e||i.ACTIONS in e){var s=this._timeline.slot,o=new Array;this._parseActionData(e,o,s.parent,s),this._mergeFrameToAnimationTimeline(r.position,o,null)}return r},i.prototype._parseFFDFrame=function(e,a,n){var r=this._timeline,s=r.display.mesh,o=t.BaseObject.borrowObject(t.ExtensionFrameData);this._parseTweenFrame(e,o,a,n);for(var h=e[i.VERTICES],l=i._getNumber(e,i.OFFSET,0),_=0,u=0,p=0,c=s.vertices.length;c>p;p+=2)if(!h||l>p||p-l>=h.length?(_=0,u=0):(_=h[p-l]*this._armature.scale,u=h[p+1-l]*this._armature.scale),s.skinned){s.slotPose.transformPoint(_,u,this._helpPoint,!0),_=this._helpPoint.x,u=this._helpPoint.y;for(var d=s.boneIndices[p/2],m=0,f=d.length;f>m;++m){var g=d[m];s.inverseBindPose[g].transformPoint(_,u,this._helpPoint,!0),o.tweens.push(this._helpPoint.x,this._helpPoint.y)}}else o.tweens.push(_,u);return o},i.prototype._parseTweenFrame=function(e,a,n,r){this._parseFrame(e,a,n,r),a.duration>0?(i.TWEEN_EASING in e?a.tweenEasing=i._getNumber(e,i.TWEEN_EASING,t.DragonBones.NO_TWEEN):this._isOldData?a.tweenEasing=this._isAutoTween?this._animationTweenEasing:t.DragonBones.NO_TWEEN:a.tweenEasing=t.DragonBones.NO_TWEEN,this._isOldData&&1===this._animation.scale&&1===this._timeline.scale&&a.duration*this._armature.frameRate<2&&(a.tweenEasing=t.DragonBones.NO_TWEEN),r>0&&i.CURVE in e&&(a.curve=new Array(2*r-1),t.TweenFrameData.samplingEasingCurve(e[i.CURVE],a.curve))):(a.tweenEasing=t.DragonBones.NO_TWEEN,a.curve=null)},i.prototype._parseFrame=function(t,e,i,a){e.position=i/this._armature.frameRate,e.duration=a/this._armature.frameRate},i.prototype._parseTimeline=function(e,a,n){if(a.scale=i._getNumber(e,i.SCALE,1),a.offset=i._getNumber(e,i.OFFSET,0),this._timeline=a,i.FRAME in e){var r=e[i.FRAME];if(1===r.length)a.frames.length=1,a.frames[0]=n.call(this,r[0],0,i._getNumber(r[0],i.DURATION,1));else if(r.length>1){a.frames.length=this._animation.frameCount+1;for(var s=0,o=0,h=null,l=null,_=0,u=0,p=a.frames.length;p>_;++_){if(_>=s+o&&u<r.length){var c=r[u++];s=_,o=i._getNumber(c,i.DURATION,1),h=n.call(this,c,s,o),l&&(l.next=h,h.prev=l,this._isOldData&&l instanceof t.TweenFrameData&&-1===i._getNumber(c,i.DISPLAY_INDEX,0)&&(l.tweenEasing=t.DragonBones.NO_TWEEN)),l=h}a.frames[_]=h}h.duration=this._animation.duration-h.position,h=a.frames[0],l.next=h,h.prev=l,this._isOldData&&l instanceof t.TweenFrameData&&-1===i._getNumber(r[0],i.DISPLAY_INDEX,0)&&(l.tweenEasing=t.DragonBones.NO_TWEEN)}}this._timeline=null},i.prototype._parseActionData=function(e,a,n,r){var s=e[i.ACTION]||e[i.ACTIONS]||e[i.DEFAULT_ACTIONS];if("string"==typeof s){var o=t.BaseObject.borrowObject(t.ActionData);o.type=0,o.bone=n,o.slot=r,o.animationConfig=t.BaseObject.borrowObject(t.AnimationConfig),o.animationConfig.animation=s,a.push(o)}else if(s instanceof Array)for(var h=0,l=s.length;l>h;++h){var _=s[h],u=_ instanceof Array,o=t.BaseObject.borrowObject(t.ActionData),p=u?_[1]:i._getString(_,"gotoAndPlay",null);if(u){var c=_[0];"string"==typeof c?o.type=i._getActionType(c):o.type=c}else o.type=0;switch(o.type){case 0:o.animationConfig=t.BaseObject.borrowObject(t.AnimationConfig),o.animationConfig.animation=p}o.bone=n,o.slot=r,a.push(o)}},i.prototype._parseEventData=function(e,a,n,r){if(i.SOUND in e){var s=t.BaseObject.borrowObject(t.EventData);s.type=11,s.name=i._getString(e,i.SOUND,null),s.bone=n,s.slot=r,a.push(s)}if(i.EVENT in e){var o=t.BaseObject.borrowObject(t.EventData);o.type=10,o.name=i._getString(e,i.EVENT,null),o.bone=n,o.slot=r,a.push(o)}if(i.EVENTS in e)for(var h=e[i.EVENTS],l=0,_=h.length;_>l;++l){var u=h[l],p=i._getString(u,i.BONE,null),c=i._getString(u,i.SLOT,null),o=t.BaseObject.borrowObject(t.EventData);if(o.type=10,o.name=i._getString(u,i.NAME,null),o.bone=this._armature.getBone(p),o.slot=this._armature.getSlot(c),i.INTS in u){o.data||(o.data=t.BaseObject.borrowObject(t.CustomData));for(var d=u[i.INTS],m=0,f=d.length;f>m;++m)o.data.ints.push(d[m])}if(i.FLOATS in u){o.data||(o.data=t.BaseObject.borrowObject(t.CustomData));for(var g=u[i.FLOATS],y=0,v=g.length;v>y;++y)o.data.floats.push(g[y])}if(i.STRINGS in u){o.data||(o.data=t.BaseObject.borrowObject(t.CustomData));for(var D=u[i.STRINGS],T=0,E=D.length;E>T;++T)o.data.strings.push(D[T])}a.push(o)}},i.prototype._parseTransform=function(e,a){a.x=i._getNumber(e,i.X,0)*this._armature.scale,a.y=i._getNumber(e,i.Y,0)*this._armature.scale,a.skewX=t.Transform.normalizeRadian(i._getNumber(e,i.SKEW_X,0)*t.DragonBones.ANGLE_TO_RADIAN),a.skewY=t.Transform.normalizeRadian(i._getNumber(e,i.SKEW_Y,0)*t.DragonBones.ANGLE_TO_RADIAN),a.scaleX=i._getNumber(e,i.SCALE_X,1),a.scaleY=i._getNumber(e,i.SCALE_Y,1)},i.prototype._parseColorTransform=function(t,e){e.alphaMultiplier=.01*i._getNumber(t,i.ALPHA_MULTIPLIER,100),e.redMultiplier=.01*i._getNumber(t,i.RED_MULTIPLIER,100),e.greenMultiplier=.01*i._getNumber(t,i.GREEN_MULTIPLIER,100),e.blueMultiplier=.01*i._getNumber(t,i.BLUE_MULTIPLIER,100),e.alphaOffset=i._getNumber(t,i.ALPHA_OFFSET,0),e.redOffset=i._getNumber(t,i.RED_OFFSET,0),e.greenOffset=i._getNumber(t,i.GREEN_OFFSET,0),e.blueOffset=i._getNumber(t,i.BLUE_OFFSET,0)},i.prototype.parseDragonBonesData=function(e,a){if(void 0===a&&(a=1),e){var n=i._getString(e,i.VERSION,null),r=i._getString(e,i.COMPATIBLE_VERSION,null);if(this._isOldData=n===i.DATA_VERSION_2_3||n===i.DATA_VERSION_3_0,this._isOldData?this._isGlobalTransform=i._getBoolean(e,i.IS_GLOBAL,!0):this._isGlobalTransform=!1,i.DATA_VERSIONS.indexOf(n)>=0||i.DATA_VERSIONS.indexOf(r)>=0){var s=t.BaseObject.borrowObject(t.DragonBonesData);if(s.version=n,s.name=i._getString(e,i.NAME,null),s.frameRate=i._getNumber(e,i.FRAME_RATE,24),0===s.frameRate&&(s.frameRate=24),i.ARMATURE in e){this._data=s;for(var o=e[i.ARMATURE],h=0,l=o.length;l>h;++h)s.addArmature(this._parseArmature(o[h],a));this._data=null}return s}throw new Error("Nonsupport data version.")}throw new Error(t.DragonBones.ARGUMENT_ERROR)},i.prototype.parseTextureAtlasData=function(e,a,n){if(void 0===n&&(n=0),!e)throw new Error(t.DragonBones.ARGUMENT_ERROR);if(a.name=i._getString(e,i.NAME,null),a.imagePath=i._getString(e,i.IMAGE_PATH,null),a.width=i._getNumber(e,i.WIDTH,0),a.height=i._getNumber(e,i.HEIGHT,0),n>0?a.scale=n:n=a.scale=i._getNumber(e,i.SCALE,a.scale),n=1/n,i.SUB_TEXTURE in e)for(var r=e[i.SUB_TEXTURE],s=0,o=r.length;o>s;++s){var h=r[s],l=a.generateTexture();l.name=i._getString(h,i.NAME,null),l.rotated=i._getBoolean(h,i.ROTATED,!1),l.region.x=i._getNumber(h,i.X,0)*n,l.region.y=i._getNumber(h,i.Y,0)*n,l.region.width=i._getNumber(h,i.WIDTH,0)*n,l.region.height=i._getNumber(h,i.HEIGHT,0)*n;var _=i._getNumber(h,i.FRAME_WIDTH,-1),u=i._getNumber(h,i.FRAME_HEIGHT,-1);_>0&&u>0&&(l.frame=t.TextureData.generateRectangle(),l.frame.x=i._getNumber(h,i.FRAME_X,0)*n,l.frame.y=i._getNumber(h,i.FRAME_Y,0)*n,l.frame.width=_*n,l.frame.height=u*n),a.addTexture(l)}},i.getInstance=function(){return i._instance||(i._instance=new i),i._instance},i}(t.DataParser);e._instance=null,t.ObjectDataParser=e,__reflect(e.prototype,"dragonBones.ObjectDataParser")}(dragonBones||(dragonBones={}));var animation;!function(t){function e(t,e,i){void 0===i&&(i=!1);var a=RES.getRes(t);if(!a)throw new Error("No data named: "+t);var n=[],r=[];if(e instanceof Array)for(var s=0,h=e.length;h>s;++s){var l=e[s],_=RES.getRes(l);if(!_)throw new Error("No texture named: "+l);n.push(_),r.push(l)}else{var _=RES.getRes(e);if(!_)throw new Error("No texture named: "+e);n.push(_),r.push(e)}o[t]={name:t,textureResources:r,textures:n},dragonBones.addMovieGroup(a,n,i?t:null)}function i(t){dragonBones.removeMovieGroup(t);var e=o[t];if(e){for(var i=0,a=e.textures.length;a>i;++i)e.textures[i].dispose();for(var i=0,a=e.textureResources.length;a>i;++i)RES.destroyRes(e.textureResources[i]);RES.destroyRes(e.name)}}function a(t,e){void 0===e&&(e=null);var i=dragonBones.buildMovie(t,e);return i&&(i._play=i.play,i.play=s),i}function n(t){return dragonBones.getMovieNames(t)}function r(){return dragonBones.EgretFactory.factory.soundEventManager}function s(t,e){return void 0===t&&(t=null),void 0===e&&(e=-1),this._play(t,e),h}var o={};t.addGroup=e,t.removeGroup=i,t.createAnimation=a,t.getAnimationNames=n,t.getSoundEventManager=r;var h={}}(animation||(animation={}));