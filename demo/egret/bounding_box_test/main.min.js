"use strict";function enableDrag(t){t&&(t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,_dragHandler,t),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,_dragHandler,t),t.addEventListener(egret.TouchEvent.TOUCH_END,_dragHandler,t))}function disableDrag(t){t&&(t.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,_dragHandler,t),t.removeEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,_dragHandler,t),t.removeEventListener(egret.TouchEvent.TOUCH_END,_dragHandler,t))}function _dragHandler(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:if(dragTarget)return;dragTarget=t.target,dragTarget.parent.globalToLocal(t.stageX,t.stageY,_helpPoint),_dragOffset.x=dragTarget.x-_helpPoint.x,_dragOffset.y=dragTarget.y-_helpPoint.y,dragTarget.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,_dragHandler,dragTarget);break;case egret.TouchEvent.TOUCH_RELEASE_OUTSIDE:case egret.TouchEvent.TOUCH_END:dragTarget&&(dragTarget.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,_dragHandler,dragTarget),dragTarget=null);break;case egret.TouchEvent.TOUCH_MOVE:dragTarget&&(dragTarget.parent.globalToLocal(t.stageX,t.stageY,_helpPoint),dragTarget.x=_helpPoint.x+_dragOffset.x,dragTarget.y=_helpPoint.y+_dragOffset.y)}}var __reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function s(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}(),BaseTest=function(t){function e(){var e=t.call(this)||this;return e._loadCount=0,e._background=new egret.Shape,e._resources=[],e._resourceMap={},e.addEventListener(egret.Event.ADDED_TO_STAGE,function(){e._background.graphics.beginFill(6710886),e._background.graphics.drawRect(0,0,e.stage.stageWidth,e.stage.stageHeight),e.addChild(e._background),e._loadResources()},e),e}return __extends(e,t),e.prototype._loadResources=function(){var t=this;this._loadCount=this._resources.length;for(var e=0,a=this._resources;e<a.length;e++){var s=a[e];RES.getResByUrl(s,function(e,a){t._resourceMap[a]=e,t._loadCount--,0===t._loadCount&&(RES.getRes=function(e){return t._resourceMap[e]},t._onStart())},this,s.indexOf(".dbbin")>0?RES.ResourceItem.TYPE_BIN:null)}},e.prototype.createText=function(t){var e=new egret.TextField;return e.size=20,e.textAlign=egret.HorizontalAlign.CENTER,e.text=t,e.width=this.stageWidth,e.x=0,e.y=this.stageHeight-60,this.addChild(e),e},Object.defineProperty(e.prototype,"stageWidth",{get:function(){return this.stage.stageWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stageHeight",{get:function(){return this.stage.stageHeight},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(BaseTest.prototype,"BaseTest");var SetBoneOffset=function(t){function e(){var e=t.call(this)||this;return e._resources.push("resource/assets/effect_ske.json","resource/assets/effect_tex.json","resource/assets/effect_tex.png"),e}return __extends(e,t),e.prototype._onStart=function(){var t=dragonBones.EgretFactory.factory;t.parseDragonBonesData(RES.getRes("resource/assets/effect_ske.json")),t.parseTextureAtlasData(RES.getRes("resource/assets/effect_tex.json"),RES.getRes("resource/assets/effect_tex.png"));for(var e=0;100>e;++e){var a=t.buildArmatureDisplay("effect");a.addEventListener(dragonBones.EventObject.COMPLETE,this._animationHandler,this),this._moveTo(a),this.addChild(a)}},e.prototype._animationHandler=function(t){this._moveTo(t.eventObject.armature.display)},e.prototype._moveTo=function(t){var e=Math.random()*this.stageWidth,a=Math.random()*this.stageHeight,s=Math.random()*this.stageWidth,i=Math.random()*this.stageHeight,r=s-e,n=i-a,o=t.armature.getBone("root"),_=t.armature.getBone("effect");o.offset.scaleX=Math.sqrt(r*r+n*n)/100,o.offset.rotation=Math.atan2(n,r),o.offset.skew=Math.random()*Math.PI-.5*Math.PI,_.offset.scaleX=.5+.5*Math.random(),_.offset.scaleY=.5+.5*Math.random(),o.invalidUpdate(),_.invalidUpdate(),t.x=e,t.y=a,t.animation.timeScale=.5+1*Math.random(),t.animation.play("idle",1)},e}(BaseTest);__reflect(SetBoneOffset.prototype,"SetBoneOffset");var dragTarget=null,_helpPoint=new egret.Point,_dragOffset=new egret.Point,AnimationBaseTest=function(t){function e(){var e=t.call(this)||this;return e._resources.push("resource/assets/animation_base_test_ske.json","resource/assets/animation_base_test_tex.json","resource/assets/animation_base_test_tex.png"),e}return __extends(e,t),e.prototype._onStart=function(){var t=dragonBones.EgretFactory.factory;t.parseDragonBonesData(RES.getRes("resource/assets/animation_base_test_ske.json")),t.parseTextureAtlasData(RES.getRes("resource/assets/animation_base_test_tex.json"),RES.getRes("resource/assets/animation_base_test_tex.png")),this._armatureDisplay=t.buildArmatureDisplay("progressBar"),this._armatureDisplay.x=.5*this.stageWidth,this._armatureDisplay.y=.5*this.stageHeight,this._armatureDisplay.scaleX=this._armatureDisplay.scaleY=this.stageWidth>=300?1:this.stageWidth/330,this.addChild(this._armatureDisplay),this._armatureDisplay.addEventListener(dragonBones.EventObject.START,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.LOOP_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FRAME_EVENT,this._animationEventHandler,this),this._armatureDisplay.animation.play("idle"),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this._touchHandler,this),this.createText("Click to control animation play progress.")},e.prototype._touchHandler=function(t){var e=Math.min(Math.max((t.stageX-this._armatureDisplay.x+300*this._armatureDisplay.scaleX)/600*this._armatureDisplay.scaleX,0),1);switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:this._armatureDisplay.animation.gotoAndStopByProgress("idle",e);break;case egret.TouchEvent.TOUCH_END:this._armatureDisplay.animation.play();break;case egret.TouchEvent.TOUCH_MOVE:if(t.touchDown){var a=this._armatureDisplay.animation.getState("idle");a&&(a.currentTime=a.totalTime*e)}}},e.prototype._animationEventHandler=function(t){console.log(t.eventObject.animationState.name,t.type,t.eventObject.name||"")},e}(BaseTest);__reflect(AnimationBaseTest.prototype,"AnimationBaseTest");var AnimationCopy=function(t){function e(){var e=t.call(this)||this;return e._resources.push("resource/assets/core_element/mecha_2903_ske.json","resource/assets/core_element/mecha_2903_tex.json","resource/assets/core_element/mecha_2903_tex.png"),e}return __extends(e,t),e.prototype._onStart=function(){var t=this,e=dragonBones.EgretFactory.factory;e.parseDragonBonesData(RES.getRes("resource/assets/core_element/mecha_2903_ske.json")),e.parseTextureAtlasData(RES.getRes("resource/assets/core_element/mecha_2903_tex.json"),RES.getRes("resource/assets/core_element/mecha_2903_tex.png")),this._armatureDisplayA=e.buildArmatureDisplay("mecha_2903"),this._armatureDisplayB=e.buildArmatureDisplay("mecha_2903b"),this._armatureDisplayC=e.buildArmatureDisplay("mecha_2903c"),this._armatureDisplayD=e.buildArmatureDisplay("mecha_2903d");var a=e.getArmatureData("mecha_2903d");e.replaceAnimation(this._armatureDisplayA.armature,a),e.replaceAnimation(this._armatureDisplayB.armature,a),e.replaceAnimation(this._armatureDisplayC.armature,a),this.addChild(this._armatureDisplayA),this.addChild(this._armatureDisplayB),this.addChild(this._armatureDisplayC),this.addChild(this._armatureDisplayD),this._armatureDisplayA.x=.5*this.stageWidth-350,this._armatureDisplayA.y=.5*this.stageHeight+200,this._armatureDisplayB.x=.5*this.stageWidth,this._armatureDisplayB.y=.5*this.stageHeight+200,this._armatureDisplayC.x=.5*this.stageWidth+350,this._armatureDisplayC.y=.5*this.stageHeight+200,this._armatureDisplayD.x=.5*this.stageWidth,this._armatureDisplayD.y=.5*this.stageHeight-50,this.stage.addEventListener(egret.TouchEvent.TOUCH_END,function(){t._replaceAnimation()},this),this.createText("Click to change animation.")},e.prototype._replaceAnimation=function(){var t=this._armatureDisplayD.animation.lastAnimationName;if(t){var e=this._armatureDisplayD.animation.animationNames,a=(e.indexOf(t)+1)%e.length;this._armatureDisplayD.animation.play(e[a])}else this._armatureDisplayD.animation.play();t=this._armatureDisplayD.animation.lastAnimationName,this._armatureDisplayA.animation.play(t),this._armatureDisplayB.animation.play(t),this._armatureDisplayC.animation.play(t)},e}(BaseTest);__reflect(AnimationCopy.prototype,"AnimationCopy");var Main=function(t){function e(){var e=t.call(this)||this;return e.addChild(new BoundingBoxTest),e}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var coreElement;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e._left=!1,e._right=!1,e._bullets=[],e._resources.push("resource/assets/core_element/mecha_1502b_ske.json","resource/assets/core_element/mecha_1502b_tex.json","resource/assets/core_element/mecha_1502b_tex.png","resource/assets/core_element/skin_1502b_ske.json","resource/assets/core_element/skin_1502b_tex.json","resource/assets/core_element/skin_1502b_tex.png","resource/assets/core_element/weapon_1000_ske.json","resource/assets/core_element/weapon_1000_tex.json","resource/assets/core_element/weapon_1000_tex.png"),e}return __extends(e,t),e.prototype._onStart=function(){e.GROUND=this.stageHeight-150,e.instance=this,this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),document.addEventListener("keydown",this._keyHandler),document.addEventListener("keyup",this._keyHandler);var t=egret.sys.TouchHandler.prototype.onTouchMove;egret.sys.TouchHandler.prototype.onTouchMove=function(a,s,i){t.call(this,a,s,i),e.instance._player.aim(a,s)},this.createText("Press W/A/S/D to move. Press Q/E to switch weapons. Press SPACE to switch skin.\nMouse Move to aim. Click to fire.");var s=dragonBones.EgretFactory.factory;s.parseDragonBonesData(RES.getRes("resource/assets/core_element/mecha_1502b_ske.json")),s.parseTextureAtlasData(RES.getRes("resource/assets/core_element/mecha_1502b_tex.json"),RES.getRes("resource/assets/core_element/mecha_1502b_tex.png")),s.parseDragonBonesData(RES.getRes("resource/assets/core_element/skin_1502b_ske.json")),s.parseTextureAtlasData(RES.getRes("resource/assets/core_element/skin_1502b_tex.json"),RES.getRes("resource/assets/core_element/skin_1502b_tex.png")),s.parseDragonBonesData(RES.getRes("resource/assets/core_element/weapon_1000_ske.json")),s.parseTextureAtlasData(RES.getRes("resource/assets/core_element/weapon_1000_tex.json"),RES.getRes("resource/assets/core_element/weapon_1000_tex.png")),this._player=new a},e.prototype._touchHandler=function(t){this._player.aim(t.stageX,t.stageY),t.type===egret.TouchEvent.TOUCH_BEGIN?this._player.attack(!0):this._player.attack(!1)},e.prototype._keyHandler=function(t){var a="keydown"===t.type;switch(t.keyCode){case 37:case 65:e.instance._left=a,e.instance._updateMove(-1);break;case 39:case 68:e.instance._right=a,e.instance._updateMove(1);break;case 38:case 87:a&&e.instance._player.jump();break;case 83:case 40:e.instance._player.squat(a);break;case 81:a&&e.instance._player.switchWeaponR();break;case 69:a&&e.instance._player.switchWeaponL();break;case 32:a&&e.instance._player.switchSkin()}},e.prototype._enterFrameHandler=function(t){this._player&&this._player.update();for(var e=this._bullets.length;e--;){var a=this._bullets[e];a.update()&&this._bullets.splice(e,1)}},e.prototype._updateMove=function(t){this._left&&this._right?this._player.move(t):this._left?this._player.move(-1):this._right?this._player.move(1):this._player.move(0)},e.prototype.addBullet=function(t){this._bullets.push(t)},e.G=.6,e}(BaseTest);t.Game=e,__reflect(e.prototype,"coreElement.Game");var a=function(){function t(){this._isJumpingA=!1,this._isJumpingB=!1,this._isSquating=!1,this._isAttackingA=!1,this._isAttackingB=!1,this._weaponRIndex=0,this._weaponLIndex=0,this._skinIndex=0,this._faceDir=1,this._aimDir=0,this._moveDir=0,this._aimRadian=0,this._speedX=0,this._speedY=0,this._aimState=null,this._walkState=null,this._attackState=null,this._target=new egret.Point,this._helpPoint=new egret.Point,this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay("mecha_1502b"),this._armatureDisplay.x=.5*e.instance.stageWidth,this._armatureDisplay.y=e.GROUND,this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_IN_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.FADE_OUT_COMPLETE,this._animationEventHandler,this),this._armatureDisplay.addEventListener(dragonBones.EventObject.COMPLETE,this._animationEventHandler,this),this._armature=this._armatureDisplay.armature,this._weaponL=this._armature.getSlot("weapon_l").childArmature,this._weaponR=this._armature.getSlot("weapon_r").childArmature,this._weaponL.eventDispatcher.addDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._weaponR.eventDispatcher.addDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),e.instance.addChild(this._armatureDisplay),this._updateAnimation()}return t.prototype.move=function(t){this._moveDir!==t&&(this._moveDir=t,this._updateAnimation())},t.prototype.jump=function(){this._isJumpingA||(this._isJumpingA=!0,this._armature.animation.fadeIn("jump_1",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1,this._walkState=null)},t.prototype.squat=function(t){this._isSquating!==t&&(this._isSquating=t,this._updateAnimation())},t.prototype.attack=function(t){this._isAttackingA!==t&&(this._isAttackingA=t)},t.prototype.switchWeaponL=function(){this._weaponL.eventDispatcher.removeDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._weaponLIndex++,this._weaponLIndex%=t.WEAPON_L_LIST.length;var e=t.WEAPON_L_LIST[this._weaponLIndex];this._weaponL=dragonBones.EgretFactory.factory.buildArmature(e),this._armature.getSlot("weapon_l").childArmature=this._weaponL,this._weaponL.eventDispatcher.addDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this)},t.prototype.switchWeaponR=function(){this._weaponR.eventDispatcher.removeDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this),this._weaponRIndex++,this._weaponRIndex%=t.WEAPON_R_LIST.length;var e=t.WEAPON_R_LIST[this._weaponRIndex];this._weaponR=dragonBones.EgretFactory.factory.buildArmature(e),this._armature.getSlot("weapon_r").childArmature=this._weaponR,this._weaponR.eventDispatcher.addDBEventListener(dragonBones.EventObject.FRAME_EVENT,this._frameEventHandler,this)},t.prototype.switchSkin=function(){this._skinIndex++,this._skinIndex%=t.SKINS.length;var e=t.SKINS[this._skinIndex],a=dragonBones.EgretFactory.factory.getArmatureData(e).defaultSkin;dragonBones.EgretFactory.factory.replaceSkin(this._armature,a,!1,["weapon_l","weapon_r"])},t.prototype.aim=function(t,e){this._target.x=t,this._target.y=e},t.prototype.update=function(){this._updatePosition(),this._updateAim(),this._updateAttack()},t.prototype._animationEventHandler=function(e){switch(e.type){case dragonBones.EventObject.FADE_IN_COMPLETE:"jump_1"===e.eventObject.animationState.name&&(this._isJumpingB=!0,this._speedY=-t.JUMP_SPEED,0!==this._moveDir&&(this._moveDir*this._faceDir>0?this._speedX=t.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-t.MAX_MOVE_SPEED_BACK*this._faceDir),this._armature.animation.fadeIn("jump_2",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1);break;case dragonBones.EventObject.FADE_OUT_COMPLETE:"attack_01"===e.eventObject.animationState.name&&(this._isAttackingB=!1,this._attackState=null);break;case dragonBones.EventObject.COMPLETE:"jump_4"===e.eventObject.animationState.name&&(this._isJumpingA=!1,this._isJumpingB=!1,this._updateAnimation())}},t.prototype._frameEventHandler=function(t){"fire"===t.eventObject.name&&(t.eventObject.armature.display.localToGlobal(t.eventObject.bone.global.x,t.eventObject.bone.global.y,this._helpPoint),this._fire(this._helpPoint))},t.prototype._fire=function(t){var a=this._faceDir<0?Math.PI-this._aimRadian:this._aimRadian,i=new s("bullet_01","fire_effect_01",a+.02*Math.random()-.01,40,t);e.instance.addBullet(i)},t.prototype._updateAnimation=function(){return this._isJumpingA?void 0:this._isSquating?(this._speedX=0,this._armature.animation.fadeIn("squat",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1,void(this._walkState=null)):void(0===this._moveDir?(this._speedX=0,this._armature.animation.fadeIn("idle",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1,this._walkState=null):(null===this._walkState&&(this._walkState=this._armature.animation.fadeIn("walk",-1,-1,0,t.NORMAL_ANIMATION_GROUP),this._walkState.resetToPose=!1),this._moveDir*this._faceDir>0?this._walkState.timeScale=t.MAX_MOVE_SPEED_FRONT/t.NORMALIZE_MOVE_SPEED:this._walkState.timeScale=-t.MAX_MOVE_SPEED_BACK/t.NORMALIZE_MOVE_SPEED,this._moveDir*this._faceDir>0?this._speedX=t.MAX_MOVE_SPEED_FRONT*this._faceDir:this._speedX=-t.MAX_MOVE_SPEED_BACK*this._faceDir))},t.prototype._updatePosition=function(){0!==this._speedX&&(this._armatureDisplay.x+=this._speedX,this._armatureDisplay.x<0?this._armatureDisplay.x=0:this._armatureDisplay.x>e.instance.stageWidth&&(this._armatureDisplay.x=e.instance.stageWidth)),0!==this._speedY&&(this._speedY<5&&this._speedY+e.G>=5&&(this._armature.animation.fadeIn("jump_3",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1),this._speedY+=e.G,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.y>e.GROUND&&(this._armatureDisplay.y=e.GROUND,this._speedY=0,this._armature.animation.fadeIn("jump_4",-1,-1,0,t.NORMAL_ANIMATION_GROUP).resetToPose=!1))},t.prototype._updateAim=function(){this._faceDir=this._target.x>this._armatureDisplay.x?1:-1,this._armatureDisplay.armature.flipX!==this._faceDir<0&&(this._armatureDisplay.armature.flipX=!this._armatureDisplay.armature.flipX,0!==this._moveDir&&this._updateAnimation());var e=this._armature.getBone("chest").global.y*this._armatureDisplay.scaleY;this._faceDir>0?this._aimRadian=Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x):(this._aimRadian=Math.PI-Math.atan2(this._target.y-this._armatureDisplay.y-e,this._target.x-this._armatureDisplay.x),this._aimRadian>Math.PI&&(this._aimRadian-=2*Math.PI));var a=0;a=this._aimRadian>0?-1:1,(null===this._aimState||this._aimDir!==a)&&(this._aimDir=a,this._aimDir>=0?this._aimState=this._armature.animation.fadeIn("aim_up",-1,-1,0,t.AIM_ANIMATION_GROUP):this._aimState=this._armature.animation.fadeIn("aim_down",-1,-1,0,t.AIM_ANIMATION_GROUP),this._aimState.resetToPose=!1),this._aimState.weight=Math.abs(this._aimRadian/Math.PI*2),this._armature.invalidUpdate()},t.prototype._updateAttack=function(){this._isAttackingA&&!this._isAttackingB&&(this._isAttackingB=!0,this._attackState=this._armature.animation.fadeIn("attack_01",-1,-1,0,t.ATTACK_ANIMATION_GROUP),this._attackState.resetToPose=!1,this._attackState.autoFadeOutTime=this._attackState.fadeTotalTime)},t.JUMP_SPEED=20,t.NORMALIZE_MOVE_SPEED=3.6,t.MAX_MOVE_SPEED_FRONT=1.4*t.NORMALIZE_MOVE_SPEED,t.MAX_MOVE_SPEED_BACK=1*t.NORMALIZE_MOVE_SPEED,t.NORMAL_ANIMATION_GROUP="normal",t.AIM_ANIMATION_GROUP="aim",t.ATTACK_ANIMATION_GROUP="attack",t.WEAPON_L_LIST=["weapon_1502b_l","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d","weapon_1005e"],t.WEAPON_R_LIST=["weapon_1502b_r","weapon_1005","weapon_1005b","weapon_1005c","weapon_1005d"],t.SKINS=["mecha_1502b","skin_a","skin_b","skin_c"],t}();__reflect(a.prototype,"Mecha");var s=function(){function t(t,a,s,i,r){this._speedX=0,this._speedY=0,this._effecDisplay=null,this._speedX=Math.cos(s)*i,this._speedY=Math.sin(s)*i,this._armatureDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay(t),this._armatureDisplay.x=r.x+2*Math.random()-1,this._armatureDisplay.y=r.y+2*Math.random()-1,this._armatureDisplay.rotation=180*s/Math.PI,null!==a&&(this._effecDisplay=dragonBones.EgretFactory.factory.buildArmatureDisplay(a),this._effecDisplay.rotation=180*s/Math.PI,this._effecDisplay.x=this._armatureDisplay.x,this._effecDisplay.y=this._armatureDisplay.y,this._effecDisplay.scaleX=1+1*Math.random(),this._effecDisplay.scaleY=1+.5*Math.random(),Math.random()<.5&&(this._effecDisplay.scaleY*=-1),e.instance.addChild(this._effecDisplay),this._effecDisplay.animation.play("idle")),e.instance.addChild(this._armatureDisplay),this._armatureDisplay.animation.play("idle")}return t.prototype.update=function(){return this._armatureDisplay.x+=this._speedX,this._armatureDisplay.y+=this._speedY,this._armatureDisplay.x<-100||this._armatureDisplay.x>=e.instance.stageWidth+100||this._armatureDisplay.y<-100||this._armatureDisplay.y>=e.instance.stageHeight+100?(e.instance.removeChild(this._armatureDisplay),this._armatureDisplay.dispose(),null!==this._effecDisplay&&(e.instance.removeChild(this._effecDisplay),this._effecDisplay.dispose()),!0):!1},t}();__reflect(s.prototype,"Bullet")}(coreElement||(coreElement={}));var HelloDragonBones=function(t){function e(){var e=t.call(this)||this;return e._resources.push("resource/assets/dragon_boy_ske.dbbin","resource/assets/dragon_boy_tex.json","resource/assets/dragon_boy_tex.png"),e}return __extends(e,t),e.prototype._onStart=function(){var t=dragonBones.EgretFactory.factory;t.parseDragonBonesData(RES.getRes("resource/assets/dragon_boy_ske.dbbin")),t.parseTextureAtlasData(RES.getRes("resource/assets/dragon_boy_tex.json"),RES.getRes("resource/assets/dragon_boy_tex.png"));var e=t.buildArmatureDisplay("DragonBoy");e.animation.play("walk"),e.x=.5*this.stageWidth,e.y=.5*this.stageHeight+100,this.addChild(e)},e}(BaseTest);__reflect(HelloDragonBones.prototype,"HelloDragonBones");var PerformanceTest=function(t){function e(){var e=t.call(this)||this;return e._addingArmature=!1,e._removingArmature=!1,e._armatures=[],e._resources.push("resource/assets/dragon_boy_ske.dbbin","resource/assets/dragon_boy_tex.json","resource/assets/dragon_boy_tex.png"),e}return __extends(e,t),e.prototype._onStart=function(){this.stage.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this._touchHandler,this),this.stage.addEventListener(egret.TouchEvent.TOUCH_END,this._touchHandler,this),this._text=this.createText("");for(var t=0;300>t;++t)this._addArmature();this._resetPosition(),this._updateText()},e.prototype._enterFrameHandler=function(t){if(this._addingArmature){for(var e=0;10>e;++e)this._addArmature();this._resetPosition(),this._updateText()}if(this._removingArmature){for(var e=0;10>e;++e)this._removeArmature();this._resetPosition(),this._updateText()}},e.prototype._touchHandler=function(t){switch(t.type){case egret.TouchEvent.TOUCH_BEGIN:var e=t.stageX>.5*this.stageWidth;this._addingArmature=e,this._removingArmature=!e;break;case egret.TouchEvent.TOUCH_END:this._addingArmature=!1,this._removingArmature=!1}},e.prototype._addArmature=function(){var t=dragonBones.EgretFactory.factory;0===this._armatures.length&&(t.parseDragonBonesData(RES.getRes("resource/assets/dragon_boy_ske.dbbin")),t.parseTextureAtlasData(RES.getRes("resource/assets/dragon_boy_tex.json"),RES.getRes("resource/assets/dragon_boy_tex.png")));var e=t.buildArmatureDisplay("DragonBoy");e.armature.cacheFrameRate=24,e.animation.play("walk",0),e.scaleX=e.scaleY=.7,this.addChild(e),this._armatures.push(e)},e.prototype._removeArmature=function(){if(0!==this._armatures.length){var t=this._armatures.pop();this.removeChild(t),t.dispose(),0===this._armatures.length&&(dragonBones.EgretFactory.factory.clear(!0),dragonBones.BaseObject.clearPool())}},e.prototype._resetPosition=function(){var t=this._armatures.length;if(0!==t)for(var e=50,a=150,s=100,i=this.stageWidth-2*e,r=Math.floor(i/s),n=.5*(this.stageWidth-r*s),o=i/r,_=(this.stageHeight-2*a)/Math.ceil(t/r),h=0,l=t;l>h;++h){var p=this._armatures[h],c=Math.floor(h/r);p.x=h%r*o+n,p.y=c*_+a}},e.prototype._updateText=function(){this._text.text="Count: "+this._armatures.length+" \nTouch screen left to decrease count / right to increase count.",this._text.width=this.stageWidth,this._text.x=0,this._text.y=this.stageHeight-60,this.addChild(this._text)},e}(BaseTest);__reflect(PerformanceTest.prototype,"PerformanceTest");var ReplaceSlotDisplay=function(t){function e(){var e=t.call(this)||this;return e._displayIndex=0,e._replaceDisplays=["display0002","display0003","display0004","display0005","display0006","display0007","display0008","display0009","display0010","meshA","meshB","meshC"],e._factory=dragonBones.EgretFactory.factory,e._resources.push("resource/assets/replace_slot_display/main_ske.json","resource/assets/replace_slot_display/main_tex.json","resource/assets/replace_slot_display/main_tex.png","resource/assets/replace_slot_display/replace_ske.json","resource/assets/replace_slot_display/replace_tex.json","resource/assets/replace_slot_display/replace_tex.png"),e}return __extends(e,t),e.prototype._onStart=function(){var t=this;this._factory.parseDragonBonesData(RES.getRes("resource/assets/replace_slot_display/main_ske.json")),this._factory.parseTextureAtlasData(RES.getRes("resource/assets/replace_slot_display/main_tex.json"),RES.getRes("resource/assets/replace_slot_display/main_tex.png")),this._factory.parseDragonBonesData(RES.getRes("resource/assets/replace_slot_display/replace_ske.json")),this._factory.parseTextureAtlasData(RES.getRes("resource/assets/replace_slot_display/replace_tex.json"),RES.getRes("resource/assets/replace_slot_display/replace_tex.png")),this._armatureDisplay=this._factory.buildArmatureDisplay("MyArmature"),this._armatureDisplay.animation.timeScale=.1,this._armatureDisplay.animation.play(),this._armatureDisplay.x=.5*this.stageWidth,this._armatureDisplay.y=.5*this.stageHeight,this.addChild(this._armatureDisplay),this.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){t._replaceDisplay()},this),this.createText("Click to replace slot display.")},e.prototype._replaceDisplay=function(){this._displayIndex=(this._displayIndex+1)%this._replaceDisplays.length;var t=this._replaceDisplays[this._displayIndex];if(t.indexOf("mesh")>=0)switch(t){case"meshA":this._factory.replaceSlotDisplay("replace","MyMesh","meshA","weapon_1004_1",this._armatureDisplay.armature.getSlot("weapon")),this._factory.replaceSlotDisplay("replace","MyDisplay","ball","display0002",this._armatureDisplay.armature.getSlot("mesh"));break;case"meshB":this._factory.replaceSlotDisplay("replace","MyMesh","meshB","weapon_1004_1",this._armatureDisplay.armature.getSlot("weapon")),this._factory.replaceSlotDisplay("replace","MyDisplay","ball","display0003",this._armatureDisplay.armature.getSlot("mesh"));break;case"meshC":this._factory.replaceSlotDisplay("replace","MyMesh","mesh","weapon_1004_1",this._armatureDisplay.armature.getSlot("weapon")),this._factory.replaceSlotDisplay("replace","MyDisplay","ball","display0005",this._armatureDisplay.armature.getSlot("mesh"))}else this._factory.replaceSlotDisplay("replace","MyDisplay","ball",t,this._armatureDisplay.armature.getSlot("ball"))},e}(BaseTest);__reflect(ReplaceSlotDisplay.prototype,"ReplaceSlotDisplay");var BoundingBoxTest=function(t){function e(){var e=t.call(this)||this;return e._helpPointA=new egret.Point,e._helpPointB=new egret.Point,e._helpPointC=new egret.Point,e._resources.push("resource/assets/core_element/mecha_2903_ske.json","resource/assets/core_element/mecha_2903_tex.json","resource/assets/core_element/mecha_2903_tex.png","resource/assets/bounding_box_test_ske.json","resource/assets/bounding_box_test_tex.json","resource/assets/bounding_box_test_tex.png"),e}return __extends(e,t),e.prototype._onStart=function(){var t=dragonBones.EgretFactory.factory;t.parseDragonBonesData(RES.getRes("resource/assets/core_element/mecha_2903_ske.json")),t.parseTextureAtlasData(RES.getRes("resource/assets/core_element/mecha_2903_tex.json"),RES.getRes("resource/assets/core_element/mecha_2903_tex.png")),t.parseDragonBonesData(RES.getRes("resource/assets/bounding_box_test_ske.json")),t.parseTextureAtlasData(RES.getRes("resource/assets/bounding_box_test_tex.json"),RES.getRes("resource/assets/bounding_box_test_tex.png")),this._armatureDisplay=t.buildArmatureDisplay("mecha_2903d"),this._boundingBoxTester=t.buildArmatureDisplay("tester"),this._targetA=this._boundingBoxTester.armature.getSlot("target_a").display,this._targetB=this._boundingBoxTester.armature.getSlot("target_b").display,this._line=this._boundingBoxTester.armature.getSlot("line").display,this._pointA=this._boundingBoxTester.armature.getSlot("point_a").display,this._pointB=this._boundingBoxTester.armature.getSlot("point_b").display,this._armatureDisplay.debugDraw=!0,this._armatureDisplay.x=.5*this.stageWidth,this._armatureDisplay.y=.5*this.stageHeight,this._boundingBoxTester.x=.5*this.stageWidth,this._boundingBoxTester.y=.5*this.stageHeight+100,this._targetA.armature.inheritAnimation=!1,this._targetB.armature.inheritAnimation=!1,this._armatureDisplay.animation.play("walk"),this._boundingBoxTester.animation.play("0"),this._line.anchorOffsetX=0,this.addChild(this._armatureDisplay),this.addChild(this._boundingBoxTester),this.addEventListener(egret.Event.ENTER_FRAME,this._enterFrameHandler,this),enableDrag(this._targetA),enableDrag(this._targetB),enableDrag(this._boundingBoxTester),this.createText("Drag to move bounding box tester.")},e.prototype._enterFrameHandler=function(t){this._boundingBoxTester.localToGlobal(this._targetA.x,this._targetA.y,this._helpPointA),this._boundingBoxTester.localToGlobal(this._targetB.x,this._targetB.y,this._helpPointB),this._armatureDisplay.globalToLocal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this._armatureDisplay.globalToLocal(this._helpPointB.x,this._helpPointB.y,this._helpPointB);var e=this._armatureDisplay.armature.containsPoint(this._helpPointA.x,this._helpPointA.y),a=this._armatureDisplay.armature.containsPoint(this._helpPointB.x,this._helpPointB.y),s=this._armatureDisplay.armature.intersectsSegment(this._helpPointA.x,this._helpPointA.y,this._helpPointB.x,this._helpPointB.y,this._helpPointA,this._helpPointB,this._helpPointC),i=e?"1":"0";this._targetA.animation.lastAnimationName!==i&&(this._targetA.animation.fadeIn(i,.2).resetToPose=!1);var i=a?"1":"0";this._targetB.animation.lastAnimationName!==i&&(this._targetB.animation.fadeIn(i,.2).resetToPose=!1);var r=this._targetB.x-this._targetA.x,n=this._targetB.y-this._targetA.y;this._line.x=this._targetA.x,this._line.y=this._targetA.y,this._line.scaleX=Math.sqrt(r*r+n*n)/400,this._line.rotation=Math.atan2(n,r)*dragonBones.Transform.RAD_DEG;var i=s?"1":"0";this._boundingBoxTester.animation.lastAnimationName!==i&&(this._boundingBoxTester.animation.fadeIn(i,.2).resetToPose=!1),s?(this._armatureDisplay.localToGlobal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this._armatureDisplay.localToGlobal(this._helpPointB.x,this._helpPointB.y,this._helpPointB),this._boundingBoxTester.globalToLocal(this._helpPointA.x,this._helpPointA.y,this._helpPointA),this._boundingBoxTester.globalToLocal(this._helpPointB.x,this._helpPointB.y,this._helpPointB),this._pointA.visible=!0,this._pointB.visible=!0,this._pointA.x=this._helpPointA.x,this._pointA.y=this._helpPointA.y,this._pointB.x=this._helpPointB.x,this._pointB.y=this._helpPointB.y,this._pointA.rotation=this._helpPointC.x*dragonBones.Transform.RAD_DEG,this._pointB.rotation=this._helpPointC.y*dragonBones.Transform.RAD_DEG,this._pointA.scaleX=this._pointA.scaleY=.6,this._pointB.scaleX=this._pointB.scaleY=.6):(this._pointA.visible=!1,this._pointB.visible=!1)
},e}(BaseTest);__reflect(BoundingBoxTest.prototype,"BoundingBoxTest");